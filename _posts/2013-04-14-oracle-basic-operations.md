---
layout: post
title: Oracle基础操作
date: 2013-04-14
categories:
  - 技术
tags:
  - Oracle
---
## 创建用户，即建立表空间

<pre class="prettyprint linenums">
i@home> $ sqlplus "/as sysdba"
SQL> create user zhangsan identified by 'zhangsan';
SQL> grant dba to zhangsan;
</pre>


## 从现有的库导出表结构

假定现有一个库实例为“lisi/lisi@oracle_1”，使用exp工具从中导出所有表结构的操作，如下：
<pre class="prettyprint linenums">
i@home> mkdir -p ~/dbport && cd ~/dbport
i@home> exp lisi/lisi@oracle_1 file=lisi.dmp rows=n log=exp.log
</pre>

__如果还需要导表的数据，只需要设置rows=y即可__


## 将表结构导入到新建的库中

<pre class="prettyprint linenums">
i@home> cd ~/dbport
i@home> imp zhangsan/zhangsan@oracle_1 fromuser=lisi touser=zhangsan file=lisi.dmp log=imp.log
i@home> cd .. && rm -rf ~/dbport
</pre>


## 在库上执行指定的SQL文件

<pre class="prettyprint linenums">
i@home> sqlplus zhangsan/zhangsan@oracle_1
SQL> @ install.sql
或
SQL> start install.sql
</pre>

__如果没有指定文件的绝对路径。默认路径为当前操作目录。__

## 在sqlplus中执行数据更新操作之后，需要执行commit命令才会实时提交数据

<pre class="prettyprint linenums">
i@home> sqlplus zhangsan/zhangsan@oracle_1
SQL> update x_table set x='y';
SQL> commit;
</pre>

## 客户端环境变量配置

<pre class="prettyprint linenums">
export ORACLE_HOME=/home/oracle/product/10/db
export ORACLE_SID=orcdb
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$ORACLE_HOME/lib
export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib;
export PATH=$ORACLE_HOME/bin:$PATH
</pre>

## 查看服务器IP配置

<pre class="prettyprint linenums">
i@home> pwd
/home/oracle/product/10/db/network/admin
i@home> cat tnsnames.ora
#TNSNAMES.ORA Network Configuration File: /ora_data/oracle/u01/app/oracle/product/8.1.7.0/network/admin/tnsnames.ora
# Generated by Oracle configuration tools.

orcdb =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST =198.168.1.18)(PORT =1521))
    )
    (CONNECT_DATA =
      (SERVICE_NAME = orcdb.orc.com)
    )
  )
</pre>

## 存储过程

<pre class="prettyprint linenums">
CREATE OR REPLACE PROCEDURE test IS
 cn varchar2(20);
 vid varchar2(16);
 type c_cursor IS ref cursor;
 c_t1 c_cursor;

begin
 open c_t1 for 'select serialno from temp2';

 loop
 	fetch c_t1 into cn;
 	exit when c_t1%notfound;
 	vid :='0';
 	select dateandtime into vid from xxxx where ser=cn;
 	update temp2 set chargedate=vid where ser=cn ;
 end loop;

 close c_t1;
 commit;
 
end test;
/
</pre>

## 查看执行错误

<pre class="prettyprint linenums">
i@home> oerr ora 111 
00111, 00000, "invalid attribute %s"
// *Cause: The specified attribute was not recognized.
// *Action: Refer to the manual for the proper keyword to use to specify
//          a dispatcher attribute.

</pre>

和

<pre class="prettyprint linenums">
SQL> whow err;
SP2-0042: unknown command "whow err" - rest of line ignored.
SQL> show err;
Errors for PROCEDURE GETSERVICESCPCODE:

</pre>


## 祝大家玩的开心


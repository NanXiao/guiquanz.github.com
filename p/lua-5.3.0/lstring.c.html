<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>lstring.c - src</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>lstring.c - src</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L92">createstrobj</a></li>
<li><a href="#L122">internshrstr</a></li>
<li><a href="#L38">luaS_eqlngstr</a></li>
<li><a href="#L47">luaS_hash</a></li>
<li><a href="#L165">luaS_new</a></li>
<li><a href="#L151">luaS_newlstr</a></li>
<li><a href="#L170">luaS_newudata</a></li>
<li><a href="#L109">luaS_remove</a></li>
<li><a href="#L60">luaS_resize</a></li>
</ul>
 <h4>Macros defined</h4>
 <ul>
<li><a href="#L31">LUAI_HASHLIMIT</a></li>
<li><a href="#L8">LUA_CORE</a></li>
<li><a href="#L7">lstring_c</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** $Id: lstring.c,v 2.45 2014/11/02 19:19:04 roberto Exp $<br/></li>
<li></span><span class="Comment">** String table (keeps all strings handled by Lua)<br/></li>
<li></span><span class="Comment">** See Copyright Notice in lua.h<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><a id="L7">&#x200c;</a><span class="PreProc">#define <span class="linkable">lstring_c</span><br/></li>
<li><a id="L8">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">LUA_CORE</span><br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lprefix.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;string.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lua.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;ldebug.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;ldo.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lmem.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lobject.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lstate.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lstring.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** Lua will use at most ~(2^<a href="#L31" title="lstring.c:31">LUAI_HASHLIMIT</a>) bytes from a string to<br/></li>
<li></span><span class="Comment">** compute its hash<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><span class="PreProc">#if !defined(<a href="#L31" title="lstring.c:31">LUAI_HASHLIMIT</a>)<br/></li>
<li><a id="L31">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">LUAI_HASHLIMIT</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">5<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** equality for long strings<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L38">&#x200c;</a></span><span class="Type">int</span> <span class="linkable">luaS_eqlngstr</span> (<a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *a, <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *b) {<br/></li>
<li>&nbsp; <span class="Type">size_t</span> len = a-&gt;len;<br/></li>
<li>&nbsp; <a href="lualib.h.html#L54" title="lualib.h:54">lua_assert</a>(a-&gt;tt == <a href="lobject.h.html#L56" title="lobject.h:56">LUA_TLNGSTR</a> &amp;&amp; b-&gt;tt == <a href="lobject.h.html#L56" title="lobject.h:56">LUA_TLNGSTR</a>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> (a == b) ||&nbsp; <span class="Comment">/* same instance or... */<br/></li>
<li></span>&nbsp; &nbsp; ((len == b-&gt;len) &amp;&amp;&nbsp; <span class="Comment">/* equal length and ... */<br/></li>
<li></span>&nbsp; &nbsp;&nbsp; (memcmp(<a href="lobject.h.html#L326" title="lobject.h:326">getstr</a>(a), <a href="lobject.h.html#L326" title="lobject.h:326">getstr</a>(b), len) == <span class="Constant">0</span>));&nbsp; <span class="Comment">/* equal contents */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L47">&#x200c;</a><span class="Type">unsigned</span> <span class="Type">int</span> <span class="linkable">luaS_hash</span> (<span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type">size_t</span> l, <span class="Type">unsigned</span> <span class="Type">int</span> seed) {<br/></li>
<li>&nbsp; <span class="Type">unsigned</span> <span class="Type">int</span> h = seed ^ <a href="llimits.h.html#L107" title="llimits.h:107">cast</a>(<span class="Type">unsigned</span> <span class="Type">int</span>, l);<br/></li>
<li>&nbsp; <span class="Type">size_t</span> l1;<br/></li>
<li>&nbsp; <span class="Type">size_t</span> step = (l &gt;&gt; <a href="#L31" title="lstring.c:31">LUAI_HASHLIMIT</a>) + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; <span class="Statement">for</span> (l1 = l; l1 &gt;= step; l1 -= step)<br/></li>
<li>&nbsp; &nbsp; h = h ^ ((h&lt;&lt;<span class="Constant">5</span>) + (h&gt;&gt;<span class="Constant">2</span>) + <a href="llimits.h.html#L110" title="llimits.h:110">cast_byte</a>(str[l1 - <span class="Constant">1</span>]));<br/></li>
<li>&nbsp; <span class="Statement">return</span> h;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** resizes the string table<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L60">&#x200c;</a></span><span class="Type">void</span> <span class="linkable">luaS_resize</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> newsize) {<br/></li>
<li>&nbsp; <span class="Type">int</span> i;<br/></li>
<li>&nbsp; <a href="lstate.h.html#L49" title="lstate.h:49">stringtable</a> *tb = &amp;<a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;strt;<br/></li>
<li>&nbsp; <span class="Statement">if</span> (newsize &gt; tb-&gt;size) {&nbsp; <span class="Comment">/* grow table if needed */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lmem.h.html#L56" title="lmem.h:56">luaM_reallocvector</a>(L, tb-&gt;hash, tb-&gt;size, newsize, <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = tb-&gt;size; i &lt; newsize; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; tb-&gt;hash[i] = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; tb-&gt;size; i++) {&nbsp; <span class="Comment">/* <a href="ltable.c.html#L378" title="ltable.c:378">rehash</a> */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *p = tb-&gt;hash[i];<br/></li>
<li>&nbsp; &nbsp; tb-&gt;hash[i] = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (p) {&nbsp; <span class="Comment">/* for each node in the list */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *hnext = p-&gt;hnext;&nbsp; <span class="Comment">/* <a href="llex.c.html#L56" title="llex.c:56">save</a> <a href="llex.c.html#L31" title="llex.c:31">next</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">int</span> h = <a href="lobject.h.html#L505" title="lobject.h:505">lmod</a>(p-&gt;hash, newsize);&nbsp; <span class="Comment">/* new position */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; p-&gt;hnext = tb-&gt;hash[h];&nbsp; <span class="Comment">/* chain it */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; tb-&gt;hash[h] = p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; p = hnext;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">if</span> (newsize &lt; tb-&gt;size) {&nbsp; <span class="Comment">/* shrink table if needed */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* vanishing slice should be empty */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lualib.h.html#L54" title="lualib.h:54">lua_assert</a>(tb-&gt;hash[newsize] == <span class="Constant">NULL</span> &amp;&amp; tb-&gt;hash[tb-&gt;size - <span class="Constant">1</span>] == <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="lmem.h.html#L56" title="lmem.h:56">luaM_reallocvector</a>(L, tb-&gt;hash, tb-&gt;size, newsize, <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; tb-&gt;size = newsize;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** creates a new string object<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L92">&#x200c;</a></span><span class="Type">static</span> <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *<span class="linkable">createstrobj</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type">size_t</span> l,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> tag, <span class="Type">unsigned</span> <span class="Type">int</span> h) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *ts;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L87" title="lobject.h:87">GCObject</a> *o;<br/></li>
<li>&nbsp; <span class="Type">size_t</span> totalsize;&nbsp; <span class="Comment">/* total size of <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> object */<br/></li>
<li></span>&nbsp; totalsize = <a href="lstring.h.html#L15" title="lstring.h:15">sizelstring</a>(l);<br/></li>
<li>&nbsp; o = <a href="lgc.c.html#L198" title="lgc.c:198">luaC_newobj</a>(L, tag, totalsize);<br/></li>
<li>&nbsp; ts = <a href="lstate.h.html#L195" title="lstate.h:195">gco2ts</a>(o);<br/></li>
<li>&nbsp; ts-&gt;len = l;<br/></li>
<li>&nbsp; ts-&gt;hash = h;<br/></li>
<li>&nbsp; ts-&gt;extra = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; memcpy(<a href="lobject.h.html#L325" title="lobject.h:325">getaddrstr</a>(ts), str, l * <span class="Statement">sizeof</span>(<span class="Type">char</span>));<br/></li>
<li>&nbsp; <a href="lobject.h.html#L325" title="lobject.h:325">getaddrstr</a>(ts)[l] = <span class="Special">'\0'</span>;&nbsp; <span class="Comment">/* ending 0 */<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> ts;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L109">&#x200c;</a><span class="Type">void</span> <span class="linkable">luaS_remove</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *ts) {<br/></li>
<li>&nbsp; <a href="lstate.h.html#L49" title="lstate.h:49">stringtable</a> *tb = &amp;<a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;strt;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> **p = &amp;tb-&gt;hash[<a href="lobject.h.html#L505" title="lobject.h:505">lmod</a>(ts-&gt;hash, tb-&gt;size)];<br/></li>
<li>&nbsp; <span class="Statement">while</span> (*p != ts)&nbsp; <span class="Comment">/* find previous element */<br/></li>
<li></span>&nbsp; &nbsp; p = &amp;(*p)-&gt;hnext;<br/></li>
<li>&nbsp; *p = (*p)-&gt;hnext;&nbsp; <span class="Comment">/* remove element from its list */<br/></li>
<li></span>&nbsp; tb-&gt;nuse--;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** checks whether short string exists and reuses it or creates a new one<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L122">&#x200c;</a></span><span class="Type">static</span> <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *<span class="linkable">internshrstr</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type">size_t</span> l) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *ts;<br/></li>
<li>&nbsp; <a href="lstate.h.html#L108" title="lstate.h:108">global_State</a> *g = <a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L);<br/></li>
<li>&nbsp; <span class="Type">unsigned</span> <span class="Type">int</span> h = <a href="#L47" title="lstring.c:47">luaS_hash</a>(str, l, g-&gt;seed);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> **list = &amp;g-&gt;strt.hash[<a href="lobject.h.html#L505" title="lobject.h:505">lmod</a>(h, g-&gt;strt.size)];<br/></li>
<li>&nbsp; <span class="Statement">for</span> (ts = *list; ts != <span class="Constant">NULL</span>; ts = ts-&gt;hnext) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (l == ts-&gt;len &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (memcmp(str, <a href="lobject.h.html#L326" title="lobject.h:326">getstr</a>(ts), l * <span class="Statement">sizeof</span>(<span class="Type">char</span>)) == <span class="Constant">0</span>)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Comment">/* found! */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="lgc.h.html#L96" title="lgc.h:96">isdead</a>(g, ts))&nbsp; <span class="Comment">/* dead (but not collected yet)? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="lgc.h.html#L98" title="lgc.h:98">changewhite</a>(ts);&nbsp; <span class="Comment">/* resurrect it */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> ts;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">if</span> (g-&gt;strt.nuse &gt;= g-&gt;strt.size &amp;&amp; g-&gt;strt.size &lt;= <a href="llimits.h.html#L51" title="llimits.h:51">MAX_INT</a>/<span class="Constant">2</span>) {<br/></li>
<li>&nbsp; &nbsp; <a href="#L60" title="lstring.c:60">luaS_resize</a>(L, g-&gt;strt.size * <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; list = &amp;g-&gt;strt.hash[<a href="lobject.h.html#L505" title="lobject.h:505">lmod</a>(h, g-&gt;strt.size)];&nbsp; <span class="Comment">/* recompute with new size */<br/></li>
<li></span>&nbsp; }<br/></li>
<li>&nbsp; ts = <a href="#L92" title="lstring.c:92">createstrobj</a>(L, str, l, <a href="lobject.h.html#L55" title="lobject.h:55">LUA_TSHRSTR</a>, h);<br/></li>
<li>&nbsp; ts-&gt;hnext = *list;<br/></li>
<li>&nbsp; *list = ts;<br/></li>
<li>&nbsp; g-&gt;strt.nuse++;<br/></li>
<li>&nbsp; <span class="Statement">return</span> ts;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** new string (with explicit length)<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L151">&#x200c;</a></span><a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *<span class="linkable">luaS_newlstr</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">const</span> <span class="Type">char</span> *str, <span class="Type">size_t</span> l) {<br/></li>
<li>&nbsp; <span class="Statement">if</span> (l &lt;= <a href="luaconf.h.html#L700" title="luaconf.h:700">LUAI_MAXSHORTLEN</a>)&nbsp; <span class="Comment">/* short string? */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L122" title="lstring.c:122">internshrstr</a>(L, str, l);<br/></li>
<li>&nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (l + <span class="Constant">1</span> &gt; (<a href="llimits.h.html#L42" title="llimits.h:42">MAX_SIZE</a> - <span class="Statement">sizeof</span>(<a href="lobject.h.html#L303" title="lobject.h:303">TString</a>))/<span class="Statement">sizeof</span>(<span class="Type">char</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lmem.c.html#L68" title="lmem.c:68">luaM_toobig</a>(L);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L92" title="lstring.c:92">createstrobj</a>(L, str, l, <a href="lobject.h.html#L56" title="lobject.h:56">LUA_TLNGSTR</a>, <a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;seed);<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** new zero-terminated string<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L165">&#x200c;</a></span><a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *<span class="linkable">luaS_new</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">const</span> <span class="Type">char</span> *str) {<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L151" title="lstring.c:151">luaS_newlstr</a>(L, str, strlen(str));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L170">&#x200c;</a><a href="lobject.h.html#L337" title="lobject.h:337">Udata</a> *<span class="linkable">luaS_newudata</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">size_t</span> s) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L337" title="lobject.h:337">Udata</a> *u;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L87" title="lobject.h:87">GCObject</a> *o;<br/></li>
<li>&nbsp; <span class="Statement">if</span> (s &gt; <a href="llimits.h.html#L42" title="llimits.h:42">MAX_SIZE</a> - <span class="Statement">sizeof</span>(<a href="lobject.h.html#L337" title="lobject.h:337">Udata</a>))<br/></li>
<li>&nbsp; &nbsp; <a href="lmem.c.html#L68" title="lmem.c:68">luaM_toobig</a>(L);<br/></li>
<li>&nbsp; o = <a href="lgc.c.html#L198" title="lgc.c:198">luaC_newobj</a>(L, <a href="lua.h.html#L69" title="lua.h:69">LUA_TUSERDATA</a>, <a href="lstring.h.html#L18" title="lstring.h:18">sizeludata</a>(s));<br/></li>
<li>&nbsp; u = <a href="lstate.h.html#L197" title="lstate.h:197">gco2u</a>(o);<br/></li>
<li>&nbsp; u-&gt;len = s;<br/></li>
<li>&nbsp; u-&gt;metatable = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L362" title="lobject.h:362">setuservalue</a>(L, u, <a href="lobject.h.html#L516" title="lobject.h:516">luaO_nilobject</a>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> u;<br/></li>
<li>}<br/></li>
<li><br/></li>
</ol></code>
 </body>
</html>

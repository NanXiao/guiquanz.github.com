<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>lbaselib.c - src</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>lbaselib.c - src</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Global variables defined</h4>
 <ul>
<li><a href="#L469">base_funcs</a></li>
</ul>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L48">b_str2int</a></li>
<li><a href="#L372">dofilecont</a></li>
<li><a href="#L424">finishpcall</a></li>
<li><a href="#L333">generic_reader</a></li>
<li><a href="#L259">ipairsaux</a></li>
<li><a href="#L248">ipairsaux_raw</a></li>
<li><a href="#L286">load_aux</a></li>
<li><a href="#L388">luaB_assert</a></li>
<li><a href="#L173">luaB_collectgarbage</a></li>
<li><a href="#L378">luaB_dofile</a></li>
<li><a href="#L102">luaB_error</a></li>
<li><a href="#L114">luaB_getmetatable</a></li>
<li><a href="#L271">luaB_ipairs</a></li>
<li><a href="#L350">luaB_load</a></li>
<li><a href="#L303">luaB_loadfile</a></li>
<li><a href="#L228">luaB_next</a></li>
<li><a href="#L240">luaB_pairs</a></li>
<li><a href="#L435">luaB_pcall</a></li>
<li><a href="#L24">luaB_print</a></li>
<li><a href="#L138">luaB_rawequal</a></li>
<li><a href="#L155">luaB_rawget</a></li>
<li><a href="#L146">luaB_rawlen</a></li>
<li><a href="#L163">luaB_rawset</a></li>
<li><a href="#L401">luaB_select</a></li>
<li><a href="#L125">luaB_setmetatable</a></li>
<li><a href="#L69">luaB_tonumber</a></li>
<li><a href="#L462">luaB_tostring</a></li>
<li><a href="#L204">luaB_type</a></li>
<li><a href="#L450">luaB_xpcall</a></li>
<li><a href="#L502">luaopen_base</a></li>
<li><a href="#L211">pairsmeta</a></li>
</ul>
 <h4>Macros defined</h4>
 <ul>
<li><a href="#L8">LUA_LIB</a></li>
<li><a href="#L324">RESERVEDSLOT</a></li>
<li><a href="#L46">SPACECHARS</a></li>
<li><a href="#L7">lbaselib_c</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** $Id: lbaselib.c,v 1.309 2014/12/10 12:26:42 roberto Exp $<br/></li>
<li></span><span class="Comment">** Basic library<br/></li>
<li></span><span class="Comment">** See Copyright Notice in lua.h<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><a id="L7">&#x200c;</a><span class="PreProc">#define <span class="linkable">lbaselib_c</span><br/></li>
<li><a id="L8">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">LUA_LIB</span><br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lprefix.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;ctype.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;stdio.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;stdlib.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;string.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lua.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lauxlib.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lualib.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L24">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_print</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">int</span> n = <a href="lapi.c.html#L166" title="lapi.c:166">lua_gettop</a>(L);&nbsp; <span class="Comment">/* number of arguments */<br/></li>
<li></span>&nbsp; <span class="Type">int</span> i;<br/></li>
<li>&nbsp; <a href="lapi.c.html#L581" title="lapi.c:581">lua_getglobal</a>(L, <span class="Constant">&quot;<a href="lvm.c.html#L354" title="lvm.c:354">tostring</a>&quot;</span>);<br/></li>
<li>&nbsp; <span class="Statement">for</span> (i=<span class="Constant">1</span>; i&lt;=n; i++) {<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *s;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span> l;<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, -<span class="Constant">1</span>);&nbsp; <span class="Comment">/* function to be called */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, i);&nbsp;&nbsp; <span class="Comment">/* value to print */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lua.h.html#L272" title="lua.h:272">lua_call</a>(L, <span class="Constant">1</span>, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; s = <a href="lapi.c.html#L372" title="lapi.c:372">lua_tolstring</a>(L, -<span class="Constant">1</span>, &amp;l);&nbsp; <span class="Comment">/* get result */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (s == <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="lauxlib.c.html#L212" title="lauxlib.c:212">luaL_error</a>(L, <span class="Constant">&quot;'<a href="lvm.c.html#L354" title="lvm.c:354">tostring</a>' must return a string to 'print'&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (i&gt;<span class="Constant">1</span>) <a href="lauxlib.h.html#L215" title="lauxlib.h:215">lua_writestring</a>(<span class="Constant">&quot;</span><span class="Special">\t</span><span class="Constant">&quot;</span>, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="lauxlib.h.html#L215" title="lauxlib.h:215">lua_writestring</a>(s, l);<br/></li>
<li>&nbsp; &nbsp; <a href="lua.h.html#L342" title="lua.h:342">lua_pop</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* pop result */<br/></li>
<li></span>&nbsp; }<br/></li>
<li>&nbsp; <a href="lauxlib.h.html#L220" title="lauxlib.h:220">lua_writeline</a>();<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L46">&#x200c;</a><span class="PreProc">#define <span class="linkable">SPACECHARS</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot; </span><span class="Special">\f\n\r\t\v</span><span class="Constant">&quot;<br/></li>
<li></span><br/></li>
<li><a id="L48">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="linkable">b_str2int</span> (<span class="Type">const</span> <span class="Type">char</span> *s, <span class="Type">int</span> base, <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> *pn) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> n = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; <span class="Type">int</span> neg = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; s += strspn(s, <a href="#L46" title="lbaselib.c:46">SPACECHARS</a>);&nbsp; <span class="Comment">/* skip initial spaces */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (*s == <span class="Constant">'-'</span>) { s++; neg = <span class="Constant">1</span>; }&nbsp; <span class="Comment">/* handle signal */<br/></li>
<li></span>&nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*s == <span class="Constant">'+'</span>) s++;<br/></li>
<li>&nbsp; <span class="Statement">if</span> (!isalnum((<span class="Type">unsigned</span> <span class="Type">char</span>)*s))&nbsp; <span class="Comment">/* no <a href="lstrlib.c.html#L1029" title="lstrlib.c:1029">digit</a>? */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span> <a href="lstrlib.c.html#L1029" title="lstrlib.c:1029">digit</a> = (isdigit((<span class="Type">unsigned</span> <span class="Type">char</span>)*s)) ? *s - <span class="Constant">'0'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; : toupper((<span class="Type">unsigned</span> <span class="Type">char</span>)*s) - <span class="Constant">'A'</span> + <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="lstrlib.c.html#L1029" title="lstrlib.c:1029">digit</a> &gt;= base) <span class="Statement">return</span> <span class="Constant">NULL</span>;&nbsp; <span class="Comment">/* invalid numeral */<br/></li>
<li></span>&nbsp; &nbsp; n = n * base + <a href="lstrlib.c.html#L1029" title="lstrlib.c:1029">digit</a>;<br/></li>
<li>&nbsp; &nbsp; s++;<br/></li>
<li>&nbsp; } <span class="Statement">while</span> (isalnum((<span class="Type">unsigned</span> <span class="Type">char</span>)*s));<br/></li>
<li>&nbsp; s += strspn(s, <a href="#L46" title="lbaselib.c:46">SPACECHARS</a>);&nbsp; <span class="Comment">/* skip trailing spaces */<br/></li>
<li></span>&nbsp; *pn = (<a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a>)((neg) ? (<span class="Constant">0u</span> - n) : n);<br/></li>
<li>&nbsp; <span class="Statement">return</span> s;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L69">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_tonumber</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="lua.h.html#L357" title="lua.h:357">lua_isnoneornil</a>(L, <span class="Constant">2</span>)) {&nbsp; <span class="Comment">/* standard conversion? */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lauxlib.c.html#L368" title="lauxlib.c:368">luaL_checkany</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="lapi.c.html#L250" title="lapi.c:250">lua_type</a>(L, <span class="Constant">1</span>) == <a href="lua.h.html#L65" title="lua.h:65">LUA_TNUMBER</a>) {&nbsp; <span class="Comment">/* already a number? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="lapi.c.html#L171" title="lapi.c:171">lua_settop</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* yes; return it */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Type">size_t</span> l;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *s = <a href="lapi.c.html#L372" title="lapi.c:372">lua_tolstring</a>(L, <span class="Constant">1</span>, &amp;l);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s != <span class="Constant">NULL</span> &amp;&amp; <a href="lapi.c.html#L336" title="lapi.c:336">lua_stringtonumber</a>(L, s) == l + <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;&nbsp; <span class="Comment">/* successful conversion to number */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">/* else not a number */<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span> l;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *s;<br/></li>
<li>&nbsp; &nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> n = <span class="Constant">0</span>;&nbsp; <span class="Comment">/* to avoid warnings */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> base = <a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="lauxlib.c.html#L362" title="lauxlib.c:362">luaL_checktype</a>(L, <span class="Constant">1</span>, <a href="lua.h.html#L66" title="lua.h:66">LUA_TSTRING</a>);&nbsp; <span class="Comment">/* before '<a href="lauxlib.c.html#L374" title="lauxlib.c:374">luaL_checklstring</a>'! */<br/></li>
<li></span>&nbsp; &nbsp; s = <a href="lauxlib.c.html#L374" title="lauxlib.c:374">luaL_checklstring</a>(L, <span class="Constant">1</span>, &amp;l);<br/></li>
<li>&nbsp; &nbsp; <a href="lauxlib.h.html#L114" title="lauxlib.h:114">luaL_argcheck</a>(L, <span class="Constant">2</span> &lt;= base &amp;&amp; base &lt;= <span class="Constant">36</span>, <span class="Constant">2</span>, <span class="Constant">&quot;base out of range&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L48" title="lbaselib.c:48">b_str2int</a>(s, (<span class="Type">int</span>)base, &amp;n) == s + l) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lapi.c.html#L464" title="lapi.c:464">lua_pushinteger</a>(L, n);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }&nbsp; <span class="Comment">/* else not a number */<br/></li>
<li></span>&nbsp; }&nbsp; <span class="Comment">/* else not a number */<br/></li>
<li></span>&nbsp; <a href="lapi.c.html#L448" title="lapi.c:448">lua_pushnil</a>(L);&nbsp; <span class="Comment">/* not a number */<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L102">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_error</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">int</span> level = (<span class="Type">int</span>)<a href="lauxlib.c.html#L424" title="lauxlib.c:424">luaL_optinteger</a>(L, <span class="Constant">2</span>, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L171" title="lapi.c:171">lua_settop</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="lapi.c.html#L282" title="lapi.c:282">lua_isstring</a>(L, <span class="Constant">1</span>) &amp;&amp; level &gt; <span class="Constant">0</span>) {&nbsp; <span class="Comment">/* add extra information? */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lauxlib.c.html#L199" title="lauxlib.c:199">luaL_where</a>(L, level);<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.c.html#L1111" title="lapi.c:1111">lua_concat</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="lapi.c.html#L1085" title="lapi.c:1085">lua_error</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L114">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_getmetatable</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L368" title="lauxlib.c:368">luaL_checkany</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (!<a href="lapi.c.html#L677" title="lapi.c:677">lua_getmetatable</a>(L, <span class="Constant">1</span>)) {<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.c.html#L448" title="lapi.c:448">lua_pushnil</a>(L);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;&nbsp; <span class="Comment">/* no metatable */<br/></li>
<li></span>&nbsp; }<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L710" title="lauxlib.c:710">luaL_getmetafield</a>(L, <span class="Constant">1</span>, <span class="Constant">&quot;__metatable&quot;</span>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;&nbsp; <span class="Comment">/* returns either __metatable <a href="lparser.c.html#L696" title="lparser.c:696">field</a> (if present) or metatable */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L125">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_setmetatable</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">int</span> t = <a href="lapi.c.html#L250" title="lapi.c:250">lua_type</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L362" title="lauxlib.c:362">luaL_checktype</a>(L, <span class="Constant">1</span>, <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a>);<br/></li>
<li>&nbsp; <a href="lauxlib.h.html#L114" title="lauxlib.h:114">luaL_argcheck</a>(L, t == <a href="lua.h.html#L62" title="lua.h:62">LUA_TNIL</a> || t == <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a>, <span class="Constant">2</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;nil or table expected&quot;</span>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="lauxlib.c.html#L710" title="lauxlib.c:710">luaL_getmetafield</a>(L, <span class="Constant">1</span>, <span class="Constant">&quot;__metatable&quot;</span>) != <a href="lua.h.html#L62" title="lua.h:62">LUA_TNIL</a>)<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="lauxlib.c.html#L212" title="lauxlib.c:212">luaL_error</a>(L, <span class="Constant">&quot;<a href="luac.c.html#L44" title="luac.c:44">cannot</a> change a protected metatable&quot;</span>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L171" title="lapi.c:171">lua_settop</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L817" title="lapi.c:817">lua_setmetatable</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L138">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_rawequal</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L368" title="lauxlib.c:368">luaL_checkany</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L368" title="lauxlib.c:368">luaL_checkany</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L550" title="lapi.c:550">lua_pushboolean</a>(L, <a href="lapi.c.html#L294" title="lapi.c:294">lua_rawequal</a>(L, <span class="Constant">1</span>, <span class="Constant">2</span>));<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L146">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_rawlen</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">int</span> t = <a href="lapi.c.html#L250" title="lapi.c:250">lua_type</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="lauxlib.h.html#L114" title="lauxlib.h:114">luaL_argcheck</a>(L, t == <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a> || t == <a href="lua.h.html#L66" title="lua.h:66">LUA_TSTRING</a>, <span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;table or string expected&quot;</span>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L464" title="lapi.c:464">lua_pushinteger</a>(L, <a href="lapi.c.html#L390" title="lapi.c:390">lua_rawlen</a>(L, <span class="Constant">1</span>));<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L155">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_rawget</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L362" title="lauxlib.c:362">luaL_checktype</a>(L, <span class="Constant">1</span>, <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a>);<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L368" title="lauxlib.c:368">luaL_checkany</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L171" title="lapi.c:171">lua_settop</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L627" title="lapi.c:627">lua_rawget</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L163">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_rawset</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L362" title="lauxlib.c:362">luaL_checktype</a>(L, <span class="Constant">1</span>, <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a>);<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L368" title="lauxlib.c:368">luaL_checkany</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L368" title="lauxlib.c:368">luaL_checkany</a>(L, <span class="Constant">3</span>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L171" title="lapi.c:171">lua_settop</a>(L, <span class="Constant">3</span>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L769" title="lapi.c:769">lua_rawset</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L173">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_collectgarbage</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="Type">const</span> opts[] = {<span class="Constant">&quot;stop&quot;</span>, <span class="Constant">&quot;restart&quot;</span>, <span class="Constant">&quot;collect&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">&quot;count&quot;</span>, <span class="Constant">&quot;step&quot;</span>, <span class="Constant">&quot;<a href="lgc.c.html#L920" title="lgc.c:920">setpause</a>&quot;</span>, <span class="Constant">&quot;setstepmul&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">&quot;isrunning&quot;</span>, <span class="Constant">NULL</span>};<br/></li>
<li>&nbsp; <span class="Type">static</span> <span class="Type">const</span> <span class="Type">int</span> optsnum[] = {<a href="lua.h.html#L300" title="lua.h:300">LUA_GCSTOP</a>, <a href="lua.h.html#L301" title="lua.h:301">LUA_GCRESTART</a>, <a href="lua.h.html#L302" title="lua.h:302">LUA_GCCOLLECT</a>,<br/></li>
<li>&nbsp; &nbsp; <a href="lua.h.html#L303" title="lua.h:303">LUA_GCCOUNT</a>, <a href="lua.h.html#L305" title="lua.h:305">LUA_GCSTEP</a>, <a href="lua.h.html#L306" title="lua.h:306">LUA_GCSETPAUSE</a>, <a href="lua.h.html#L307" title="lua.h:307">LUA_GCSETSTEPMUL</a>,<br/></li>
<li>&nbsp; &nbsp; <a href="lua.h.html#L308" title="lua.h:308">LUA_GCISRUNNING</a>};<br/></li>
<li>&nbsp; <span class="Type">int</span> o = optsnum[<a href="lauxlib.c.html#L337" title="lauxlib.c:337">luaL_checkoption</a>(L, <span class="Constant">1</span>, <span class="Constant">&quot;collect&quot;</span>, opts)];<br/></li>
<li>&nbsp; <span class="Type">int</span> ex = (<span class="Type">int</span>)<a href="lauxlib.c.html#L424" title="lauxlib.c:424">luaL_optinteger</a>(L, <span class="Constant">2</span>, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; <span class="Type">int</span> res = <a href="lapi.c.html#L1011" title="lapi.c:1011">lua_gc</a>(L, o, ex);<br/></li>
<li>&nbsp; <span class="Statement">switch</span> (o) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L303" title="lua.h:303">LUA_GCCOUNT</a>: {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Type">int</span> b = <a href="lapi.c.html#L1011" title="lapi.c:1011">lua_gc</a>(L, <a href="lua.h.html#L304" title="lua.h:304">LUA_GCCOUNTB</a>, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lapi.c.html#L456" title="lapi.c:456">lua_pushnumber</a>(L, (<a href="lua.h.html#L87" title="lua.h:87">lua_Number</a>)res + ((<a href="lua.h.html#L87" title="lua.h:87">lua_Number</a>)b/<span class="Constant">1024</span>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L305" title="lua.h:305">LUA_GCSTEP</a>: <span class="Statement">case</span> <a href="lua.h.html#L308" title="lua.h:308">LUA_GCISRUNNING</a>: {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lapi.c.html#L550" title="lapi.c:550">lua_pushboolean</a>(L, res);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lapi.c.html#L464" title="lapi.c:464">lua_pushinteger</a>(L, res);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** This function has all type names as upvalues, to maximize performance.<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L204">&#x200c;</a></span><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_type</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L368" title="lauxlib.c:368">luaL_checkany</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, <a href="lua.h.html#L41" title="lua.h:41">lua_upvalueindex</a>(<a href="lapi.c.html#L250" title="lapi.c:250">lua_type</a>(L, <span class="Constant">1</span>) + <span class="Constant">1</span>));<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L211">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">pairsmeta</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">const</span> <span class="Type">char</span> *method, <span class="Type">int</span> iszero,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="lua.h.html#L103" title="lua.h:103">lua_CFunction</a> iter) {<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="lauxlib.c.html#L710" title="lauxlib.c:710">luaL_getmetafield</a>(L, <span class="Constant">1</span>, method) == <a href="lua.h.html#L62" title="lua.h:62">LUA_TNIL</a>) {&nbsp; <span class="Comment">/* no metamethod? */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lauxlib.c.html#L362" title="lauxlib.c:362">luaL_checktype</a>(L, <span class="Constant">1</span>, <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a>);&nbsp; <span class="Comment">/* argument must be a table */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lua.h.html#L348" title="lua.h:348">lua_pushcfunction</a>(L, iter);&nbsp; <span class="Comment">/* will return generator, */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* state, */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (iszero) <a href="lapi.c.html#L464" title="lapi.c:464">lua_pushinteger</a>(L, <span class="Constant">0</span>);&nbsp; <span class="Comment">/* and initial value */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> <a href="lapi.c.html#L448" title="lapi.c:448">lua_pushnil</a>(L);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* argument 'self' to metamethod */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lua.h.html#L272" title="lua.h:272">lua_call</a>(L, <span class="Constant">1</span>, <span class="Constant">3</span>);&nbsp; <span class="Comment">/* get 3 values from metamethod */<br/></li>
<li></span>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">3</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L228">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_next</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L362" title="lauxlib.c:362">luaL_checktype</a>(L, <span class="Constant">1</span>, <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L171" title="lapi.c:171">lua_settop</a>(L, <span class="Constant">2</span>);&nbsp; <span class="Comment">/* create a 2nd argument if there isn't one */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (<a href="lapi.c.html#L1094" title="lapi.c:1094">lua_next</a>(L, <span class="Constant">1</span>))<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">2</span>;<br/></li>
<li>&nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.c.html#L448" title="lapi.c:448">lua_pushnil</a>(L);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L240">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_pairs</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L211" title="lbaselib.c:211">pairsmeta</a>(L, <span class="Constant">&quot;__pairs&quot;</span>, <span class="Constant">0</span>, <a href="#L228" title="lbaselib.c:228">luaB_next</a>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** Traversal function for 'ipairs' for raw tables<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L248">&#x200c;</a></span><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">ipairsaux_raw</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> i = <a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>(L, <span class="Constant">2</span>) + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L362" title="lauxlib.c:362">luaL_checktype</a>(L, <span class="Constant">1</span>, <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L464" title="lapi.c:464">lua_pushinteger</a>(L, i);<br/></li>
<li>&nbsp; <span class="Statement">return</span> (<a href="lapi.c.html#L638" title="lapi.c:638">lua_rawgeti</a>(L, <span class="Constant">1</span>, i) == <a href="lua.h.html#L62" title="lua.h:62">LUA_TNIL</a>) ? <span class="Constant">1</span> : <span class="Constant">2</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** Traversal function for 'ipairs' for tables with metamethods<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L259">&#x200c;</a></span><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">ipairsaux</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> i = <a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>(L, <span class="Constant">2</span>) + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; <a href="lapi.c.html#L464" title="lapi.c:464">lua_pushinteger</a>(L, i);<br/></li>
<li>&nbsp; <span class="Statement">return</span> (<a href="lapi.c.html#L615" title="lapi.c:615">lua_geti</a>(L, <span class="Constant">1</span>, i) == <a href="lua.h.html#L62" title="lua.h:62">LUA_TNIL</a>) ? <span class="Constant">1</span> : <span class="Constant">2</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** This function will use either '<a href="#L259" title="lbaselib.c:259">ipairsaux</a>' or '<a href="#L248" title="lbaselib.c:248">ipairsaux_raw</a>' to<br/></li>
<li></span><span class="Comment">** traverse a table, depending on whether the table has metamethods<br/></li>
<li></span><span class="Comment">** that can affect the traversal.<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L271">&#x200c;</a></span><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_ipairs</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L103" title="lua.h:103">lua_CFunction</a> iter = (<a href="lauxlib.c.html#L710" title="lauxlib.c:710">luaL_getmetafield</a>(L, <span class="Constant">1</span>, <span class="Constant">&quot;__index&quot;</span>) != <a href="lua.h.html#L62" title="lua.h:62">LUA_TNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ? <a href="#L259" title="lbaselib.c:259">ipairsaux</a> : <a href="#L248" title="lbaselib.c:248">ipairsaux_raw</a>;<br/></li>
<li><span class="PreProc">#if defined(<a href="luaconf.h.html#L294" title="luaconf.h:294">LUA_COMPAT_IPAIRS</a>)<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <a href="#L211" title="lbaselib.c:211">pairsmeta</a>(L, <span class="Constant">&quot;__ipairs&quot;</span>, <span class="Constant">1</span>, iter);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; <a href="lauxlib.c.html#L368" title="lauxlib.c:368">luaL_checkany</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="lua.h.html#L348" title="lua.h:348">lua_pushcfunction</a>(L, iter);&nbsp; <span class="Comment">/* iteration function */<br/></li>
<li></span>&nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* state */<br/></li>
<li></span>&nbsp; <a href="lapi.c.html#L464" title="lapi.c:464">lua_pushinteger</a>(L, <span class="Constant">0</span>);&nbsp; <span class="Comment">/* initial value */<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <span class="Constant">3</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L286">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">load_aux</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> status, <span class="Type">int</span> envidx) {<br/></li>
<li>&nbsp; <span class="Statement">if</span> (status == <a href="lua.h.html#L45" title="lua.h:45">LUA_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (envidx != <span class="Constant">0</span>) {&nbsp; <span class="Comment">/* 'env' parameter? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, envidx);&nbsp; <span class="Comment">/* environment for loaded function */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="lapi.c.html#L1207" title="lapi.c:1207">lua_setupvalue</a>(L, -<span class="Constant">2</span>, <span class="Constant">1</span>))&nbsp; <span class="Comment">/* set it as 1st upvalue */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="lua.h.html#L342" title="lua.h:342">lua_pop</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* remove 'env' if not used by previous call */<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> {&nbsp; <span class="Comment">/* <a href="lundump.c.html#L40" title="lundump.c:40">error</a> (message is on top of the stack) */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lapi.c.html#L448" title="lapi.c:448">lua_pushnil</a>(L);<br/></li>
<li>&nbsp; &nbsp; <a href="lua.h.html#L368" title="lua.h:368">lua_insert</a>(L, -<span class="Constant">2</span>);&nbsp; <span class="Comment">/* put before <a href="lundump.c.html#L40" title="lundump.c:40">error</a> message */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">2</span>;&nbsp; <span class="Comment">/* return nil plus <a href="lundump.c.html#L40" title="lundump.c:40">error</a> message */<br/></li>
<li></span>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L303">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_loadfile</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">const</span> <span class="Type">char</span> *fname = <a href="lauxlib.h.html#L117" title="lauxlib.h:117">luaL_optstring</a>(L, <span class="Constant">1</span>, <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; <span class="Type">const</span> <span class="Type">char</span> *mode = <a href="lauxlib.h.html#L117" title="lauxlib.h:117">luaL_optstring</a>(L, <span class="Constant">2</span>, <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; <span class="Type">int</span> env = (!<a href="lua.h.html#L356" title="lua.h:356">lua_isnone</a>(L, <span class="Constant">3</span>) ? <span class="Constant">3</span> : <span class="Constant">0</span>);&nbsp; <span class="Comment">/* 'env' index or 0 if no 'env' */<br/></li>
<li></span>&nbsp; <span class="Type">int</span> status = <a href="lauxlib.c.html#L641" title="lauxlib.c:641">luaL_loadfilex</a>(L, fname, mode);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L286" title="lbaselib.c:286">load_aux</a>(L, status, env);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** {======================================================<br/></li>
<li></span><span class="Comment">** Generic Read function<br/></li>
<li></span><span class="Comment">** =======================================================<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** reserved slot, above all arguments, to hold a copy of the returned<br/></li>
<li></span><span class="Comment">** string to avoid it being collected while parsed. 'load' has four<br/></li>
<li></span><span class="Comment">** optional arguments (chunk, source name, mode, and environment).<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L324">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">RESERVEDSLOT</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">5<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** Reader for generic 'load' function: '<a href="lapi.c.html#L963" title="lapi.c:963">lua_load</a>' uses the<br/></li>
<li></span><span class="Comment">** stack for internal stuff, so the <a href="luac.c.html#L122" title="luac.c:122">reader</a> <a href="luac.c.html#L44" title="luac.c:44">cannot</a> change the<br/></li>
<li></span><span class="Comment">** stack top. Instead, it keeps its resulting string in a<br/></li>
<li></span><span class="Comment">** reserved slot inside the stack.<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L333">&#x200c;</a></span><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="linkable">generic_reader</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">void</span> *ud, <span class="Type">size_t</span> *size) {<br/></li>
<li>&nbsp; (<span class="Type">void</span>)(ud);&nbsp; <span class="Comment">/* not used */<br/></li>
<li></span>&nbsp; <a href="lauxlib.c.html#L350" title="lauxlib.c:350">luaL_checkstack</a>(L, <span class="Constant">2</span>, <span class="Constant">&quot;too many nested functions&quot;</span>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* get function */<br/></li>
<li></span>&nbsp; <a href="lua.h.html#L272" title="lua.h:272">lua_call</a>(L, <span class="Constant">0</span>, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* call it */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (<a href="lua.h.html#L353" title="lua.h:353">lua_isnil</a>(L, -<span class="Constant">1</span>)) {<br/></li>
<li>&nbsp; &nbsp; <a href="lua.h.html#L342" title="lua.h:342">lua_pop</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* pop result */<br/></li>
<li></span>&nbsp; &nbsp; *size = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!<a href="lapi.c.html#L282" title="lapi.c:282">lua_isstring</a>(L, -<span class="Constant">1</span>))<br/></li>
<li>&nbsp; &nbsp; <a href="lauxlib.c.html#L212" title="lauxlib.c:212">luaL_error</a>(L, <span class="Constant">&quot;<a href="luac.c.html#L122" title="luac.c:122">reader</a> function must return a string&quot;</span>);<br/></li>
<li>&nbsp; <a href="lua.h.html#L372" title="lua.h:372">lua_replace</a>(L, <a href="#L324" title="lbaselib.c:324">RESERVEDSLOT</a>);&nbsp; <span class="Comment">/* <a href="llex.c.html#L56" title="llex.c:56">save</a> string in reserved slot */<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <a href="lapi.c.html#L372" title="lapi.c:372">lua_tolstring</a>(L, <a href="#L324" title="lbaselib.c:324">RESERVEDSLOT</a>, size);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L350">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_load</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">int</span> status;<br/></li>
<li>&nbsp; <span class="Type">size_t</span> l;<br/></li>
<li>&nbsp; <span class="Type">const</span> <span class="Type">char</span> *s = <a href="lapi.c.html#L372" title="lapi.c:372">lua_tolstring</a>(L, <span class="Constant">1</span>, &amp;l);<br/></li>
<li>&nbsp; <span class="Type">const</span> <span class="Type">char</span> *mode = <a href="lauxlib.h.html#L117" title="lauxlib.h:117">luaL_optstring</a>(L, <span class="Constant">3</span>, <span class="Constant">&quot;bt&quot;</span>);<br/></li>
<li>&nbsp; <span class="Type">int</span> env = (!<a href="lua.h.html#L356" title="lua.h:356">lua_isnone</a>(L, <span class="Constant">4</span>) ? <span class="Constant">4</span> : <span class="Constant">0</span>);&nbsp; <span class="Comment">/* 'env' index or 0 if no 'env' */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (s != <span class="Constant">NULL</span>) {&nbsp; <span class="Comment">/* loading a string? */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *chunkname = <a href="lauxlib.h.html#L117" title="lauxlib.h:117">luaL_optstring</a>(L, <span class="Constant">2</span>, s);<br/></li>
<li>&nbsp; &nbsp; status = <a href="lauxlib.c.html#L693" title="lauxlib.c:693">luaL_loadbufferx</a>(L, s, l, chunkname, mode);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> {&nbsp; <span class="Comment">/* loading from a <a href="luac.c.html#L122" title="luac.c:122">reader</a> function */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *chunkname = <a href="lauxlib.h.html#L117" title="lauxlib.h:117">luaL_optstring</a>(L, <span class="Constant">2</span>, <span class="Constant">&quot;=(load)&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="lauxlib.c.html#L362" title="lauxlib.c:362">luaL_checktype</a>(L, <span class="Constant">1</span>, <a href="lua.h.html#L68" title="lua.h:68">LUA_TFUNCTION</a>);<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.c.html#L171" title="lapi.c:171">lua_settop</a>(L, <a href="#L324" title="lbaselib.c:324">RESERVEDSLOT</a>);&nbsp; <span class="Comment">/* create reserved slot */<br/></li>
<li></span>&nbsp; &nbsp; status = <a href="lapi.c.html#L963" title="lapi.c:963">lua_load</a>(L, <a href="#L333" title="lbaselib.c:333">generic_reader</a>, <span class="Constant">NULL</span>, chunkname, mode);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L286" title="lbaselib.c:286">load_aux</a>(L, status, env);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* }====================================================== */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L372">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">dofilecont</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> d1, <a href="lua.h.html#L97" title="lua.h:97">lua_KContext</a> d2) {<br/></li>
<li>&nbsp; (<span class="Type">void</span>)d1;&nbsp; (<span class="Type">void</span>)d2;&nbsp; <span class="Comment">/* only to <a href="lstrlib.c.html#L420" title="lstrlib.c:420">match</a> 'lua_Kfunction' prototype */<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <a href="lapi.c.html#L166" title="lapi.c:166">lua_gettop</a>(L) - <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L378">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_dofile</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">const</span> <span class="Type">char</span> *fname = <a href="lauxlib.h.html#L117" title="lauxlib.h:117">luaL_optstring</a>(L, <span class="Constant">1</span>, <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L171" title="lapi.c:171">lua_settop</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="lauxlib.h.html#L78" title="lauxlib.h:78">luaL_loadfile</a>(L, fname) != <a href="lua.h.html#L45" title="lua.h:45">LUA_OK</a>)<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="lapi.c.html#L1085" title="lapi.c:1085">lua_error</a>(L);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L880" title="lapi.c:880">lua_callk</a>(L, <span class="Constant">0</span>, <a href="lua.h.html#L34" title="lua.h:34">LUA_MULTRET</a>, <span class="Constant">0</span>, <a href="#L372" title="lbaselib.c:372">dofilecont</a>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L372" title="lbaselib.c:372">dofilecont</a>(L, <span class="Constant">0</span>, <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L388">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_assert</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="lapi.c.html#L366" title="lapi.c:366">lua_toboolean</a>(L, <span class="Constant">1</span>))&nbsp; <span class="Comment">/* condition is true? */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> <a href="lapi.c.html#L166" title="lapi.c:166">lua_gettop</a>(L);&nbsp; <span class="Comment">/* return all arguments */<br/></li>
<li></span>&nbsp; <span class="Statement">else</span> {&nbsp; <span class="Comment">/* <a href="lundump.c.html#L40" title="lundump.c:40">error</a> */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lauxlib.c.html#L368" title="lauxlib.c:368">luaL_checkany</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* there must be a condition */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lua.h.html#L370" title="lua.h:370">lua_remove</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* remove it */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lua.h.html#L359" title="lua.h:359">lua_pushliteral</a>(L, <span class="Constant">&quot;assertion failed!&quot;</span>);&nbsp; <span class="Comment">/* default message */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lapi.c.html#L171" title="lapi.c:171">lua_settop</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* leave only message (default if no other one) */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L102" title="lbaselib.c:102">luaB_error</a>(L);&nbsp; <span class="Comment">/* call '<a href="lundump.c.html#L40" title="lundump.c:40">error</a>' */<br/></li>
<li></span>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L401">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_select</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">int</span> n = <a href="lapi.c.html#L166" title="lapi.c:166">lua_gettop</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="lapi.c.html#L250" title="lapi.c:250">lua_type</a>(L, <span class="Constant">1</span>) == <a href="lua.h.html#L66" title="lua.h:66">LUA_TSTRING</a> &amp;&amp; *<a href="lua.h.html#L365" title="lua.h:365">lua_tostring</a>(L, <span class="Constant">1</span>) == <span class="Constant">'#'</span>) {<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.c.html#L464" title="lapi.c:464">lua_pushinteger</a>(L, n-<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> i = <a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (i &lt; <span class="Constant">0</span>) i = n + i;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (i &gt; n) i = n;<br/></li>
<li>&nbsp; &nbsp; <a href="lauxlib.h.html#L114" title="lauxlib.h:114">luaL_argcheck</a>(L, <span class="Constant">1</span> &lt;= i, <span class="Constant">1</span>, <span class="Constant">&quot;index out of range&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> n - (<span class="Type">int</span>)i;<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** Continuation function for 'pcall' and 'xpcall'. Both functions<br/></li>
<li></span><span class="Comment">** already pushed a 'true' before doing the call, so in case of success<br/></li>
<li></span><span class="Comment">** '<a href="#L424" title="lbaselib.c:424">finishpcall</a>' only has to return everything in the stack minus<br/></li>
<li></span><span class="Comment">** 'extra' values (where 'extra' is exactly the number of items to be<br/></li>
<li></span><span class="Comment">** ignored).<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L424">&#x200c;</a></span><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">finishpcall</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> status, <a href="lua.h.html#L97" title="lua.h:97">lua_KContext</a> extra) {<br/></li>
<li>&nbsp; <span class="Statement">if</span> (status != <a href="lua.h.html#L45" title="lua.h:45">LUA_OK</a> &amp;&amp; status != <a href="lua.h.html#L46" title="lua.h:46">LUA_YIELD</a>) {&nbsp; <span class="Comment">/* <a href="lundump.c.html#L40" title="lundump.c:40">error</a>? */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lapi.c.html#L550" title="lapi.c:550">lua_pushboolean</a>(L, <span class="Constant">0</span>);&nbsp; <span class="Comment">/* first result (false) */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, -<span class="Constant">2</span>);&nbsp; <span class="Comment">/* <a href="lundump.c.html#L40" title="lundump.c:40">error</a> message */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">2</span>;&nbsp; <span class="Comment">/* return false, msg */<br/></li>
<li></span>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> <a href="lapi.c.html#L166" title="lapi.c:166">lua_gettop</a>(L) - (<span class="Type">int</span>)extra;&nbsp; <span class="Comment">/* return all results */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L435">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_pcall</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">int</span> status;<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L368" title="lauxlib.c:368">luaL_checkany</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L550" title="lapi.c:550">lua_pushboolean</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* first result if no errors */<br/></li>
<li></span>&nbsp; <a href="lua.h.html#L368" title="lua.h:368">lua_insert</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* put it in place */<br/></li>
<li></span>&nbsp; status = <a href="lapi.c.html#L919" title="lapi.c:919">lua_pcallk</a>(L, <a href="lapi.c.html#L166" title="lapi.c:166">lua_gettop</a>(L) - <span class="Constant">2</span>, <a href="lua.h.html#L34" title="lua.h:34">LUA_MULTRET</a>, <span class="Constant">0</span>, <span class="Constant">0</span>, <a href="#L424" title="lbaselib.c:424">finishpcall</a>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L424" title="lbaselib.c:424">finishpcall</a>(L, status, <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** Do a protected call with <a href="lundump.c.html#L40" title="lundump.c:40">error</a> handling. After '<a href="lapi.c.html#L206" title="lapi.c:206">lua_rotate</a>', the<br/></li>
<li></span><span class="Comment">** stack will have &lt;f, err, true, f, [args...]&gt;; so, the function passes<br/></li>
<li></span><span class="Comment">** 2 to '<a href="#L424" title="lbaselib.c:424">finishpcall</a>' to skip the 2 first values when returning results.<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L450">&#x200c;</a></span><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_xpcall</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">int</span> status;<br/></li>
<li>&nbsp; <span class="Type">int</span> n = <a href="lapi.c.html#L166" title="lapi.c:166">lua_gettop</a>(L);<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L362" title="lauxlib.c:362">luaL_checktype</a>(L, <span class="Constant">2</span>, <a href="lua.h.html#L68" title="lua.h:68">LUA_TFUNCTION</a>);&nbsp; <span class="Comment">/* <a href="lparser.c.html#L106" title="lparser.c:106">check</a> <a href="lundump.c.html#L40" title="lundump.c:40">error</a> function */<br/></li>
<li></span>&nbsp; <a href="lapi.c.html#L550" title="lapi.c:550">lua_pushboolean</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* first result */<br/></li>
<li></span>&nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* function */<br/></li>
<li></span>&nbsp; <a href="lapi.c.html#L206" title="lapi.c:206">lua_rotate</a>(L, <span class="Constant">3</span>, <span class="Constant">2</span>);&nbsp; <span class="Comment">/* move them below function's arguments */<br/></li>
<li></span>&nbsp; status = <a href="lapi.c.html#L919" title="lapi.c:919">lua_pcallk</a>(L, n - <span class="Constant">2</span>, <a href="lua.h.html#L34" title="lua.h:34">LUA_MULTRET</a>, <span class="Constant">2</span>, <span class="Constant">2</span>, <a href="#L424" title="lbaselib.c:424">finishpcall</a>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L424" title="lbaselib.c:424">finishpcall</a>(L, status, <span class="Constant">2</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L462">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">luaB_tostring</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L368" title="lauxlib.c:368">luaL_checkany</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L748" title="lauxlib.c:748">luaL_tolstring</a>(L, <span class="Constant">1</span>, <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L469">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <a href="lauxlib.h.html#L23" title="lauxlib.h:23">luaL_Reg</a> <span class="linkable">base_funcs</span>[] = {<br/></li>
<li>&nbsp; {<span class="Constant">&quot;assert&quot;</span>, <a href="#L388" title="lbaselib.c:388">luaB_assert</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;collectgarbage&quot;</span>, <a href="#L173" title="lbaselib.c:173">luaB_collectgarbage</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;<a href="lua.c.html#L245" title="lua.c:245">dofile</a>&quot;</span>, <a href="#L378" title="lbaselib.c:378">luaB_dofile</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;<a href="lundump.c.html#L40" title="lundump.c:40">error</a>&quot;</span>, <a href="#L102" title="lbaselib.c:102">luaB_error</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;getmetatable&quot;</span>, <a href="#L114" title="lbaselib.c:114">luaB_getmetatable</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;ipairs&quot;</span>, <a href="#L271" title="lbaselib.c:271">luaB_ipairs</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;loadfile&quot;</span>, <a href="#L303" title="lbaselib.c:303">luaB_loadfile</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;load&quot;</span>, <a href="#L350" title="lbaselib.c:350">luaB_load</a>},<br/></li>
<li><span class="PreProc">#if defined(<a href="luaconf.h.html#L349" title="luaconf.h:349">LUA_COMPAT_LOADSTRING</a>)<br/></li>
<li></span>&nbsp; {<span class="Constant">&quot;loadstring&quot;</span>, <a href="#L350" title="lbaselib.c:350">luaB_load</a>},<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; {<span class="Constant">&quot;<a href="llex.c.html#L31" title="llex.c:31">next</a>&quot;</span>, <a href="#L228" title="lbaselib.c:228">luaB_next</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;pairs&quot;</span>, <a href="#L240" title="lbaselib.c:240">luaB_pairs</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;pcall&quot;</span>, <a href="#L435" title="lbaselib.c:435">luaB_pcall</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;print&quot;</span>, <a href="#L24" title="lbaselib.c:24">luaB_print</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;rawequal&quot;</span>, <a href="#L138" title="lbaselib.c:138">luaB_rawequal</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;rawlen&quot;</span>, <a href="#L146" title="lbaselib.c:146">luaB_rawlen</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;rawget&quot;</span>, <a href="#L155" title="lbaselib.c:155">luaB_rawget</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;rawset&quot;</span>, <a href="#L163" title="lbaselib.c:163">luaB_rawset</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;select&quot;</span>, <a href="#L401" title="lbaselib.c:401">luaB_select</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;setmetatable&quot;</span>, <a href="#L125" title="lbaselib.c:125">luaB_setmetatable</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;<a href="lvm.h.html#L30" title="lvm.h:30">tonumber</a>&quot;</span>, <a href="#L69" title="lbaselib.c:69">luaB_tonumber</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;<a href="lvm.c.html#L354" title="lvm.c:354">tostring</a>&quot;</span>, <a href="#L462" title="lbaselib.c:462">luaB_tostring</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;xpcall&quot;</span>, <a href="#L450" title="lbaselib.c:450">luaB_xpcall</a>},<br/></li>
<li>&nbsp; <span class="Comment">/* placeholders */<br/></li>
<li></span>&nbsp; {<span class="Constant">&quot;type&quot;</span>, <span class="Constant">NULL</span>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;_G&quot;</span>, <span class="Constant">NULL</span>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;_VERSION&quot;</span>, <span class="Constant">NULL</span>},<br/></li>
<li>&nbsp; {<span class="Constant">NULL</span>, <span class="Constant">NULL</span>}<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L502">&#x200c;</a><a href="luaconf.h.html#L236" title="luaconf.h:236">LUAMOD_API</a> <span class="Type">int</span> <span class="linkable">luaopen_base</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">int</span> i;<br/></li>
<li>&nbsp; <span class="Comment">/* open lib into global table */<br/></li>
<li></span>&nbsp; <a href="lua.h.html#L362" title="lua.h:362">lua_pushglobaltable</a>(L);<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L863" title="lauxlib.c:863">luaL_setfuncs</a>(L, <a href="#L469" title="lbaselib.c:469">base_funcs</a>, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; <span class="Comment">/* set global _G */<br/></li>
<li></span>&nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, -<span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L745" title="lapi.c:745">lua_setfield</a>(L, -<span class="Constant">2</span>, <span class="Constant">&quot;_G&quot;</span>);<br/></li>
<li>&nbsp; <span class="Comment">/* set global _VERSION */<br/></li>
<li></span>&nbsp; <a href="lua.h.html#L359" title="lua.h:359">lua_pushliteral</a>(L, <a href="lua.h.html#L24" title="lua.h:24">LUA_VERSION</a>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L745" title="lapi.c:745">lua_setfield</a>(L, -<span class="Constant">2</span>, <span class="Constant">&quot;_VERSION&quot;</span>);<br/></li>
<li>&nbsp; <span class="Comment">/* set function 'type' with proper upvalues */<br/></li>
<li></span>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; <a href="lua.h.html#L72" title="lua.h:72">LUA_NUMTAGS</a>; i++)&nbsp; <span class="Comment">/* push all type names as upvalues */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lapi.c.html#L484" title="lapi.c:484">lua_pushstring</a>(L, <a href="lapi.c.html#L256" title="lapi.c:256">lua_typename</a>(L, i));<br/></li>
<li>&nbsp; <a href="lapi.c.html#L526" title="lapi.c:526">lua_pushcclosure</a>(L, <a href="#L204" title="lbaselib.c:204">luaB_type</a>, <a href="lua.h.html#L72" title="lua.h:72">LUA_NUMTAGS</a>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L745" title="lapi.c:745">lua_setfield</a>(L, -<span class="Constant">2</span>, <span class="Constant">&quot;type&quot;</span>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
</ol></code>
 </body>
</html>

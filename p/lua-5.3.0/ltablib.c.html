<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>ltablib.c - src</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>ltablib.c - src</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Global variables defined</h4>
 <ul>
<li><a href="#L333">tab_funcs</a></li>
</ul>
 <h4>Data types defined</h4>
 <ul>
<li><a href="#L29">TabA</a></li>
</ul>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L156">addfield</a></li>
<li><a href="#L256">auxsort</a></li>
<li><a href="#L36">checktab</a></li>
<li><a href="#L348">luaopen_table</a></li>
<li><a href="#L59">maxn</a></li>
<li><a href="#L192">pack</a></li>
<li><a href="#L236">set2</a></li>
<li><a href="#L319">sort</a></li>
<li><a href="#L241">sort_comp</a></li>
<li><a href="#L165">tconcat</a></li>
<li><a href="#L76">tinsert</a></li>
<li><a href="#L121">tmove</a></li>
<li><a href="#L104">tremove</a></li>
<li><a href="#L205">unpack</a></li>
</ul>
 <h4>Macros defined</h4>
 <ul>
<li><a href="#L8">LUA_LIB</a></li>
<li><a href="#L55">aux_getn</a></li>
<li><a href="#L7">ltablib_c</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** $Id: ltablib.c,v 1.79 2014/11/02 19:19:04 roberto Exp $<br/></li>
<li></span><span class="Comment">** Library for <a href="lobject.h.html#L488" title="lobject.h:488">Table</a> Manipulation<br/></li>
<li></span><span class="Comment">** See Copyright Notice in lua.h<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><a id="L7">&#x200c;</a><span class="PreProc">#define <span class="linkable">ltablib_c</span><br/></li>
<li><a id="L8">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">LUA_LIB</span><br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lprefix.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;limits.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;stddef.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lua.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lauxlib.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lualib.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** Structure with table-access functions<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><span class="Type">typedef</span> <span class="Type">struct</span> {<br/></li>
<li>&nbsp; <span class="Type">int</span> (*geti) (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx, <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> n);<br/></li>
<li>&nbsp; <span class="Type">void</span> (*seti) (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx, <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> n);<br/></li>
<li><a id="L29">&#x200c;</a>} <span class="linkable">TabA</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** Check that 'arg' has a table and set access functions in 'ta' to raw<br/></li>
<li></span><span class="Comment">** or non-raw according to the presence of corresponding metamethods.<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L36">&#x200c;</a></span><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">checktab</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> arg, <a href="#L29" title="ltablib.c:29">TabA</a> *ta) {<br/></li>
<li>&nbsp; ta-&gt;geti = <span class="Constant">NULL</span>; ta-&gt;seti = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="lapi.c.html#L677" title="lapi.c:677">lua_getmetatable</a>(L, arg)) {<br/></li>
<li>&nbsp; &nbsp; <a href="lua.h.html#L359" title="lua.h:359">lua_pushliteral</a>(L, <span class="Constant">&quot;__index&quot;</span>);&nbsp; <span class="Comment">/* 'index' metamethod */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="lapi.c.html#L627" title="lapi.c:627">lua_rawget</a>(L, -<span class="Constant">2</span>) != <a href="lua.h.html#L62" title="lua.h:62">LUA_TNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; ta-&gt;geti = <a href="lapi.c.html#L615" title="lapi.c:615">lua_geti</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="lua.h.html#L359" title="lua.h:359">lua_pushliteral</a>(L, <span class="Constant">&quot;__newindex&quot;</span>);&nbsp; <span class="Comment">/* 'newindex' metamethod */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="lapi.c.html#L627" title="lapi.c:627">lua_rawget</a>(L, -<span class="Constant">3</span>) != <a href="lua.h.html#L62" title="lua.h:62">LUA_TNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; ta-&gt;seti = <a href="lapi.c.html#L757" title="lapi.c:757">lua_seti</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="lua.h.html#L342" title="lua.h:342">lua_pop</a>(L, <span class="Constant">3</span>);&nbsp; <span class="Comment">/* pop metatable plus both metamethods */<br/></li>
<li></span>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">if</span> (ta-&gt;geti == <span class="Constant">NULL</span> || ta-&gt;seti == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; <a href="lauxlib.c.html#L362" title="lauxlib.c:362">luaL_checktype</a>(L, arg, <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a>);&nbsp; <span class="Comment">/* must be table for raw methods */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (ta-&gt;geti == <span class="Constant">NULL</span>) ta-&gt;geti = <a href="lapi.c.html#L638" title="lapi.c:638">lua_rawgeti</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ta-&gt;seti == <span class="Constant">NULL</span>) ta-&gt;seti = <a href="lapi.c.html#L785" title="lapi.c:785">lua_rawseti</a>;<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L55">&#x200c;</a><span class="PreProc">#define <span class="linkable">aux_getn</span>(L,n,ta)&nbsp; &nbsp; &nbsp; &nbsp; (<a href="#L36" title="ltablib.c:36">checktab</a>(L, n, ta), <a href="lauxlib.c.html#L736" title="lauxlib.c:736">luaL_len</a>(L, n))<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#if defined(<a href="luaconf.h.html#L354" title="luaconf.h:354">LUA_COMPAT_MAXN</a>)<br/></li>
<li><a id="L59">&#x200c;</a></span><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">maxn</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L87" title="lua.h:87">lua_Number</a> max = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L362" title="lauxlib.c:362">luaL_checktype</a>(L, <span class="Constant">1</span>, <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L448" title="lapi.c:448">lua_pushnil</a>(L);&nbsp; <span class="Comment">/* first key */<br/></li>
<li></span>&nbsp; <span class="Statement">while</span> (<a href="lapi.c.html#L1094" title="lapi.c:1094">lua_next</a>(L, <span class="Constant">1</span>)) {<br/></li>
<li>&nbsp; &nbsp; <a href="lua.h.html#L342" title="lua.h:342">lua_pop</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* remove value */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="lapi.c.html#L250" title="lapi.c:250">lua_type</a>(L, -<span class="Constant">1</span>) == <a href="lua.h.html#L65" title="lua.h:65">LUA_TNUMBER</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lua.h.html#L87" title="lua.h:87">lua_Number</a> v = <a href="lua.h.html#L339" title="lua.h:339">lua_tonumber</a>(L, -<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (v &gt; max) max = v;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <a href="lapi.c.html#L456" title="lapi.c:456">lua_pushnumber</a>(L, max);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L76">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">tinsert</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="#L29" title="ltablib.c:29">TabA</a> ta;<br/></li>
<li>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> e = <a href="#L55" title="ltablib.c:55">aux_getn</a>(L, <span class="Constant">1</span>, &amp;ta) + <span class="Constant">1</span>;&nbsp; <span class="Comment">/* first empty element */<br/></li>
<li></span>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> pos;&nbsp; <span class="Comment">/* where to insert new element */<br/></li>
<li></span>&nbsp; <span class="Statement">switch</span> (<a href="lapi.c.html#L166" title="lapi.c:166">lua_gettop</a>(L)) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">2</span>: {&nbsp; <span class="Comment">/* called with only 2 arguments */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; pos = e;&nbsp; <span class="Comment">/* insert new element at the end */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">3</span>: {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> i;<br/></li>
<li>&nbsp; &nbsp; &nbsp; pos = <a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>(L, <span class="Constant">2</span>);&nbsp; <span class="Comment">/* 2nd argument is the position */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="lauxlib.h.html#L114" title="lauxlib.h:114">luaL_argcheck</a>(L, <span class="Constant">1</span> &lt;= pos &amp;&amp; pos &lt;= e, <span class="Constant">2</span>, <span class="Constant">&quot;position out of bounds&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = e; i &gt; pos; i--) {&nbsp; <span class="Comment">/* move up elements */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; (*ta.geti)(L, <span class="Constant">1</span>, i - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (*ta.seti)(L, <span class="Constant">1</span>, i);&nbsp; <span class="Comment">/* t[i] = t[i - 1] */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="lauxlib.c.html#L212" title="lauxlib.c:212">luaL_error</a>(L, <span class="Constant">&quot;wrong number of arguments to 'insert'&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; (*ta.seti)(L, <span class="Constant">1</span>, pos);&nbsp; <span class="Comment">/* t[pos] = v */<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L104">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">tremove</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="#L29" title="ltablib.c:29">TabA</a> ta;<br/></li>
<li>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> size = <a href="#L55" title="ltablib.c:55">aux_getn</a>(L, <span class="Constant">1</span>, &amp;ta);<br/></li>
<li>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> pos = <a href="lauxlib.c.html#L424" title="lauxlib.c:424">luaL_optinteger</a>(L, <span class="Constant">2</span>, size);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (pos != size)&nbsp; <span class="Comment">/* validate 'pos' if given */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lauxlib.h.html#L114" title="lauxlib.h:114">luaL_argcheck</a>(L, <span class="Constant">1</span> &lt;= pos &amp;&amp; pos &lt;= size + <span class="Constant">1</span>, <span class="Constant">1</span>, <span class="Constant">&quot;position out of bounds&quot;</span>);<br/></li>
<li>&nbsp; (*ta.geti)(L, <span class="Constant">1</span>, pos);&nbsp; <span class="Comment">/* result = t[pos] */<br/></li>
<li></span>&nbsp; <span class="Statement">for</span> ( ; pos &lt; size; pos++) {<br/></li>
<li>&nbsp; &nbsp; (*ta.geti)(L, <span class="Constant">1</span>, pos + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; (*ta.seti)(L, <span class="Constant">1</span>, pos);&nbsp; <span class="Comment">/* t[pos] = t[pos + 1] */<br/></li>
<li></span>&nbsp; }<br/></li>
<li>&nbsp; <a href="lapi.c.html#L448" title="lapi.c:448">lua_pushnil</a>(L);<br/></li>
<li>&nbsp; (*ta.seti)(L, <span class="Constant">1</span>, pos);&nbsp; <span class="Comment">/* t[pos] = nil */<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L121">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">tmove</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="#L29" title="ltablib.c:29">TabA</a> ta;<br/></li>
<li>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> f = <a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> e = <a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>(L, <span class="Constant">3</span>);<br/></li>
<li>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> t = <a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>(L, <span class="Constant">4</span>);<br/></li>
<li>&nbsp; <span class="Type">int</span> tt = !<a href="lua.h.html#L357" title="lua.h:357">lua_isnoneornil</a>(L, <span class="Constant">5</span>) ? <span class="Constant">5</span> : <span class="Constant">1</span>;&nbsp; <span class="Comment">/* destination table */<br/></li>
<li></span>&nbsp; <span class="Comment">/* the following restriction avoids several problems with overflows */<br/></li>
<li></span>&nbsp; <a href="lauxlib.h.html#L114" title="lauxlib.h:114">luaL_argcheck</a>(L, f &gt; <span class="Constant">0</span>, <span class="Constant">2</span>, <span class="Constant">&quot;initial position must be positive&quot;</span>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (e &gt;= f) {&nbsp; <span class="Comment">/* otherwise, nothing to move */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> n, i;<br/></li>
<li>&nbsp; &nbsp; ta.geti = (<a href="lauxlib.c.html#L710" title="lauxlib.c:710">luaL_getmetafield</a>(L, <span class="Constant">1</span>, <span class="Constant">&quot;__index&quot;</span>) == <a href="lua.h.html#L62" title="lua.h:62">LUA_TNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; ? (<a href="lauxlib.c.html#L362" title="lauxlib.c:362">luaL_checktype</a>(L, <span class="Constant">1</span>, <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a>), <a href="lapi.c.html#L638" title="lapi.c:638">lua_rawgeti</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; : <a href="lapi.c.html#L615" title="lapi.c:615">lua_geti</a>;<br/></li>
<li>&nbsp; &nbsp; ta.seti = (<a href="lauxlib.c.html#L710" title="lauxlib.c:710">luaL_getmetafield</a>(L, tt, <span class="Constant">&quot;__newindex&quot;</span>) == <a href="lua.h.html#L62" title="lua.h:62">LUA_TNIL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; ? (<a href="lauxlib.c.html#L362" title="lauxlib.c:362">luaL_checktype</a>(L, tt, <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a>), <a href="lapi.c.html#L785" title="lapi.c:785">lua_rawseti</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; : <a href="lapi.c.html#L757" title="lapi.c:757">lua_seti</a>;<br/></li>
<li>&nbsp; &nbsp; n = e - f + <span class="Constant">1</span>;&nbsp; <span class="Comment">/* number of elements to move */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (t &gt; f) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = n - <span class="Constant">1</span>; i &gt;= <span class="Constant">0</span>; i--) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (*ta.geti)(L, <span class="Constant">1</span>, f + i);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (*ta.seti)(L, tt, t + i);<br/></li>
<li>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (*ta.geti)(L, <span class="Constant">1</span>, f + i);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (*ta.seti)(L, tt, t + i);<br/></li>
<li>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, tt);&nbsp; <span class="Comment">/* return &quot;to table&quot; */<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L156">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">addfield</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <a href="lauxlib.h.html#L140" title="lauxlib.h:140">luaL_Buffer</a> *b, <a href="#L29" title="ltablib.c:29">TabA</a> *ta, <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> i) {<br/></li>
<li>&nbsp; (*ta-&gt;geti)(L, <span class="Constant">1</span>, i);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (!<a href="lapi.c.html#L282" title="lapi.c:282">lua_isstring</a>(L, -<span class="Constant">1</span>))<br/></li>
<li>&nbsp; &nbsp; <a href="lauxlib.c.html#L212" title="lauxlib.c:212">luaL_error</a>(L, <span class="Constant">&quot;invalid value (</span><span class="Special">%s</span><span class="Constant">) at index </span><span class="Special">%d</span><span class="Constant"> in table for 'concat'&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="lauxlib.h.html#L119" title="lauxlib.h:119">luaL_typename</a>(L, -<span class="Constant">1</span>), i);<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L496" title="lauxlib.c:496">luaL_addvalue</a>(b);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L165">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">tconcat</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="#L29" title="ltablib.c:29">TabA</a> ta;<br/></li>
<li>&nbsp; <a href="lauxlib.h.html#L140" title="lauxlib.h:140">luaL_Buffer</a> b;<br/></li>
<li>&nbsp; <span class="Type">size_t</span> lsep;<br/></li>
<li>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> i, last;<br/></li>
<li>&nbsp; <span class="Type">const</span> <span class="Type">char</span> *sep = <a href="lauxlib.c.html#L381" title="lauxlib.c:381">luaL_optlstring</a>(L, <span class="Constant">2</span>, <span class="Constant">&quot;&quot;</span>, &amp;lsep);<br/></li>
<li>&nbsp; <a href="#L36" title="ltablib.c:36">checktab</a>(L, <span class="Constant">1</span>, &amp;ta);<br/></li>
<li>&nbsp; i = <a href="lauxlib.c.html#L424" title="lauxlib.c:424">luaL_optinteger</a>(L, <span class="Constant">3</span>, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; last = <a href="lauxlib.h.html#L129" title="lauxlib.h:129">luaL_opt</a>(L, <a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>, <span class="Constant">4</span>, <a href="lauxlib.c.html#L736" title="lauxlib.c:736">luaL_len</a>(L, <span class="Constant">1</span>));<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L507" title="lauxlib.c:507">luaL_buffinit</a>(L, &amp;b);<br/></li>
<li>&nbsp; <span class="Statement">for</span> (; i &lt; last; i++) {<br/></li>
<li>&nbsp; &nbsp; <a href="#L156" title="ltablib.c:156">addfield</a>(L, &amp;b, &amp;ta, i);<br/></li>
<li>&nbsp; &nbsp; <a href="lauxlib.c.html#L470" title="lauxlib.c:470">luaL_addlstring</a>(&amp;b, sep, lsep);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">if</span> (i == last)&nbsp; <span class="Comment">/* add last value (if interval was not empty) */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L156" title="ltablib.c:156">addfield</a>(L, &amp;b, &amp;ta, i);<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L482" title="lauxlib.c:482">luaL_pushresult</a>(&amp;b);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** {======================================================<br/></li>
<li></span><span class="Comment">** Pack/<a href="#L205" title="ltablib.c:205">unpack</a><br/></li>
<li></span><span class="Comment">** =======================================================<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><a id="L192">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">pack</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">int</span> i;<br/></li>
<li>&nbsp; <span class="Type">int</span> n = <a href="lapi.c.html#L166" title="lapi.c:166">lua_gettop</a>(L);&nbsp; <span class="Comment">/* number of elements to <a href="#L192" title="ltablib.c:192">pack</a> */<br/></li>
<li></span>&nbsp; <a href="lapi.c.html#L664" title="lapi.c:664">lua_createtable</a>(L, n, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* create result table */<br/></li>
<li></span>&nbsp; <a href="lua.h.html#L368" title="lua.h:368">lua_insert</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* put it at index 1 */<br/></li>
<li></span>&nbsp; <span class="Statement">for</span> (i = n; i &gt;= <span class="Constant">1</span>; i--)&nbsp; <span class="Comment">/* assign elements */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lapi.c.html#L785" title="lapi.c:785">lua_rawseti</a>(L, <span class="Constant">1</span>, i);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L464" title="lapi.c:464">lua_pushinteger</a>(L, n);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L745" title="lapi.c:745">lua_setfield</a>(L, <span class="Constant">1</span>, <span class="Constant">&quot;n&quot;</span>);&nbsp; <span class="Comment">/* t.n = number of elements */<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;&nbsp; <span class="Comment">/* return table */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L205">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">unpack</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="#L29" title="ltablib.c:29">TabA</a> ta;<br/></li>
<li>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> i, e;<br/></li>
<li>&nbsp; <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> n;<br/></li>
<li>&nbsp; <a href="#L36" title="ltablib.c:36">checktab</a>(L, <span class="Constant">1</span>, &amp;ta);<br/></li>
<li>&nbsp; i = <a href="lauxlib.c.html#L424" title="lauxlib.c:424">luaL_optinteger</a>(L, <span class="Constant">2</span>, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; e = <a href="lauxlib.h.html#L129" title="lauxlib.h:129">luaL_opt</a>(L, <a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>, <span class="Constant">3</span>, <a href="lauxlib.c.html#L736" title="lauxlib.c:736">luaL_len</a>(L, <span class="Constant">1</span>));<br/></li>
<li>&nbsp; <span class="Statement">if</span> (i &gt; e) <span class="Statement">return</span> <span class="Constant">0</span>;&nbsp; <span class="Comment">/* empty range */<br/></li>
<li></span>&nbsp; n = (<a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a>)e - i;&nbsp; <span class="Comment">/* number of elements minus 1 (avoid overflows) */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (n &gt;= (<span class="Type">unsigned</span> <span class="Type">int</span>)<span class="Constant">INT_MAX</span>&nbsp; || !<a href="lapi.c.html#L97" title="lapi.c:97">lua_checkstack</a>(L, (<span class="Type">int</span>)(++n)))<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="lauxlib.c.html#L212" title="lauxlib.c:212">luaL_error</a>(L, <span class="Constant">&quot;too many results to <a href="#L205" title="ltablib.c:205">unpack</a>&quot;</span>);<br/></li>
<li>&nbsp; <span class="Statement">do</span> {&nbsp; <span class="Comment">/* must have at least one element */<br/></li>
<li></span>&nbsp; &nbsp; (*ta.geti)(L, <span class="Constant">1</span>, i);&nbsp; <span class="Comment">/* push arg[i..e] */<br/></li>
<li></span>&nbsp; } <span class="Statement">while</span> (i++ &lt; e);<br/></li>
<li><br/></li>
<li>&nbsp; <span class="Statement">return</span> (<span class="Type">int</span>)n;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* }====================================================== */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** {======================================================<br/></li>
<li></span><span class="Comment">** Quicksort<br/></li>
<li></span><span class="Comment">** (based on 'Algorithms in MODULA-3', Robert Sedgewick;<br/></li>
<li></span><span class="Comment">**&nbsp; Addison-Wesley, 1993.)<br/></li>
<li></span><span class="Comment">** =======================================================<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L236">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">set2</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <a href="#L29" title="ltablib.c:29">TabA</a> *ta, <span class="Type">int</span> i, <span class="Type">int</span> j) {<br/></li>
<li>&nbsp; (*ta-&gt;seti)(L, <span class="Constant">1</span>, i);<br/></li>
<li>&nbsp; (*ta-&gt;seti)(L, <span class="Constant">1</span>, j);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L241">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">sort_comp</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> a, <span class="Type">int</span> b) {<br/></li>
<li>&nbsp; <span class="Statement">if</span> (!<a href="lua.h.html#L353" title="lua.h:353">lua_isnil</a>(L, <span class="Constant">2</span>)) {&nbsp; <span class="Comment">/* function? */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">int</span> res;<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, a-<span class="Constant">1</span>);&nbsp; <span class="Comment">/* -1 to compensate function */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, b-<span class="Constant">2</span>);&nbsp; <span class="Comment">/* -2 to compensate function and 'a' */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lua.h.html#L272" title="lua.h:272">lua_call</a>(L, <span class="Constant">2</span>, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; res = <a href="lapi.c.html#L366" title="lapi.c:366">lua_toboolean</a>(L, -<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="lua.h.html#L342" title="lua.h:342">lua_pop</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> res;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span>&nbsp; <span class="Comment">/* a &lt; b? */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">return</span> <a href="lapi.c.html#L317" title="lapi.c:317">lua_compare</a>(L, a, b, <a href="lua.h.html#L212" title="lua.h:212">LUA_OPLT</a>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L256">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">auxsort</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <a href="#L29" title="ltablib.c:29">TabA</a> *ta, <span class="Type">int</span> l, <span class="Type">int</span> u) {<br/></li>
<li>&nbsp; <span class="Statement">while</span> (l &lt; u) {&nbsp; <span class="Comment">/* for tail recursion */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">int</span> i, j;<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="#L319" title="ltablib.c:319">sort</a> elements a[l], a[(l+u)/2] and a[u] */<br/></li>
<li></span>&nbsp; &nbsp; (*ta-&gt;geti)(L, <span class="Constant">1</span>, l);<br/></li>
<li>&nbsp; &nbsp; (*ta-&gt;geti)(L, <span class="Constant">1</span>, u);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L241" title="ltablib.c:241">sort_comp</a>(L, -<span class="Constant">1</span>, -<span class="Constant">2</span>))&nbsp; <span class="Comment">/* a[u] &lt; a[l]? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="#L236" title="ltablib.c:236">set2</a>(L, ta, l, u);&nbsp; <span class="Comment">/* swap a[l] - a[u] */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="lua.h.html#L342" title="lua.h:342">lua_pop</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (u-l == <span class="Constant">1</span>) <span class="Statement">break</span>;&nbsp; <span class="Comment">/* only 2 elements */<br/></li>
<li></span>&nbsp; &nbsp; i = (l+u)/<span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; (*ta-&gt;geti)(L, <span class="Constant">1</span>, i);<br/></li>
<li>&nbsp; &nbsp; (*ta-&gt;geti)(L, <span class="Constant">1</span>, l);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L241" title="ltablib.c:241">sort_comp</a>(L, -<span class="Constant">2</span>, -<span class="Constant">1</span>))&nbsp; <span class="Comment">/* a[i]&lt;a[l]? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="#L236" title="ltablib.c:236">set2</a>(L, ta, i, l);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lua.h.html#L342" title="lua.h:342">lua_pop</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* remove a[l] */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; (*ta-&gt;geti)(L, <span class="Constant">1</span>, u);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L241" title="ltablib.c:241">sort_comp</a>(L, -<span class="Constant">1</span>, -<span class="Constant">2</span>))&nbsp; <span class="Comment">/* a[u]&lt;a[i]? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L236" title="ltablib.c:236">set2</a>(L, ta, i, u);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="lua.h.html#L342" title="lua.h:342">lua_pop</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (u-l == <span class="Constant">2</span>) <span class="Statement">break</span>;&nbsp; <span class="Comment">/* only 3 elements */<br/></li>
<li></span>&nbsp; &nbsp; (*ta-&gt;geti)(L, <span class="Constant">1</span>, i);&nbsp; <span class="Comment">/* Pivot */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lapi.c.html#L236" title="lapi.c:236">lua_pushvalue</a>(L, -<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; (*ta-&gt;geti)(L, <span class="Constant">1</span>, u-<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="#L236" title="ltablib.c:236">set2</a>(L, ta, i, u-<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* a[l] &lt;= P == a[u-1] &lt;= a[u], only need to <a href="#L319" title="ltablib.c:319">sort</a> from l+1 to u-2 */<br/></li>
<li></span>&nbsp; &nbsp; i = l; j = u-<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (;;) {&nbsp; <span class="Comment">/* invariant: a[l..i] &lt;= P &lt;= a[j..u] */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">/* repeat ++i until a[i] &gt;= P */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">while</span> ((*ta-&gt;geti)(L, <span class="Constant">1</span>, ++i), <a href="#L241" title="ltablib.c:241">sort_comp</a>(L, -<span class="Constant">1</span>, -<span class="Constant">2</span>)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i&gt;=u) <a href="lauxlib.c.html#L212" title="lauxlib.c:212">luaL_error</a>(L, <span class="Constant">&quot;invalid order function for sorting&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="lua.h.html#L342" title="lua.h:342">lua_pop</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* remove a[i] */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Comment">/* repeat --j until a[j] &lt;= P */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">while</span> ((*ta-&gt;geti)(L, <span class="Constant">1</span>, --j), <a href="#L241" title="ltablib.c:241">sort_comp</a>(L, -<span class="Constant">3</span>, -<span class="Constant">1</span>)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (j&lt;=l) <a href="lauxlib.c.html#L212" title="lauxlib.c:212">luaL_error</a>(L, <span class="Constant">&quot;invalid order function for sorting&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="lua.h.html#L342" title="lua.h:342">lua_pop</a>(L, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* remove a[j] */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (j&lt;i) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="lua.h.html#L342" title="lua.h:342">lua_pop</a>(L, <span class="Constant">3</span>);&nbsp; <span class="Comment">/* pop pivot, a[i], a[j] */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L236" title="ltablib.c:236">set2</a>(L, ta, i, j);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; (*ta-&gt;geti)(L, <span class="Constant">1</span>, u-<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; (*ta-&gt;geti)(L, <span class="Constant">1</span>, i);<br/></li>
<li>&nbsp; &nbsp; <a href="#L236" title="ltablib.c:236">set2</a>(L, ta, u-<span class="Constant">1</span>, i);&nbsp; <span class="Comment">/* swap pivot (a[u-1]) with a[i] */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* a[l..i-1] &lt;= a[i] == P &lt;= a[i+1..u] */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* adjust so that smaller half is in [j..i] and larger one in [l..u] */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (i-l &lt; u-i) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; j=l; i=i-<span class="Constant">1</span>; l=i+<span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; j=i+<span class="Constant">1</span>; i=u; u=j-<span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <a href="#L256" title="ltablib.c:256">auxsort</a>(L, ta, j, i);&nbsp; <span class="Comment">/* call recursively the smaller one */<br/></li>
<li></span>&nbsp; }&nbsp; <span class="Comment">/* repeat the routine for the larger one */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L319">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">sort</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="#L29" title="ltablib.c:29">TabA</a> ta;<br/></li>
<li>&nbsp; <span class="Type">int</span> n = (<span class="Type">int</span>)<a href="#L55" title="ltablib.c:55">aux_getn</a>(L, <span class="Constant">1</span>, &amp;ta);<br/></li>
<li>&nbsp; <a href="lauxlib.c.html#L350" title="lauxlib.c:350">luaL_checkstack</a>(L, <span class="Constant">50</span>, <span class="Constant">&quot;&quot;</span>);&nbsp; <span class="Comment">/* assume array is smaller than 2^50 */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (!<a href="lua.h.html#L357" title="lua.h:357">lua_isnoneornil</a>(L, <span class="Constant">2</span>))&nbsp; <span class="Comment">/* is there a 2nd argument? */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lauxlib.c.html#L362" title="lauxlib.c:362">luaL_checktype</a>(L, <span class="Constant">2</span>, <a href="lua.h.html#L68" title="lua.h:68">LUA_TFUNCTION</a>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L171" title="lapi.c:171">lua_settop</a>(L, <span class="Constant">2</span>);&nbsp; <span class="Comment">/* make sure there are two arguments */<br/></li>
<li></span>&nbsp; <a href="#L256" title="ltablib.c:256">auxsort</a>(L, &amp;ta, <span class="Constant">1</span>, n);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/* }====================================================== */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L333">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <a href="lauxlib.h.html#L23" title="lauxlib.h:23">luaL_Reg</a> <span class="linkable">tab_funcs</span>[] = {<br/></li>
<li>&nbsp; {<span class="Constant">&quot;concat&quot;</span>, <a href="#L165" title="ltablib.c:165">tconcat</a>},<br/></li>
<li><span class="PreProc">#if defined(<a href="luaconf.h.html#L354" title="luaconf.h:354">LUA_COMPAT_MAXN</a>)<br/></li>
<li></span>&nbsp; {<span class="Constant">&quot;<a href="#L59" title="ltablib.c:59">maxn</a>&quot;</span>, <a href="#L59" title="ltablib.c:59">maxn</a>},<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; {<span class="Constant">&quot;insert&quot;</span>, <a href="#L76" title="ltablib.c:76">tinsert</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;<a href="#L192" title="ltablib.c:192">pack</a>&quot;</span>, <a href="#L192" title="ltablib.c:192">pack</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;<a href="#L205" title="ltablib.c:205">unpack</a>&quot;</span>, <a href="#L205" title="ltablib.c:205">unpack</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;remove&quot;</span>, <a href="#L104" title="ltablib.c:104">tremove</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;move&quot;</span>, <a href="#L121" title="ltablib.c:121">tmove</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;<a href="#L319" title="ltablib.c:319">sort</a>&quot;</span>, <a href="#L319" title="ltablib.c:319">sort</a>},<br/></li>
<li>&nbsp; {<span class="Constant">NULL</span>, <span class="Constant">NULL</span>}<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L348">&#x200c;</a><a href="luaconf.h.html#L236" title="luaconf.h:236">LUAMOD_API</a> <span class="Type">int</span> <span class="linkable">luaopen_table</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lauxlib.h.html#L111" title="lauxlib.h:111">luaL_newlib</a>(L, <a href="#L333" title="ltablib.c:333">tab_funcs</a>);<br/></li>
<li><span class="PreProc">#if defined(<a href="luaconf.h.html#L321" title="luaconf.h:321">LUA_COMPAT_UNPACK</a>)<br/></li>
<li></span>&nbsp; <span class="Comment">/* _G.<a href="#L205" title="ltablib.c:205">unpack</a> = table.<a href="#L205" title="ltablib.c:205">unpack</a> */<br/></li>
<li></span>&nbsp; <a href="lapi.c.html#L603" title="lapi.c:603">lua_getfield</a>(L, -<span class="Constant">1</span>, <span class="Constant">&quot;<a href="#L205" title="ltablib.c:205">unpack</a>&quot;</span>);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L721" title="lapi.c:721">lua_setglobal</a>(L, <span class="Constant">&quot;<a href="#L205" title="ltablib.c:205">unpack</a>&quot;</span>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
</ol></code>
 </body>
</html>

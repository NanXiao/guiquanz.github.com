<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>lundump.c - src</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>lundump.c - src</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Data types defined</h4>
 <ul>
<li><a href="#L37">LoadState</a></li>
</ul>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L52">LoadBlock</a></li>
<li><a href="#L61">LoadByte</a></li>
<li><a href="#L103">LoadCode</a></li>
<li><a href="#L114">LoadConstants</a></li>
<li><a href="#L176">LoadDebug</a></li>
<li><a href="#L198">LoadFunction</a></li>
<li><a href="#L68">LoadInt</a></li>
<li><a href="#L82">LoadInteger</a></li>
<li><a href="#L75">LoadNumber</a></li>
<li><a href="#L148">LoadProtos</a></li>
<li><a href="#L89">LoadString</a></li>
<li><a href="#L162">LoadUpvalues</a></li>
<li><a href="#L232">checkHeader</a></li>
<li><a href="#L215">checkliteral</a></li>
<li><a href="#L40">error</a></li>
<li><a href="#L224">fchecksize</a></li>
<li><a href="#L254">luaU_undump</a></li>
</ul>
 <h4>Macros defined</h4>
 <ul>
<li><a href="#L8">LUA_CORE</a></li>
<li><a href="#L58">LoadVar</a></li>
<li><a href="#L50">LoadVector</a></li>
<li><a href="#L230">checksize</a></li>
<li><a href="#L28">luai_verifycode</a></li>
<li><a href="#L7">lundump_c</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** $Id: lundump.c,v 2.41 2014/11/02 19:19:04 roberto Exp $<br/></li>
<li></span><span class="Comment">** load precompiled Lua chunks<br/></li>
<li></span><span class="Comment">** See Copyright Notice in lua.h<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><a id="L7">&#x200c;</a><span class="PreProc">#define <span class="linkable">lundump_c</span><br/></li>
<li><a id="L8">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">LUA_CORE</span><br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lprefix.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;string.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lua.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;ldebug.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;ldo.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lfunc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lmem.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lobject.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lstring.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lundump.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lzio.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#if !defined(<a href="#L28" title="lundump.c:28">luai_verifycode</a>)<br/></li>
<li><a id="L28">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">luai_verifycode</span>(L,b,f)&nbsp; </span><span class="Comment">/* empty */<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct</span> {<br/></li>
<li>&nbsp; <a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L;<br/></li>
<li>&nbsp; <a href="lzio.h.html#L18" title="lzio.h:18">ZIO</a> *Z;<br/></li>
<li>&nbsp; <a href="lzio.h.html#L23" title="lzio.h:23">Mbuffer</a> *b;<br/></li>
<li>&nbsp; <span class="Type">const</span> <span class="Type">char</span> *name;<br/></li>
<li><a id="L37">&#x200c;</a>} <span class="linkable">LoadState</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L40">&#x200c;</a><span class="Type">static</span> <a href="llimits.h.html#L135" title="llimits.h:135">l_noret</a> <span class="linkable">error</span>(<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>, <span class="Type">const</span> <span class="Type">char</span> *why) {<br/></li>
<li>&nbsp; <a href="lobject.c.html#L416" title="lobject.c:416">luaO_pushfstring</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;L, <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">: </span><span class="Special">%s</span><span class="Constant"> precompiled chunk&quot;</span>, <a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;name, why);<br/></li>
<li>&nbsp; <a href="ldo.c.html#L110" title="ldo.c:110">luaD_throw</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;L, <a href="lua.h.html#L48" title="lua.h:48">LUA_ERRSYNTAX</a>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** All high-level loads go through <a href="#L50" title="lundump.c:50">LoadVector</a>; you can change it to<br/></li>
<li></span><span class="Comment">** adapt to the endianness of the input<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L50">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">LoadVector</span>(<a href="luac.c.html#L393" title="luac.c:393">S</a>,b,n)&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L52" title="lundump.c:52">LoadBlock</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>,b,(n)*</span><span class="Statement">sizeof</span><span class="PreProc">((b)[</span><span class="Constant">0</span><span class="PreProc">]))<br/></li>
<li></span><br/></li>
<li><a id="L52">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">LoadBlock</span> (<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>, <span class="Type">void</span> *b, <span class="Type">size_t</span> size) {<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="lzio.c.html#L48" title="lzio.c:48">luaZ_read</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;Z, b, size) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; <a href="#L40" title="lundump.c:40">error</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, <span class="Constant">&quot;truncated&quot;</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L58">&#x200c;</a><span class="PreProc">#define <span class="linkable">LoadVar</span>(<a href="luac.c.html#L393" title="luac.c:393">S</a>,x)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L50" title="lundump.c:50">LoadVector</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>,&amp;x,</span><span class="Constant">1</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L61">&#x200c;</a><span class="Type">static</span> <a href="llimits.h.html#L35" title="llimits.h:35">lu_byte</a> <span class="linkable">LoadByte</span> (<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>) {<br/></li>
<li>&nbsp; <a href="llimits.h.html#L35" title="llimits.h:35">lu_byte</a> x;<br/></li>
<li>&nbsp; <a href="#L58" title="lundump.c:58">LoadVar</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, x);<br/></li>
<li>&nbsp; <span class="Statement">return</span> x;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L68">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">LoadInt</span> (<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>) {<br/></li>
<li>&nbsp; <span class="Type">int</span> x;<br/></li>
<li>&nbsp; <a href="#L58" title="lundump.c:58">LoadVar</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, x);<br/></li>
<li>&nbsp; <span class="Statement">return</span> x;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L75">&#x200c;</a><span class="Type">static</span> <a href="lua.h.html#L87" title="lua.h:87">lua_Number</a> <span class="linkable">LoadNumber</span> (<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L87" title="lua.h:87">lua_Number</a> x;<br/></li>
<li>&nbsp; <a href="#L58" title="lundump.c:58">LoadVar</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, x);<br/></li>
<li>&nbsp; <span class="Statement">return</span> x;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L82">&#x200c;</a><span class="Type">static</span> <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> <span class="linkable">LoadInteger</span> (<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> x;<br/></li>
<li>&nbsp; <a href="#L58" title="lundump.c:58">LoadVar</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, x);<br/></li>
<li>&nbsp; <span class="Statement">return</span> x;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L89">&#x200c;</a><span class="Type">static</span> <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *<span class="linkable">LoadString</span> (<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>) {<br/></li>
<li>&nbsp; <span class="Type">size_t</span> size = <a href="#L61" title="lundump.c:61">LoadByte</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (size == <span class="Constant">0xFF</span>)<br/></li>
<li>&nbsp; &nbsp; <a href="#L58" title="lundump.c:58">LoadVar</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, size);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (size == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span> *s = <a href="lzio.c.html#L70" title="lzio.c:70">luaZ_openspace</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;L, <a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;b, --size);<br/></li>
<li>&nbsp; &nbsp; <a href="#L50" title="lundump.c:50">LoadVector</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, s, size);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="lstring.c.html#L151" title="lstring.c:151">luaS_newlstr</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;L, s, size);<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L103">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">LoadCode</span> (<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>, <a href="lobject.h.html#L398" title="lobject.h:398">Proto</a> *f) {<br/></li>
<li>&nbsp; <span class="Type">int</span> n = <a href="#L68" title="lundump.c:68">LoadInt</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; f-&gt;code = <a href="lmem.h.html#L47" title="lmem.h:47">luaM_newvector</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;L, n, <a href="llimits.h.html#L164" title="llimits.h:164">Instruction</a>);<br/></li>
<li>&nbsp; f-&gt;sizecode = n;<br/></li>
<li>&nbsp; <a href="#L50" title="lundump.c:50">LoadVector</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, f-&gt;code, n);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L198" title="lundump.c:198">LoadFunction</a>(<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>, <a href="lobject.h.html#L398" title="lobject.h:398">Proto</a> *f, <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *psource);<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L114">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">LoadConstants</span> (<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>, <a href="lobject.h.html#L398" title="lobject.h:398">Proto</a> *f) {<br/></li>
<li>&nbsp; <span class="Type">int</span> i;<br/></li>
<li>&nbsp; <span class="Type">int</span> n = <a href="#L68" title="lundump.c:68">LoadInt</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; f-&gt;k = <a href="lmem.h.html#L47" title="lmem.h:47">luaM_newvector</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;L, n, <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a>);<br/></li>
<li>&nbsp; f-&gt;sizek = n;<br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i++)<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L196" title="lobject.h:196">setnilvalue</a>(&amp;f-&gt;k[i]);<br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i++) {<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *o = &amp;f-&gt;k[i];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span> t = <a href="#L61" title="lundump.c:61">LoadByte</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (t) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L62" title="lua.h:62">LUA_TNIL</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L196" title="lobject.h:196">setnilvalue</a>(o);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L63" title="lua.h:63">LUA_TBOOLEAN</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L204" title="lobject.h:204">setbvalue</a>(o, <a href="#L61" title="lundump.c:61">LoadByte</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lobject.h.html#L60" title="lobject.h:60">LUA_TNUMFLT</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L190" title="lobject.h:190">setfltvalue</a>(o, <a href="#L75" title="lundump.c:75">LoadNumber</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lobject.h.html#L61" title="lobject.h:61">LUA_TNUMINT</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L193" title="lobject.h:193">setivalue</a>(o, <a href="#L82" title="lundump.c:82">LoadInteger</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lobject.h.html#L55" title="lobject.h:55">LUA_TSHRSTR</a>:<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lobject.h.html#L56" title="lobject.h:56">LUA_TLNGSTR</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L267" title="lobject.h:267">setsvalue2n</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;L, o, <a href="#L89" title="lundump.c:89">LoadString</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="lualib.h.html#L54" title="lualib.h:54">lua_assert</a>(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L148">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">LoadProtos</span> (<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>, <a href="lobject.h.html#L398" title="lobject.h:398">Proto</a> *f) {<br/></li>
<li>&nbsp; <span class="Type">int</span> i;<br/></li>
<li>&nbsp; <span class="Type">int</span> n = <a href="#L68" title="lundump.c:68">LoadInt</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; f-&gt;p = <a href="lmem.h.html#L47" title="lmem.h:47">luaM_newvector</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;L, n, <a href="lobject.h.html#L398" title="lobject.h:398">Proto</a> *);<br/></li>
<li>&nbsp; f-&gt;sizep = n;<br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i++)<br/></li>
<li>&nbsp; &nbsp; f-&gt;p[i] = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i++) {<br/></li>
<li>&nbsp; &nbsp; f-&gt;p[i] = <a href="lfunc.c.html#L99" title="lfunc.c:99">luaF_newproto</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;L);<br/></li>
<li>&nbsp; &nbsp; <a href="#L198" title="lundump.c:198">LoadFunction</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, f-&gt;p[i], f-&gt;source);<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L162">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">LoadUpvalues</span> (<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>, <a href="lobject.h.html#L398" title="lobject.h:398">Proto</a> *f) {<br/></li>
<li>&nbsp; <span class="Type">int</span> i, n;<br/></li>
<li>&nbsp; n = <a href="#L68" title="lundump.c:68">LoadInt</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; f-&gt;upvalues = <a href="lmem.h.html#L47" title="lmem.h:47">luaM_newvector</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;L, n, <a href="lobject.h.html#L377" title="lobject.h:377">Upvaldesc</a>);<br/></li>
<li>&nbsp; f-&gt;sizeupvalues = n;<br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i++)<br/></li>
<li>&nbsp; &nbsp; f-&gt;upvalues[i].name = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i++) {<br/></li>
<li>&nbsp; &nbsp; f-&gt;upvalues[i].instack = <a href="#L61" title="lundump.c:61">LoadByte</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; &nbsp; f-&gt;upvalues[i].idx = <a href="#L61" title="lundump.c:61">LoadByte</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L176">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">LoadDebug</span> (<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>, <a href="lobject.h.html#L398" title="lobject.h:398">Proto</a> *f) {<br/></li>
<li>&nbsp; <span class="Type">int</span> i, n;<br/></li>
<li>&nbsp; n = <a href="#L68" title="lundump.c:68">LoadInt</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; f-&gt;lineinfo = <a href="lmem.h.html#L47" title="lmem.h:47">luaM_newvector</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;L, n, <span class="Type">int</span>);<br/></li>
<li>&nbsp; f-&gt;sizelineinfo = n;<br/></li>
<li>&nbsp; <a href="#L50" title="lundump.c:50">LoadVector</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, f-&gt;lineinfo, n);<br/></li>
<li>&nbsp; n = <a href="#L68" title="lundump.c:68">LoadInt</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; f-&gt;locvars = <a href="lmem.h.html#L47" title="lmem.h:47">luaM_newvector</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;L, n, <a href="lobject.h.html#L388" title="lobject.h:388">LocVar</a>);<br/></li>
<li>&nbsp; f-&gt;sizelocvars = n;<br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i++)<br/></li>
<li>&nbsp; &nbsp; f-&gt;locvars[i].varname = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i++) {<br/></li>
<li>&nbsp; &nbsp; f-&gt;locvars[i].varname = <a href="#L89" title="lundump.c:89">LoadString</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; &nbsp; f-&gt;locvars[i].startpc = <a href="#L68" title="lundump.c:68">LoadInt</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; &nbsp; f-&gt;locvars[i].endpc = <a href="#L68" title="lundump.c:68">LoadInt</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; n = <a href="#L68" title="lundump.c:68">LoadInt</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i++)<br/></li>
<li>&nbsp; &nbsp; f-&gt;upvalues[i].name = <a href="#L89" title="lundump.c:89">LoadString</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L198">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">LoadFunction</span> (<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>, <a href="lobject.h.html#L398" title="lobject.h:398">Proto</a> *f, <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *psource) {<br/></li>
<li>&nbsp; f-&gt;source = <a href="#L89" title="lundump.c:89">LoadString</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (f-&gt;source == <span class="Constant">NULL</span>)&nbsp; <span class="Comment">/* no source in dump? */<br/></li>
<li></span>&nbsp; &nbsp; f-&gt;source = psource;&nbsp; <span class="Comment">/* reuse parent's source */<br/></li>
<li></span>&nbsp; f-&gt;linedefined = <a href="#L68" title="lundump.c:68">LoadInt</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; f-&gt;lastlinedefined = <a href="#L68" title="lundump.c:68">LoadInt</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; f-&gt;numparams = <a href="#L61" title="lundump.c:61">LoadByte</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; f-&gt;is_vararg = <a href="#L61" title="lundump.c:61">LoadByte</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; f-&gt;maxstacksize = <a href="#L61" title="lundump.c:61">LoadByte</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; <a href="#L103" title="lundump.c:103">LoadCode</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, f);<br/></li>
<li>&nbsp; <a href="#L114" title="lundump.c:114">LoadConstants</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, f);<br/></li>
<li>&nbsp; <a href="#L162" title="lundump.c:162">LoadUpvalues</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, f);<br/></li>
<li>&nbsp; <a href="#L148" title="lundump.c:148">LoadProtos</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, f);<br/></li>
<li>&nbsp; <a href="#L176" title="lundump.c:176">LoadDebug</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, f);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L215">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">checkliteral</span> (<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>, <span class="Type">const</span> <span class="Type">char</span> *s, <span class="Type">const</span> <span class="Type">char</span> *msg) {<br/></li>
<li>&nbsp; <span class="Type">char</span> buff[<span class="Statement">sizeof</span>(<a href="lua.h.html#L31" title="lua.h:31">LUA_SIGNATURE</a>) + <span class="Statement">sizeof</span>(<a href="lundump.h.html#L16" title="lundump.h:16">LUAC_DATA</a>)]; <span class="Comment">/* larger than both */<br/></li>
<li></span>&nbsp; <span class="Type">size_t</span> len = strlen(s);<br/></li>
<li>&nbsp; <a href="#L50" title="lundump.c:50">LoadVector</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, buff, len);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (memcmp(s, buff, len) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; <a href="#L40" title="lundump.c:40">error</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, msg);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L224">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">fchecksize</span> (<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>, <span class="Type">size_t</span> size, <span class="Type">const</span> <span class="Type">char</span> *tname) {<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="#L61" title="lundump.c:61">LoadByte</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>) != size)<br/></li>
<li>&nbsp; &nbsp; <a href="#L40" title="lundump.c:40">error</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, <a href="lobject.c.html#L416" title="lobject.c:416">luaO_pushfstring</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>-&gt;L, <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> size mismatch in&quot;</span>, tname));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L230">&#x200c;</a><span class="PreProc">#define <span class="linkable">checksize</span>(<a href="luac.c.html#L393" title="luac.c:393">S</a>,t)&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L224" title="lundump.c:224">fchecksize</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>,</span><span class="Statement">sizeof</span><span class="PreProc">(t),#t)<br/></li>
<li></span><br/></li>
<li><a id="L232">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">checkHeader</span> (<a href="#L37" title="lundump.c:37">LoadState</a> *<a href="luac.c.html#L393" title="luac.c:393">S</a>) {<br/></li>
<li>&nbsp; <a href="#L215" title="lundump.c:215">checkliteral</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, <a href="lua.h.html#L31" title="lua.h:31">LUA_SIGNATURE</a> + <span class="Constant">1</span>, <span class="Constant">&quot;not a&quot;</span>);&nbsp; <span class="Comment">/* 1st char already checked */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (<a href="#L61" title="lundump.c:61">LoadByte</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>) != <a href="lundump.h.html#L22" title="lundump.h:22">LUAC_VERSION</a>)<br/></li>
<li>&nbsp; &nbsp; <a href="#L40" title="lundump.c:40">error</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, <span class="Constant">&quot;version mismatch in&quot;</span>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="#L61" title="lundump.c:61">LoadByte</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>) != <a href="lundump.h.html#L23" title="lundump.h:23">LUAC_FORMAT</a>)<br/></li>
<li>&nbsp; &nbsp; <a href="#L40" title="lundump.c:40">error</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, <span class="Constant">&quot;format mismatch in&quot;</span>);<br/></li>
<li>&nbsp; <a href="#L215" title="lundump.c:215">checkliteral</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, <a href="lundump.h.html#L16" title="lundump.h:16">LUAC_DATA</a>, <span class="Constant">&quot;corrupted&quot;</span>);<br/></li>
<li>&nbsp; <a href="#L230" title="lundump.c:230">checksize</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, <span class="Type">int</span>);<br/></li>
<li>&nbsp; <a href="#L230" title="lundump.c:230">checksize</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, <span class="Type">size_t</span>);<br/></li>
<li>&nbsp; <a href="#L230" title="lundump.c:230">checksize</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, <a href="llimits.h.html#L164" title="llimits.h:164">Instruction</a>);<br/></li>
<li>&nbsp; <a href="#L230" title="lundump.c:230">checksize</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a>);<br/></li>
<li>&nbsp; <a href="#L230" title="lundump.c:230">checksize</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, <a href="lua.h.html#L87" title="lua.h:87">lua_Number</a>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="#L82" title="lundump.c:82">LoadInteger</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>) != <a href="lundump.h.html#L18" title="lundump.h:18">LUAC_INT</a>)<br/></li>
<li>&nbsp; &nbsp; <a href="#L40" title="lundump.c:40">error</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, <span class="Constant">&quot;endianness mismatch in&quot;</span>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="#L75" title="lundump.c:75">LoadNumber</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>) != <a href="lundump.h.html#L19" title="lundump.h:19">LUAC_NUM</a>)<br/></li>
<li>&nbsp; &nbsp; <a href="#L40" title="lundump.c:40">error</a>(<a href="luac.c.html#L393" title="luac.c:393">S</a>, <span class="Constant">&quot;float format mismatch in&quot;</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** load precompiled chunk<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L254">&#x200c;</a></span><a href="lobject.h.html#L444" title="lobject.h:444">LClosure</a> *<span class="linkable">luaU_undump</span>(<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <a href="lzio.h.html#L18" title="lzio.h:18">ZIO</a> *Z, <a href="lzio.h.html#L23" title="lzio.h:23">Mbuffer</a> *buff,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *name) {<br/></li>
<li>&nbsp; <a href="#L37" title="lundump.c:37">LoadState</a> <a href="luac.c.html#L393" title="luac.c:393">S</a>;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L444" title="lobject.h:444">LClosure</a> *cl;<br/></li>
<li>&nbsp; <span class="Statement">if</span> (*name == <span class="Constant">'@'</span> || *name == <span class="Constant">'='</span>)<br/></li>
<li>&nbsp; &nbsp; <a href="luac.c.html#L393" title="luac.c:393">S</a>.name = name + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (*name == <a href="lua.h.html#L31" title="lua.h:31">LUA_SIGNATURE</a>[<span class="Constant">0</span>])<br/></li>
<li>&nbsp; &nbsp; <a href="luac.c.html#L393" title="luac.c:393">S</a>.name = <span class="Constant">&quot;binary string&quot;</span>;<br/></li>
<li>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; <a href="luac.c.html#L393" title="luac.c:393">S</a>.name = name;<br/></li>
<li>&nbsp; <a href="luac.c.html#L393" title="luac.c:393">S</a>.L = L;<br/></li>
<li>&nbsp; <a href="luac.c.html#L393" title="luac.c:393">S</a>.Z = Z;<br/></li>
<li>&nbsp; <a href="luac.c.html#L393" title="luac.c:393">S</a>.b = buff;<br/></li>
<li>&nbsp; <a href="#L232" title="lundump.c:232">checkHeader</a>(&amp;<a href="luac.c.html#L393" title="luac.c:393">S</a>);<br/></li>
<li>&nbsp; cl = <a href="lfunc.c.html#L33" title="lfunc.c:33">luaF_newLclosure</a>(L, <a href="#L61" title="lundump.c:61">LoadByte</a>(&amp;<a href="luac.c.html#L393" title="luac.c:393">S</a>));<br/></li>
<li>&nbsp; <a href="lobject.h.html#L226" title="lobject.h:226">setclLvalue</a>(L, L-&gt;top, cl);<br/></li>
<li>&nbsp; <a href="ldo.h.html#L20" title="ldo.h:20">incr_top</a>(L);<br/></li>
<li>&nbsp; cl-&gt;p = <a href="lfunc.c.html#L99" title="lfunc.c:99">luaF_newproto</a>(L);<br/></li>
<li>&nbsp; <a href="#L198" title="lundump.c:198">LoadFunction</a>(&amp;<a href="luac.c.html#L393" title="luac.c:393">S</a>, cl-&gt;p, <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; <a href="lualib.h.html#L54" title="lualib.h:54">lua_assert</a>(cl-&gt;nupvalues == cl-&gt;p-&gt;sizeupvalues);<br/></li>
<li>&nbsp; <a href="#L28" title="lundump.c:28">luai_verifycode</a>(L, buff, cl-&gt;p);<br/></li>
<li>&nbsp; <span class="Statement">return</span> cl;<br/></li>
<li>}<br/></li>
<li><br/></li>
</ol></code>
 </body>
</html>

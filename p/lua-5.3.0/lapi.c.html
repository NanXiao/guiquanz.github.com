<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>lapi.c - src</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>lapi.c - src</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Global variables defined</h4>
 <ul>
<li><a href="#L34">lua_ident</a></li>
</ul>
 <h4>Data types defined</h4>
 <ul>
<li><a href="#L906">CallS</a></li>
</ul>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L1168">aux_upvalue</a></li>
<li><a href="#L912">f_call</a></li>
<li><a href="#L1228">getupvalref</a></li>
<li><a href="#L91">growstack</a></li>
<li><a href="#L60">index2addr</a></li>
<li><a href="#L159">lua_absindex</a></li>
<li><a href="#L301">lua_arith</a></li>
<li><a href="#L133">lua_atpanic</a></li>
<li><a href="#L880">lua_callk</a></li>
<li><a href="#L97">lua_checkstack</a></li>
<li><a href="#L317">lua_compare</a></li>
<li><a href="#L1111">lua_concat</a></li>
<li><a href="#L221">lua_copy</a></li>
<li><a href="#L664">lua_createtable</a></li>
<li><a href="#L987">lua_dump</a></li>
<li><a href="#L1085">lua_error</a></li>
<li><a href="#L1011">lua_gc</a></li>
<li><a href="#L1137">lua_getallocf</a></li>
<li><a href="#L603">lua_getfield</a></li>
<li><a href="#L581">lua_getglobal</a></li>
<li><a href="#L615">lua_geti</a></li>
<li><a href="#L677">lua_getmetatable</a></li>
<li><a href="#L593">lua_gettable</a></li>
<li><a href="#L166">lua_gettop</a></li>
<li><a href="#L1193">lua_getupvalue</a></li>
<li><a href="#L704">lua_getuservalue</a></li>
<li><a href="#L263">lua_iscfunction</a></li>
<li><a href="#L269">lua_isinteger</a></li>
<li><a href="#L275">lua_isnumber</a></li>
<li><a href="#L282">lua_isstring</a></li>
<li><a href="#L288">lua_isuserdata</a></li>
<li><a href="#L1127">lua_len</a></li>
<li><a href="#L963">lua_load</a></li>
<li><a href="#L1155">lua_newuserdata</a></li>
<li><a href="#L1094">lua_next</a></li>
<li><a href="#L919">lua_pcallk</a></li>
<li><a href="#L550">lua_pushboolean</a></li>
<li><a href="#L526">lua_pushcclosure</a></li>
<li><a href="#L513">lua_pushfstring</a></li>
<li><a href="#L464">lua_pushinteger</a></li>
<li><a href="#L558">lua_pushlightuserdata</a></li>
<li><a href="#L472">lua_pushlstring</a></li>
<li><a href="#L448">lua_pushnil</a></li>
<li><a href="#L456">lua_pushnumber</a></li>
<li><a href="#L484">lua_pushstring</a></li>
<li><a href="#L566">lua_pushthread</a></li>
<li><a href="#L236">lua_pushvalue</a></li>
<li><a href="#L502">lua_pushvfstring</a></li>
<li><a href="#L294">lua_rawequal</a></li>
<li><a href="#L627">lua_rawget</a></li>
<li><a href="#L638">lua_rawgeti</a></li>
<li><a href="#L650">lua_rawgetp</a></li>
<li><a href="#L390">lua_rawlen</a></li>
<li><a href="#L769">lua_rawset</a></li>
<li><a href="#L785">lua_rawseti</a></li>
<li><a href="#L800">lua_rawsetp</a></li>
<li><a href="#L206">lua_rotate</a></li>
<li><a href="#L1147">lua_setallocf</a></li>
<li><a href="#L745">lua_setfield</a></li>
<li><a href="#L721">lua_setglobal</a></li>
<li><a href="#L757">lua_seti</a></li>
<li><a href="#L817">lua_setmetatable</a></li>
<li><a href="#L734">lua_settable</a></li>
<li><a href="#L171">lua_settop</a></li>
<li><a href="#L1207">lua_setupvalue</a></li>
<li><a href="#L857">lua_setuservalue</a></li>
<li><a href="#L1002">lua_status</a></li>
<li><a href="#L336">lua_stringtonumber</a></li>
<li><a href="#L366">lua_toboolean</a></li>
<li><a href="#L401">lua_tocfunction</a></li>
<li><a href="#L355">lua_tointegerx</a></li>
<li><a href="#L372">lua_tolstring</a></li>
<li><a href="#L344">lua_tonumberx</a></li>
<li><a href="#L426">lua_topointer</a></li>
<li><a href="#L420">lua_tothread</a></li>
<li><a href="#L410">lua_touserdata</a></li>
<li><a href="#L250">lua_type</a></li>
<li><a href="#L256">lua_typename</a></li>
<li><a href="#L1239">lua_upvalueid</a></li>
<li><a href="#L1258">lua_upvaluejoin</a></li>
<li><a href="#L143">lua_version</a></li>
<li><a href="#L118">lua_xmove</a></li>
<li><a href="#L192">reverse</a></li>
</ul>
 <h4>Macros defined</h4>
 <ul>
<li><a href="#L8">LUA_CORE</a></li>
<li><a href="#L40">NONVALIDVALUE</a></li>
<li><a href="#L56">api_checkstackindex</a></li>
<li><a href="#L54">api_checkvalidindex</a></li>
<li><a href="#L875">checkresults</a></li>
<li><a href="#L46">ispseudo</a></li>
<li><a href="#L52">isstackindex</a></li>
<li><a href="#L49">isupvalue</a></li>
<li><a href="#L43">isvalid</a></li>
<li><a href="#L7">lapi_c</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** $Id: lapi.c,v 2.244 2014/12/26 14:43:45 roberto Exp $<br/></li>
<li></span><span class="Comment">** Lua API<br/></li>
<li></span><span class="Comment">** See Copyright Notice in lua.h<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><a id="L7">&#x200c;</a><span class="PreProc">#define <span class="linkable">lapi_c</span><br/></li>
<li><a id="L8">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">LUA_CORE</span><br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lprefix.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;stdarg.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;string.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lua.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lapi.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;ldebug.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;ldo.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lfunc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lgc.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lmem.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lobject.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lstate.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lstring.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;ltable.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;ltm.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lundump.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lvm.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L34">&#x200c;</a><span class="Type">const</span> <span class="Type">char</span> <span class="linkable">lua_ident</span>[] =<br/></li>
<li>&nbsp; <span class="Constant">&quot;$LuaVersion: &quot;</span> <a href="lua.h.html#L26" title="lua.h:26">LUA_COPYRIGHT</a> <span class="Constant">&quot; $&quot;<br/></li>
<li></span>&nbsp; <span class="Constant">&quot;$LuaAuthors: &quot;</span> <a href="lua.h.html#L27" title="lua.h:27">LUA_AUTHORS</a> <span class="Constant">&quot; $&quot;</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* value at a non-valid index */<br/></li>
<li><a id="L40">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NONVALIDVALUE</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="llimits.h.html#L107" title="llimits.h:107">cast</a>(<a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *, <a href="lobject.h.html#L516" title="lobject.h:516">luaO_nilobject</a>)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* corresponding test */<br/></li>
<li><a id="L43">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">isvalid</span>(o)&nbsp; &nbsp; &nbsp; &nbsp; ((o) != <a href="lobject.h.html#L516" title="lobject.h:516">luaO_nilobject</a>)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* test for pseudo index */<br/></li>
<li><a id="L46">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ispseudo</span>(i)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((i) &lt;= <a href="lua.h.html#L40" title="lua.h:40">LUA_REGISTRYINDEX</a>)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* test for upvalue */<br/></li>
<li><a id="L49">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">isupvalue</span>(i)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((i) &lt; <a href="lua.h.html#L40" title="lua.h:40">LUA_REGISTRYINDEX</a>)<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* test for valid but not pseudo index */<br/></li>
<li><a id="L52">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">isstackindex</span>(i, o)&nbsp; &nbsp; &nbsp; &nbsp; (<a href="#L43" title="lapi.c:43">isvalid</a>(o) &amp;&amp; !<a href="#L46" title="lapi.c:46">ispseudo</a>(i))<br/></li>
<li></span><br/></li>
<li><a id="L54">&#x200c;</a><span class="PreProc">#define <span class="linkable">api_checkvalidindex</span>(o)&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<a href="#L43" title="lapi.c:43">isvalid</a>(o), </span><span class="Constant">&quot;invalid index&quot;</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><a id="L56">&#x200c;</a><span class="PreProc">#define <span class="linkable">api_checkstackindex</span>(i, o)&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<a href="#L52" title="lapi.c:52">isstackindex</a>(i, o), </span><span class="Constant">&quot;index not in the stack&quot;</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L60">&#x200c;</a><span class="Type">static</span> <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *<span class="linkable">index2addr</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lstate.h.html#L65" title="lstate.h:65">CallInfo</a> *ci = L-&gt;ci;<br/></li>
<li>&nbsp; <span class="Statement">if</span> (idx &gt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *o = ci-&gt;func + idx;<br/></li>
<li>&nbsp; &nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(idx &lt;= ci-&gt;top - (ci-&gt;func + <span class="Constant">1</span>), <span class="Constant">&quot;unacceptable index&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (o &gt;= L-&gt;top) <span class="Statement">return</span> <a href="#L40" title="lapi.c:40">NONVALIDVALUE</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">return</span> o;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!<a href="#L46" title="lapi.c:46">ispseudo</a>(idx)) {&nbsp; <span class="Comment">/* negative index */<br/></li>
<li></span>&nbsp; &nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(idx != <span class="Constant">0</span> &amp;&amp; -idx &lt;= L-&gt;top - (ci-&gt;func + <span class="Constant">1</span>), <span class="Constant">&quot;invalid index&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> L-&gt;top + idx;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (idx == <a href="lua.h.html#L40" title="lua.h:40">LUA_REGISTRYINDEX</a>)<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> &amp;<a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;l_registry;<br/></li>
<li>&nbsp; <span class="Statement">else</span> {&nbsp; <span class="Comment">/* upvalues */<br/></li>
<li></span>&nbsp; &nbsp; idx = <a href="lua.h.html#L40" title="lua.h:40">LUA_REGISTRYINDEX</a> - idx;<br/></li>
<li>&nbsp; &nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(idx &lt;= <a href="llimits.h.html#L156" title="llimits.h:156">MAXUPVAL</a> + <span class="Constant">1</span>, <span class="Constant">&quot;upvalue index too large&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="lobject.h.html#L148" title="lobject.h:148">ttislcf</a>(ci-&gt;func))&nbsp; <span class="Comment">/* light C function? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L40" title="lapi.c:40">NONVALIDVALUE</a>;&nbsp; <span class="Comment">/* it has no upvalues */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L437" title="lobject.h:437">CClosure</a> *func = <a href="lobject.h.html#L165" title="lobject.h:165">clCvalue</a>(ci-&gt;func);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> (idx &lt;= func-&gt;nupvalues) ? &amp;func-&gt;upvalue[idx-<span class="Constant">1</span>] : <a href="#L40" title="lapi.c:40">NONVALIDVALUE</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** to be called by '<a href="#L97" title="lapi.c:97">lua_checkstack</a>' in protected mode, to grow stack<br/></li>
<li></span><span class="Comment">** capturing memory errors<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L91">&#x200c;</a></span><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">growstack</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">void</span> *ud) {<br/></li>
<li>&nbsp; <span class="Type">int</span> size = *(<span class="Type">int</span> *)ud;<br/></li>
<li>&nbsp; <a href="ldo.c.html#L186" title="ldo.c:186">luaD_growstack</a>(L, size);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L97">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_checkstack</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> n) {<br/></li>
<li>&nbsp; <span class="Type">int</span> res;<br/></li>
<li>&nbsp; <a href="lstate.h.html#L65" title="lstate.h:65">CallInfo</a> *ci = L-&gt;ci;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(n &gt;= <span class="Constant">0</span>, <span class="Constant">&quot;negative 'n'&quot;</span>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (L-&gt;stack_last - L-&gt;top &gt; n)&nbsp; <span class="Comment">/* stack large enough? */<br/></li>
<li></span>&nbsp; &nbsp; res = <span class="Constant">1</span>;&nbsp; <span class="Comment">/* yes; <a href="lparser.c.html#L106" title="lparser.c:106">check</a> is OK */<br/></li>
<li></span>&nbsp; <span class="Statement">else</span> {&nbsp; <span class="Comment">/* no; need to grow stack */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">int</span> inuse = <a href="llimits.h.html#L112" title="llimits.h:112">cast_int</a>(L-&gt;top - L-&gt;stack) + <a href="lstate.h.html#L38" title="lstate.h:38">EXTRA_STACK</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (inuse &gt; <a href="luaconf.h.html#L669" title="luaconf.h:669">LUAI_MAXSTACK</a> - n)&nbsp; <span class="Comment">/* can grow without overflow? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; res = <span class="Constant">0</span>;&nbsp; <span class="Comment">/* no */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">else</span>&nbsp; <span class="Comment">/* try to grow stack */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; res = (<a href="ldo.c.html#L136" title="ldo.c:136">luaD_rawrunprotected</a>(L, &amp;<a href="#L91" title="lapi.c:91">growstack</a>, &amp;n) == <a href="lua.h.html#L45" title="lua.h:45">LUA_OK</a>);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">if</span> (res &amp;&amp; ci-&gt;top &lt; L-&gt;top + n)<br/></li>
<li>&nbsp; &nbsp; ci-&gt;top = L-&gt;top + n;&nbsp; <span class="Comment">/* adjust frame top */<br/></li>
<li></span>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> res;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L118">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_xmove</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *from, <a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *to, <span class="Type">int</span> n) {<br/></li>
<li>&nbsp; <span class="Type">int</span> i;<br/></li>
<li>&nbsp; <span class="Statement">if</span> (from == to) <span class="Statement">return</span>;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(to);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(from, n);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<a href="lstate.h.html#L175" title="lstate.h:175">G</a>(from) == <a href="lstate.h.html#L175" title="lstate.h:175">G</a>(to), <span class="Constant">&quot;moving among independent states&quot;</span>);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(to-&gt;ci-&gt;top - to-&gt;top &gt;= n, <span class="Constant">&quot;not enough elements to move&quot;</span>);<br/></li>
<li>&nbsp; from-&gt;top -= n;<br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i++) {<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L257" title="lobject.h:257">setobj2s</a>(to, to-&gt;top++, from-&gt;top + i);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(to);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L133">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <a href="lua.h.html#L103" title="lua.h:103">lua_CFunction</a> <span class="linkable">lua_atpanic</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <a href="lua.h.html#L103" title="lua.h:103">lua_CFunction</a> panicf) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L103" title="lua.h:103">lua_CFunction</a> old;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; old = <a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;<a href="lauxlib.c.html#L948" title="lauxlib.c:948">panic</a>;<br/></li>
<li>&nbsp; <a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;<a href="lauxlib.c.html#L948" title="lauxlib.c:948">panic</a> = panicf;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> old;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L143">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">const</span> <a href="lua.h.html#L87" title="lua.h:87">lua_Number</a> *<span class="linkable">lua_version</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">static</span> <span class="Type">const</span> <a href="lua.h.html#L87" title="lua.h:87">lua_Number</a> version = <a href="lua.h.html#L21" title="lua.h:21">LUA_VERSION_NUM</a>;<br/></li>
<li>&nbsp; <span class="Statement">if</span> (L == <span class="Constant">NULL</span>) <span class="Statement">return</span> &amp;version;<br/></li>
<li>&nbsp; <span class="Statement">else</span> <span class="Statement">return</span> <a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;version;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** basic stack manipulation<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** convert an acceptable stack index into an absolute index<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L159">&#x200c;</a></span><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_absindex</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <span class="Statement">return</span> (idx &gt; <span class="Constant">0</span> || <a href="#L46" title="lapi.c:46">ispseudo</a>(idx))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ? idx<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; : <a href="llimits.h.html#L112" title="llimits.h:112">cast_int</a>(L-&gt;top - L-&gt;ci-&gt;func + idx);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L166">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_gettop</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="llimits.h.html#L112" title="llimits.h:112">cast_int</a>(L-&gt;top - (L-&gt;ci-&gt;func + <span class="Constant">1</span>));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L171">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_settop</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> func = L-&gt;ci-&gt;func;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (idx &gt;= <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(idx &lt;= L-&gt;stack_last - (func + <span class="Constant">1</span>), <span class="Constant">&quot;new top too large&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (L-&gt;top &lt; (func + <span class="Constant">1</span>) + idx)<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L196" title="lobject.h:196">setnilvalue</a>(L-&gt;top++);<br/></li>
<li>&nbsp; &nbsp; L-&gt;top = (func + <span class="Constant">1</span>) + idx;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(-(idx+<span class="Constant">1</span>) &lt;= (L-&gt;top - (func + <span class="Constant">1</span>)), <span class="Constant">&quot;invalid new top&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; L-&gt;top += idx+<span class="Constant">1</span>;&nbsp; <span class="Comment">/* 'subtract' index (index is negative) */<br/></li>
<li></span>&nbsp; }<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** Reverse the stack segment from 'from' to 'to'<br/></li>
<li></span><span class="Comment">** (auxiliary to '<a href="#L206" title="lapi.c:206">lua_rotate</a>')<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L192">&#x200c;</a></span><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">reverse</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> from, <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> to) {<br/></li>
<li>&nbsp; <span class="Statement">for</span> (; from &lt; to; from++, to--) {<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> temp;<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L245" title="lobject.h:245">setobj</a>(L, &amp;temp, from);<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L255" title="lobject.h:255">setobjs2s</a>(L, from, to);<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L257" title="lobject.h:257">setobj2s</a>(L, to, &amp;temp);<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** Let x = AB, where A is a prefix of length 'n'. Then,<br/></li>
<li></span><span class="Comment">** rotate x n == BA. But BA == (A^r . B^r)^r.<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L206">&#x200c;</a></span><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_rotate</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx, <span class="Type">int</span> n) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> p, t, m;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; t = L-&gt;top - <span class="Constant">1</span>;&nbsp; <span class="Comment">/* end of stack segment being rotated */<br/></li>
<li></span>&nbsp; p = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);&nbsp; <span class="Comment">/* start of segment */<br/></li>
<li></span>&nbsp; <a href="#L56" title="lapi.c:56">api_checkstackindex</a>(idx, p);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>((n &gt;= <span class="Constant">0</span> ? n : -n) &lt;= (t - p + <span class="Constant">1</span>), <span class="Constant">&quot;invalid 'n'&quot;</span>);<br/></li>
<li>&nbsp; m = (n &gt;= <span class="Constant">0</span> ? t - n : p - n - <span class="Constant">1</span>);&nbsp; <span class="Comment">/* end of prefix */<br/></li>
<li></span>&nbsp; <a href="#L192" title="lapi.c:192">reverse</a>(L, p, m);&nbsp; <span class="Comment">/* <a href="#L192" title="lapi.c:192">reverse</a> the prefix with length 'n' */<br/></li>
<li></span>&nbsp; <a href="#L192" title="lapi.c:192">reverse</a>(L, m + <span class="Constant">1</span>, t);&nbsp; <span class="Comment">/* <a href="#L192" title="lapi.c:192">reverse</a> the suffix */<br/></li>
<li></span>&nbsp; <a href="#L192" title="lapi.c:192">reverse</a>(L, p, t);&nbsp; <span class="Comment">/* <a href="#L192" title="lapi.c:192">reverse</a> the entire segment */<br/></li>
<li></span>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L221">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_copy</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> fromidx, <span class="Type">int</span> toidx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *fr, *to;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; fr = <a href="#L60" title="lapi.c:60">index2addr</a>(L, fromidx);<br/></li>
<li>&nbsp; to = <a href="#L60" title="lapi.c:60">index2addr</a>(L, toidx);<br/></li>
<li>&nbsp; <a href="#L54" title="lapi.c:54">api_checkvalidindex</a>(to);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L245" title="lobject.h:245">setobj</a>(L, to, fr);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="#L49" title="lapi.c:49">isupvalue</a>(toidx))&nbsp; <span class="Comment">/* function upvalue? */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lgc.h.html#L109" title="lgc.h:109">luaC_barrier</a>(L, <a href="lobject.h.html#L165" title="lobject.h:165">clCvalue</a>(L-&gt;ci-&gt;func), fr);<br/></li>
<li>&nbsp; <span class="Comment">/* <a href="lua.h.html#L40" title="lua.h:40">LUA_REGISTRYINDEX</a> does not need gc barrier<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; (collector revisits it before finishing collection) */<br/></li>
<li></span>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L236">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_pushvalue</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L257" title="lobject.h:257">setobj2s</a>(L, L-&gt;top, <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx));<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** access functions (stack -&gt; C)<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L250">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_type</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <span class="Statement">return</span> (<a href="#L43" title="lapi.c:43">isvalid</a>(o) ? <a href="lobject.h.html#L128" title="lobject.h:128">ttnov</a>(o) : <a href="lua.h.html#L60" title="lua.h:60">LUA_TNONE</a>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L256">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">const</span> <span class="Type">char</span> *<span class="linkable">lua_typename</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> t) {<br/></li>
<li>&nbsp; <a href="llimits.h.html#L103" title="llimits.h:103">UNUSED</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<a href="lua.h.html#L60" title="lua.h:60">LUA_TNONE</a> &lt;= t &amp;&amp; t &lt; <a href="lua.h.html#L72" title="lua.h:72">LUA_NUMTAGS</a>, <span class="Constant">&quot;invalid tag&quot;</span>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="ltm.h.html#L53" title="ltm.h:53">ttypename</a>(t);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L263">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_iscfunction</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <span class="Statement">return</span> (<a href="lobject.h.html#L148" title="lobject.h:148">ttislcf</a>(o) || (<a href="lobject.h.html#L146" title="lobject.h:146">ttisCclosure</a>(o)));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L269">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_isinteger</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="lobject.h.html#L136" title="lobject.h:136">ttisinteger</a>(o);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L275">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_isnumber</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L87" title="lua.h:87">lua_Number</a> n;<br/></li>
<li>&nbsp; <span class="Type">const</span> <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="lvm.h.html#L30" title="lvm.h:30">tonumber</a>(o, &amp;n);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L282">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_isstring</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <span class="Type">const</span> <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <span class="Statement">return</span> (<a href="lobject.h.html#L140" title="lobject.h:140">ttisstring</a>(o) || <a href="lvm.h.html#L17" title="lvm.h:17">cvt2str</a>(o));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L288">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_isuserdata</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <span class="Type">const</span> <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <span class="Statement">return</span> (<a href="lobject.h.html#L149" title="lobject.h:149">ttisfulluserdata</a>(o) || <a href="lobject.h.html#L139" title="lobject.h:139">ttislightuserdata</a>(o));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L294">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_rawequal</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> index1, <span class="Type">int</span> index2) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o1 = <a href="#L60" title="lapi.c:60">index2addr</a>(L, index1);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o2 = <a href="#L60" title="lapi.c:60">index2addr</a>(L, index2);<br/></li>
<li>&nbsp; <span class="Statement">return</span> (<a href="#L43" title="lapi.c:43">isvalid</a>(o1) &amp;&amp; <a href="#L43" title="lapi.c:43">isvalid</a>(o2)) ? <a href="lvm.h.html#L38" title="lvm.h:38">luaV_rawequalobj</a>(o1, o2) : <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L301">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_arith</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> op) {<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (op != <a href="lua.h.html#L206" title="lua.h:206">LUA_OPUNM</a> &amp;&amp; op != <a href="lua.h.html#L207" title="lua.h:207">LUA_OPBNOT</a>)<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, <span class="Constant">2</span>);&nbsp; <span class="Comment">/* all other operations expect two operands */<br/></li>
<li></span>&nbsp; <span class="Statement">else</span> {&nbsp; <span class="Comment">/* for unary operations, add fake 2nd operand */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L255" title="lobject.h:255">setobjs2s</a>(L, L-&gt;top, L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; L-&gt;top++;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Comment">/* first operand at top - 2, second at top - 1; result go to top - 2 */<br/></li>
<li></span>&nbsp; <a href="lobject.c.html#L116" title="lobject.c:116">luaO_arith</a>(L, op, L-&gt;top - <span class="Constant">2</span>, L-&gt;top - <span class="Constant">1</span>, L-&gt;top - <span class="Constant">2</span>);<br/></li>
<li>&nbsp; L-&gt;top--;&nbsp; <span class="Comment">/* remove second operand */<br/></li>
<li></span>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L317">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_compare</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> index1, <span class="Type">int</span> index2, <span class="Type">int</span> op) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o1, o2;<br/></li>
<li>&nbsp; <span class="Type">int</span> i = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);&nbsp; <span class="Comment">/* may call tag method */<br/></li>
<li></span>&nbsp; o1 = <a href="#L60" title="lapi.c:60">index2addr</a>(L, index1);<br/></li>
<li>&nbsp; o2 = <a href="#L60" title="lapi.c:60">index2addr</a>(L, index2);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="#L43" title="lapi.c:43">isvalid</a>(o1) &amp;&amp; <a href="#L43" title="lapi.c:43">isvalid</a>(o2)) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (op) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L211" title="lua.h:211">LUA_OPEQ</a>: i = <a href="lvm.c.html#L305" title="lvm.c:305">luaV_equalobj</a>(L, o1, o2); <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L212" title="lua.h:212">LUA_OPLT</a>: i = <a href="lvm.c.html#L266" title="lvm.c:266">luaV_lessthan</a>(L, o1, o2); <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L213" title="lua.h:213">LUA_OPLE</a>: i = <a href="lvm.c.html#L284" title="lvm.c:284">luaV_lessequal</a>(L, o1, o2); <span class="Statement">break</span>;<br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<span class="Constant">0</span>, <span class="Constant">&quot;invalid option&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> i;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L336">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">size_t</span> <span class="linkable">lua_stringtonumber</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">const</span> <span class="Type">char</span> *s) {<br/></li>
<li>&nbsp; <span class="Type">size_t</span> sz = <a href="lobject.c.html#L282" title="lobject.c:282">luaO_str2num</a>(s, L-&gt;top);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (sz != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> sz;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L344">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <a href="lua.h.html#L87" title="lua.h:87">lua_Number</a> <span class="linkable">lua_tonumberx</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx, <span class="Type">int</span> *pisnum) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L87" title="lua.h:87">lua_Number</a> n;<br/></li>
<li>&nbsp; <span class="Type">const</span> <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <span class="Type">int</span> isnum = <a href="lvm.h.html#L30" title="lvm.h:30">tonumber</a>(o, &amp;n);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (!isnum)<br/></li>
<li>&nbsp; &nbsp; n = <span class="Constant">0</span>;&nbsp; <span class="Comment">/* call to '<a href="lvm.h.html#L30" title="lvm.h:30">tonumber</a>' may change 'n' even if it fails */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (pisnum) *pisnum = isnum;<br/></li>
<li>&nbsp; <span class="Statement">return</span> n;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L355">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> <span class="linkable">lua_tointegerx</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx, <span class="Type">int</span> *pisnum) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> res;<br/></li>
<li>&nbsp; <span class="Type">const</span> <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <span class="Type">int</span> isnum = <a href="lvm.h.html#L33" title="lvm.h:33">tointeger</a>(o, &amp;res);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (!isnum)<br/></li>
<li>&nbsp; &nbsp; res = <span class="Constant">0</span>;&nbsp; <span class="Comment">/* call to '<a href="lvm.h.html#L33" title="lvm.h:33">tointeger</a>' may change 'n' even if it fails */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (pisnum) *pisnum = isnum;<br/></li>
<li>&nbsp; <span class="Statement">return</span> res;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L366">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_toboolean</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <span class="Type">const</span> <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <span class="Statement">return</span> !<a href="lobject.h.html#L173" title="lobject.h:173">l_isfalse</a>(o);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L372">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">const</span> <span class="Type">char</span> *<span class="linkable">lua_tolstring</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx, <span class="Type">size_t</span> *len) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (!<a href="lobject.h.html#L140" title="lobject.h:140">ttisstring</a>(o)) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="lvm.h.html#L17" title="lvm.h:17">cvt2str</a>(o)) {&nbsp; <span class="Comment">/* not convertible? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len != <span class="Constant">NULL</span>) *len = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);&nbsp; <span class="Comment">/* '<a href="lobject.c.html#L322" title="lobject.c:322">luaO_tostring</a>' may create a new string */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lgc.h.html#L106" title="lgc.h:106">luaC_checkGC</a>(L);<br/></li>
<li>&nbsp; &nbsp; o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);&nbsp; <span class="Comment">/* previous call may reallocate the stack */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lobject.c.html#L322" title="lobject.c:322">luaO_tostring</a>(L, o);<br/></li>
<li>&nbsp; &nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">if</span> (len != <span class="Constant">NULL</span>) *len = <a href="lobject.h.html#L161" title="lobject.h:161">tsvalue</a>(o)-&gt;len;<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="lobject.h.html#L330" title="lobject.h:330">svalue</a>(o);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L390">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">size_t</span> <span class="linkable">lua_rawlen</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <span class="Statement">switch</span> (<a href="lobject.h.html#L128" title="lobject.h:128">ttnov</a>(o)) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L66" title="lua.h:66">LUA_TSTRING</a>: <span class="Statement">return</span> <a href="lobject.h.html#L161" title="lobject.h:161">tsvalue</a>(o)-&gt;len;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L69" title="lua.h:69">LUA_TUSERDATA</a>: <span class="Statement">return</span> <a href="lobject.h.html#L162" title="lobject.h:162">uvalue</a>(o)-&gt;len;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a>: <span class="Statement">return</span> <a href="ltable.c.html#L622" title="ltable.c:622">luaH_getn</a>(<a href="lobject.h.html#L167" title="lobject.h:167">hvalue</a>(o));<br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L401">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <a href="lua.h.html#L103" title="lua.h:103">lua_CFunction</a> <span class="linkable">lua_tocfunction</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="lobject.h.html#L148" title="lobject.h:148">ttislcf</a>(o)) <span class="Statement">return</span> <a href="lobject.h.html#L166" title="lobject.h:166">fvalue</a>(o);<br/></li>
<li>&nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="lobject.h.html#L146" title="lobject.h:146">ttisCclosure</a>(o))<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="lobject.h.html#L165" title="lobject.h:165">clCvalue</a>(o)-&gt;f;<br/></li>
<li>&nbsp; <span class="Statement">else</span> <span class="Statement">return</span> <span class="Constant">NULL</span>;&nbsp; <span class="Comment">/* not a C function */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L410">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> *<span class="linkable">lua_touserdata</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <span class="Statement">switch</span> (<a href="lobject.h.html#L128" title="lobject.h:128">ttnov</a>(o)) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L69" title="lua.h:69">LUA_TUSERDATA</a>: <span class="Statement">return</span> <a href="lobject.h.html#L359" title="lobject.h:359">getudatamem</a>(<a href="lobject.h.html#L162" title="lobject.h:162">uvalue</a>(o));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L64" title="lua.h:64">LUA_TLIGHTUSERDATA</a>: <span class="Statement">return</span> <a href="lobject.h.html#L160" title="lobject.h:160">pvalue</a>(o);<br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L420">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *<span class="linkable">lua_tothread</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <span class="Statement">return</span> (!<a href="lobject.h.html#L150" title="lobject.h:150">ttisthread</a>(o)) ? <span class="Constant">NULL</span> : <a href="lobject.h.html#L169" title="lobject.h:169">thvalue</a>(o);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L426">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">const</span> <span class="Type">void</span> *<span class="linkable">lua_topointer</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <span class="Statement">switch</span> (<a href="lobject.h.html#L125" title="lobject.h:125">ttype</a>(o)) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a>: <span class="Statement">return</span> <a href="lobject.h.html#L167" title="lobject.h:167">hvalue</a>(o);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lobject.h.html#L49" title="lobject.h:49">LUA_TLCL</a>: <span class="Statement">return</span> <a href="lobject.h.html#L164" title="lobject.h:164">clLvalue</a>(o);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lobject.h.html#L51" title="lobject.h:51">LUA_TCCL</a>: <span class="Statement">return</span> <a href="lobject.h.html#L165" title="lobject.h:165">clCvalue</a>(o);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lobject.h.html#L50" title="lobject.h:50">LUA_TLCF</a>: <span class="Statement">return</span> <a href="llimits.h.html#L107" title="llimits.h:107">cast</a>(<span class="Type">void</span> *, <a href="llimits.h.html#L107" title="llimits.h:107">cast</a>(<span class="Type">size_t</span>, <a href="lobject.h.html#L166" title="lobject.h:166">fvalue</a>(o)));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L70" title="lua.h:70">LUA_TTHREAD</a>: <span class="Statement">return</span> <a href="lobject.h.html#L169" title="lobject.h:169">thvalue</a>(o);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L69" title="lua.h:69">LUA_TUSERDATA</a>:<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L64" title="lua.h:64">LUA_TLIGHTUSERDATA</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L410" title="lapi.c:410">lua_touserdata</a>(L, idx);<br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** push functions (C -&gt; stack)<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L448">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_pushnil</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L196" title="lobject.h:196">setnilvalue</a>(L-&gt;top);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L456">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_pushnumber</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <a href="lua.h.html#L87" title="lua.h:87">lua_Number</a> n) {<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L190" title="lobject.h:190">setfltvalue</a>(L-&gt;top, n);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L464">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_pushinteger</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> n) {<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L193" title="lobject.h:193">setivalue</a>(L-&gt;top, n);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L472">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">const</span> <span class="Type">char</span> *<span class="linkable">lua_pushlstring</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">const</span> <span class="Type">char</span> *s, <span class="Type">size_t</span> len) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *ts;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lgc.h.html#L106" title="lgc.h:106">luaC_checkGC</a>(L);<br/></li>
<li>&nbsp; ts = <a href="lstring.c.html#L151" title="lstring.c:151">luaS_newlstr</a>(L, s, len);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L258" title="lobject.h:258">setsvalue2s</a>(L, L-&gt;top, ts);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="lobject.h.html#L326" title="lobject.h:326">getstr</a>(ts);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L484">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">const</span> <span class="Type">char</span> *<span class="linkable">lua_pushstring</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">const</span> <span class="Type">char</span> *s) {<br/></li>
<li>&nbsp; <span class="Statement">if</span> (s == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; <a href="#L448" title="lapi.c:448">lua_pushnil</a>(L);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *ts;<br/></li>
<li>&nbsp; &nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; &nbsp; <a href="lgc.h.html#L106" title="lgc.h:106">luaC_checkGC</a>(L);<br/></li>
<li>&nbsp; &nbsp; ts = <a href="lstring.c.html#L165" title="lstring.c:165">luaS_new</a>(L, s);<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L258" title="lobject.h:258">setsvalue2s</a>(L, L-&gt;top, ts);<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; &nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="lobject.h.html#L326" title="lobject.h:326">getstr</a>(ts);<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L502">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">const</span> <span class="Type">char</span> *<span class="linkable">lua_pushvfstring</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">const</span> <span class="Type">char</span> *fmt,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">va_list</span> argp) {<br/></li>
<li>&nbsp; <span class="Type">const</span> <span class="Type">char</span> *ret;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lgc.h.html#L106" title="lgc.h:106">luaC_checkGC</a>(L);<br/></li>
<li>&nbsp; ret = <a href="lobject.c.html#L348" title="lobject.c:348">luaO_pushvfstring</a>(L, fmt, argp);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> ret;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L513">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">const</span> <span class="Type">char</span> *<span class="linkable">lua_pushfstring</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">const</span> <span class="Type">char</span> *fmt, ...) {<br/></li>
<li>&nbsp; <span class="Type">const</span> <span class="Type">char</span> *ret;<br/></li>
<li>&nbsp; <span class="Type">va_list</span> argp;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lgc.h.html#L106" title="lgc.h:106">luaC_checkGC</a>(L);<br/></li>
<li>&nbsp; va_start(argp, fmt);<br/></li>
<li>&nbsp; ret = <a href="lobject.c.html#L348" title="lobject.c:348">luaO_pushvfstring</a>(L, fmt, argp);<br/></li>
<li>&nbsp; va_end(argp);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> ret;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L526">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_pushcclosure</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <a href="lua.h.html#L103" title="lua.h:103">lua_CFunction</a> fn, <span class="Type">int</span> n) {<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L198" title="lobject.h:198">setfvalue</a>(L-&gt;top, fn);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L437" title="lobject.h:437">CClosure</a> *cl;<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, n);<br/></li>
<li>&nbsp; &nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(n &lt;= <a href="llimits.h.html#L156" title="llimits.h:156">MAXUPVAL</a>, <span class="Constant">&quot;upvalue index too large&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="lgc.h.html#L106" title="lgc.h:106">luaC_checkGC</a>(L);<br/></li>
<li>&nbsp; &nbsp; cl = <a href="lfunc.c.html#L25" title="lfunc.c:25">luaF_newCclosure</a>(L, n);<br/></li>
<li>&nbsp; &nbsp; cl-&gt;f = fn;<br/></li>
<li>&nbsp; &nbsp; L-&gt;top -= n;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (n--) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L266" title="lobject.h:266">setobj2n</a>(L, &amp;cl-&gt;upvalue[n], L-&gt;top + n);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Comment">/* does not need barrier because closure is white */<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L231" title="lobject.h:231">setclCvalue</a>(L, L-&gt;top, cl);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L550">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_pushboolean</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> b) {<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L204" title="lobject.h:204">setbvalue</a>(L-&gt;top, (b != <span class="Constant">0</span>));&nbsp; <span class="Comment">/* ensure that true is 1 */<br/></li>
<li></span>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L558">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_pushlightuserdata</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">void</span> *p) {<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L201" title="lobject.h:201">setpvalue</a>(L-&gt;top, p);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L566">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_pushthread</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L221" title="lobject.h:221">setthvalue</a>(L, L-&gt;top, L);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> (<a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;mainthread == L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** get functions (Lua -&gt; stack)<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L581">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_getglobal</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">const</span> <span class="Type">char</span> *name) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L488" title="lobject.h:488">Table</a> *reg = <a href="lobject.h.html#L167" title="lobject.h:167">hvalue</a>(&amp;<a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;l_registry);<br/></li>
<li>&nbsp; <span class="Type">const</span> <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *gt;&nbsp; <span class="Comment">/* global table */<br/></li>
<li></span>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; gt = <a href="ltable.c.html#L497" title="ltable.c:497">luaH_getint</a>(reg, <a href="lua.h.html#L82" title="lua.h:82">LUA_RIDX_GLOBALS</a>);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L258" title="lobject.h:258">setsvalue2s</a>(L, L-&gt;top++, <a href="lstring.c.html#L165" title="lstring.c:165">luaS_new</a>(L, name));<br/></li>
<li>&nbsp; <a href="lvm.c.html#L164" title="lvm.c:164">luaV_gettable</a>(L, gt, L-&gt;top - <span class="Constant">1</span>, L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="lobject.h.html#L128" title="lobject.h:128">ttnov</a>(L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L593">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_gettable</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> t;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; t = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="lvm.c.html#L164" title="lvm.c:164">luaV_gettable</a>(L, t, L-&gt;top - <span class="Constant">1</span>, L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="lobject.h.html#L128" title="lobject.h:128">ttnov</a>(L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L603">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_getfield</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx, <span class="Type">const</span> <span class="Type">char</span> *k) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> t;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; t = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L258" title="lobject.h:258">setsvalue2s</a>(L, L-&gt;top, <a href="lstring.c.html#L165" title="lstring.c:165">luaS_new</a>(L, k));<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="lvm.c.html#L164" title="lvm.c:164">luaV_gettable</a>(L, t, L-&gt;top - <span class="Constant">1</span>, L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="lobject.h.html#L128" title="lobject.h:128">ttnov</a>(L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L615">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_geti</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx, <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> n) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> t;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; t = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L193" title="lobject.h:193">setivalue</a>(L-&gt;top, n);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="lvm.c.html#L164" title="lvm.c:164">luaV_gettable</a>(L, t, L-&gt;top - <span class="Constant">1</span>, L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="lobject.h.html#L128" title="lobject.h:128">ttnov</a>(L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L627">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_rawget</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> t;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; t = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<a href="lobject.h.html#L143" title="lobject.h:143">ttistable</a>(t), <span class="Constant">&quot;table expected&quot;</span>);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L257" title="lobject.h:257">setobj2s</a>(L, L-&gt;top - <span class="Constant">1</span>, <a href="ltable.c.html#L540" title="ltable.c:540">luaH_get</a>(<a href="lobject.h.html#L167" title="lobject.h:167">hvalue</a>(t), L-&gt;top - <span class="Constant">1</span>));<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="lobject.h.html#L128" title="lobject.h:128">ttnov</a>(L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L638">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_rawgeti</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx, <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> n) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> t;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; t = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<a href="lobject.h.html#L143" title="lobject.h:143">ttistable</a>(t), <span class="Constant">&quot;table expected&quot;</span>);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L257" title="lobject.h:257">setobj2s</a>(L, L-&gt;top, <a href="ltable.c.html#L497" title="ltable.c:497">luaH_getint</a>(<a href="lobject.h.html#L167" title="lobject.h:167">hvalue</a>(t), n));<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="lobject.h.html#L128" title="lobject.h:128">ttnov</a>(L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L650">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_rawgetp</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx, <span class="Type">const</span> <span class="Type">void</span> *p) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> t;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> k;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; t = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<a href="lobject.h.html#L143" title="lobject.h:143">ttistable</a>(t), <span class="Constant">&quot;table expected&quot;</span>);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L201" title="lobject.h:201">setpvalue</a>(&amp;k, <a href="llimits.h.html#L107" title="llimits.h:107">cast</a>(<span class="Type">void</span> *, p));<br/></li>
<li>&nbsp; <a href="lobject.h.html#L257" title="lobject.h:257">setobj2s</a>(L, L-&gt;top, <a href="ltable.c.html#L540" title="ltable.c:540">luaH_get</a>(<a href="lobject.h.html#L167" title="lobject.h:167">hvalue</a>(t), &amp;k));<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="lobject.h.html#L128" title="lobject.h:128">ttnov</a>(L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L664">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_createtable</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> narray, <span class="Type">int</span> nrec) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L488" title="lobject.h:488">Table</a> *t;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lgc.h.html#L106" title="lgc.h:106">luaC_checkGC</a>(L);<br/></li>
<li>&nbsp; t = <a href="ltable.c.html#L403" title="ltable.c:403">luaH_new</a>(L);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L236" title="lobject.h:236">sethvalue</a>(L, L-&gt;top, t);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (narray &gt; <span class="Constant">0</span> || nrec &gt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; <a href="ltable.c.html#L335" title="ltable.c:335">luaH_resize</a>(L, t, narray, nrec);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L677">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_getmetatable</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> objindex) {<br/></li>
<li>&nbsp; <span class="Type">const</span> <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *obj;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L488" title="lobject.h:488">Table</a> *mt;<br/></li>
<li>&nbsp; <span class="Type">int</span> res = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; obj = <a href="#L60" title="lapi.c:60">index2addr</a>(L, objindex);<br/></li>
<li>&nbsp; <span class="Statement">switch</span> (<a href="lobject.h.html#L128" title="lobject.h:128">ttnov</a>(obj)) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; mt = <a href="lobject.h.html#L167" title="lobject.h:167">hvalue</a>(obj)-&gt;metatable;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L69" title="lua.h:69">LUA_TUSERDATA</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; mt = <a href="lobject.h.html#L162" title="lobject.h:162">uvalue</a>(obj)-&gt;metatable;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; mt = <a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;mt[<a href="lobject.h.html#L128" title="lobject.h:128">ttnov</a>(obj)];<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">if</span> (mt != <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L236" title="lobject.h:236">sethvalue</a>(L, L-&gt;top, mt);<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; &nbsp; res = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> res;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L704">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_getuservalue</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<a href="lobject.h.html#L149" title="lobject.h:149">ttisfulluserdata</a>(o), <span class="Constant">&quot;full userdata expected&quot;</span>);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L368" title="lobject.h:368">getuservalue</a>(L, <a href="lobject.h.html#L162" title="lobject.h:162">uvalue</a>(o), L-&gt;top);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="lobject.h.html#L128" title="lobject.h:128">ttnov</a>(L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** set functions (stack -&gt; Lua)<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L721">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_setglobal</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">const</span> <span class="Type">char</span> *name) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L488" title="lobject.h:488">Table</a> *reg = <a href="lobject.h.html#L167" title="lobject.h:167">hvalue</a>(&amp;<a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;l_registry);<br/></li>
<li>&nbsp; <span class="Type">const</span> <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *gt;&nbsp; <span class="Comment">/* global table */<br/></li>
<li></span>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; gt = <a href="ltable.c.html#L497" title="ltable.c:497">luaH_getint</a>(reg, <a href="lua.h.html#L82" title="lua.h:82">LUA_RIDX_GLOBALS</a>);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L258" title="lobject.h:258">setsvalue2s</a>(L, L-&gt;top++, <a href="lstring.c.html#L165" title="lstring.c:165">luaS_new</a>(L, name));<br/></li>
<li>&nbsp; <a href="lvm.c.html#L194" title="lvm.c:194">luaV_settable</a>(L, gt, L-&gt;top - <span class="Constant">1</span>, L-&gt;top - <span class="Constant">2</span>);<br/></li>
<li>&nbsp; L-&gt;top -= <span class="Constant">2</span>;&nbsp; <span class="Comment">/* pop value and key */<br/></li>
<li></span>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L734">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_settable</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> t;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; t = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="lvm.c.html#L194" title="lvm.c:194">luaV_settable</a>(L, t, L-&gt;top - <span class="Constant">2</span>, L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; L-&gt;top -= <span class="Constant">2</span>;&nbsp; <span class="Comment">/* pop index and value */<br/></li>
<li></span>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L745">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_setfield</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx, <span class="Type">const</span> <span class="Type">char</span> *k) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> t;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; t = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L258" title="lobject.h:258">setsvalue2s</a>(L, L-&gt;top++, <a href="lstring.c.html#L165" title="lstring.c:165">luaS_new</a>(L, k));<br/></li>
<li>&nbsp; <a href="lvm.c.html#L194" title="lvm.c:194">luaV_settable</a>(L, t, L-&gt;top - <span class="Constant">1</span>, L-&gt;top - <span class="Constant">2</span>);<br/></li>
<li>&nbsp; L-&gt;top -= <span class="Constant">2</span>;&nbsp; <span class="Comment">/* pop value and key */<br/></li>
<li></span>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L757">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_seti</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx, <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> n) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> t;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; t = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L193" title="lobject.h:193">setivalue</a>(L-&gt;top++, n);<br/></li>
<li>&nbsp; <a href="lvm.c.html#L194" title="lvm.c:194">luaV_settable</a>(L, t, L-&gt;top - <span class="Constant">1</span>, L-&gt;top - <span class="Constant">2</span>);<br/></li>
<li>&nbsp; L-&gt;top -= <span class="Constant">2</span>;&nbsp; <span class="Comment">/* pop value and key */<br/></li>
<li></span>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L769">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_rawset</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L488" title="lobject.h:488">Table</a> *t;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<a href="lobject.h.html#L143" title="lobject.h:143">ttistable</a>(o), <span class="Constant">&quot;table expected&quot;</span>);<br/></li>
<li>&nbsp; t = <a href="lobject.h.html#L167" title="lobject.h:167">hvalue</a>(o);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L264" title="lobject.h:264">setobj2t</a>(L, <a href="ltable.c.html#L572" title="ltable.c:572">luaH_set</a>(L, t, L-&gt;top-<span class="Constant">2</span>), L-&gt;top-<span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="ltable.h.html#L23" title="ltable.h:23">invalidateTMcache</a>(t);<br/></li>
<li>&nbsp; <a href="lgc.h.html#L113" title="lgc.h:113">luaC_barrierback</a>(L, t, L-&gt;top-<span class="Constant">1</span>);<br/></li>
<li>&nbsp; L-&gt;top -= <span class="Constant">2</span>;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L785">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_rawseti</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx, <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> n) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L488" title="lobject.h:488">Table</a> *t;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<a href="lobject.h.html#L143" title="lobject.h:143">ttistable</a>(o), <span class="Constant">&quot;table expected&quot;</span>);<br/></li>
<li>&nbsp; t = <a href="lobject.h.html#L167" title="lobject.h:167">hvalue</a>(o);<br/></li>
<li>&nbsp; <a href="ltable.c.html#L580" title="ltable.c:580">luaH_setint</a>(L, t, n, L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="lgc.h.html#L113" title="lgc.h:113">luaC_barrierback</a>(L, t, L-&gt;top-<span class="Constant">1</span>);<br/></li>
<li>&nbsp; L-&gt;top--;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L800">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_rawsetp</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx, <span class="Type">const</span> <span class="Type">void</span> *p) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L488" title="lobject.h:488">Table</a> *t;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> k;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<a href="lobject.h.html#L143" title="lobject.h:143">ttistable</a>(o), <span class="Constant">&quot;table expected&quot;</span>);<br/></li>
<li>&nbsp; t = <a href="lobject.h.html#L167" title="lobject.h:167">hvalue</a>(o);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L201" title="lobject.h:201">setpvalue</a>(&amp;k, <a href="llimits.h.html#L107" title="llimits.h:107">cast</a>(<span class="Type">void</span> *, p));<br/></li>
<li>&nbsp; <a href="lobject.h.html#L264" title="lobject.h:264">setobj2t</a>(L, <a href="ltable.c.html#L572" title="ltable.c:572">luaH_set</a>(L, t, &amp;k), L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="lgc.h.html#L113" title="lgc.h:113">luaC_barrierback</a>(L, t, L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; L-&gt;top--;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L817">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_setmetatable</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> objindex) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *obj;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L488" title="lobject.h:488">Table</a> *mt;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; obj = <a href="#L60" title="lapi.c:60">index2addr</a>(L, objindex);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="lobject.h.html#L137" title="lobject.h:137">ttisnil</a>(L-&gt;top - <span class="Constant">1</span>))<br/></li>
<li>&nbsp; &nbsp; mt = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<a href="lobject.h.html#L143" title="lobject.h:143">ttistable</a>(L-&gt;top - <span class="Constant">1</span>), <span class="Constant">&quot;table expected&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; mt = <a href="lobject.h.html#L167" title="lobject.h:167">hvalue</a>(L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">switch</span> (<a href="lobject.h.html#L128" title="lobject.h:128">ttnov</a>(obj)) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L67" title="lua.h:67">LUA_TTABLE</a>: {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L167" title="lobject.h:167">hvalue</a>(obj)-&gt;metatable = mt;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mt) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="lgc.h.html#L117" title="lgc.h:117">luaC_objbarrier</a>(L, <a href="lobject.h.html#L159" title="lobject.h:159">gcvalue</a>(obj), mt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="lgc.c.html#L882" title="lgc.c:882">luaC_checkfinalizer</a>(L, <a href="lobject.h.html#L159" title="lobject.h:159">gcvalue</a>(obj), mt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L69" title="lua.h:69">LUA_TUSERDATA</a>: {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L162" title="lobject.h:162">uvalue</a>(obj)-&gt;metatable = mt;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mt) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="lgc.h.html#L117" title="lgc.h:117">luaC_objbarrier</a>(L, <a href="lobject.h.html#L162" title="lobject.h:162">uvalue</a>(obj), mt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="lgc.c.html#L882" title="lgc.c:882">luaC_checkfinalizer</a>(L, <a href="lobject.h.html#L159" title="lobject.h:159">gcvalue</a>(obj), mt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;mt[<a href="lobject.h.html#L128" title="lobject.h:128">ttnov</a>(obj)] = mt;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; L-&gt;top--;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L857">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_setuservalue</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<a href="lobject.h.html#L149" title="lobject.h:149">ttisfulluserdata</a>(o), <span class="Constant">&quot;full userdata expected&quot;</span>);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L362" title="lobject.h:362">setuservalue</a>(L, <a href="lobject.h.html#L162" title="lobject.h:162">uvalue</a>(o), L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="lgc.h.html#L109" title="lgc.h:109">luaC_barrier</a>(L, <a href="lobject.h.html#L159" title="lobject.h:159">gcvalue</a>(o), L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; L-&gt;top--;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** 'load' and 'call' functions (run Lua code)<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L875">&#x200c;</a><span class="PreProc">#define <span class="linkable">checkresults</span>(L,na,nr) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp;&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>((nr) == <a href="lua.h.html#L34" title="lua.h:34">LUA_MULTRET</a> || (L-&gt;ci-&gt;top - L-&gt;top &gt;= (nr) - (na)), \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;results from function overflow current stack size&quot;</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L880">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_callk</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> nargs, <span class="Type">int</span> nresults,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="lua.h.html#L97" title="lua.h:97">lua_KContext</a> ctx, <a href="lua.h.html#L108" title="lua.h:108">lua_KFunction</a> k) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> func;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(k == <span class="Constant">NULL</span> || !<a href="lstate.h.html#L98" title="lstate.h:98">isLua</a>(L-&gt;ci),<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">&quot;<a href="luac.c.html#L44" title="luac.c:44">cannot</a> use continuations inside hooks&quot;</span>);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, nargs+<span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(L-&gt;status == <a href="lua.h.html#L45" title="lua.h:45">LUA_OK</a>, <span class="Constant">&quot;<a href="luac.c.html#L44" title="luac.c:44">cannot</a> do calls on non-normal thread&quot;</span>);<br/></li>
<li>&nbsp; <a href="#L875" title="lapi.c:875">checkresults</a>(L, nargs, nresults);<br/></li>
<li>&nbsp; func = L-&gt;top - (nargs+<span class="Constant">1</span>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (k != <span class="Constant">NULL</span> &amp;&amp; L-&gt;nny == <span class="Constant">0</span>) {&nbsp; <span class="Comment">/* need to prepare continuation? */<br/></li>
<li></span>&nbsp; &nbsp; L-&gt;ci-&gt;u.c.k = k;&nbsp; <span class="Comment">/* <a href="llex.c.html#L56" title="llex.c:56">save</a> continuation */<br/></li>
<li></span>&nbsp; &nbsp; L-&gt;ci-&gt;u.c.ctx = ctx;&nbsp; <span class="Comment">/* <a href="llex.c.html#L56" title="llex.c:56">save</a> context */<br/></li>
<li></span>&nbsp; &nbsp; <a href="ldo.c.html#L413" title="ldo.c:413">luaD_call</a>(L, func, nresults, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* do the call */<br/></li>
<li></span>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span>&nbsp; <span class="Comment">/* no continuation or no yieldable */<br/></li>
<li></span>&nbsp; &nbsp; <a href="ldo.c.html#L413" title="ldo.c:413">luaD_call</a>(L, func, nresults, <span class="Constant">0</span>);&nbsp; <span class="Comment">/* just do the call */<br/></li>
<li></span>&nbsp; <a href="lapi.h.html#L17" title="lapi.h:17">adjustresults</a>(L, nresults);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** Execute a protected call.<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L906">&#x200c;</a></span><span class="Type">struct</span> <span class="linkable">CallS</span> {&nbsp; <span class="Comment">/* data to '<a href="#L912" title="lapi.c:912">f_call</a>' */<br/></li>
<li></span>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> func;<br/></li>
<li>&nbsp; <span class="Type">int</span> nresults;<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L912">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">f_call</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">void</span> *ud) {<br/></li>
<li>&nbsp; <span class="Type">struct</span> <a href="#L906" title="lapi.c:906">CallS</a> *c = <a href="llimits.h.html#L107" title="llimits.h:107">cast</a>(<span class="Type">struct</span> <a href="#L906" title="lapi.c:906">CallS</a> *, ud);<br/></li>
<li>&nbsp; <a href="ldo.c.html#L413" title="ldo.c:413">luaD_call</a>(L, c-&gt;func, c-&gt;nresults, <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L919">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_pcallk</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> nargs, <span class="Type">int</span> nresults, <span class="Type">int</span> errfunc,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="lua.h.html#L97" title="lua.h:97">lua_KContext</a> ctx, <a href="lua.h.html#L108" title="lua.h:108">lua_KFunction</a> k) {<br/></li>
<li>&nbsp; <span class="Type">struct</span> <a href="#L906" title="lapi.c:906">CallS</a> c;<br/></li>
<li>&nbsp; <span class="Type">int</span> status;<br/></li>
<li>&nbsp; <span class="Type">ptrdiff_t</span> func;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(k == <span class="Constant">NULL</span> || !<a href="lstate.h.html#L98" title="lstate.h:98">isLua</a>(L-&gt;ci),<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">&quot;<a href="luac.c.html#L44" title="luac.c:44">cannot</a> use continuations inside hooks&quot;</span>);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, nargs+<span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(L-&gt;status == <a href="lua.h.html#L45" title="lua.h:45">LUA_OK</a>, <span class="Constant">&quot;<a href="luac.c.html#L44" title="luac.c:44">cannot</a> do calls on non-normal thread&quot;</span>);<br/></li>
<li>&nbsp; <a href="#L875" title="lapi.c:875">checkresults</a>(L, nargs, nresults);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (errfunc == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; func = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> o = <a href="#L60" title="lapi.c:60">index2addr</a>(L, errfunc);<br/></li>
<li>&nbsp; &nbsp; <a href="#L56" title="lapi.c:56">api_checkstackindex</a>(errfunc, o);<br/></li>
<li>&nbsp; &nbsp; func = <a href="ldo.h.html#L22" title="ldo.h:22">savestack</a>(L, o);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; c.func = L-&gt;top - (nargs+<span class="Constant">1</span>);&nbsp; <span class="Comment">/* function to be called */<br/></li>
<li></span>&nbsp; <span class="Statement">if</span> (k == <span class="Constant">NULL</span> || L-&gt;nny &gt; <span class="Constant">0</span>) {&nbsp; <span class="Comment">/* no continuation or no yieldable? */<br/></li>
<li></span>&nbsp; &nbsp; c.nresults = nresults;&nbsp; <span class="Comment">/* do a 'conventional' protected call */<br/></li>
<li></span>&nbsp; &nbsp; status = <a href="ldo.c.html#L636" title="ldo.c:636">luaD_pcall</a>(L, <a href="#L912" title="lapi.c:912">f_call</a>, &amp;c, <a href="ldo.h.html#L22" title="ldo.h:22">savestack</a>(L, c.func), func);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> {&nbsp; <span class="Comment">/* prepare continuation (call is already protected by '<a href="ldo.c.html#L534" title="ldo.c:534">resume</a>') */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lstate.h.html#L65" title="lstate.h:65">CallInfo</a> *ci = L-&gt;ci;<br/></li>
<li>&nbsp; &nbsp; ci-&gt;u.c.k = k;&nbsp; <span class="Comment">/* <a href="llex.c.html#L56" title="llex.c:56">save</a> continuation */<br/></li>
<li></span>&nbsp; &nbsp; ci-&gt;u.c.ctx = ctx;&nbsp; <span class="Comment">/* <a href="llex.c.html#L56" title="llex.c:56">save</a> context */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* <a href="llex.c.html#L56" title="llex.c:56">save</a> information for <a href="lundump.c.html#L40" title="lundump.c:40">error</a> recovery */<br/></li>
<li></span>&nbsp; &nbsp; ci-&gt;extra = <a href="ldo.h.html#L22" title="ldo.h:22">savestack</a>(L, c.func);<br/></li>
<li>&nbsp; &nbsp; ci-&gt;u.c.old_errfunc = L-&gt;errfunc;<br/></li>
<li>&nbsp; &nbsp; L-&gt;errfunc = func;<br/></li>
<li>&nbsp; &nbsp; <a href="lstate.h.html#L101" title="lstate.h:101">setoah</a>(ci-&gt;callstatus, L-&gt;allowhook);&nbsp; <span class="Comment">/* <a href="llex.c.html#L56" title="llex.c:56">save</a> value of 'allowhook' */<br/></li>
<li></span>&nbsp; &nbsp; ci-&gt;callstatus |= <a href="lstate.h.html#L94" title="lstate.h:94">CIST_YPCALL</a>;&nbsp; <span class="Comment">/* function can do <a href="lundump.c.html#L40" title="lundump.c:40">error</a> recovery */<br/></li>
<li></span>&nbsp; &nbsp; <a href="ldo.c.html#L413" title="ldo.c:413">luaD_call</a>(L, c.func, nresults, <span class="Constant">1</span>);&nbsp; <span class="Comment">/* do the call */<br/></li>
<li></span>&nbsp; &nbsp; ci-&gt;callstatus &amp;= ~<a href="lstate.h.html#L94" title="lstate.h:94">CIST_YPCALL</a>;<br/></li>
<li>&nbsp; &nbsp; L-&gt;errfunc = ci-&gt;u.c.old_errfunc;<br/></li>
<li>&nbsp; &nbsp; status = <a href="lua.h.html#L45" title="lua.h:45">LUA_OK</a>;&nbsp; <span class="Comment">/* if it is here, there were no errors */<br/></li>
<li></span>&nbsp; }<br/></li>
<li>&nbsp; <a href="lapi.h.html#L17" title="lapi.h:17">adjustresults</a>(L, nresults);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> status;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L963">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_load</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <a href="lua.h.html#L114" title="lua.h:114">lua_Reader</a> <a href="luac.c.html#L122" title="luac.c:122">reader</a>, <span class="Type">void</span> *data,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> <span class="Type">char</span> *chunkname, <span class="Type">const</span> <span class="Type">char</span> *mode) {<br/></li>
<li>&nbsp; <a href="lzio.h.html#L18" title="lzio.h:18">ZIO</a> z;<br/></li>
<li>&nbsp; <span class="Type">int</span> status;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (!chunkname) chunkname = <span class="Constant">&quot;?&quot;</span>;<br/></li>
<li>&nbsp; <a href="lzio.c.html#L38" title="lzio.c:38">luaZ_init</a>(L, &amp;z, <a href="luac.c.html#L122" title="luac.c:122">reader</a>, data);<br/></li>
<li>&nbsp; status = <a href="ldo.c.html#L698" title="ldo.c:698">luaD_protectedparser</a>(L, &amp;z, chunkname, mode);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (status == <a href="lua.h.html#L45" title="lua.h:45">LUA_OK</a>) {&nbsp; <span class="Comment">/* no errors? */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lobject.h.html#L444" title="lobject.h:444">LClosure</a> *f = <a href="lobject.h.html#L164" title="lobject.h:164">clLvalue</a>(L-&gt;top - <span class="Constant">1</span>);&nbsp; <span class="Comment">/* get newly created function */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (f-&gt;nupvalues &gt;= <span class="Constant">1</span>) {&nbsp; <span class="Comment">/* does it have an upvalue? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Comment">/* get global table from registry */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L488" title="lobject.h:488">Table</a> *reg = <a href="lobject.h.html#L167" title="lobject.h:167">hvalue</a>(&amp;<a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;l_registry);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Type">const</span> <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *gt = <a href="ltable.c.html#L497" title="ltable.c:497">luaH_getint</a>(reg, <a href="lua.h.html#L82" title="lua.h:82">LUA_RIDX_GLOBALS</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Comment">/* set global table as 1st upvalue of 'f' (may be <a href="llex.h.html#L18" title="llex.h:18">LUA_ENV</a>) */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L245" title="lobject.h:245">setobj</a>(L, f-&gt;upvals[<span class="Constant">0</span>]-&gt;v, gt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lgc.h.html#L121" title="lgc.h:121">luaC_upvalbarrier</a>(L, f-&gt;upvals[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> status;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L987">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_dump</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <a href="lua.h.html#L116" title="lua.h:116">lua_Writer</a> <a href="lstrlib.c.html#L177" title="lstrlib.c:177">writer</a>, <span class="Type">void</span> *data, <span class="Type">int</span> strip) {<br/></li>
<li>&nbsp; <span class="Type">int</span> status;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *o;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; o = L-&gt;top - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="lobject.h.html#L457" title="lobject.h:457">isLfunction</a>(o))<br/></li>
<li>&nbsp; &nbsp; status = <a href="ldump.c.html#L201" title="ldump.c:201">luaU_dump</a>(L, <a href="lobject.h.html#L459" title="lobject.h:459">getproto</a>(o), <a href="lstrlib.c.html#L177" title="lstrlib.c:177">writer</a>, data, strip);<br/></li>
<li>&nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; status = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> status;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L1002">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_status</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Statement">return</span> L-&gt;status;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** Garbage-collection function<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><a id="L1011">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_gc</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> what, <span class="Type">int</span> data) {<br/></li>
<li>&nbsp; <span class="Type">int</span> res = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; <a href="lstate.h.html#L108" title="lstate.h:108">global_State</a> *g;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; g = <a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">switch</span> (what) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L300" title="lua.h:300">LUA_GCSTOP</a>: {<br/></li>
<li>&nbsp; &nbsp; &nbsp; g-&gt;gcrunning = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L301" title="lua.h:301">LUA_GCRESTART</a>: {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lstate.c.html#L101" title="lstate.c:101">luaE_setdebt</a>(g, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; g-&gt;gcrunning = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L302" title="lua.h:302">LUA_GCCOLLECT</a>: {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lgc.c.html#L1139" title="lgc.c:1139">luaC_fullgc</a>(L, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L303" title="lua.h:303">LUA_GCCOUNT</a>: {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Comment">/* GC values are expressed in Kbytes: #bytes/2^10 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; res = <a href="llimits.h.html#L112" title="llimits.h:112">cast_int</a>(<a href="lstate.h.html#L213" title="lstate.h:213">gettotalbytes</a>(g) &gt;&gt; <span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L304" title="lua.h:304">LUA_GCCOUNTB</a>: {<br/></li>
<li>&nbsp; &nbsp; &nbsp; res = <a href="llimits.h.html#L112" title="llimits.h:112">cast_int</a>(<a href="lstate.h.html#L213" title="lstate.h:213">gettotalbytes</a>(g) &amp; <span class="Constant">0x3ff</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L305" title="lua.h:305">LUA_GCSTEP</a>: {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="llimits.h.html#L24" title="llimits.h:24">l_mem</a> debt = <span class="Constant">1</span>;&nbsp; <span class="Comment">/* =1 to signal that it did an actual step */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Type">int</span> oldrunning = g-&gt;gcrunning;<br/></li>
<li>&nbsp; &nbsp; &nbsp; g-&gt;gcrunning = <span class="Constant">1</span>;&nbsp; <span class="Comment">/* allow GC to run */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (data == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="lstate.c.html#L101" title="lstate.c:101">luaE_setdebt</a>(g, -<a href="lgc.h.html#L32" title="lgc.h:32">GCSTEPSIZE</a>);&nbsp; <span class="Comment">/* to do a &quot;small&quot; step */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="lgc.c.html#L1109" title="lgc.c:1109">luaC_step</a>(L);<br/></li>
<li>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">else</span> {&nbsp; <span class="Comment">/* add 'data' to total debt */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; debt = <a href="llimits.h.html#L107" title="llimits.h:107">cast</a>(<a href="llimits.h.html#L24" title="llimits.h:24">l_mem</a>, data) * <span class="Constant">1024</span> + g-&gt;GCdebt;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="lstate.c.html#L101" title="lstate.c:101">luaE_setdebt</a>(g, debt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="lgc.h.html#L106" title="lgc.h:106">luaC_checkGC</a>(L);<br/></li>
<li>&nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; g-&gt;gcrunning = oldrunning;&nbsp; <span class="Comment">/* restore previous state */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (debt &gt; <span class="Constant">0</span> &amp;&amp; g-&gt;gcstate == <a href="lgc.h.html#L46" title="lgc.h:46">GCSpause</a>)&nbsp; <span class="Comment">/* end of cycle? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; res = <span class="Constant">1</span>;&nbsp; <span class="Comment">/* signal it */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L306" title="lua.h:306">LUA_GCSETPAUSE</a>: {<br/></li>
<li>&nbsp; &nbsp; &nbsp; res = g-&gt;gcpause;<br/></li>
<li>&nbsp; &nbsp; &nbsp; g-&gt;gcpause = data;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L307" title="lua.h:307">LUA_GCSETSTEPMUL</a>: {<br/></li>
<li>&nbsp; &nbsp; &nbsp; res = g-&gt;gcstepmul;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (data &lt; <span class="Constant">40</span>) data = <span class="Constant">40</span>;&nbsp; <span class="Comment">/* avoid ridiculous low values (and 0) */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; g-&gt;gcstepmul = data;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lua.h.html#L308" title="lua.h:308">LUA_GCISRUNNING</a>: {<br/></li>
<li>&nbsp; &nbsp; &nbsp; res = g-&gt;gcrunning;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> res = -<span class="Constant">1</span>;&nbsp; <span class="Comment">/* invalid option */<br/></li>
<li></span>&nbsp; }<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> res;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** miscellaneous functions<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L1085">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_error</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="ldebug.c.html#L591" title="ldebug.c:591">luaG_errormsg</a>(L);<br/></li>
<li>&nbsp; <span class="Comment">/* code unreachable; will unlock when control actually leaves the kernel */<br/></li>
<li></span>&nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;&nbsp; <span class="Comment">/* to avoid warnings */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L1094">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">int</span> <span class="linkable">lua_next</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> t;<br/></li>
<li>&nbsp; <span class="Type">int</span> more;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; t = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<a href="lobject.h.html#L143" title="lobject.h:143">ttistable</a>(t), <span class="Constant">&quot;table expected&quot;</span>);<br/></li>
<li>&nbsp; more = <a href="ltable.c.html#L193" title="ltable.c:193">luaH_next</a>(L, <a href="lobject.h.html#L167" title="lobject.h:167">hvalue</a>(t), L-&gt;top - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (more) {<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span>&nbsp; <span class="Comment">/* no more elements */<br/></li>
<li></span>&nbsp; &nbsp; L-&gt;top -= <span class="Constant">1</span>;&nbsp; <span class="Comment">/* remove key */<br/></li>
<li></span>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> more;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L1111">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_concat</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> n) {<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, n);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (n &gt;= <span class="Constant">2</span>) {<br/></li>
<li>&nbsp; &nbsp; <a href="lgc.h.html#L106" title="lgc.h:106">luaC_checkGC</a>(L);<br/></li>
<li>&nbsp; &nbsp; <a href="lvm.c.html#L361" title="lvm.c:361">luaV_concat</a>(L, n);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (n == <span class="Constant">0</span>) {&nbsp; <span class="Comment">/* push empty string */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lobject.h.html#L258" title="lobject.h:258">setsvalue2s</a>(L, L-&gt;top, <a href="lstring.c.html#L151" title="lstring.c:151">luaS_newlstr</a>(L, <span class="Constant">&quot;&quot;</span>, <span class="Constant">0</span>));<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Comment">/* else n == 1; nothing to do */<br/></li>
<li></span>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L1127">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_len</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> idx) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> t;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; t = <a href="#L60" title="lapi.c:60">index2addr</a>(L, idx);<br/></li>
<li>&nbsp; <a href="lvm.c.html#L404" title="lvm.c:404">luaV_objlen</a>(L, L-&gt;top, t);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L1137">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <a href="lua.h.html#L122" title="lua.h:122">lua_Alloc</a> <span class="linkable">lua_getallocf</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">void</span> **ud) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L122" title="lua.h:122">lua_Alloc</a> f;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (ud) *ud = <a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;ud;<br/></li>
<li>&nbsp; f = <a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;frealloc;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> f;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L1147">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_setallocf</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <a href="lua.h.html#L122" title="lua.h:122">lua_Alloc</a> f, <span class="Type">void</span> *ud) {<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;ud = ud;<br/></li>
<li>&nbsp; <a href="lstate.h.html#L175" title="lstate.h:175">G</a>(L)-&gt;frealloc = f;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L1155">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> *<span class="linkable">lua_newuserdata</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">size_t</span> size) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L337" title="lobject.h:337">Udata</a> *u;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; <a href="lgc.h.html#L106" title="lgc.h:106">luaC_checkGC</a>(L);<br/></li>
<li>&nbsp; u = <a href="lstring.c.html#L170" title="lstring.c:170">luaS_newudata</a>(L, size);<br/></li>
<li>&nbsp; <a href="lobject.h.html#L216" title="lobject.h:216">setuvalue</a>(L, L-&gt;top, u);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="lobject.h.html#L359" title="lobject.h:359">getudatamem</a>(u);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L1168">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <span class="Type">char</span> *<span class="linkable">aux_upvalue</span> (<a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> fi, <span class="Type">int</span> n, <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> **val,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L437" title="lobject.h:437">CClosure</a> **owner, <a href="lfunc.h.html#L28" title="lfunc.h:28">UpVal</a> **uv) {<br/></li>
<li>&nbsp; <span class="Statement">switch</span> (<a href="lobject.h.html#L125" title="lobject.h:125">ttype</a>(fi)) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lobject.h.html#L51" title="lobject.h:51">LUA_TCCL</a>: {&nbsp; <span class="Comment">/* C closure */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L437" title="lobject.h:437">CClosure</a> *f = <a href="lobject.h.html#L165" title="lobject.h:165">clCvalue</a>(fi);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!(<span class="Constant">1</span> &lt;= n &amp;&amp; n &lt;= f-&gt;nupvalues)) <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; *val = &amp;f-&gt;upvalue[n-<span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (owner) *owner = f;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">&quot;&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lobject.h.html#L49" title="lobject.h:49">LUA_TLCL</a>: {&nbsp; <span class="Comment">/* Lua closure */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L444" title="lobject.h:444">LClosure</a> *f = <a href="lobject.h.html#L164" title="lobject.h:164">clLvalue</a>(fi);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L303" title="lobject.h:303">TString</a> *name;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L398" title="lobject.h:398">Proto</a> *p = f-&gt;p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!(<span class="Constant">1</span> &lt;= n &amp;&amp; n &lt;= p-&gt;sizeupvalues)) <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; *val = f-&gt;upvals[n-<span class="Constant">1</span>]-&gt;v;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (uv) *uv = f-&gt;upvals[n - <span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; name = p-&gt;upvalues[n-<span class="Constant">1</span>].name;<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> (name == <span class="Constant">NULL</span>) ? <span class="Constant">&quot;(*no name)&quot;</span> : <a href="lobject.h.html#L326" title="lobject.h:326">getstr</a>(name);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> <span class="Statement">return</span> <span class="Constant">NULL</span>;&nbsp; <span class="Comment">/* not a closure */<br/></li>
<li></span>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L1193">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">const</span> <span class="Type">char</span> *<span class="linkable">lua_getupvalue</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> funcindex, <span class="Type">int</span> n) {<br/></li>
<li>&nbsp; <span class="Type">const</span> <span class="Type">char</span> *name;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *val = <span class="Constant">NULL</span>;&nbsp; <span class="Comment">/* to avoid warnings */<br/></li>
<li></span>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; name = <a href="#L1168" title="lapi.c:1168">aux_upvalue</a>(<a href="#L60" title="lapi.c:60">index2addr</a>(L, funcindex), n, &amp;val, <span class="Constant">NULL</span>, <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (name) {<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L257" title="lobject.h:257">setobj2s</a>(L, L-&gt;top, val);<br/></li>
<li>&nbsp; &nbsp; <a href="lapi.h.html#L14" title="lapi.h:14">api_incr_top</a>(L);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> name;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L1207">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">const</span> <span class="Type">char</span> *<span class="linkable">lua_setupvalue</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> funcindex, <span class="Type">int</span> n) {<br/></li>
<li>&nbsp; <span class="Type">const</span> <span class="Type">char</span> *name;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L108" title="lobject.h:108">TValue</a> *val = <span class="Constant">NULL</span>;&nbsp; <span class="Comment">/* to avoid warnings */<br/></li>
<li></span>&nbsp; <a href="lobject.h.html#L437" title="lobject.h:437">CClosure</a> *owner = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; <a href="lfunc.h.html#L28" title="lfunc.h:28">UpVal</a> *uv = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> fi;<br/></li>
<li>&nbsp; <a href="llimits.h.html#L185" title="llimits.h:185">lua_lock</a>(L);<br/></li>
<li>&nbsp; fi = <a href="#L60" title="lapi.c:60">index2addr</a>(L, funcindex);<br/></li>
<li>&nbsp; <a href="lapi.h.html#L20" title="lapi.h:20">api_checknelems</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; name = <a href="#L1168" title="lapi.c:1168">aux_upvalue</a>(fi, n, &amp;val, &amp;owner, &amp;uv);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (name) {<br/></li>
<li>&nbsp; &nbsp; L-&gt;top--;<br/></li>
<li>&nbsp; &nbsp; <a href="lobject.h.html#L245" title="lobject.h:245">setobj</a>(L, val, L-&gt;top);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (owner) { <a href="lgc.h.html#L109" title="lgc.h:109">luaC_barrier</a>(L, owner, L-&gt;top); }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (uv) { <a href="lgc.h.html#L121" title="lgc.h:121">luaC_upvalbarrier</a>(L, uv); }<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <a href="llimits.h.html#L186" title="llimits.h:186">lua_unlock</a>(L);<br/></li>
<li>&nbsp; <span class="Statement">return</span> name;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L1228">&#x200c;</a><span class="Type">static</span> <a href="lfunc.h.html#L28" title="lfunc.h:28">UpVal</a> **<span class="linkable">getupvalref</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> fidx, <span class="Type">int</span> n, <a href="lobject.h.html#L444" title="lobject.h:444">LClosure</a> **pf) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L444" title="lobject.h:444">LClosure</a> *f;<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> fi = <a href="#L60" title="lapi.c:60">index2addr</a>(L, fidx);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<a href="lobject.h.html#L147" title="lobject.h:147">ttisLclosure</a>(fi), <span class="Constant">&quot;Lua function expected&quot;</span>);<br/></li>
<li>&nbsp; f = <a href="lobject.h.html#L164" title="lobject.h:164">clLvalue</a>(fi);<br/></li>
<li>&nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>((<span class="Constant">1</span> &lt;= n &amp;&amp; n &lt;= f-&gt;p-&gt;sizeupvalues), <span class="Constant">&quot;invalid upvalue index&quot;</span>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (pf) *pf = f;<br/></li>
<li>&nbsp; <span class="Statement">return</span> &amp;f-&gt;upvals[n - <span class="Constant">1</span>];&nbsp; <span class="Comment">/* get its upvalue pointer */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L1239">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> *<span class="linkable">lua_upvalueid</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> fidx, <span class="Type">int</span> n) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L294" title="lobject.h:294">StkId</a> fi = <a href="#L60" title="lapi.c:60">index2addr</a>(L, fidx);<br/></li>
<li>&nbsp; <span class="Statement">switch</span> (<a href="lobject.h.html#L125" title="lobject.h:125">ttype</a>(fi)) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lobject.h.html#L49" title="lobject.h:49">LUA_TLCL</a>: {&nbsp; <span class="Comment">/* lua closure */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> *<a href="#L1228" title="lapi.c:1228">getupvalref</a>(L, fidx, n, <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="lobject.h.html#L51" title="lobject.h:51">LUA_TCCL</a>: {&nbsp; <span class="Comment">/* C closure */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; <a href="lobject.h.html#L437" title="lobject.h:437">CClosure</a> *f = <a href="lobject.h.html#L165" title="lobject.h:165">clCvalue</a>(fi);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<span class="Constant">1</span> &lt;= n &amp;&amp; n &lt;= f-&gt;nupvalues, <span class="Constant">&quot;invalid upvalue index&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> &amp;f-&gt;upvalue[n - <span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="llimits.h.html#L99" title="llimits.h:99">api_check</a>(<span class="Constant">0</span>, <span class="Constant">&quot;closure expected&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L1258">&#x200c;</a><a href="luaconf.h.html#L222" title="luaconf.h:222">LUA_API</a> <span class="Type">void</span> <span class="linkable">lua_upvaluejoin</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> fidx1, <span class="Type">int</span> n1,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> fidx2, <span class="Type">int</span> n2) {<br/></li>
<li>&nbsp; <a href="lobject.h.html#L444" title="lobject.h:444">LClosure</a> *f1;<br/></li>
<li>&nbsp; <a href="lfunc.h.html#L28" title="lfunc.h:28">UpVal</a> **up1 = <a href="#L1228" title="lapi.c:1228">getupvalref</a>(L, fidx1, n1, &amp;f1);<br/></li>
<li>&nbsp; <a href="lfunc.h.html#L28" title="lfunc.h:28">UpVal</a> **up2 = <a href="#L1228" title="lapi.c:1228">getupvalref</a>(L, fidx2, n2, <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; <a href="lgc.c.html#L657" title="lgc.c:657">luaC_upvdeccount</a>(L, *up1);<br/></li>
<li>&nbsp; *up1 = *up2;<br/></li>
<li>&nbsp; (*up1)-&gt;refcount++;<br/></li>
<li>&nbsp; <span class="Statement">if</span> (<a href="lfunc.h.html#L40" title="lfunc.h:40">upisopen</a>(*up1)) (*up1)-&gt;u.open.touched = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; <a href="lgc.h.html#L121" title="lgc.h:121">luaC_upvalbarrier</a>(L, *up1);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
</ol></code>
 </body>
</html>

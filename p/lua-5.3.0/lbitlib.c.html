<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>lbitlib.c - src</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>lbitlib.c - src</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Global variables defined</h4>
 <ul>
<li><a href="#L199">bitlib</a></li>
</ul>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L45">andaux</a></li>
<li><a href="#L54">b_and</a></li>
<li><a href="#L122">b_arshift</a></li>
<li><a href="#L176">b_extract</a></li>
<li><a href="#L148">b_lrot</a></li>
<li><a href="#L112">b_lshift</a></li>
<li><a href="#L88">b_not</a></li>
<li><a href="#L68">b_or</a></li>
<li><a href="#L186">b_replace</a></li>
<li><a href="#L137">b_rot</a></li>
<li><a href="#L153">b_rrot</a></li>
<li><a href="#L117">b_rshift</a></li>
<li><a href="#L95">b_shift</a></li>
<li><a href="#L61">b_test</a></li>
<li><a href="#L78">b_xor</a></li>
<li><a href="#L164">fieldargs</a></li>
<li><a href="#L217">luaopen_bit32</a></li>
<li><a href="#L226">luaopen_bit32</a></li>
</ul>
 <h4>Macros defined</h4>
 <ul>
<li><a href="#L33">ALLONES</a></li>
<li><a href="#L8">LUA_LIB</a></li>
<li><a href="#L24">LUA_NBITS</a></li>
<li><a href="#L7">lbitlib_c</a></li>
<li><a href="#L41">mask</a></li>
<li><a href="#L37">trim</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** $Id: lbitlib.c,v 1.28 2014/11/02 19:19:04 roberto Exp $<br/></li>
<li></span><span class="Comment">** Standard library for bitwise operations<br/></li>
<li></span><span class="Comment">** See Copyright Notice in lua.h<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li></span><br/></li>
<li><a id="L7">&#x200c;</a><span class="PreProc">#define <span class="linkable">lbitlib_c</span><br/></li>
<li><a id="L8">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">LUA_LIB</span><br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lprefix.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lua.h&quot;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&quot;lauxlib.h&quot;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;lualib.h&quot;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#if defined(<a href="luaconf.h.html#L289" title="luaconf.h:289">LUA_COMPAT_BITLIB</a>)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">/* { */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/* number of bits to consider in a number */<br/></li>
<li></span><span class="PreProc">#if !defined(<a href="#L24" title="lbitlib.c:24">LUA_NBITS</a>)<br/></li>
<li><a id="L24">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">LUA_NBITS</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">32<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** a <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> with its first <a href="#L24" title="lbitlib.c:24">LUA_NBITS</a> bits equal to 1. (Shift must<br/></li>
<li></span><span class="Comment">** be made in two parts to avoid problems when <a href="#L24" title="lbitlib.c:24">LUA_NBITS</a> is equal to the<br/></li>
<li></span><span class="Comment">** number of bits in a <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a>.)<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L33">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ALLONES</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (~(((~(<a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a>)</span><span class="Constant">0</span><span class="PreProc">) &lt;&lt; (<a href="#L24" title="lbitlib.c:24">LUA_NBITS</a> - </span><span class="Constant">1</span><span class="PreProc">)) &lt;&lt; </span><span class="Constant">1</span><span class="PreProc">))<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/* macro to <a href="#L37" title="lbitlib.c:37">trim</a> extra bits */<br/></li>
<li><a id="L37">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">trim</span>(x)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((x) &amp; <a href="#L33" title="lbitlib.c:33">ALLONES</a>)<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/* builds a number with 'n' ones (1 &lt;= n &lt;= <a href="#L24" title="lbitlib.c:24">LUA_NBITS</a>) */<br/></li>
<li><a id="L41">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">mask</span>(n)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (~((<a href="#L33" title="lbitlib.c:33">ALLONES</a> &lt;&lt; </span><span class="Constant">1</span><span class="PreProc">) &lt;&lt; ((n) - </span><span class="Constant">1</span><span class="PreProc">)))<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L45">&#x200c;</a><span class="Type">static</span> <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> <span class="linkable">andaux</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">int</span> i, n = <a href="lapi.c.html#L166" title="lapi.c:166">lua_gettop</a>(L);<br/></li>
<li>&nbsp; <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> r = ~(<a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a>)<span class="Constant">0</span>;<br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">1</span>; i &lt;= n; i++)<br/></li>
<li>&nbsp; &nbsp; r &amp;= <a href="lauxlib.h.html#L239" title="lauxlib.h:239">luaL_checkunsigned</a>(L, i);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L37" title="lbitlib.c:37">trim</a>(r);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L54">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">b_and</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> r = <a href="#L45" title="lbitlib.c:45">andaux</a>(L);<br/></li>
<li>&nbsp; <a href="lua.h.html#L384" title="lua.h:384">lua_pushunsigned</a>(L, r);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L61">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">b_test</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> r = <a href="#L45" title="lbitlib.c:45">andaux</a>(L);<br/></li>
<li>&nbsp; <a href="lapi.c.html#L550" title="lapi.c:550">lua_pushboolean</a>(L, r != <span class="Constant">0</span>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L68">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">b_or</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">int</span> i, n = <a href="lapi.c.html#L166" title="lapi.c:166">lua_gettop</a>(L);<br/></li>
<li>&nbsp; <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> r = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">1</span>; i &lt;= n; i++)<br/></li>
<li>&nbsp; &nbsp; r |= <a href="lauxlib.h.html#L239" title="lauxlib.h:239">luaL_checkunsigned</a>(L, i);<br/></li>
<li>&nbsp; <a href="lua.h.html#L384" title="lua.h:384">lua_pushunsigned</a>(L, <a href="#L37" title="lbitlib.c:37">trim</a>(r));<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L78">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">b_xor</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">int</span> i, n = <a href="lapi.c.html#L166" title="lapi.c:166">lua_gettop</a>(L);<br/></li>
<li>&nbsp; <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> r = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; <span class="Statement">for</span> (i = <span class="Constant">1</span>; i &lt;= n; i++)<br/></li>
<li>&nbsp; &nbsp; r ^= <a href="lauxlib.h.html#L239" title="lauxlib.h:239">luaL_checkunsigned</a>(L, i);<br/></li>
<li>&nbsp; <a href="lua.h.html#L384" title="lua.h:384">lua_pushunsigned</a>(L, <a href="#L37" title="lbitlib.c:37">trim</a>(r));<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L88">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">b_not</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> r = ~<a href="lauxlib.h.html#L239" title="lauxlib.h:239">luaL_checkunsigned</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="lua.h.html#L384" title="lua.h:384">lua_pushunsigned</a>(L, <a href="#L37" title="lbitlib.c:37">trim</a>(r));<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L95">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">b_shift</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> r, <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> i) {<br/></li>
<li>&nbsp; <span class="Statement">if</span> (i &lt; <span class="Constant">0</span>) {&nbsp; <span class="Comment">/* shift right? */<br/></li>
<li></span>&nbsp; &nbsp; i = -i;<br/></li>
<li>&nbsp; &nbsp; r = <a href="#L37" title="lbitlib.c:37">trim</a>(r);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (i &gt;= <a href="#L24" title="lbitlib.c:24">LUA_NBITS</a>) r = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> r &gt;&gt;= i;<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <span class="Statement">else</span> {&nbsp; <span class="Comment">/* shift left */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (i &gt;= <a href="#L24" title="lbitlib.c:24">LUA_NBITS</a>) r = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else</span> r &lt;&lt;= i;<br/></li>
<li>&nbsp; &nbsp; r = <a href="#L37" title="lbitlib.c:37">trim</a>(r);<br/></li>
<li>&nbsp; }<br/></li>
<li>&nbsp; <a href="lua.h.html#L384" title="lua.h:384">lua_pushunsigned</a>(L, r);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L112">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">b_lshift</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L95" title="lbitlib.c:95">b_shift</a>(L, <a href="lauxlib.h.html#L239" title="lauxlib.h:239">luaL_checkunsigned</a>(L, <span class="Constant">1</span>), <a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>(L, <span class="Constant">2</span>));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L117">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">b_rshift</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L95" title="lbitlib.c:95">b_shift</a>(L, <a href="lauxlib.h.html#L239" title="lauxlib.h:239">luaL_checkunsigned</a>(L, <span class="Constant">1</span>), -<a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>(L, <span class="Constant">2</span>));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L122">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">b_arshift</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> r = <a href="lauxlib.h.html#L239" title="lauxlib.h:239">luaL_checkunsigned</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> i = <a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (i &lt; <span class="Constant">0</span> || !(r &amp; ((<a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a>)<span class="Constant">1</span> &lt;&lt; (<a href="#L24" title="lbitlib.c:24">LUA_NBITS</a> - <span class="Constant">1</span>))))<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L95" title="lbitlib.c:95">b_shift</a>(L, r, -i);<br/></li>
<li>&nbsp; <span class="Statement">else</span> {&nbsp; <span class="Comment">/* arithmetic shift for 'negative' number */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (i &gt;= <a href="#L24" title="lbitlib.c:24">LUA_NBITS</a>) r = <a href="#L33" title="lbitlib.c:33">ALLONES</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; r = <a href="#L37" title="lbitlib.c:37">trim</a>((r &gt;&gt; i) | ~(<a href="#L37" title="lbitlib.c:37">trim</a>(~(<a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a>)<span class="Constant">0</span>) &gt;&gt; i));&nbsp; <span class="Comment">/* add signal bit */<br/></li>
<li></span>&nbsp; &nbsp; <a href="lua.h.html#L384" title="lua.h:384">lua_pushunsigned</a>(L, r);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L137">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">b_rot</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> d) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> r = <a href="lauxlib.h.html#L239" title="lauxlib.h:239">luaL_checkunsigned</a>(L, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <span class="Type">int</span> i = d &amp; (<a href="#L24" title="lbitlib.c:24">LUA_NBITS</a> - <span class="Constant">1</span>);&nbsp; <span class="Comment">/* i = d % <a href="lvm.c.html#L471" title="lvm.c:471">NBITS</a> */<br/></li>
<li></span>&nbsp; r = <a href="#L37" title="lbitlib.c:37">trim</a>(r);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (i != <span class="Constant">0</span>)&nbsp; <span class="Comment">/* avoid undefined shift of <a href="#L24" title="lbitlib.c:24">LUA_NBITS</a> when i == 0 */<br/></li>
<li></span>&nbsp; &nbsp; r = (r &lt;&lt; i) | (r &gt;&gt; (<a href="#L24" title="lbitlib.c:24">LUA_NBITS</a> - i));<br/></li>
<li>&nbsp; <a href="lua.h.html#L384" title="lua.h:384">lua_pushunsigned</a>(L, <a href="#L37" title="lbitlib.c:37">trim</a>(r));<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L148">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">b_lrot</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L137" title="lbitlib.c:137">b_rot</a>(L, <a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>(L, <span class="Constant">2</span>));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L153">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">b_rrot</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="#L137" title="lbitlib.c:137">b_rot</a>(L, -<a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>(L, <span class="Constant">2</span>));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment">** get <a href="lparser.c.html#L696" title="lparser.c:696">field</a> and width arguments for <a href="lparser.c.html#L696" title="lparser.c:696">field</a>-manipulation functions,<br/></li>
<li></span><span class="Comment">** checking whether they are valid.<br/></li>
<li></span><span class="Comment">** ('<a href="lauxlib.c.html#L212" title="lauxlib.c:212">luaL_error</a>' called without 'return' to avoid later warnings about<br/></li>
<li></span><span class="Comment">** 'width' being used uninitialized.)<br/></li>
<li></span><span class="Comment">*/<br/></li>
<li><a id="L164">&#x200c;</a></span><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">fieldargs</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L, <span class="Type">int</span> farg, <span class="Type">int</span> *width) {<br/></li>
<li>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> f = <a href="lauxlib.c.html#L414" title="lauxlib.c:414">luaL_checkinteger</a>(L, farg);<br/></li>
<li>&nbsp; <a href="lua.h.html#L91" title="lua.h:91">lua_Integer</a> w = <a href="lauxlib.c.html#L424" title="lauxlib.c:424">luaL_optinteger</a>(L, farg + <span class="Constant">1</span>, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; <a href="lauxlib.h.html#L114" title="lauxlib.h:114">luaL_argcheck</a>(L, <span class="Constant">0</span> &lt;= f, farg, <span class="Constant">&quot;<a href="lparser.c.html#L696" title="lparser.c:696">field</a> <a href="luac.c.html#L44" title="luac.c:44">cannot</a> be negative&quot;</span>);<br/></li>
<li>&nbsp; <a href="lauxlib.h.html#L114" title="lauxlib.h:114">luaL_argcheck</a>(L, <span class="Constant">0</span> &lt; w, farg + <span class="Constant">1</span>, <span class="Constant">&quot;width must be positive&quot;</span>);<br/></li>
<li>&nbsp; <span class="Statement">if</span> (f + w &gt; <a href="#L24" title="lbitlib.c:24">LUA_NBITS</a>)<br/></li>
<li>&nbsp; &nbsp; <a href="lauxlib.c.html#L212" title="lauxlib.c:212">luaL_error</a>(L, <span class="Constant">&quot;trying to access non-existent bits&quot;</span>);<br/></li>
<li>&nbsp; *width = (<span class="Type">int</span>)w;<br/></li>
<li>&nbsp; <span class="Statement">return</span> (<span class="Type">int</span>)f;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L176">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">b_extract</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">int</span> w;<br/></li>
<li>&nbsp; <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> r = <a href="#L37" title="lbitlib.c:37">trim</a>(<a href="lauxlib.h.html#L239" title="lauxlib.h:239">luaL_checkunsigned</a>(L, <span class="Constant">1</span>));<br/></li>
<li>&nbsp; <span class="Type">int</span> f = <a href="#L164" title="lbitlib.c:164">fieldargs</a>(L, <span class="Constant">2</span>, &amp;w);<br/></li>
<li>&nbsp; r = (r &gt;&gt; f) &amp; <a href="#L41" title="lbitlib.c:41">mask</a>(w);<br/></li>
<li>&nbsp; <a href="lua.h.html#L384" title="lua.h:384">lua_pushunsigned</a>(L, r);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L186">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">b_replace</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Type">int</span> w;<br/></li>
<li>&nbsp; <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> r = <a href="#L37" title="lbitlib.c:37">trim</a>(<a href="lauxlib.h.html#L239" title="lauxlib.h:239">luaL_checkunsigned</a>(L, <span class="Constant">1</span>));<br/></li>
<li>&nbsp; <a href="lua.h.html#L94" title="lua.h:94">lua_Unsigned</a> v = <a href="lauxlib.h.html#L239" title="lauxlib.h:239">luaL_checkunsigned</a>(L, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; <span class="Type">int</span> f = <a href="#L164" title="lbitlib.c:164">fieldargs</a>(L, <span class="Constant">3</span>, &amp;w);<br/></li>
<li>&nbsp; <span class="Type">int</span> m = <a href="#L41" title="lbitlib.c:41">mask</a>(w);<br/></li>
<li>&nbsp; v &amp;= m;&nbsp; <span class="Comment">/* erase bits outside given width */<br/></li>
<li></span>&nbsp; r = (r &amp; ~(m &lt;&lt; f)) | (v &lt;&lt; f);<br/></li>
<li>&nbsp; <a href="lua.h.html#L384" title="lua.h:384">lua_pushunsigned</a>(L, r);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L199">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> <a href="lauxlib.h.html#L23" title="lauxlib.h:23">luaL_Reg</a> <span class="linkable">bitlib</span>[] = {<br/></li>
<li>&nbsp; {<span class="Constant">&quot;arshift&quot;</span>, <a href="#L122" title="lbitlib.c:122">b_arshift</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;band&quot;</span>, <a href="#L54" title="lbitlib.c:54">b_and</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;bnot&quot;</span>, <a href="#L88" title="lbitlib.c:88">b_not</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;bor&quot;</span>, <a href="#L68" title="lbitlib.c:68">b_or</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;bxor&quot;</span>, <a href="#L78" title="lbitlib.c:78">b_xor</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;btest&quot;</span>, <a href="#L61" title="lbitlib.c:61">b_test</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;extract&quot;</span>, <a href="#L176" title="lbitlib.c:176">b_extract</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;lrotate&quot;</span>, <a href="#L148" title="lbitlib.c:148">b_lrot</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;lshift&quot;</span>, <a href="#L112" title="lbitlib.c:112">b_lshift</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;replace&quot;</span>, <a href="#L186" title="lbitlib.c:186">b_replace</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;rrotate&quot;</span>, <a href="#L153" title="lbitlib.c:153">b_rrot</a>},<br/></li>
<li>&nbsp; {<span class="Constant">&quot;rshift&quot;</span>, <a href="#L117" title="lbitlib.c:117">b_rshift</a>},<br/></li>
<li>&nbsp; {<span class="Constant">NULL</span>, <span class="Constant">NULL</span>}<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L217">&#x200c;</a><a href="luaconf.h.html#L236" title="luaconf.h:236">LUAMOD_API</a> <span class="Type">int</span> <span class="linkable">luaopen_bit32</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <a href="lauxlib.h.html#L111" title="lauxlib.h:111">luaL_newlib</a>(L, <a href="#L199" title="lbitlib.c:199">bitlib</a>);<br/></li>
<li>&nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="PreProc">#else</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* }{ */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L226">&#x200c;</a><a href="luaconf.h.html#L236" title="luaconf.h:236">LUAMOD_API</a> <span class="Type">int</span> <span class="linkable">luaopen_bit32</span> (<a href="lstate.h.html#L149" title="lstate.h:149">lua_State</a> *L) {<br/></li>
<li>&nbsp; <span class="Statement">return</span> <a href="lauxlib.c.html#L212" title="lauxlib.c:212">luaL_error</a>(L, <span class="Constant">&quot;library 'bit32' has been deprecated&quot;</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* } */<br/></li>
</ol></span></code>
 </body>
</html>

<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>Makefile - linux-0.11-ebook</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>Makefile - linux-0.11-ebook</h3>
   <a href="../index.html"> Table of Contents </a>

  <code><ol><li><span class="Comment">#<br/></li>
<li></span><span class="Comment"># if you want the ram-disk device, define this to be the<br/></li>
<li></span><span class="Comment"># size in blocks.<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Identifier">RAMDISK </span>= -DRAMDISK=512<br/></li>
<li><br/></li>
<li><span class="Identifier">AS86&nbsp; &nbsp; &nbsp; &nbsp; </span>=as86 -0 -a<br/></li>
<li><span class="Identifier">LD86&nbsp; &nbsp; &nbsp; &nbsp; </span>=ld86 -0<br/></li>
<li><br/></li>
<li><span class="Identifier">AS&nbsp; &nbsp; &nbsp; &nbsp; </span>=as --32<br/></li>
<li><span class="Identifier">LD&nbsp; &nbsp; &nbsp; &nbsp; </span>=ld -m elf_i386 -Ttext 0x0 -e startup_32<br/></li>
<li><span class="Identifier">LDFLAGS&nbsp; &nbsp; &nbsp; &nbsp; </span>=-s -x -M<br/></li>
<li><span class="Identifier">CC&nbsp; &nbsp; &nbsp; &nbsp; </span>=gcc <span class="Identifier">$(RAMDISK)<br/></li>
<li></span><span class="Identifier">CFLAGS&nbsp; &nbsp; &nbsp; &nbsp; </span>= -w -O -fleading-underscore -m32 -fstrength-reduce -fomit-frame-pointer<br/></li>
<li><span class="Identifier">CPP&nbsp; &nbsp; &nbsp; &nbsp; </span>=cpp -nostdinc -Iinclude<br/></li>
<li><br/></li>
<li><span class="Comment">#<br/></li>
<li></span><span class="Comment"># ROOT_DEV specifies the default root-device when making the image.<br/></li>
<li></span><span class="Comment"># This can be either FLOPPY, /dev/xxxx or empty, in which case the<br/></li>
<li></span><span class="Comment"># default of /dev/hd6 is used by 'build'.<br/></li>
<li></span><span class="Comment">#<br/></li>
<li></span><span class="Comment"># ROOT_DEV=/dev/hd6<br/></li>
<li></span><span class="Identifier">ROOT_DEV</span>=FLOPPY<br/></li>
<li><br/></li>
<li><span class="Identifier">ARCHIVES</span>=kernel/kernel.o mm/mm.o fs/fs.o<br/></li>
<li><span class="Identifier">DRIVERS </span>=kernel/blk_drv/blk_drv.a kernel/chr_drv/chr_drv.a<br/></li>
<li><span class="Identifier">MATH&nbsp; &nbsp; &nbsp; &nbsp; </span>=kernel/math/math.a<br/></li>
<li><span class="Identifier">LIBS&nbsp; &nbsp; &nbsp; &nbsp; </span>=lib/lib.a<br/></li>
<li><br/></li>
<li><span class="Identifier">.c.s:<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">$(CC)</span><span class="Constant"> </span><span class="Identifier">$(CFLAGS)</span><span class="Constant"> </span><span class="Special">\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; -nostdinc -Iinclude -S -o </span><span class="Identifier">$*</span><span class="Constant">.s </span><span class="Identifier">$&lt;<br/></li>
<li></span><span class="Identifier">.s.o:<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">$(AS)</span><span class="Constant"> -o </span><span class="Identifier">$*</span><span class="Constant">.o </span><span class="Identifier">$&lt;<br/></li>
<li></span><span class="Identifier">.c.o:<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">$(CC)</span><span class="Constant"> </span><span class="Identifier">$(CFLAGS)</span><span class="Constant"> </span><span class="Special">\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; -nostdinc -Iinclude -c -o </span><span class="Identifier">$*</span><span class="Constant">.o </span><span class="Identifier">$&lt;<br/></li>
<li></span><br/></li>
<li><span class="Identifier">all:</span>&nbsp; &nbsp; &nbsp; &nbsp; Image<br/></li>
<li><br/></li>
<li><span class="Identifier">Image:</span> boot/bootsect boot/setup tools/system tools/build<br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; tools/build boot/bootsect boot/setup tools/system </span><span class="Identifier">$(ROOT_DEV)</span><span class="Constant"> &gt; Image<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; sync<br/></li>
<li></span><br/></li>
<li><span class="Identifier">disk:</span> Image<br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; dd if=Image of=bootimage-fda.img<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; dd bs=1024 if=/dev/zero of=bootimage-fda.img seek=256 count=1184<br/></li>
<li></span><br/></li>
<li><span class="Identifier">tools/build:</span> tools/build.c<br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">$(CC)</span><span class="Constant"> -w -O -m32 -fstrength-reduce -fomit-frame-pointer </span><span class="Special">\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; -o tools/build tools/build.c<br/></li>
<li></span><br/></li>
<li><span class="Identifier">boot/head.o:</span> boot/head.s<br/></li>
<li><br/></li>
<li><span class="Identifier">tools/system:</span>&nbsp; &nbsp; &nbsp; &nbsp; boot/head.o init/main.o <span class="Special">\<br/></li>
<li></span><span class="Special">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">$(ARCHIVES)</span> <span class="Identifier">$(DRIVERS)</span> <span class="Identifier">$(MATH)</span> <span class="Identifier">$(LIBS)<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">$(LD)</span><span class="Constant"> </span><span class="Identifier">$(LDFLAGS)</span><span class="Constant"> boot/head.o init/main.o </span><span class="Special">\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">$(ARCHIVES)</span><span class="Constant"> </span><span class="Special">\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">$(DRIVERS)</span><span class="Constant"> </span><span class="Special">\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">$(MATH)</span><span class="Constant"> </span><span class="Special">\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">$(LIBS)</span><span class="Constant"> </span><span class="Special">\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; -o tools/system &gt; System.map<br/></li>
<li></span><br/></li>
<li><span class="Identifier">kernel/math/math.a:<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (cd kernel/math; make)<br/></li>
<li></span><br/></li>
<li><span class="Identifier">kernel/blk_drv/blk_drv.a:<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (cd kernel/blk_drv; make)<br/></li>
<li></span><br/></li>
<li><span class="Identifier">kernel/chr_drv/chr_drv.a:<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (cd kernel/chr_drv; make)<br/></li>
<li></span><br/></li>
<li><span class="Identifier">kernel/kernel.o:<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (cd kernel; make)<br/></li>
<li></span><br/></li>
<li><span class="Identifier">mm/mm.o:<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (cd mm; make)<br/></li>
<li></span><br/></li>
<li><span class="Identifier">fs/fs.o:<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (cd fs; make)<br/></li>
<li></span><br/></li>
<li><span class="Identifier">lib/lib.a:<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (cd lib; make)<br/></li>
<li></span><br/></li>
<li><span class="Identifier">boot/setup:</span> boot/setup.s<br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">$(AS86)</span><span class="Constant"> -o boot/setup.o boot/setup.s<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">$(LD86)</span><span class="Constant"> -s -o boot/setup boot/setup.o<br/></li>
<li></span><br/></li>
<li><span class="Identifier">boot/bootsect:</span>&nbsp; &nbsp; &nbsp; &nbsp; boot/bootsect.s<br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">$(AS86)</span><span class="Constant"> -o boot/bootsect.o boot/bootsect.s<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">$(LD86)</span><span class="Constant"> -s -o boot/bootsect boot/bootsect.o<br/></li>
<li></span><br/></li>
<li><span class="Identifier">tmp.s:</span>&nbsp; &nbsp; &nbsp; &nbsp; boot/bootsect.s tools/system<br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (echo -n &quot;SYSSIZE = (&quot;;ls -l tools/system | grep system </span><span class="Special">\<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | cut -c25-31 | tr '\012' ' '; echo &quot;+ 15 ) / 16&quot;) &gt; tmp.s<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; cat boot/bootsect.s &gt;&gt; tmp.s<br/></li>
<li></span><br/></li>
<li><span class="Identifier">clean:<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; rm -f Image System.map tmp_make core boot/bootsect boot/setup bochsout.txt<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; rm -f init/*.o tools/system tools/build boot/*.o<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (cd mm;make clean)<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (cd fs;make clean)<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (cd kernel;make clean)<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (cd lib;make clean)<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; find . -name \*~ -type f |xargs rm -f<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; find . -name \*.bak -type f |xargs rm -f<br/></li>
<li></span><br/></li>
<li><span class="Identifier">backup:</span> clean<br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (cd .. ; tar cf - linux | compress - &gt; backup.Z)<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; sync<br/></li>
<li></span><br/></li>
<li><span class="Identifier">dep:<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; sed '/\#\#\# Dependencies/q' &lt; Makefile &gt; tmp_make<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (for i in init/*.c;do echo -n &quot;init/&quot;;</span><span class="Identifier">$(CPP)</span><span class="Constant"> -M </span><span class="Identifier">$$</span><span class="Constant">i;done) &gt;&gt; tmp_make<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; cp tmp_make Makefile<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (cd fs; make dep)<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (cd kernel; make dep)<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; (cd mm; make dep)<br/></li>
<li></span><br/></li>
<li><span class="Identifier">bochs:</span> disk bootimage-fda.img diskb.img hdc-0.11-new.img dot-bochsrc<br/></li>
<li><span class="Constant">&nbsp; &nbsp; &nbsp; &nbsp; bochs -f dot-bochsrc<br/></li>
<li></span><br/></li>
<li><span class="Comment">### Dependencies:<br/></li>
<li></span><span class="Identifier">init/main.o :</span> init/main.c include/unistd.h include/sys/stat.h <span class="Special">\<br/></li>
<li></span><span class="Special">&nbsp; </span>include/sys/types.h include/sys/times.h include/sys/utsname.h <span class="Special">\<br/></li>
<li></span><span class="Special">&nbsp; </span>include/utime.h include/time.h include/linux/tty.h include/termios.h <span class="Special">\<br/></li>
<li></span><span class="Special">&nbsp; </span>include/linux/sched.h include/linux/head.h include/linux/fs.h <span class="Special">\<br/></li>
<li></span><span class="Special">&nbsp; </span>include/linux/mm.h include/signal.h include/asm/system.h include/asm/io.h <span class="Special">\<br/></li>
<li></span><span class="Special">&nbsp; </span>include/stddef.h include/stdarg.h include/fcntl.h<br/></li>
</ol></code>
 </body>
</html>

<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>include/asm/system.h - linux-0.11-ebook</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>include/asm/system.h - linux-0.11-ebook</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Macros defined</h4>
 <ul>
<li><a href="#L22">_set_gate</a></li>
<li><a href="#L42">_set_seg_desc</a></li>
<li><a href="#L52">_set_tssldt_desc</a></li>
<li><a href="#L17">cli</a></li>
<li><a href="#L20">iret</a></li>
<li><a href="#L1">move_to_user_mode</a></li>
<li><a href="#L18">nop</a></li>
<li><a href="#L33">set_intr_gate</a></li>
<li><a href="#L66">set_ldt_desc</a></li>
<li><a href="#L39">set_system_gate</a></li>
<li><a href="#L36">set_trap_gate</a></li>
<li><a href="#L65">set_tss_desc</a></li>
<li><a href="#L16">sti</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><a id="L1">&#x200c;</a><span class="PreProc">#define <span class="linkable">move_to_user_mode</span>() \<br/></li>
<li></span><span class="PreProc">__asm__ (</span><span class="Constant">&quot;movl </span><span class="Special">%%</span><span class="Constant">esp,</span><span class="Special">%%</span><span class="Constant">eax</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;pushl $0x17</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;pushl </span><span class="Special">%%</span><span class="Constant">eax</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;pushfl</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;pushl $0x0f</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;pushl $1f</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;<a href="#L20" title="include/asm/system.h:20">iret</a></span><span class="Special">\n</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;1:</span><span class="Special">\t</span><span class="Constant">movl $0x17,</span><span class="Special">%%</span><span class="Constant">eax</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;movw </span><span class="Special">%%</span><span class="Constant">ax,</span><span class="Special">%%</span><span class="Constant">ds</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;movw </span><span class="Special">%%</span><span class="Constant">ax,</span><span class="Special">%%</span><span class="Constant">es</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;movw </span><span class="Special">%%</span><span class="Constant">ax,</span><span class="Special">%%</span><span class="Constant">fs</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;movw </span><span class="Special">%%</span><span class="Constant">ax,</span><span class="Special">%%</span><span class="Constant">gs&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; :::)<br/></li>
<li></span><br/></li>
<li><a id="L16">&#x200c;</a><span class="PreProc">#define <span class="linkable">sti</span>() __asm__ (</span><span class="Constant">&quot;<span class="linkable">sti</span>&quot;</span><span class="PreProc">::)<br/></li>
<li><a id="L17">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">cli</span>() __asm__ (</span><span class="Constant">&quot;<span class="linkable">cli</span>&quot;</span><span class="PreProc">::)<br/></li>
<li><a id="L18">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">nop</span>() __asm__ (</span><span class="Constant">&quot;<span class="linkable">nop</span>&quot;</span><span class="PreProc">::)<br/></li>
<li></span><br/></li>
<li><a id="L20">&#x200c;</a><span class="PreProc">#define <span class="linkable">iret</span>() __asm__ (</span><span class="Constant">&quot;<span class="linkable">iret</span>&quot;</span><span class="PreProc">::)<br/></li>
<li></span><br/></li>
<li><a id="L22">&#x200c;</a><span class="PreProc">#define <span class="linkable">_set_gate</span>(gate_addr,type,dpl,addr) \<br/></li>
<li></span><span class="PreProc">__asm__ (</span><span class="Constant">&quot;movw </span><span class="Special">%%</span><span class="Constant">dx,</span><span class="Special">%%</span><span class="Constant">ax</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;movw %0,</span><span class="Special">%%</span><span class="Constant">dx</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;movl </span><span class="Special">%%</span><span class="Constant">eax,%1</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;movl </span><span class="Special">%%</span><span class="Constant">edx,%2&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; : \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; : </span><span class="Constant">&quot;i&quot;</span><span class="PreProc"> ((</span><span class="Type">short</span><span class="PreProc">) (</span><span class="Constant">0x8000</span><span class="PreProc">+(dpl&lt;&lt;</span><span class="Constant">13</span><span class="PreProc">)+(type&lt;&lt;</span><span class="Constant">8</span><span class="PreProc">))), \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;o&quot;</span><span class="PreProc"> (*((</span><span class="Type">char</span><span class="PreProc"> *) (gate_addr))), \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;o&quot;</span><span class="PreProc"> (*(</span><span class="Constant">4</span><span class="PreProc">+(</span><span class="Type">char</span><span class="PreProc"> *) (gate_addr))), \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;d&quot;</span><span class="PreProc"> ((</span><span class="Type">char</span><span class="PreProc"> *) (addr)),</span><span class="Constant">&quot;a&quot;</span><span class="PreProc"> (</span><span class="Constant">0x00080000</span><span class="PreProc">))<br/></li>
<li></span><br/></li>
<li><a id="L33">&#x200c;</a><span class="PreProc">#define <span class="linkable">set_intr_gate</span>(n,addr) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L22" title="include/asm/system.h:22">_set_gate</a>(&amp;idt[n],</span><span class="Constant">14</span><span class="PreProc">,</span><span class="Constant">0</span><span class="PreProc">,addr)<br/></li>
<li></span><br/></li>
<li><a id="L36">&#x200c;</a><span class="PreProc">#define <span class="linkable">set_trap_gate</span>(n,addr) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L22" title="include/asm/system.h:22">_set_gate</a>(&amp;idt[n],</span><span class="Constant">15</span><span class="PreProc">,</span><span class="Constant">0</span><span class="PreProc">,addr)<br/></li>
<li></span><br/></li>
<li><a id="L39">&#x200c;</a><span class="PreProc">#define <span class="linkable">set_system_gate</span>(n,addr) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L22" title="include/asm/system.h:22">_set_gate</a>(&amp;idt[n],</span><span class="Constant">15</span><span class="PreProc">,</span><span class="Constant">3</span><span class="PreProc">,addr)<br/></li>
<li></span><br/></li>
<li><a id="L42">&#x200c;</a><span class="PreProc">#define <span class="linkable">_set_seg_desc</span>(gate_addr,type,dpl,base,limit) {\<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; *(gate_addr) = ((base) &amp; </span><span class="Constant">0xff000000</span><span class="PreProc">) | \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (((base) &amp; </span><span class="Constant">0x00ff0000</span><span class="PreProc">)&gt;&gt;</span><span class="Constant">16</span><span class="PreProc">) | \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((limit) &amp; </span><span class="Constant">0xf0000</span><span class="PreProc">) | \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((dpl)&lt;&lt;</span><span class="Constant">13</span><span class="PreProc">) | \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">0x00408000</span><span class="PreProc">) | \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((type)&lt;&lt;</span><span class="Constant">8</span><span class="PreProc">); \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; *((gate_addr)+</span><span class="Constant">1</span><span class="PreProc">) = (((base) &amp; </span><span class="Constant">0x0000ffff</span><span class="PreProc">)&lt;&lt;</span><span class="Constant">16</span><span class="PreProc">) | \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((limit) &amp; </span><span class="Constant">0x0ffff</span><span class="PreProc">); }<br/></li>
<li></span><br/></li>
<li><a id="L52">&#x200c;</a><span class="PreProc">#define <span class="linkable">_set_tssldt_desc</span>(n,addr,type) \<br/></li>
<li></span><span class="PreProc">__asm__ (</span><span class="Constant">&quot;movw $104,%1</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;movw </span><span class="Special">%%</span><span class="Constant">ax,%2</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;rorl $16,</span><span class="Special">%%</span><span class="Constant">eax</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;movb </span><span class="Special">%%</span><span class="Constant">al,%3</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;movb $&quot;</span><span class="PreProc"> type </span><span class="Constant">&quot;,%4</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;movb $0x00,%5</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;movb </span><span class="Special">%%</span><span class="Constant">ah,%6</span><span class="Special">\n\t</span><span class="Constant">&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">&quot;rorl $16,</span><span class="Special">%%</span><span class="Constant">eax&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; ::</span><span class="Constant">&quot;a&quot;</span><span class="PreProc"> (addr), </span><span class="Constant">&quot;m&quot;</span><span class="PreProc"> (*(n)), </span><span class="Constant">&quot;m&quot;</span><span class="PreProc"> (*(n+</span><span class="Constant">2</span><span class="PreProc">)), </span><span class="Constant">&quot;m&quot;</span><span class="PreProc"> (*(n+</span><span class="Constant">4</span><span class="PreProc">)), \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">&quot;m&quot;</span><span class="PreProc"> (*(n+</span><span class="Constant">5</span><span class="PreProc">)), </span><span class="Constant">&quot;m&quot;</span><span class="PreProc"> (*(n+</span><span class="Constant">6</span><span class="PreProc">)), </span><span class="Constant">&quot;m&quot;</span><span class="PreProc"> (*(n+</span><span class="Constant">7</span><span class="PreProc">)) \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; )<br/></li>
<li></span><br/></li>
<li><a id="L65">&#x200c;</a><span class="PreProc">#define <span class="linkable">set_tss_desc</span>(n,addr) <a href="#L52" title="include/asm/system.h:52">_set_tssldt_desc</a>(((</span><span class="Type">char</span><span class="PreProc"> *) (n)),addr,</span><span class="Constant">&quot;0x89&quot;</span><span class="PreProc">)<br/></li>
<li><a id="L66">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">set_ldt_desc</span>(n,addr) <a href="#L52" title="include/asm/system.h:52">_set_tssldt_desc</a>(((</span><span class="Type">char</span><span class="PreProc"> *) (n)),addr,</span><span class="Constant">&quot;0x82&quot;</span><span class="PreProc">)<br/></li>
</ol></span></code>
 </body>
</html>

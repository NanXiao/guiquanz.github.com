<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>kernel/traps.c - linux-0.11-ebook</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>kernel/traps.c - linux-0.11-ebook</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L63">die</a></li>
<li><a href="#L134">do_bounds</a></li>
<li><a href="#L169">do_coprocessor_error</a></li>
<li><a href="#L149">do_coprocessor_segment_overrun</a></li>
<li><a href="#L124">do_debug</a></li>
<li><a href="#L144">do_device_not_available</a></li>
<li><a href="#L97">do_divide_error</a></li>
<li><a href="#L87">do_double_fault</a></li>
<li><a href="#L92">do_general_protection</a></li>
<li><a href="#L102">do_int3</a></li>
<li><a href="#L154">do_invalid_TSS</a></li>
<li><a href="#L139">do_invalid_op</a></li>
<li><a href="#L119">do_nmi</a></li>
<li><a href="#L129">do_overflow</a></li>
<li><a href="#L176">do_reserved</a></li>
<li><a href="#L159">do_segment_not_present</a></li>
<li><a href="#L164">do_stack_segment</a></li>
<li><a href="#L181">trap_init</a></li>
</ul>
 <h4>Macros defined</h4>
 <ul>
<li><a href="#L34">_fs</a></li>
<li><a href="#L22">get_seg_byte</a></li>
<li><a href="#L28">get_seg_long</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; linux/kernel/traps.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; (C) 1991&nbsp; Linus Torvalds<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * 'Traps.c' handles hardware traps and faults after we have saved some<br/></li>
<li></span><span class="Comment"> * <a href="chr_drv/console.c.html#L74" title="kernel/chr_drv/console.c:74">state</a> in 'asm.s'. Currently mostly a debugging-aid, will be extended<br/></li>
<li></span><span class="Comment"> * to mainly kill the offending process (probably by giving it a signal,<br/></li>
<li></span><span class="Comment"> * but possibly by killing it outright if necessary).<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;string.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;linux/<a href="blk_drv/floppy.c.html#L117" title="kernel/blk_drv/floppy.c:117">head</a>.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;linux/sched.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;linux/kernel.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;asm/system.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;asm/segment.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;asm/io.h&gt;<br/></li>
<li></span><br/></li>
<li><a id="L22">&#x200c;</a><span class="PreProc">#define <span class="linkable">get_seg_byte</span>(seg,addr) (</span><span class="Error">{</span><span class="PreProc"> \<br/></li>
<li></span><span class="Type">register</span><span class="PreProc"> </span><span class="Type">char</span><span class="PreProc"> __res; \<br/></li>
<li></span><span class="PreProc">__asm__(</span><span class="Constant">&quot;push </span><span class="Special">%%</span><span class="Constant">fs;mov </span><span class="Special">%%</span><span class="Constant">ax,</span><span class="Special">%%</span><span class="Constant">fs;movb </span><span class="Special">%%</span><span class="Constant">fs:%2,</span><span class="Special">%%</span><span class="Constant">al;pop </span><span class="Special">%%</span><span class="Constant">fs&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; :</span><span class="Constant">&quot;=a&quot;</span><span class="PreProc"> (__res):</span><span class="Constant">&quot;0&quot;</span><span class="PreProc"> (seg),</span><span class="Constant">&quot;m&quot;</span><span class="PreProc"> (*(addr))); \<br/></li>
<li></span><span class="PreProc">__res;</span><span class="Error">}</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><a id="L28">&#x200c;</a><span class="PreProc">#define <span class="linkable">get_seg_long</span>(seg,addr) (</span><span class="Error">{</span><span class="PreProc"> \<br/></li>
<li></span><span class="Type">register</span><span class="PreProc"> </span><span class="Type">unsigned</span><span class="PreProc"> </span><span class="Type">long</span><span class="PreProc"> __res; \<br/></li>
<li></span><span class="PreProc">__asm__(</span><span class="Constant">&quot;push </span><span class="Special">%%</span><span class="Constant">fs;mov </span><span class="Special">%%</span><span class="Constant">ax,</span><span class="Special">%%</span><span class="Constant">fs;movl </span><span class="Special">%%</span><span class="Constant">fs:%2,</span><span class="Special">%%</span><span class="Constant">eax;pop </span><span class="Special">%%</span><span class="Constant">fs&quot;</span><span class="PreProc"> \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; :</span><span class="Constant">&quot;=a&quot;</span><span class="PreProc"> (__res):</span><span class="Constant">&quot;0&quot;</span><span class="PreProc"> (seg),</span><span class="Constant">&quot;m&quot;</span><span class="PreProc"> (*(addr))); \<br/></li>
<li></span><span class="PreProc">__res;</span><span class="Error">}</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><a id="L34">&#x200c;</a><span class="PreProc">#define <span class="linkable">_fs</span>() (</span><span class="Error">{</span><span class="PreProc"> \<br/></li>
<li></span><span class="Type">register</span><span class="PreProc"> </span><span class="Type">unsigned</span><span class="PreProc"> </span><span class="Type">short</span><span class="PreProc"> __res; \<br/></li>
<li></span><span class="PreProc">__asm__(</span><span class="Constant">&quot;mov </span><span class="Special">%%</span><span class="Constant">fs,</span><span class="Special">%%</span><span class="Constant">ax&quot;</span><span class="PreProc">:</span><span class="Constant">&quot;=a&quot;</span><span class="PreProc"> (__res):); \<br/></li>
<li></span><span class="PreProc">__res;</span><span class="Error">}</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><span class="Type">int</span> <a href="exit.c.html#L102" title="kernel/exit.c:102">do_exit</a>(<span class="Type">long</span> code);<br/></li>
<li><br/></li>
<li><span class="Type">void</span> page_exception(<span class="Type">void</span>);<br/></li>
<li><br/></li>
<li><span class="Type">void</span> divide_error(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> debug(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> nmi(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> int3(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> overflow(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> bounds(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> invalid_op(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> device_not_available(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> double_fault(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> coprocessor_segment_overrun(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> invalid_TSS(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> segment_not_present(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> stack_segment(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> general_protection(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> page_fault(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> coprocessor_error(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> reserved(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> parallel_interrupt(<span class="Type">void</span>);<br/></li>
<li><span class="Type">void</span> irq13(<span class="Type">void</span>);<br/></li>
<li><br/></li>
<li><a id="L63">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">die</span>(<span class="Type">char</span> * <a href="../include/linux/sched.h.html#L159" title="include/linux/sched.h:159">str</a>,<span class="Type">long</span> esp_ptr,<span class="Type">long</span> nr)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">long</span> * esp = (<span class="Type">long</span> *) esp_ptr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">: </span><span class="Special">%04x\n\r</span><span class="Constant">&quot;</span>,<a href="../include/linux/sched.h.html#L159" title="include/linux/sched.h:159">str</a>,nr&amp;<span class="Constant">0xffff</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;EIP:</span><span class="Special">\t%04x</span><span class="Constant">:</span><span class="Special">%p\n</span><span class="Constant">EFLAGS:</span><span class="Special">\t%p\n</span><span class="Constant">ESP:</span><span class="Special">\t%04x</span><span class="Constant">:</span><span class="Special">%p\n</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; esp[<span class="Constant">1</span>],esp[<span class="Constant">0</span>],esp[<span class="Constant">2</span>],esp[<span class="Constant">4</span>],esp[<span class="Constant">3</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;fs: </span><span class="Special">%04x\n</span><span class="Constant">&quot;</span>,<a href="#L34" title="kernel/traps.c:34">_fs</a>());<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;base: </span><span class="Special">%p</span><span class="Constant">, limit: </span><span class="Special">%p\n</span><span class="Constant">&quot;</span>,<a href="../include/linux/sched.h.html#L226" title="include/linux/sched.h:226">get_base</a>(<a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;ldt[<span class="Constant">1</span>]),<a href="../include/linux/sched.h.html#L228" title="include/linux/sched.h:228">get_limit</a>(<span class="Constant">0x17</span>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (esp[<span class="Constant">4</span>] == <span class="Constant">0x17</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;Stack: &quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i=<span class="Constant">0</span>;i&lt;<span class="Constant">4</span>;i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;</span><span class="Special">%p</span><span class="Constant"> &quot;</span>,<a href="#L28" title="kernel/traps.c:28">get_seg_long</a>(<span class="Constant">0x17</span>,i+(<span class="Type">long</span> *)esp[<span class="Constant">3</span>]));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/linux/sched.h.html#L159" title="include/linux/sched.h:159">str</a>(i);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;Pid: </span><span class="Special">%d</span><span class="Constant">, process nr: </span><span class="Special">%d\n\r</span><span class="Constant">&quot;</span>,<a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;pid,<span class="Constant">0xffff</span> &amp; i);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span>(i=<span class="Constant">0</span>;i&lt;<span class="Constant">10</span>;i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;</span><span class="Special">%02x</span><span class="Constant"> &quot;</span>,<span class="Constant">0xff</span> &amp; <a href="#L22" title="kernel/traps.c:22">get_seg_byte</a>(esp[<span class="Constant">1</span>],(i+(<span class="Type">char</span> *)esp[<span class="Constant">0</span>])));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;</span><span class="Special">\n\r</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="exit.c.html#L102" title="kernel/exit.c:102">do_exit</a>(<span class="Constant">11</span>);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* play segment exception */<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><a id="L87">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_double_fault</span>(<span class="Type">long</span> esp, <span class="Type">long</span> error_code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tools/build.c.html#L50" title="tools/build.c:50">die</a>(<span class="Constant">&quot;double fault&quot;</span>,esp,error_code);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L92">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_general_protection</span>(<span class="Type">long</span> esp, <span class="Type">long</span> error_code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tools/build.c.html#L50" title="tools/build.c:50">die</a>(<span class="Constant">&quot;general protection&quot;</span>,esp,error_code);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L97">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_divide_error</span>(<span class="Type">long</span> esp, <span class="Type">long</span> error_code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tools/build.c.html#L50" title="tools/build.c:50">die</a>(<span class="Constant">&quot;divide error&quot;</span>,esp,error_code);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L102">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_int3</span>(<span class="Type">long</span> * esp, <span class="Type">long</span> error_code,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">long</span> fs,<span class="Type">long</span> es,<span class="Type">long</span> ds,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">long</span> ebp,<span class="Type">long</span> esi,<span class="Type">long</span> edi,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">long</span> edx,<span class="Type">long</span> ecx,<span class="Type">long</span> ebx,<span class="Type">long</span> eax)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> tr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; __asm__(<span class="Constant">&quot;<a href="../include/linux/sched.h.html#L159" title="include/linux/sched.h:159">str</a> </span><span class="Special">%%</span><span class="Constant">ax&quot;</span>:<span class="Constant">&quot;=a&quot;</span> (tr):<span class="Constant">&quot;0&quot;</span> (<span class="Constant">0</span>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;eax</span><span class="Special">\t\t</span><span class="Constant">ebx</span><span class="Special">\t\t</span><span class="Constant">ecx</span><span class="Special">\t\t</span><span class="Constant">edx</span><span class="Special">\n\r%8x\t%8x\t%8x\t%8x\n\r</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eax,ebx,ecx,edx);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;esi</span><span class="Special">\t\t</span><span class="Constant">edi</span><span class="Special">\t\t</span><span class="Constant">ebp</span><span class="Special">\t\t</span><span class="Constant">esp</span><span class="Special">\n\r%8x\t%8x\t%8x\t%8x\n\r</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; esi,edi,ebp,(<span class="Type">long</span>) esp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;</span><span class="Special">\n\r</span><span class="Constant">ds</span><span class="Special">\t</span><span class="Constant">es</span><span class="Special">\t</span><span class="Constant">fs</span><span class="Special">\t</span><span class="Constant">tr</span><span class="Special">\n\r%4x\t%4x\t%4x\t%4x\n\r</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ds,es,fs,tr);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;EIP: </span><span class="Special">%8x</span><span class="Constant">&nbsp;&nbsp; CS: </span><span class="Special">%4x</span><span class="Constant">&nbsp; EFLAGS: </span><span class="Special">%8x\n\r</span><span class="Constant">&quot;</span>,esp[<span class="Constant">0</span>],esp[<span class="Constant">1</span>],esp[<span class="Constant">2</span>]);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L119">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_nmi</span>(<span class="Type">long</span> esp, <span class="Type">long</span> error_code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tools/build.c.html#L50" title="tools/build.c:50">die</a>(<span class="Constant">&quot;nmi&quot;</span>,esp,error_code);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L124">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_debug</span>(<span class="Type">long</span> esp, <span class="Type">long</span> error_code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tools/build.c.html#L50" title="tools/build.c:50">die</a>(<span class="Constant">&quot;debug&quot;</span>,esp,error_code);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L129">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_overflow</span>(<span class="Type">long</span> esp, <span class="Type">long</span> error_code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tools/build.c.html#L50" title="tools/build.c:50">die</a>(<span class="Constant">&quot;overflow&quot;</span>,esp,error_code);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L134">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_bounds</span>(<span class="Type">long</span> esp, <span class="Type">long</span> error_code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tools/build.c.html#L50" title="tools/build.c:50">die</a>(<span class="Constant">&quot;bounds&quot;</span>,esp,error_code);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L139">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_invalid_op</span>(<span class="Type">long</span> esp, <span class="Type">long</span> error_code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tools/build.c.html#L50" title="tools/build.c:50">die</a>(<span class="Constant">&quot;invalid operand&quot;</span>,esp,error_code);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L144">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_device_not_available</span>(<span class="Type">long</span> esp, <span class="Type">long</span> error_code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tools/build.c.html#L50" title="tools/build.c:50">die</a>(<span class="Constant">&quot;device not available&quot;</span>,esp,error_code);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L149">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_coprocessor_segment_overrun</span>(<span class="Type">long</span> esp, <span class="Type">long</span> error_code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tools/build.c.html#L50" title="tools/build.c:50">die</a>(<span class="Constant">&quot;coprocessor segment overrun&quot;</span>,esp,error_code);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L154">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_invalid_TSS</span>(<span class="Type">long</span> esp,<span class="Type">long</span> error_code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tools/build.c.html#L50" title="tools/build.c:50">die</a>(<span class="Constant">&quot;invalid TSS&quot;</span>,esp,error_code);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L159">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_segment_not_present</span>(<span class="Type">long</span> esp,<span class="Type">long</span> error_code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tools/build.c.html#L50" title="tools/build.c:50">die</a>(<span class="Constant">&quot;segment not present&quot;</span>,esp,error_code);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L164">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_stack_segment</span>(<span class="Type">long</span> esp,<span class="Type">long</span> error_code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tools/build.c.html#L50" title="tools/build.c:50">die</a>(<span class="Constant">&quot;stack segment&quot;</span>,esp,error_code);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L169">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_coprocessor_error</span>(<span class="Type">long</span> esp, <span class="Type">long</span> error_code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="sched.c.html#L63" title="kernel/sched.c:63">last_task_used_math</a> != <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tools/build.c.html#L50" title="tools/build.c:50">die</a>(<span class="Constant">&quot;coprocessor error&quot;</span>,esp,error_code);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L176">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_reserved</span>(<span class="Type">long</span> esp, <span class="Type">long</span> error_code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../tools/build.c.html#L50" title="tools/build.c:50">die</a>(<span class="Constant">&quot;reserved (15,17-47) error&quot;</span>,esp,error_code);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L181">&#x200c;</a><span class="Type">void</span> <span class="linkable">trap_init</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">0</span>,&amp;divide_error);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">1</span>,&amp;debug);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">2</span>,&amp;nmi);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L39" title="include/asm/system.h:39">set_system_gate</a>(<span class="Constant">3</span>,&amp;int3);&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* int3-5 can be called from all */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L39" title="include/asm/system.h:39">set_system_gate</a>(<span class="Constant">4</span>,&amp;overflow);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L39" title="include/asm/system.h:39">set_system_gate</a>(<span class="Constant">5</span>,&amp;bounds);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">6</span>,&amp;invalid_op);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">7</span>,&amp;device_not_available);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">8</span>,&amp;double_fault);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">9</span>,&amp;coprocessor_segment_overrun);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">10</span>,&amp;invalid_TSS);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">11</span>,&amp;segment_not_present);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">12</span>,&amp;stack_segment);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">13</span>,&amp;general_protection);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">14</span>,&amp;page_fault);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">15</span>,&amp;reserved);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">16</span>,&amp;coprocessor_error);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i=<span class="Constant">17</span>;i&lt;<span class="Constant">48</span>;i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(i,&amp;reserved);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">45</span>,&amp;irq13);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/io.h.html#L11" title="include/asm/io.h:11">outb_p</a>(<a href="../include/asm/io.h.html#L17" title="include/asm/io.h:17">inb_p</a>(<span class="Constant">0x21</span>)&amp;<span class="Constant">0xfb</span>,<span class="Constant">0x21</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/io.h.html#L1" title="include/asm/io.h:1">outb</a>(<a href="../include/asm/io.h.html#L17" title="include/asm/io.h:17">inb_p</a>(<span class="Constant">0xA1</span>)&amp;<span class="Constant">0xdf</span>,<span class="Constant">0xA1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">39</span>,&amp;parallel_interrupt);<br/></li>
<li>}<br/></li>
</ol></code>
 </body>
</html>

<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>kernel/sys.c - linux-0.11-ebook</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>kernel/sys.c - linux-0.11-ebook</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L77">sys_acct</a></li>
<li><a href="#L21">sys_break</a></li>
<li><a href="#L168">sys_brk</a></li>
<li><a href="#L16">sys_ftime</a></li>
<li><a href="#L201">sys_getpgrp</a></li>
<li><a href="#L36">sys_gtty</a></li>
<li><a href="#L87">sys_lock</a></li>
<li><a href="#L92">sys_mpx</a></li>
<li><a href="#L82">sys_phys</a></li>
<li><a href="#L46">sys_prof</a></li>
<li><a href="#L26">sys_ptrace</a></li>
<li><a href="#L41">sys_rename</a></li>
<li><a href="#L72">sys_setgid</a></li>
<li><a href="#L181">sys_setpgid</a></li>
<li><a href="#L51">sys_setregid</a></li>
<li><a href="#L118">sys_setreuid</a></li>
<li><a href="#L206">sys_setsid</a></li>
<li><a href="#L143">sys_setuid</a></li>
<li><a href="#L148">sys_stime</a></li>
<li><a href="#L31">sys_stty</a></li>
<li><a href="#L102">sys_time</a></li>
<li><a href="#L156">sys_times</a></li>
<li><a href="#L97">sys_ulimit</a></li>
<li><a href="#L230">sys_umask</a></li>
<li><a href="#L216">sys_uname</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; linux/kernel/sys.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; (C) 1991&nbsp; Linus Torvalds<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;<a href="../lib/errno.c.html#L7" title="lib/errno.c:7">errno</a>.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;linux/sched.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;linux/tty.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;linux/kernel.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;asm/segment.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;sys/times.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;sys/<a href="../include/sys/utsname.h.html#L6" title="include/sys/utsname.h:6">utsname</a>.h&gt;<br/></li>
<li></span><br/></li>
<li><a id="L16">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_ftime</span>()<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L57" title="include/errno.h:57">ENOSYS</a></span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L21">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_break</span>()<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L57" title="include/errno.h:57">ENOSYS</a></span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L26">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_ptrace</span>()<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L57" title="include/errno.h:57">ENOSYS</a></span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L31">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_stty</span>()<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L57" title="include/errno.h:57">ENOSYS</a></span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L36">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_gtty</span>()<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L57" title="include/errno.h:57">ENOSYS</a></span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L41">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_rename</span>()<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L57" title="include/errno.h:57">ENOSYS</a></span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L46">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_prof</span>()<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L57" title="include/errno.h:57">ENOSYS</a></span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L51">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_setregid</span>(<span class="Type">int</span> rgid, <span class="Type">int</span> egid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rgid&gt;<span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((<a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;gid == rgid) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/linux/kernel.h.html#L21" title="include/linux/kernel.h:21">suser</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;gid = rgid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>(-<span class="Constant"><a href="../include/errno.h.html#L20" title="include/errno.h:20">EPERM</a></span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (egid&gt;<span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((<a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;gid == egid) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;egid == egid) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;sgid == egid) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/linux/kernel.h.html#L21" title="include/linux/kernel.h:21">suser</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;egid = egid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>(-<span class="Constant"><a href="../include/errno.h.html#L20" title="include/errno.h:20">EPERM</a></span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L72">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_setgid</span>(<span class="Type">int</span> gid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>(<a href="#L51" title="kernel/sys.c:51">sys_setregid</a>(gid, gid));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L77">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_acct</span>()<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L57" title="include/errno.h:57">ENOSYS</a></span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L82">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_phys</span>()<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L57" title="include/errno.h:57">ENOSYS</a></span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L87">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_lock</span>()<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L57" title="include/errno.h:57">ENOSYS</a></span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L92">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_mpx</span>()<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L57" title="include/errno.h:57">ENOSYS</a></span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L97">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_ulimit</span>()<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L57" title="include/errno.h:57">ENOSYS</a></span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L102">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_time</span>(<span class="Type">long</span> * tloc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; i = <a href="../include/linux/sched.h.html#L142" title="include/linux/sched.h:142">CURRENT_TIME</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tloc) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="fork.c.html#L24" title="kernel/fork.c:24">verify_area</a>(tloc,<span class="Constant">4</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L35" title="include/asm/segment.h:35">put_fs_long</a>(i,(<span class="Type">unsigned</span> <span class="Type">long</span> *)tloc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> i;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Unprivileged users may change the real user id to the effective uid<br/></li>
<li></span><span class="Comment"> * or vice versa.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L118">&#x200c;</a></span><span class="Type">int</span> <span class="linkable">sys_setreuid</span>(<span class="Type">int</span> ruid, <span class="Type">int</span> euid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> old_ruid = <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;uid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ruid&gt;<span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((<a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;euid==ruid) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (old_ruid == ruid) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/linux/kernel.h.html#L21" title="include/linux/kernel.h:21">suser</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;uid = ruid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>(-<span class="Constant"><a href="../include/errno.h.html#L20" title="include/errno.h:20">EPERM</a></span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (euid&gt;<span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((old_ruid == euid) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;euid == euid) ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/linux/kernel.h.html#L21" title="include/linux/kernel.h:21">suser</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;euid = euid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;uid = old_ruid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>(-<span class="Constant"><a href="../include/errno.h.html#L20" title="include/errno.h:20">EPERM</a></span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L143">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_setuid</span>(<span class="Type">int</span> uid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>(<a href="#L118" title="kernel/sys.c:118">sys_setreuid</a>(uid, uid));<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L148">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_stime</span>(<span class="Type">long</span> * tptr)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="../include/linux/kernel.h.html#L21" title="include/linux/kernel.h:21">suser</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L20" title="include/errno.h:20">EPERM</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="sched.c.html#L61" title="kernel/sched.c:61">startup_time</a> = <a href="../include/asm/segment.h.html#L17" title="include/asm/segment.h:17">get_fs_long</a>((<span class="Type">unsigned</span> <span class="Type">long</span> *)tptr) - <a href="sched.c.html#L60" title="kernel/sched.c:60">jiffies</a>/<a href="../include/linux/sched.h.html#L5" title="include/linux/sched.h:5">HZ</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L156">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_times</span>(<span class="Type">struct</span> <a href="../include/sys/times.h.html#L6" title="include/sys/times.h:6">tms</a> * tbuf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tbuf) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="fork.c.html#L24" title="kernel/fork.c:24">verify_area</a>(tbuf,<span class="Statement">sizeof</span> *tbuf);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L35" title="include/asm/segment.h:35">put_fs_long</a>(<a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;utime,(<span class="Type">unsigned</span> <span class="Type">long</span> *)&amp;tbuf-&gt;tms_utime);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L35" title="include/asm/segment.h:35">put_fs_long</a>(<a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;stime,(<span class="Type">unsigned</span> <span class="Type">long</span> *)&amp;tbuf-&gt;tms_stime);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L35" title="include/asm/segment.h:35">put_fs_long</a>(<a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;cutime,(<span class="Type">unsigned</span> <span class="Type">long</span> *)&amp;tbuf-&gt;tms_cutime);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L35" title="include/asm/segment.h:35">put_fs_long</a>(<a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;cstime,(<span class="Type">unsigned</span> <span class="Type">long</span> *)&amp;tbuf-&gt;tms_cstime);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="sched.c.html#L60" title="kernel/sched.c:60">jiffies</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L168">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_brk</span>(<span class="Type">unsigned</span> <span class="Type">long</span> end_data_seg)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (end_data_seg &gt;= <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;end_code &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end_data_seg &lt; <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;start_stack - <span class="Constant">16384</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;brk = end_data_seg;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;brk;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * This needs some heave checking ...<br/></li>
<li></span><span class="Comment"> * I just haven't get the stomach for it. I also don't fully<br/></li>
<li></span><span class="Comment"> * understand sessions/pgrp etc. Let somebody who does explain it.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L181">&#x200c;</a></span><span class="Type">int</span> <span class="linkable">sys_setpgid</span>(<span class="Type">int</span> pid, <span class="Type">int</span> pgid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!pid)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pid = <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;pid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!pgid)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pgid = <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;pid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i=<span class="Constant">0</span> ; i&lt;<a href="../include/linux/sched.h.html#L4" title="include/linux/sched.h:4">NR_TASKS</a> ; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="sched.c.html#L65" title="kernel/sched.c:65">task</a>[i] &amp;&amp; <a href="sched.c.html#L65" title="kernel/sched.c:65">task</a>[i]-&gt;pid==pid) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="sched.c.html#L65" title="kernel/sched.c:65">task</a>[i]-&gt;leader)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L20" title="include/errno.h:20">EPERM</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="sched.c.html#L65" title="kernel/sched.c:65">task</a>[i]-&gt;session != <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;session)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L20" title="include/errno.h:20">EPERM</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="sched.c.html#L65" title="kernel/sched.c:65">task</a>[i]-&gt;pgrp = pgid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L22" title="include/errno.h:22">ESRCH</a></span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L201">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_getpgrp</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;pgrp;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L206">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_setsid</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;leader &amp;&amp; !<a href="../include/linux/kernel.h.html#L21" title="include/linux/kernel.h:21">suser</a>())<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L20" title="include/errno.h:20">EPERM</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;leader = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;session = <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;pgrp = <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;pid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;tty = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;pgrp;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L216">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_uname</span>(<span class="Type">struct</span> <a href="../include/sys/utsname.h.html#L6" title="include/sys/utsname.h:6">utsname</a> * name)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">static</span> <span class="Type">struct</span> <a href="../include/sys/utsname.h.html#L6" title="include/sys/utsname.h:6">utsname</a> thisname = {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;linux .0&quot;</span>,<span class="Constant">&quot;nodename&quot;</span>,<span class="Constant">&quot;<a href="exit.c.html#L19" title="kernel/exit.c:19">release</a> &quot;</span>,<span class="Constant">&quot;version &quot;</span>,<span class="Constant">&quot;machine &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; };<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!name) <span class="Statement">return</span> -<a href="../include/errno.h.html#L19" title="include/errno.h:19">ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="fork.c.html#L24" title="kernel/fork.c:24">verify_area</a>(name,<span class="Statement">sizeof</span> *name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span>(i=<span class="Constant">0</span>;i&lt;<span class="Statement">sizeof</span> *name;i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L25" title="include/asm/segment.h:25">put_fs_byte</a>(((<span class="Type">char</span> *) &amp;thisname)[i],i+(<span class="Type">char</span> *) name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L230">&#x200c;</a><span class="Type">int</span> <span class="linkable">sys_umask</span>(<span class="Type">int</span> mask)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> old = <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;umask;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;umask = mask &amp; <span class="PreProc">0</span><span class="Constant">777</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> (old);<br/></li>
<li>}<br/></li>
</ol></code>
 </body>
</html>

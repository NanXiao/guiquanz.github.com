<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>kernel/blk_drv/ramdisk.c - linux-0.11-ebook</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>kernel/blk_drv/ramdisk.c - linux-0.11-ebook</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Global variables defined</h4>
 <ul>
<li><a href="#L21">rd_length</a></li>
<li><a href="#L20">rd_start</a></li>
</ul>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L23">do_rd_request</a></li>
<li><a href="#L52">rd_init</a></li>
<li><a href="#L71">rd_load</a></li>
</ul>
 <h4>Macros defined</h4>
 <ul>
<li><a href="#L17">MAJOR_NR</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; linux/kernel/blk_drv/ramdisk.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; Written by Theodore Ts'o, 12/2/91<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;string.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;linux/config.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;linux/sched.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;linux/fs.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;linux/kernel.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;asm/system.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;asm/segment.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;asm/memory.h&gt;<br/></li>
<li></span><br/></li>
<li><a id="L17">&#x200c;</a><span class="PreProc">#define <span class="linkable">MAJOR_NR</span> </span><span class="Constant">1<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&quot;blk.h&quot;<br/></li>
<li></span><br/></li>
<li><a id="L20">&#x200c;</a><span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; *<span class="linkable">rd_start</span>;<br/></li>
<li><a id="L21">&#x200c;</a><span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">rd_length</span> = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li><a id="L23">&#x200c;</a><span class="Type">void</span> <span class="linkable">do_rd_request</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; *addr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="blk.h.html#L127" title="kernel/blk_drv/blk.h:127">INIT_REQUEST</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; addr = <a href="#L20" title="kernel/blk_drv/ramdisk.c:20">rd_start</a> + (<a href="blk.h.html#L93" title="kernel/blk_drv/blk.h:93">CURRENT</a>-&gt;<a href="floppy.c.html#L116" title="kernel/blk_drv/floppy.c:116">sector</a> &lt;&lt; <span class="Constant">9</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <a href="blk.h.html#L93" title="kernel/blk_drv/blk.h:93">CURRENT</a>-&gt;nr_sectors &lt;&lt; <span class="Constant">9</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((<a href="../../include/linux/fs.h.html#L34" title="include/linux/fs.h:34">MINOR</a>(<a href="blk.h.html#L93" title="kernel/blk_drv/blk.h:93">CURRENT</a>-&gt;dev) != <span class="Constant">1</span>) || (addr+len &gt; <a href="#L20" title="kernel/blk_drv/ramdisk.c:20">rd_start</a>+<a href="#L21" title="kernel/blk_drv/ramdisk.c:21">rd_length</a>)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="blk.h.html#L109" title="kernel/blk_drv/blk.h:109">end_request</a>(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> repeat;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="blk.h.html#L93" title="kernel/blk_drv/blk.h:93">CURRENT</a>-&gt; cmd == <a href="../../include/linux/fs.h.html#L27" title="include/linux/fs.h:27">WRITE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">void</span> ) <a href="../../include/string.h.html#L336" title="include/string.h:336">memcpy</a>(addr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="blk.h.html#L93" title="kernel/blk_drv/blk.h:93">CURRENT</a>-&gt;buffer,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (<a href="blk.h.html#L93" title="kernel/blk_drv/blk.h:93">CURRENT</a>-&gt;cmd == <a href="../../include/linux/fs.h.html#L26" title="include/linux/fs.h:26">READ</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">void</span>) <a href="../../include/string.h.html#L336" title="include/string.h:336">memcpy</a>(<a href="blk.h.html#L93" title="kernel/blk_drv/blk.h:93">CURRENT</a>-&gt;buffer,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; addr,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../panic.c.html#L16" title="kernel/panic.c:16">panic</a>(<span class="Constant">&quot;unknown ramdisk-<a href="floppy.c.html#L121" title="kernel/blk_drv/floppy.c:121">command</a>&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="blk.h.html#L109" title="kernel/blk_drv/blk.h:109">end_request</a>(<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> repeat;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Returns amount of memory which needs to be reserved.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L52">&#x200c;</a></span><span class="Type">long</span> <span class="linkable">rd_init</span>(<span class="Type">long</span> mem_start, <span class="Type">int</span> length)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; *cp;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ll_rw_blk.c.html#L32" title="kernel/blk_drv/ll_rw_blk.c:32">blk_dev</a>[<a href="#L17" title="kernel/blk_drv/ramdisk.c:17">MAJOR_NR</a>].request_fn = <a href="blk.h.html#L64" title="kernel/blk_drv/blk.h:64">DEVICE_REQUEST</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L20" title="kernel/blk_drv/ramdisk.c:20">rd_start</a> = (<span class="Type">char</span> *) mem_start;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L21" title="kernel/blk_drv/ramdisk.c:21">rd_length</a> = length;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cp = <a href="#L20" title="kernel/blk_drv/ramdisk.c:20">rd_start</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i=<span class="Constant">0</span>; i &lt; length; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *cp++ = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>(length);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * If the root device is the ram disk, try to load it.<br/></li>
<li></span><span class="Comment"> * In order to do this, the root device is originally set to the<br/></li>
<li></span><span class="Comment"> * <a href="floppy.c.html#L114" title="kernel/blk_drv/floppy.c:114">floppy</a>, and we later change it to be ram disk.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L71">&#x200c;</a></span><span class="Type">void</span> <span class="linkable">rd_load</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> <a href="../../include/linux/fs.h.html#L68" title="include/linux/fs.h:68">buffer_head</a> *bh;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> <a href="../../include/linux/fs.h.html#L124" title="include/linux/fs.h:124">super_block</a>&nbsp; &nbsp; &nbsp; &nbsp; s;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; block = <span class="Constant">256</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Start at block 256 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nblocks;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *cp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Move pointer */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L21" title="kernel/blk_drv/ramdisk.c:21">rd_length</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;Ram disk: </span><span class="Special">%d</span><span class="Constant"> bytes, starting at 0x</span><span class="Special">%<a href="../chr_drv/console.c.html#L72" title="kernel/chr_drv/console.c:72">x</a>\n</span><span class="Constant">&quot;</span>, <a href="#L21" title="kernel/blk_drv/ramdisk.c:21">rd_length</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">int</span>) <a href="#L20" title="kernel/blk_drv/ramdisk.c:20">rd_start</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../../include/linux/fs.h.html#L33" title="include/linux/fs.h:33">MAJOR</a>(<a href="../../fs/super.c.html#L29" title="fs/super.c:29">ROOT_DEV</a>) != <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; bh = <a href="../../fs/buffer.c.html#L322" title="fs/buffer.c:322">breada</a>(<a href="../../fs/super.c.html#L29" title="fs/super.c:29">ROOT_DEV</a>,block+<span class="Constant">1</span>,block,block+<span class="Constant">2</span>,-<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!bh) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;Disk error while looking for ramdisk!</span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *((<span class="Type">struct</span> <a href="../../include/linux/fs.h.html#L146" title="include/linux/fs.h:146">d_super_block</a> *) &amp;s) = *((<span class="Type">struct</span> <a href="../../include/linux/fs.h.html#L146" title="include/linux/fs.h:146">d_super_block</a> *) bh-&gt;b_data);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../fs/buffer.c.html#L253" title="fs/buffer.c:253">brelse</a>(bh);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s.s_magic != <a href="../../include/linux/fs.h.html#L41" title="include/linux/fs.h:41">SUPER_MAGIC</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* No ram disk image present, assume normal <a href="floppy.c.html#L114" title="kernel/blk_drv/floppy.c:114">floppy</a> boot */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; nblocks = s.s_nzones &lt;&lt; s.s_log_zone_size;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (nblocks &gt; (<a href="#L21" title="kernel/blk_drv/ramdisk.c:21">rd_length</a> &gt;&gt; <a href="../../include/linux/fs.h.html#L50" title="include/linux/fs.h:50">BLOCK_SIZE_BITS</a>)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;Ram disk image too big!&nbsp; (</span><span class="Special">%d</span><span class="Constant"> blocks, </span><span class="Special">%d</span><span class="Constant"> avail)</span><span class="Special">\n</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nblocks, <a href="#L21" title="kernel/blk_drv/ramdisk.c:21">rd_length</a> &gt;&gt; <a href="../../include/linux/fs.h.html#L50" title="include/linux/fs.h:50">BLOCK_SIZE_BITS</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;Loading </span><span class="Special">%d</span><span class="Constant"> bytes into ram disk... 0000k&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nblocks &lt;&lt; <a href="../../include/linux/fs.h.html#L50" title="include/linux/fs.h:50">BLOCK_SIZE_BITS</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cp = <a href="#L20" title="kernel/blk_drv/ramdisk.c:20">rd_start</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (nblocks) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (nblocks &gt; <span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bh = <a href="../../fs/buffer.c.html#L322" title="fs/buffer.c:322">breada</a>(<a href="../../fs/super.c.html#L29" title="fs/super.c:29">ROOT_DEV</a>, block, block+<span class="Constant">1</span>, block+<span class="Constant">2</span>, -<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bh = <a href="../../fs/buffer.c.html#L267" title="fs/buffer.c:267">bread</a>(<a href="../../fs/super.c.html#L29" title="fs/super.c:29">ROOT_DEV</a>, block);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!bh) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;I/O error on block </span><span class="Special">%d</span><span class="Constant">, aborting load</span><span class="Special">\n</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; block);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">void</span>) <a href="../../include/string.h.html#L336" title="include/string.h:336">memcpy</a>(cp, bh-&gt;b_data, <a href="../../include/linux/fs.h.html#L49" title="include/linux/fs.h:49">BLOCK_SIZE</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../fs/buffer.c.html#L253" title="fs/buffer.c:253">brelse</a>(bh);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;</span><span class="Special">\010\010\010\010\010%4d</span><span class="Constant">k&quot;</span>,i);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cp += <a href="../../include/linux/fs.h.html#L49" title="include/linux/fs.h:49">BLOCK_SIZE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; block++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nblocks--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;</span><span class="Special">\010\010\010\010\010</span><span class="Constant">done </span><span class="Special">\n</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../fs/super.c.html#L29" title="fs/super.c:29">ROOT_DEV</a>=<span class="Constant">0x0101</span>;<br/></li>
<li>}<br/></li>
</ol></code>
 </body>
</html>

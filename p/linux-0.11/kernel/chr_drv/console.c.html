<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>kernel/chr_drv/console.c - linux-0.11-ebook</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>kernel/chr_drv/console.c - linux-0.11-ebook</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Global variables defined</h4>
 <ul>
<li><a href="#L77">attr</a></li>
<li><a href="#L697">beepcount</a></li>
<li><a href="#L73">bottom</a></li>
<li><a href="#L75">npar</a></li>
<li><a href="#L69">origin</a></li>
<li><a href="#L75">par</a></li>
<li><a href="#L71">pos</a></li>
<li><a href="#L76">ques</a></li>
<li><a href="#L431">saved_x</a></li>
<li><a href="#L432">saved_y</a></li>
<li><a href="#L70">scr_end</a></li>
<li><a href="#L74">state</a></li>
<li><a href="#L73">top</a></li>
<li><a href="#L67">video_erase_char</a></li>
<li><a href="#L64">video_mem_end</a></li>
<li><a href="#L63">video_mem_start</a></li>
<li><a href="#L59">video_num_columns</a></li>
<li><a href="#L61">video_num_lines</a></li>
<li><a href="#L62">video_page</a></li>
<li><a href="#L65">video_port_reg</a></li>
<li><a href="#L66">video_port_val</a></li>
<li><a href="#L60">video_size_row</a></li>
<li><a href="#L58">video_type</a></li>
<li><a href="#L72">x</a></li>
<li><a href="#L72">y</a></li>
</ul>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L617">con_init</a></li>
<li><a href="#L445">con_write</a></li>
<li><a href="#L224">cr</a></li>
<li><a href="#L239">csi_J</a></li>
<li><a href="#L268">csi_K</a></li>
<li><a href="#L401">csi_L</a></li>
<li><a href="#L421">csi_M</a></li>
<li><a href="#L411">csi_P</a></li>
<li><a href="#L391">csi_at</a></li>
<li><a href="#L299">csi_m</a></li>
<li><a href="#L230">del</a></li>
<li><a href="#L363">delete_char</a></li>
<li><a href="#L378">delete_line</a></li>
<li><a href="#L88">gotoxy</a></li>
<li><a href="#L336">insert_char</a></li>
<li><a href="#L350">insert_line</a></li>
<li><a href="#L204">lf</a></li>
<li><a href="#L323">respond</a></li>
<li><a href="#L440">restore_cur</a></li>
<li><a href="#L214">ri</a></li>
<li><a href="#L434">save_cur</a></li>
<li><a href="#L170">scrdown</a></li>
<li><a href="#L107">scrup</a></li>
<li><a href="#L313">set_cursor</a></li>
<li><a href="#L97">set_origin</a></li>
<li><a href="#L699">sysbeep</a></li>
<li><a href="#L691">sysbeepstop</a></li>
</ul>
 <h4>Macros defined</h4>
 <ul>
<li><a href="#L54">NPAR</a></li>
<li><a href="#L43">ORIG_VIDEO_COLS</a></li>
<li><a href="#L45">ORIG_VIDEO_EGA_AX</a></li>
<li><a href="#L46">ORIG_VIDEO_EGA_BX</a></li>
<li><a href="#L47">ORIG_VIDEO_EGA_CX</a></li>
<li><a href="#L44">ORIG_VIDEO_LINES</a></li>
<li><a href="#L42">ORIG_VIDEO_MODE</a></li>
<li><a href="#L41">ORIG_VIDEO_PAGE</a></li>
<li><a href="#L39">ORIG_X</a></li>
<li><a href="#L40">ORIG_Y</a></li>
<li><a href="#L85">RESPONSE</a></li>
<li><a href="#L50">VIDEO_TYPE_CGA</a></li>
<li><a href="#L52">VIDEO_TYPE_EGAC</a></li>
<li><a href="#L51">VIDEO_TYPE_EGAM</a></li>
<li><a href="#L49">VIDEO_TYPE_MDA</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; linux/kernel/console.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; (C) 1991&nbsp; Linus Torvalds<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; console.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This module implements the console io functions<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; 'void <a href="#L617" title="kernel/chr_drv/console.c:617">con_init</a>(void)'<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; &nbsp; &nbsp; 'void <a href="#L445" title="kernel/chr_drv/console.c:445">con_write</a>(struct <a href="../../include/linux/tty.h.html#L16" title="include/linux/tty.h:16">tty_queue</a> * queue)'<br/></li>
<li></span><span class="Comment"> * Hopefully this will be a rather complete VT102 implementation.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Beeping thanks to John T Kohl.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; NOTE!!! We sometimes disable and enable interrupts for a short while<br/></li>
<li></span><span class="Comment"> * (to put a word in video IO), but this will work even for keyboard<br/></li>
<li></span><span class="Comment"> * interrupts. We know interrupts aren't enabled when getting a keyboard<br/></li>
<li></span><span class="Comment"> * interrupt, as we use trap-gates. Hopefully all is well.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Code to check for different video-cards mostly by Galen Hunt,<br/></li>
<li></span><span class="Comment"> * &lt;g-hunt@ee.utah.edu&gt;<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;linux/sched.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;linux/tty.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;asm/io.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;asm/system.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * These are set up by the setup-routine at boot-time:<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><a id="L39">&#x200c;</a><span class="PreProc">#define <span class="linkable">ORIG_X</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (*(</span><span class="Type">unsigned</span><span class="PreProc"> </span><span class="Type">char</span><span class="PreProc"> *)</span><span class="Constant">0x90000</span><span class="PreProc">)<br/></li>
<li><a id="L40">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ORIG_Y</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (*(</span><span class="Type">unsigned</span><span class="PreProc"> </span><span class="Type">char</span><span class="PreProc"> *)</span><span class="Constant">0x90001</span><span class="PreProc">)<br/></li>
<li><a id="L41">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ORIG_VIDEO_PAGE</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (*(</span><span class="Type">unsigned</span><span class="PreProc"> </span><span class="Type">short</span><span class="PreProc"> *)</span><span class="Constant">0x90004</span><span class="PreProc">)<br/></li>
<li><a id="L42">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ORIG_VIDEO_MODE</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((*(</span><span class="Type">unsigned</span><span class="PreProc"> </span><span class="Type">short</span><span class="PreProc"> *)</span><span class="Constant">0x90006</span><span class="PreProc">) &amp; </span><span class="Constant">0xff</span><span class="PreProc">)<br/></li>
<li><a id="L43">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ORIG_VIDEO_COLS</span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (((*(</span><span class="Type">unsigned</span><span class="PreProc"> </span><span class="Type">short</span><span class="PreProc"> *)</span><span class="Constant">0x90006</span><span class="PreProc">) &amp; </span><span class="Constant">0xff00</span><span class="PreProc">) &gt;&gt; </span><span class="Constant">8</span><span class="PreProc">)<br/></li>
<li><a id="L44">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ORIG_VIDEO_LINES</span>&nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="Constant">25</span><span class="PreProc">)<br/></li>
<li><a id="L45">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ORIG_VIDEO_EGA_AX</span>&nbsp; &nbsp; &nbsp; &nbsp; (*(</span><span class="Type">unsigned</span><span class="PreProc"> </span><span class="Type">short</span><span class="PreProc"> *)</span><span class="Constant">0x90008</span><span class="PreProc">)<br/></li>
<li><a id="L46">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ORIG_VIDEO_EGA_BX</span>&nbsp; &nbsp; &nbsp; &nbsp; (*(</span><span class="Type">unsigned</span><span class="PreProc"> </span><span class="Type">short</span><span class="PreProc"> *)</span><span class="Constant">0x9000a</span><span class="PreProc">)<br/></li>
<li><a id="L47">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ORIG_VIDEO_EGA_CX</span>&nbsp; &nbsp; &nbsp; &nbsp; (*(</span><span class="Type">unsigned</span><span class="PreProc"> </span><span class="Type">short</span><span class="PreProc"> *)</span><span class="Constant">0x9000c</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><a id="L49">&#x200c;</a><span class="PreProc">#define <span class="linkable">VIDEO_TYPE_MDA</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">0x10</span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">/* Monochrome Text Display&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L50">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">VIDEO_TYPE_CGA</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">0x11</span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">/* CGA Display&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li><a id="L51">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">VIDEO_TYPE_EGAM</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">0x20</span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">/* EGA/VGA in Monochrome Mode&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L52">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">VIDEO_TYPE_EGAC</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">0x21</span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Comment">/* EGA/VGA in Color Mode&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><br/></li>
<li><a id="L54">&#x200c;</a><span class="PreProc">#define <span class="linkable">NPAR</span> </span><span class="Constant">16<br/></li>
<li></span><br/></li>
<li><span class="Type"><a href="../../lib/string.c.html#L11" title="lib/string.c:11">extern</a></span> <span class="Type">void</span> keyboard_interrupt(<span class="Type">void</span>);<br/></li>
<li><br/></li>
<li><a id="L58">&#x200c;</a><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">video_type</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Type of display being used&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L59">&#x200c;</a></span><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">video_num_columns</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Number of text columns&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L60">&#x200c;</a></span><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">video_size_row</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Bytes per row&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L61">&#x200c;</a></span><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">video_num_lines</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Number of test lines&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L62">&#x200c;</a></span><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">video_page</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Initial video page&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L63">&#x200c;</a></span><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">video_mem_start</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Start of video RAM&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L64">&#x200c;</a></span><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">video_mem_end</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* End of video RAM (sort of)&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L65">&#x200c;</a></span><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">short</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">video_port_reg</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Video register select port&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L66">&#x200c;</a></span><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">short</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">video_port_val</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Video register value port&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L67">&#x200c;</a></span><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">short</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">video_erase_char</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Char+Attrib to erase with&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><br/></li>
<li><a id="L69">&#x200c;</a><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">origin</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Used for EGA/VGA fast scroll&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L70">&#x200c;</a></span><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">scr_end</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Used for EGA/VGA fast scroll&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li><a id="L71">&#x200c;</a></span><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">pos</span>;<br/></li>
<li><a id="L72">&#x200c;</a><a id="L72">&#x200c;</a><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">x</span>,<span class="linkable">y</span>;<br/></li>
<li><a id="L73">&#x200c;</a><a id="L73">&#x200c;</a><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">top</span>,<span class="linkable">bottom</span>;<br/></li>
<li><a id="L74">&#x200c;</a><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">state</span>=<span class="Constant">0</span>;<br/></li>
<li><a id="L75">&#x200c;</a><a id="L75">&#x200c;</a><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">npar</span>,<span class="linkable">par</span>[<a href="#L54" title="kernel/chr_drv/console.c:54">NPAR</a>];<br/></li>
<li><a id="L76">&#x200c;</a><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">ques</span>=<span class="Constant">0</span>;<br/></li>
<li><a id="L77">&#x200c;</a><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">attr</span>=<span class="Constant">0x07</span>;<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L699" title="kernel/chr_drv/console.c:699">sysbeep</a>(<span class="Type">void</span>);<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * this is what the terminal answers to a ESC-Z or csi0c<br/></li>
<li></span><span class="Comment"> * query (= vt100 response).<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L85">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">RESPONSE</span> </span><span class="Constant">&quot;</span><span class="Special">\033</span><span class="Constant">[?1;2c&quot;<br/></li>
<li></span><br/></li>
<li><span class="Comment">/* NOTE! <a href="#L88" title="kernel/chr_drv/console.c:88">gotoxy</a> thinks <a href="#L72" title="kernel/chr_drv/console.c:72">x</a>==<a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a> is ok */<br/></li>
<li><a id="L88">&#x200c;</a></span><span class="Type">static</span> <span class="Type"><a href="../../lib/string.c.html#L12" title="lib/string.c:12">inline</a></span> <span class="Type">void</span> <span class="linkable">gotoxy</span>(<span class="Type">unsigned</span> <span class="Type">int</span> new_x,<span class="Type">unsigned</span> <span class="Type">int</span> new_y)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (new_x &gt; <a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a> || new_y &gt;= <a href="#L61" title="kernel/chr_drv/console.c:61">video_num_lines</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L72" title="kernel/chr_drv/console.c:72">x</a>=new_x;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L72" title="kernel/chr_drv/console.c:72">y</a>=new_y;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a>=<a href="#L69" title="kernel/chr_drv/console.c:69">origin</a> + <a href="#L72" title="kernel/chr_drv/console.c:72">y</a>*<a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a> + (<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>&lt;&lt;<span class="Constant">1</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L97">&#x200c;</a><span class="Type">static</span> <span class="Type"><a href="../../lib/string.c.html#L12" title="lib/string.c:12">inline</a></span> <span class="Type">void</span> <span class="linkable">set_origin</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/system.h.html#L17" title="include/asm/system.h:17">cli</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L11" title="include/asm/io.h:11">outb_p</a>(<span class="Constant">12</span>, <a href="#L65" title="kernel/chr_drv/console.c:65">video_port_reg</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L11" title="include/asm/io.h:11">outb_p</a>(<span class="Constant">0xff</span>&amp;((<a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>-<a href="#L63" title="kernel/chr_drv/console.c:63">video_mem_start</a>)&gt;&gt;<span class="Constant">9</span>), <a href="#L66" title="kernel/chr_drv/console.c:66">video_port_val</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L11" title="include/asm/io.h:11">outb_p</a>(<span class="Constant">13</span>, <a href="#L65" title="kernel/chr_drv/console.c:65">video_port_reg</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L11" title="include/asm/io.h:11">outb_p</a>(<span class="Constant">0xff</span>&amp;((<a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>-<a href="#L63" title="kernel/chr_drv/console.c:63">video_mem_start</a>)&gt;&gt;<span class="Constant">1</span>), <a href="#L66" title="kernel/chr_drv/console.c:66">video_port_val</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/system.h.html#L16" title="include/asm/system.h:16">sti</a>();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L107">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">scrup</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L58" title="kernel/chr_drv/console.c:58">video_type</a> == <a href="#L52" title="kernel/chr_drv/console.c:52">VIDEO_TYPE_EGAC</a> || <a href="#L58" title="kernel/chr_drv/console.c:58">video_type</a> == <a href="#L51" title="kernel/chr_drv/console.c:51">VIDEO_TYPE_EGAM</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L73" title="kernel/chr_drv/console.c:73">top</a> &amp;&amp; <a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a> == <a href="#L61" title="kernel/chr_drv/console.c:61">video_num_lines</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L69" title="kernel/chr_drv/console.c:69">origin</a> += <a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a> += <a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L70" title="kernel/chr_drv/console.c:70">scr_end</a> += <a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L70" title="kernel/chr_drv/console.c:70">scr_end</a> &gt; <a href="#L64" title="kernel/chr_drv/console.c:64">video_mem_end</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; __asm__(<span class="Constant">&quot;cld</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rep</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;movsl</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;movl _video_num_columns,%1</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rep</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;stosw&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ::<span class="Constant">&quot;a&quot;</span> (<a href="#L67" title="kernel/chr_drv/console.c:67">video_erase_char</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;c&quot;</span> ((<a href="#L61" title="kernel/chr_drv/console.c:61">video_num_lines</a>-<span class="Constant">1</span>)*<a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>&gt;&gt;<span class="Constant">1</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;D&quot;</span> (<a href="#L63" title="kernel/chr_drv/console.c:63">video_mem_start</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;S&quot;</span> (<a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :) ;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L70" title="kernel/chr_drv/console.c:70">scr_end</a> -= <a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>-<a href="#L63" title="kernel/chr_drv/console.c:63">video_mem_start</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a> -= <a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>-<a href="#L63" title="kernel/chr_drv/console.c:63">video_mem_start</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L69" title="kernel/chr_drv/console.c:69">origin</a> = <a href="#L63" title="kernel/chr_drv/console.c:63">video_mem_start</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; __asm__(<span class="Constant">&quot;cld</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rep</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;stosw&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ::<span class="Constant">&quot;a&quot;</span> (<a href="#L67" title="kernel/chr_drv/console.c:67">video_erase_char</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;c&quot;</span> (<a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;D&quot;</span> (<a href="#L70" title="kernel/chr_drv/console.c:70">scr_end</a>-<a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :) ;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L97" title="kernel/chr_drv/console.c:97">set_origin</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; __asm__(<span class="Constant">&quot;cld</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rep</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;movsl</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;movl _video_num_columns,</span><span class="Special">%%</span><span class="Constant">ecx</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rep</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;stosw&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ::<span class="Constant">&quot;a&quot;</span> (<a href="#L67" title="kernel/chr_drv/console.c:67">video_erase_char</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;c&quot;</span> ((<a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a>-<a href="#L73" title="kernel/chr_drv/console.c:73">top</a>-<span class="Constant">1</span>)*<a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>&gt;&gt;<span class="Constant">1</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;D&quot;</span> (<a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>+<a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>*<a href="#L73" title="kernel/chr_drv/console.c:73">top</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;S&quot;</span> (<a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>+<a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>*(<a href="#L73" title="kernel/chr_drv/console.c:73">top</a>+<span class="Constant">1</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :) ;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Not EGA/VGA */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; __asm__(<span class="Constant">&quot;cld</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rep</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;movsl</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;movl _video_num_columns,</span><span class="Special">%%</span><span class="Constant">ecx</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rep</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;stosw&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ::<span class="Constant">&quot;a&quot;</span> (<a href="#L67" title="kernel/chr_drv/console.c:67">video_erase_char</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;c&quot;</span> ((<a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a>-<a href="#L73" title="kernel/chr_drv/console.c:73">top</a>-<span class="Constant">1</span>)*<a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>&gt;&gt;<span class="Constant">1</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;D&quot;</span> (<a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>+<a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>*<a href="#L73" title="kernel/chr_drv/console.c:73">top</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;S&quot;</span> (<a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>+<a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>*(<a href="#L73" title="kernel/chr_drv/console.c:73">top</a>+<span class="Constant">1</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :) ;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L170">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">scrdown</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L58" title="kernel/chr_drv/console.c:58">video_type</a> == <a href="#L52" title="kernel/chr_drv/console.c:52">VIDEO_TYPE_EGAC</a> || <a href="#L58" title="kernel/chr_drv/console.c:58">video_type</a> == <a href="#L51" title="kernel/chr_drv/console.c:51">VIDEO_TYPE_EGAM</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; __asm__(<span class="Constant">&quot;std</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rep</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;movsl</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;addl $2,</span><span class="Special">%%</span><span class="Constant">edi</span><span class="Special">\n\t</span><span class="Constant">&quot;</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* %edi has been decremented by 4 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;movl _video_num_columns,</span><span class="Special">%%</span><span class="Constant">ecx</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rep</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;stosw&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ::<span class="Constant">&quot;a&quot;</span> (<a href="#L67" title="kernel/chr_drv/console.c:67">video_erase_char</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;c&quot;</span> ((<a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a>-<a href="#L73" title="kernel/chr_drv/console.c:73">top</a>-<span class="Constant">1</span>)*<a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>&gt;&gt;<span class="Constant">1</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;D&quot;</span> (<a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>+<a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>*<a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a>-<span class="Constant">4</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;S&quot;</span> (<a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>+<a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>*(<a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a>-<span class="Constant">1</span>)-<span class="Constant">4</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :) ;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Not EGA/VGA */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; __asm__(<span class="Constant">&quot;std</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rep</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;movsl</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;addl $2,</span><span class="Special">%%</span><span class="Constant">edi</span><span class="Special">\n\t</span><span class="Constant">&quot;</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* %edi has been decremented by 4 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;movl _video_num_columns,</span><span class="Special">%%</span><span class="Constant">ecx</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rep</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;stosw&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ::<span class="Constant">&quot;a&quot;</span> (<a href="#L67" title="kernel/chr_drv/console.c:67">video_erase_char</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;c&quot;</span> ((<a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a>-<a href="#L73" title="kernel/chr_drv/console.c:73">top</a>-<span class="Constant">1</span>)*<a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>&gt;&gt;<span class="Constant">1</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;D&quot;</span> (<a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>+<a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>*<a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a>-<span class="Constant">4</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;S&quot;</span> (<a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>+<a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>*(<a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a>-<span class="Constant">1</span>)-<span class="Constant">4</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :) ;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L204">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">lf</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L72" title="kernel/chr_drv/console.c:72">y</a>+<span class="Constant">1</span>&lt;<a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L72" title="kernel/chr_drv/console.c:72">y</a>++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a> += <a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L107" title="kernel/chr_drv/console.c:107">scrup</a>();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L214">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">ri</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L72" title="kernel/chr_drv/console.c:72">y</a>&gt;<a href="#L73" title="kernel/chr_drv/console.c:73">top</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L72" title="kernel/chr_drv/console.c:72">y</a>--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a> -= <a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L170" title="kernel/chr_drv/console.c:170">scrdown</a>();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L224">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">cr</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a> -= <a href="#L72" title="kernel/chr_drv/console.c:72">x</a>&lt;&lt;<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L72" title="kernel/chr_drv/console.c:72">x</a>=<span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L230">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">del</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a> -= <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L72" title="kernel/chr_drv/console.c:72">x</a>--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(<span class="Type">unsigned</span> <span class="Type">short</span> *)<a href="#L71" title="kernel/chr_drv/console.c:71">pos</a> = <a href="#L67" title="kernel/chr_drv/console.c:67">video_erase_char</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L239">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">csi_J</span>(<span class="Type">int</span> <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">long</span> <a href="../../fs/exec.c.html#L75" title="fs/exec.c:75">count</a> __asm__(<span class="Constant">&quot;cx&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">long</span> start __asm__(<span class="Constant">&quot;di&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">0</span>:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* erase from cursor to end of display */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../fs/exec.c.html#L75" title="fs/exec.c:75">count</a> = (<a href="#L70" title="kernel/chr_drv/console.c:70">scr_end</a>-<a href="#L71" title="kernel/chr_drv/console.c:71">pos</a>)&gt;&gt;<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start = <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">1</span>:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* erase from start to cursor */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../fs/exec.c.html#L75" title="fs/exec.c:75">count</a> = (<a href="#L71" title="kernel/chr_drv/console.c:71">pos</a>-<a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>)&gt;&gt;<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start = <a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">2</span>: <span class="Comment">/* erase whole display */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../fs/exec.c.html#L75" title="fs/exec.c:75">count</a> = <a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a> * <a href="#L61" title="kernel/chr_drv/console.c:61">video_num_lines</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start = <a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; __asm__(<span class="Constant">&quot;cld</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rep</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;stosw</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ::<span class="Constant">&quot;c&quot;</span> (<a href="../../fs/exec.c.html#L75" title="fs/exec.c:75">count</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;D&quot;</span> (start),<span class="Constant">&quot;a&quot;</span> (<a href="#L67" title="kernel/chr_drv/console.c:67">video_erase_char</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :) ;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L268">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">csi_K</span>(<span class="Type">int</span> <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">long</span> <a href="../../fs/exec.c.html#L75" title="fs/exec.c:75">count</a> __asm__(<span class="Constant">&quot;cx&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">long</span> start __asm__(<span class="Constant">&quot;di&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">0</span>:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* erase from cursor to end of line */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>&gt;=<a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../fs/exec.c.html#L75" title="fs/exec.c:75">count</a> = <a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>-<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start = <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">1</span>:&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* erase from start of line to cursor */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start = <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a> - (<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>&lt;&lt;<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../fs/exec.c.html#L75" title="fs/exec.c:75">count</a> = (<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>&lt;<a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>)?<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>:<a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">2</span>: <span class="Comment">/* erase whole line */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start = <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a> - (<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>&lt;&lt;<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../fs/exec.c.html#L75" title="fs/exec.c:75">count</a> = <a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; __asm__(<span class="Constant">&quot;cld</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rep</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;stosw</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ::<span class="Constant">&quot;c&quot;</span> (<a href="../../fs/exec.c.html#L75" title="fs/exec.c:75">count</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;D&quot;</span> (start),<span class="Constant">&quot;a&quot;</span> (<a href="#L67" title="kernel/chr_drv/console.c:67">video_erase_char</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :) ;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L299">&#x200c;</a><span class="Type">void</span> <span class="linkable">csi_m</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i=<span class="Constant">0</span>;i&lt;=<a href="#L75" title="kernel/chr_drv/console.c:75">npar</a>;i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[i]) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">0</span>:<a href="#L77" title="kernel/chr_drv/console.c:77">attr</a>=<span class="Constant">0x07</span>;<span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">1</span>:<a href="#L77" title="kernel/chr_drv/console.c:77">attr</a>=<span class="Constant">0x0f</span>;<span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">4</span>:<a href="#L77" title="kernel/chr_drv/console.c:77">attr</a>=<span class="Constant">0x0f</span>;<span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">7</span>:<a href="#L77" title="kernel/chr_drv/console.c:77">attr</a>=<span class="Constant">0x70</span>;<span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">27</span>:<a href="#L77" title="kernel/chr_drv/console.c:77">attr</a>=<span class="Constant">0x07</span>;<span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L313">&#x200c;</a><span class="Type">static</span> <span class="Type"><a href="../../lib/string.c.html#L12" title="lib/string.c:12">inline</a></span> <span class="Type">void</span> <span class="linkable">set_cursor</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/system.h.html#L17" title="include/asm/system.h:17">cli</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L11" title="include/asm/io.h:11">outb_p</a>(<span class="Constant">14</span>, <a href="#L65" title="kernel/chr_drv/console.c:65">video_port_reg</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L11" title="include/asm/io.h:11">outb_p</a>(<span class="Constant">0xff</span>&amp;((<a href="#L71" title="kernel/chr_drv/console.c:71">pos</a>-<a href="#L63" title="kernel/chr_drv/console.c:63">video_mem_start</a>)&gt;&gt;<span class="Constant">9</span>), <a href="#L66" title="kernel/chr_drv/console.c:66">video_port_val</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L11" title="include/asm/io.h:11">outb_p</a>(<span class="Constant">15</span>, <a href="#L65" title="kernel/chr_drv/console.c:65">video_port_reg</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L11" title="include/asm/io.h:11">outb_p</a>(<span class="Constant">0xff</span>&amp;((<a href="#L71" title="kernel/chr_drv/console.c:71">pos</a>-<a href="#L63" title="kernel/chr_drv/console.c:63">video_mem_start</a>)&gt;&gt;<span class="Constant">1</span>), <a href="#L66" title="kernel/chr_drv/console.c:66">video_port_val</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/system.h.html#L16" title="include/asm/system.h:16">sti</a>();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L323">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">respond</span>(<span class="Type">struct</span> <a href="../../include/linux/tty.h.html#L45" title="include/linux/tty.h:45">tty_struct</a> * tty)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span> * p = <a href="#L85" title="kernel/chr_drv/console.c:85">RESPONSE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/system.h.html#L17" title="include/asm/system.h:17">cli</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*p) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/linux/tty.h.html#L33" title="include/linux/tty.h:33">PUTCH</a>(*p,tty-&gt;read_q);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/system.h.html#L16" title="include/asm/system.h:16">sti</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="tty_io.c.html#L145" title="kernel/chr_drv/tty_io.c:145">copy_to_cooked</a>(tty);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L336">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">insert_char</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> i=<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">short</span> tmp, old = <a href="#L67" title="kernel/chr_drv/console.c:67">video_erase_char</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">short</span> * p = (<span class="Type">unsigned</span> <span class="Type">short</span> *) <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (i++&lt;<a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp=*p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p=old;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; old=tmp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L350">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">insert_line</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> oldtop,oldbottom;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; oldtop=<a href="#L73" title="kernel/chr_drv/console.c:73">top</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; oldbottom=<a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L73" title="kernel/chr_drv/console.c:73">top</a>=<a href="#L72" title="kernel/chr_drv/console.c:72">y</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a> = <a href="#L61" title="kernel/chr_drv/console.c:61">video_num_lines</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L170" title="kernel/chr_drv/console.c:170">scrdown</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L73" title="kernel/chr_drv/console.c:73">top</a>=oldtop;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a>=oldbottom;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L363">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">delete_char</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> i;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">short</span> * p = (<span class="Type">unsigned</span> <span class="Type">short</span> *) <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>&gt;=<a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; i = <a href="#L72" title="kernel/chr_drv/console.c:72">x</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (++i &lt; <a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p = *(p+<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *p = <a href="#L67" title="kernel/chr_drv/console.c:67">video_erase_char</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L378">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">delete_line</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> oldtop,oldbottom;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; oldtop=<a href="#L73" title="kernel/chr_drv/console.c:73">top</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; oldbottom=<a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L73" title="kernel/chr_drv/console.c:73">top</a>=<a href="#L72" title="kernel/chr_drv/console.c:72">y</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a> = <a href="#L61" title="kernel/chr_drv/console.c:61">video_num_lines</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L107" title="kernel/chr_drv/console.c:107">scrup</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L73" title="kernel/chr_drv/console.c:73">top</a>=oldtop;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a>=oldbottom;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L391">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">csi_at</span>(<span class="Type">unsigned</span> <span class="Type">int</span> nr)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (nr &gt; <a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nr = <a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!nr)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nr = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (nr--)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L336" title="kernel/chr_drv/console.c:336">insert_char</a>();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L401">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">csi_L</span>(<span class="Type">unsigned</span> <span class="Type">int</span> nr)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (nr &gt; <a href="#L61" title="kernel/chr_drv/console.c:61">video_num_lines</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nr = <a href="#L61" title="kernel/chr_drv/console.c:61">video_num_lines</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!nr)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nr = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (nr--)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L350" title="kernel/chr_drv/console.c:350">insert_line</a>();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L411">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">csi_P</span>(<span class="Type">unsigned</span> <span class="Type">int</span> nr)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (nr &gt; <a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nr = <a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!nr)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nr = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (nr--)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L363" title="kernel/chr_drv/console.c:363">delete_char</a>();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L421">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">csi_M</span>(<span class="Type">unsigned</span> <span class="Type">int</span> nr)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (nr &gt; <a href="#L61" title="kernel/chr_drv/console.c:61">video_num_lines</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nr = <a href="#L61" title="kernel/chr_drv/console.c:61">video_num_lines</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (!nr)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nr=<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (nr--)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L378" title="kernel/chr_drv/console.c:378">delete_line</a>();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L431">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">saved_x</span>=<span class="Constant">0</span>;<br/></li>
<li><a id="L432">&#x200c;</a><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">saved_y</span>=<span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li><a id="L434">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">save_cur</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L431" title="kernel/chr_drv/console.c:431">saved_x</a>=<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L432" title="kernel/chr_drv/console.c:432">saved_y</a>=<a href="#L72" title="kernel/chr_drv/console.c:72">y</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L440">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">restore_cur</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L88" title="kernel/chr_drv/console.c:88">gotoxy</a>(<a href="#L431" title="kernel/chr_drv/console.c:431">saved_x</a>, <a href="#L432" title="kernel/chr_drv/console.c:432">saved_y</a>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L445">&#x200c;</a><span class="Type">void</span> <span class="linkable">con_write</span>(<span class="Type">struct</span> <a href="../../include/linux/tty.h.html#L45" title="include/linux/tty.h:45">tty_struct</a> * tty)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> nr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span> c;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; nr = <a href="../../include/linux/tty.h.html#L30" title="include/linux/tty.h:30">CHARS</a>(tty-&gt;write_q);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (nr--) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/linux/tty.h.html#L31" title="include/linux/tty.h:31">GETCH</a>(tty-&gt;write_q,c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span>(<a href="#L74" title="kernel/chr_drv/console.c:74">state</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">0</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c&gt;<span class="Constant">31</span> &amp;&amp; c&lt;<span class="Constant">127</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>&gt;=<a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L72" title="kernel/chr_drv/console.c:72">x</a> -= <a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a> -= <a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L204" title="kernel/chr_drv/console.c:204">lf</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; __asm__(<span class="Constant">&quot;movb _attr,</span><span class="Special">%%</span><span class="Constant">ah</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;movw </span><span class="Special">%%</span><span class="Constant">ax,%1</span><span class="Special">\n\t</span><span class="Constant">&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ::<span class="Constant">&quot;a&quot;</span> (c),<span class="Constant">&quot;m&quot;</span> (*(<span class="Type">short</span> *)<a href="#L71" title="kernel/chr_drv/console.c:71">pos</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :) ;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a> += <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L72" title="kernel/chr_drv/console.c:72">x</a>++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (c==<span class="Constant">27</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L74" title="kernel/chr_drv/console.c:74">state</a>=<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c==<span class="Constant">10</span> || c==<span class="Constant">11</span> || c==<span class="Constant">12</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L204" title="kernel/chr_drv/console.c:204">lf</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c==<span class="Constant">13</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L224" title="kernel/chr_drv/console.c:224">cr</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c==<a href="../../include/linux/tty.h.html#L38" title="include/linux/tty.h:38">ERASE_CHAR</a>(tty))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L230" title="kernel/chr_drv/console.c:230">del</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c==<span class="Constant">8</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L72" title="kernel/chr_drv/console.c:72">x</a>--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a> -= <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (c==<span class="Constant">9</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c=<span class="Constant">8</span>-(<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>&amp;<span class="Constant">7</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L72" title="kernel/chr_drv/console.c:72">x</a> += c;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a> += c&lt;&lt;<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>&gt;<a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L72" title="kernel/chr_drv/console.c:72">x</a> -= <a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L71" title="kernel/chr_drv/console.c:71">pos</a> -= <a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L204" title="kernel/chr_drv/console.c:204">lf</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c=<span class="Constant">9</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (c==<span class="Constant">7</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L699" title="kernel/chr_drv/console.c:699">sysbeep</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">1</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L74" title="kernel/chr_drv/console.c:74">state</a>=<span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c==<span class="Constant">'['</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L74" title="kernel/chr_drv/console.c:74">state</a>=<span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c==<span class="Constant">'E'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L88" title="kernel/chr_drv/console.c:88">gotoxy</a>(<span class="Constant">0</span>,<a href="#L72" title="kernel/chr_drv/console.c:72">y</a>+<span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c==<span class="Constant">'M'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L214" title="kernel/chr_drv/console.c:214">ri</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c==<span class="Constant">'D'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L204" title="kernel/chr_drv/console.c:204">lf</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (c==<span class="Constant">'Z'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L323" title="kernel/chr_drv/console.c:323">respond</a>(tty);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>==<span class="Constant">'7'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L434" title="kernel/chr_drv/console.c:434">save_cur</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>==<span class="Constant">'8'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L440" title="kernel/chr_drv/console.c:440">restore_cur</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">2</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span>(<a href="#L75" title="kernel/chr_drv/console.c:75">npar</a>=<span class="Constant">0</span>;<a href="#L75" title="kernel/chr_drv/console.c:75">npar</a>&lt;<a href="#L54" title="kernel/chr_drv/console.c:54">NPAR</a>;<a href="#L75" title="kernel/chr_drv/console.c:75">npar</a>++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<a href="#L75" title="kernel/chr_drv/console.c:75">npar</a>]=<span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L75" title="kernel/chr_drv/console.c:75">npar</a>=<span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L74" title="kernel/chr_drv/console.c:74">state</a>=<span class="Constant">3</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="kernel/chr_drv/console.c:76">ques</a>=(c==<span class="Constant">'?'</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">3</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c==<span class="Constant">';'</span> &amp;&amp; <a href="#L75" title="kernel/chr_drv/console.c:75">npar</a>&lt;<a href="#L54" title="kernel/chr_drv/console.c:54">NPAR</a>-<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L75" title="kernel/chr_drv/console.c:75">npar</a>++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (c&gt;=<span class="Constant">'0'</span> &amp;&amp; c&lt;=<span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<a href="#L75" title="kernel/chr_drv/console.c:75">npar</a>]=<span class="Constant">10</span>*<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<a href="#L75" title="kernel/chr_drv/console.c:75">npar</a>]+c-<span class="Constant">'0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> <a href="#L74" title="kernel/chr_drv/console.c:74">state</a>=<span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">4</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L74" title="kernel/chr_drv/console.c:74">state</a>=<span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span>(c) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'G'</span>: <span class="Statement">case</span> <span class="Constant">'`'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]) <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L88" title="kernel/chr_drv/console.c:88">gotoxy</a>(<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>],<a href="#L72" title="kernel/chr_drv/console.c:72">y</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'A'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]) <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L88" title="kernel/chr_drv/console.c:88">gotoxy</a>(<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>,<a href="#L72" title="kernel/chr_drv/console.c:72">y</a>-<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'B'</span>: <span class="Statement">case</span> <span class="Constant">'e'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]) <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L88" title="kernel/chr_drv/console.c:88">gotoxy</a>(<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>,<a href="#L72" title="kernel/chr_drv/console.c:72">y</a>+<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'C'</span>: <span class="Statement">case</span> <span class="Constant">'a'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]) <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L88" title="kernel/chr_drv/console.c:88">gotoxy</a>(<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>+<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>],<a href="#L72" title="kernel/chr_drv/console.c:72">y</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'D'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]) <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L88" title="kernel/chr_drv/console.c:88">gotoxy</a>(<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>-<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>],<a href="#L72" title="kernel/chr_drv/console.c:72">y</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'E'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]) <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L88" title="kernel/chr_drv/console.c:88">gotoxy</a>(<span class="Constant">0</span>,<a href="#L72" title="kernel/chr_drv/console.c:72">y</a>+<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'F'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]) <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L88" title="kernel/chr_drv/console.c:88">gotoxy</a>(<span class="Constant">0</span>,<a href="#L72" title="kernel/chr_drv/console.c:72">y</a>-<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'d'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]) <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L88" title="kernel/chr_drv/console.c:88">gotoxy</a>(<a href="#L72" title="kernel/chr_drv/console.c:72">x</a>,<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'H'</span>: <span class="Statement">case</span> <span class="Constant">'f'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]) <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">1</span>]) <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">1</span>]--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L88" title="kernel/chr_drv/console.c:88">gotoxy</a>(<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">1</span>],<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'J'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L239" title="kernel/chr_drv/console.c:239">csi_J</a>(<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'K'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L268" title="kernel/chr_drv/console.c:268">csi_K</a>(<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'L'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L401" title="kernel/chr_drv/console.c:401">csi_L</a>(<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'M'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L421" title="kernel/chr_drv/console.c:421">csi_M</a>(<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'P'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L411" title="kernel/chr_drv/console.c:411">csi_P</a>(<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'@'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L391" title="kernel/chr_drv/console.c:391">csi_at</a>(<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'m'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L299" title="kernel/chr_drv/console.c:299">csi_m</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'r'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]) <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>]--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">1</span>]) <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">1</span>] = <a href="#L61" title="kernel/chr_drv/console.c:61">video_num_lines</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>] &lt; <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">1</span>] &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">1</span>] &lt;= <a href="#L61" title="kernel/chr_drv/console.c:61">video_num_lines</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L73" title="kernel/chr_drv/console.c:73">top</a>=<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">0</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a>=<a href="#L75" title="kernel/chr_drv/console.c:75">par</a>[<span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'s'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L434" title="kernel/chr_drv/console.c:434">save_cur</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'u'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L440" title="kernel/chr_drv/console.c:440">restore_cur</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L313" title="kernel/chr_drv/console.c:313">set_cursor</a>();<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; void <a href="#L617" title="kernel/chr_drv/console.c:617">con_init</a>(void);<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * This routine initalizes console interrupts, and does nothing<br/></li>
<li></span><span class="Comment"> * else. If you want the screen to clear, call <a href="tty_io.c.html#L290" title="kernel/chr_drv/tty_io.c:290">tty_write</a> with<br/></li>
<li></span><span class="Comment"> * the appropriate escape-sequece.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Reads the information preserved by setup.s to determine the <a href="../sched.c.html#L62" title="kernel/sched.c:62">current</a> display<br/></li>
<li></span><span class="Comment"> * type and sets everything accordingly.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L617">&#x200c;</a></span><span class="Type">void</span> <span class="linkable">con_init</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">register</span> <span class="Type">unsigned</span> <span class="Type">char</span> a;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span> *display_desc = <span class="Constant">&quot;????&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span> *display_ptr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a> = <a href="#L43" title="kernel/chr_drv/console.c:43">ORIG_VIDEO_COLS</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a> = <a href="#L59" title="kernel/chr_drv/console.c:59">video_num_columns</a> * <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="kernel/chr_drv/console.c:61">video_num_lines</a> = <a href="#L44" title="kernel/chr_drv/console.c:44">ORIG_VIDEO_LINES</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L62" title="kernel/chr_drv/console.c:62">video_page</a> = <a href="#L41" title="kernel/chr_drv/console.c:41">ORIG_VIDEO_PAGE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L67" title="kernel/chr_drv/console.c:67">video_erase_char</a> = <span class="Constant">0x0720</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L42" title="kernel/chr_drv/console.c:42">ORIG_VIDEO_MODE</a> == <span class="Constant">7</span>)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Is this a monochrome display? */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L63" title="kernel/chr_drv/console.c:63">video_mem_start</a> = <span class="Constant">0xb0000</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L65" title="kernel/chr_drv/console.c:65">video_port_reg</a> = <span class="Constant">0x3b4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L66" title="kernel/chr_drv/console.c:66">video_port_val</a> = <span class="Constant">0x3b5</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((<a href="#L46" title="kernel/chr_drv/console.c:46">ORIG_VIDEO_EGA_BX</a> &amp; <span class="Constant">0xff</span>) != <span class="Constant">0x10</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L58" title="kernel/chr_drv/console.c:58">video_type</a> = <a href="#L51" title="kernel/chr_drv/console.c:51">VIDEO_TYPE_EGAM</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L64" title="kernel/chr_drv/console.c:64">video_mem_end</a> = <span class="Constant">0xb8000</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; display_desc = <span class="Constant">&quot;EGAm&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L58" title="kernel/chr_drv/console.c:58">video_type</a> = <a href="#L49" title="kernel/chr_drv/console.c:49">VIDEO_TYPE_MDA</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L64" title="kernel/chr_drv/console.c:64">video_mem_end</a>&nbsp; &nbsp; &nbsp; &nbsp; = <span class="Constant">0xb2000</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; display_desc = <span class="Constant">&quot;*MDA&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* If not, it is color. */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L63" title="kernel/chr_drv/console.c:63">video_mem_start</a> = <span class="Constant">0xb8000</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L65" title="kernel/chr_drv/console.c:65">video_port_reg</a>&nbsp; &nbsp; &nbsp; &nbsp; = <span class="Constant">0x3d4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L66" title="kernel/chr_drv/console.c:66">video_port_val</a>&nbsp; &nbsp; &nbsp; &nbsp; = <span class="Constant">0x3d5</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((<a href="#L46" title="kernel/chr_drv/console.c:46">ORIG_VIDEO_EGA_BX</a> &amp; <span class="Constant">0xff</span>) != <span class="Constant">0x10</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L58" title="kernel/chr_drv/console.c:58">video_type</a> = <a href="#L52" title="kernel/chr_drv/console.c:52">VIDEO_TYPE_EGAC</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L64" title="kernel/chr_drv/console.c:64">video_mem_end</a> = <span class="Constant">0xbc000</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; display_desc = <span class="Constant">&quot;EGAc&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L58" title="kernel/chr_drv/console.c:58">video_type</a> = <a href="#L50" title="kernel/chr_drv/console.c:50">VIDEO_TYPE_CGA</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L64" title="kernel/chr_drv/console.c:64">video_mem_end</a> = <span class="Constant">0xba000</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; display_desc = <span class="Constant">&quot;*CGA&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Let the user known what kind of display driver we are using */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; display_ptr = ((<span class="Type">char</span> *)<a href="#L63" title="kernel/chr_drv/console.c:63">video_mem_start</a>) + <a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a> - <span class="Constant">8</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*display_desc)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *display_ptr++ = *display_desc++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; display_ptr++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Initialize the variables used for scrolling (mostly EGA/VGA)&nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L69" title="kernel/chr_drv/console.c:69">origin</a>&nbsp; &nbsp; &nbsp; &nbsp; = <a href="#L63" title="kernel/chr_drv/console.c:63">video_mem_start</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L70" title="kernel/chr_drv/console.c:70">scr_end</a>&nbsp; &nbsp; &nbsp; &nbsp; = <a href="#L63" title="kernel/chr_drv/console.c:63">video_mem_start</a> + <a href="#L61" title="kernel/chr_drv/console.c:61">video_num_lines</a> * <a href="#L60" title="kernel/chr_drv/console.c:60">video_size_row</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L73" title="kernel/chr_drv/console.c:73">top</a>&nbsp; &nbsp; &nbsp; &nbsp; = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L73" title="kernel/chr_drv/console.c:73">bottom</a>&nbsp; &nbsp; &nbsp; &nbsp; = <a href="#L61" title="kernel/chr_drv/console.c:61">video_num_lines</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L88" title="kernel/chr_drv/console.c:88">gotoxy</a>(<a href="#L39" title="kernel/chr_drv/console.c:39">ORIG_X</a>,<a href="#L40" title="kernel/chr_drv/console.c:40">ORIG_Y</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/system.h.html#L36" title="include/asm/system.h:36">set_trap_gate</a>(<span class="Constant">0x21</span>,&amp;keyboard_interrupt);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L11" title="include/asm/io.h:11">outb_p</a>(<a href="../../include/asm/io.h.html#L17" title="include/asm/io.h:17">inb_p</a>(<span class="Constant">0x21</span>)&amp;<span class="Constant">0xfd</span>,<span class="Constant">0x21</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; a=<a href="../../include/asm/io.h.html#L17" title="include/asm/io.h:17">inb_p</a>(<span class="Constant">0x61</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L11" title="include/asm/io.h:11">outb_p</a>(a|<span class="Constant">0x80</span>,<span class="Constant">0x61</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L1" title="include/asm/io.h:1">outb</a>(a,<span class="Constant">0x61</span>);<br/></li>
<li>}<br/></li>
<li><span class="Comment">/* from bsd-net-2: */<br/></li>
<li></span><br/></li>
<li><a id="L691">&#x200c;</a><span class="Type">void</span> <span class="linkable">sysbeepstop</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* disable counter 2 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L1" title="include/asm/io.h:1">outb</a>(<a href="../../include/asm/io.h.html#L17" title="include/asm/io.h:17">inb_p</a>(<span class="Constant">0x61</span>)&amp;<span class="Constant">0xFC</span>, <span class="Constant">0x61</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L697">&#x200c;</a><span class="Type">int</span> <span class="linkable">beepcount</span> = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li><a id="L699">&#x200c;</a><span class="Type">static</span> <span class="Type">void</span> <span class="linkable">sysbeep</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* enable counter 2 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L11" title="include/asm/io.h:11">outb_p</a>(<a href="../../include/asm/io.h.html#L17" title="include/asm/io.h:17">inb_p</a>(<span class="Constant">0x61</span>)|<span class="Constant">3</span>, <span class="Constant">0x61</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* set <a href="../blk_drv/floppy.c.html#L121" title="kernel/blk_drv/floppy.c:121">command</a> for counter 2, 2 byte write */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L11" title="include/asm/io.h:11">outb_p</a>(<span class="Constant">0xB6</span>, <span class="Constant">0x43</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* send 0x637 for 750 <a href="../../include/linux/sched.h.html#L5" title="include/linux/sched.h:5">HZ</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L11" title="include/asm/io.h:11">outb_p</a>(<span class="Constant">0x37</span>, <span class="Constant">0x42</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../include/asm/io.h.html#L1" title="include/asm/io.h:1">outb</a>(<span class="Constant">0x06</span>, <span class="Constant">0x42</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* 1/8 second */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L697" title="kernel/chr_drv/console.c:697">beepcount</a> = <a href="../../include/linux/sched.h.html#L5" title="include/linux/sched.h:5">HZ</a>/<span class="Constant">8</span>;<br/></li>
<li>}<br/></li>
</ol></code>
 </body>
</html>

<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>fs/exec.c - linux-0.11-ebook</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>fs/exec.c - linux-0.11-ebook</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L157">change_ldt</a></li>
<li><a href="#L104">copy_strings</a></li>
<li><a href="#L75">count</a></li>
<li><a href="#L46">create_tables</a></li>
<li><a href="#L185">do_execve</a></li>
</ul>
 <h4>Macros defined</h4>
 <ul>
<li><a href="#L39">MAX_ARG_PAGES</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> *&nbsp; linux/fs/<a href="../include/a.out.h.html#L6" title="include/a.out.h:6">exec</a>.c<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; (C) 1991&nbsp; Linus Torvalds<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * #!-checking implemented by tytso.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Demand-loading implemented 01.12.91 - no need to read anything but<br/></li>
<li></span><span class="Comment"> * the header into memory. The inode of the executable is put into<br/></li>
<li></span><span class="Comment"> * &quot;<a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;executable&quot;, and page faults do the actual loading. Clean.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Once more I can proudly say that linux stood up to being changed: it<br/></li>
<li></span><span class="Comment"> * was less than 2 hours work to get demand-loading completely implemented.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;<a href="../lib/errno.c.html#L7" title="lib/errno.c:7">errno</a>.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;string.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;sys/<a href="../include/sys/stat.h.html#L6" title="include/sys/stat.h:6">stat</a>.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;a.out.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;linux/fs.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;linux/sched.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;linux/kernel.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;linux/mm.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;asm/segment.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="Type"><a href="../lib/string.c.html#L11" title="lib/string.c:11">extern</a></span> <span class="Type">int</span> <a href="../kernel/exit.c.html#L137" title="kernel/exit.c:137">sys_exit</a>(<span class="Type">int</span> exit_code);<br/></li>
<li><span class="Type"><a href="../lib/string.c.html#L11" title="lib/string.c:11">extern</a></span> <span class="Type">int</span> <a href="open.c.html#L192" title="fs/open.c:192">sys_close</a>(<span class="Type">int</span> fd);<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L39" title="fs/exec.c:39">MAX_ARG_PAGES</a> defines the <a href="../kernel/vsprintf.c.html#L40" title="kernel/vsprintf.c:40">number</a> of pages allocated for arguments<br/></li>
<li></span><span class="Comment"> * and envelope for the new program. 32 should suffice, this gives<br/></li>
<li></span><span class="Comment"> * a maximum env+arg of 128kB !<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L39">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">MAX_ARG_PAGES</span> </span><span class="Constant">32<br/></li>
<li></span><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L46" title="fs/exec.c:46">create_tables</a>() parses the env- and arg-strings in new user<br/></li>
<li></span><span class="Comment"> * memory and creates the pointer tables from them, and puts their<br/></li>
<li></span><span class="Comment"> * addresses on the &quot;stack&quot;, returning the new stack pointer value.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L46">&#x200c;</a></span><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span> * <span class="linkable">create_tables</span>(<span class="Type">char</span> * p,<span class="Type">int</span> argc,<span class="Type">int</span> envc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">long</span> *<a href="../init/main.c.html#L165" title="init/main.c:165">argv</a>,*<a href="../init/main.c.html#L166" title="init/main.c:166">envp</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">long</span> * sp;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sp = (<span class="Type">unsigned</span> <span class="Type">long</span> *) (<span class="Constant">0xfffffffc</span> &amp; (<span class="Type">unsigned</span> <span class="Type">long</span>) p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sp -= envc+<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../init/main.c.html#L166" title="init/main.c:166">envp</a> = sp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sp -= argc+<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../init/main.c.html#L165" title="init/main.c:165">argv</a> = sp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L35" title="include/asm/segment.h:35">put_fs_long</a>((<span class="Type">unsigned</span> <span class="Type">long</span>)<a href="../init/main.c.html#L166" title="init/main.c:166">envp</a>,--sp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L35" title="include/asm/segment.h:35">put_fs_long</a>((<span class="Type">unsigned</span> <span class="Type">long</span>)<a href="../init/main.c.html#L165" title="init/main.c:165">argv</a>,--sp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L35" title="include/asm/segment.h:35">put_fs_long</a>((<span class="Type">unsigned</span> <span class="Type">long</span>)argc,--sp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (argc--&gt;<span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L35" title="include/asm/segment.h:35">put_fs_long</a>((<span class="Type">unsigned</span> <span class="Type">long</span>) p,<a href="../init/main.c.html#L165" title="init/main.c:165">argv</a>++);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (<a href="../include/asm/segment.h.html#L1" title="include/asm/segment.h:1">get_fs_byte</a>(p++)) <span class="Comment">/* nothing */</span> ;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L35" title="include/asm/segment.h:35">put_fs_long</a>(<span class="Constant">0</span>,<a href="../init/main.c.html#L165" title="init/main.c:165">argv</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (envc--&gt;<span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L35" title="include/asm/segment.h:35">put_fs_long</a>((<span class="Type">unsigned</span> <span class="Type">long</span>) p,<a href="../init/main.c.html#L166" title="init/main.c:166">envp</a>++);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (<a href="../include/asm/segment.h.html#L1" title="include/asm/segment.h:1">get_fs_byte</a>(p++)) <span class="Comment">/* nothing */</span> ;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L35" title="include/asm/segment.h:35">put_fs_long</a>(<span class="Constant">0</span>,<a href="../init/main.c.html#L166" title="init/main.c:166">envp</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> sp;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L75" title="fs/exec.c:75">count</a>() counts the <a href="../kernel/vsprintf.c.html#L40" title="kernel/vsprintf.c:40">number</a> of arguments/envelopes<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L75">&#x200c;</a></span><span class="Type">static</span> <span class="Type">int</span> <span class="linkable">count</span>(<span class="Type">char</span> ** <a href="../init/main.c.html#L165" title="init/main.c:165">argv</a>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> i=<span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span> ** tmp;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tmp = <a href="../init/main.c.html#L165" title="init/main.c:165">argv</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (<a href="../include/asm/segment.h.html#L17" title="include/asm/segment.h:17">get_fs_long</a>((<span class="Type">unsigned</span> <span class="Type">long</span> *) (tmp++)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> i;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * 'copy_string()' copies argument/envelope strings from user<br/></li>
<li></span><span class="Comment"> * memory to <a href="../include/linux/kernel.h.html#L12" title="include/linux/kernel.h:12">free</a> pages in kernel mem. These are in a format ready<br/></li>
<li></span><span class="Comment"> * to be put directly into the <a href="../kernel/chr_drv/console.c.html#L73" title="kernel/chr_drv/console.c:73">top</a> of new user memory.<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * Modified by TYT, 11/24/91 to add the from_kmem argument, which specifies<br/></li>
<li></span><span class="Comment"> * whether the string and the string array are from user or kernel segments:<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * from_kmem&nbsp; &nbsp;&nbsp; <a href="../init/main.c.html#L165" title="init/main.c:165">argv</a> *&nbsp; &nbsp; &nbsp; &nbsp; <a href="../init/main.c.html#L165" title="init/main.c:165">argv</a> **<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; user space&nbsp; &nbsp; user space<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; kernel space&nbsp; user space<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; kernel space&nbsp; kernel space<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> * We do this by playing games with the fs segment register.&nbsp; Since it<br/></li>
<li></span><span class="Comment"> * it is expensive to load a segment register, we try to avoid calling<br/></li>
<li></span><span class="Comment"> * <a href="../include/asm/segment.h.html#L61" title="include/asm/segment.h:61">set_fs</a>() unless we absolutely have to.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L104">&#x200c;</a></span><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span> <span class="linkable">copy_strings</span>(<span class="Type">int</span> argc,<span class="Type">char</span> ** <a href="../init/main.c.html#L165" title="init/main.c:165">argv</a>,<span class="Type">unsigned</span> <span class="Type">long</span> *page,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">long</span> p, <span class="Type">int</span> from_kmem)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span> *tmp, *pag;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> len, offset = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">long</span> old_fs, new_fs;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!p)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* bullet-proofing */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; new_fs = <a href="../include/asm/segment.h.html#L54" title="include/asm/segment.h:54">get_ds</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; old_fs = <a href="../include/asm/segment.h.html#L47" title="include/asm/segment.h:47">get_fs</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (from_kmem==<span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L61" title="include/asm/segment.h:61">set_fs</a>(new_fs);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (argc-- &gt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (from_kmem == <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L61" title="include/asm/segment.h:61">set_fs</a>(new_fs);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!(tmp = (<span class="Type">char</span> *)<a href="../include/asm/segment.h.html#L17" title="include/asm/segment.h:17">get_fs_long</a>(((<span class="Type">unsigned</span> <span class="Type">long</span> *)<a href="../init/main.c.html#L165" title="init/main.c:165">argv</a>)+argc)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../kernel/panic.c.html#L16" title="kernel/panic.c:16">panic</a>(<span class="Constant">&quot;argc is wrong&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (from_kmem == <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L61" title="include/asm/segment.h:61">set_fs</a>(old_fs);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len=<span class="Constant">0</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* remember zero-padding */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> (<a href="../include/asm/segment.h.html#L1" title="include/asm/segment.h:1">get_fs_byte</a>(tmp++));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p-len &lt; <span class="Constant">0</span>) {&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* this shouldn't happen - 128kB */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L61" title="include/asm/segment.h:61">set_fs</a>(old_fs);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --p; --tmp; --len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (--offset &lt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; offset = p % <a href="../include/linux/mm.h.html#L4" title="include/linux/mm.h:4">PAGE_SIZE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (from_kmem==<span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L61" title="include/asm/segment.h:61">set_fs</a>(old_fs);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((!page[p/<a href="../include/linux/mm.h.html#L4" title="include/linux/mm.h:4">PAGE_SIZE</a>]) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; !(page[p/<a href="../include/linux/mm.h.html#L4" title="include/linux/mm.h:4">PAGE_SIZE</a>] =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">unsigned</span> <span class="Type">long</span> *) <a href="../mm/memory.c.html#L63" title="mm/memory.c:63">get_free_page</a>()))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pag = (<span class="Type">char</span> *)page[p/<a href="../include/linux/mm.h.html#L4" title="include/linux/mm.h:4">PAGE_SIZE</a>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (from_kmem==<span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L61" title="include/asm/segment.h:61">set_fs</a>(new_fs);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *(pag + offset) = <a href="../include/asm/segment.h.html#L1" title="include/asm/segment.h:1">get_fs_byte</a>(tmp);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (from_kmem==<span class="Constant">2</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L61" title="include/asm/segment.h:61">set_fs</a>(old_fs);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> p;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L157">&#x200c;</a><span class="Type">static</span> <span class="Type">unsigned</span> <span class="Type">long</span> <span class="linkable">change_ldt</span>(<span class="Type">unsigned</span> <span class="Type">long</span> text_size,<span class="Type">unsigned</span> <span class="Type">long</span> * page)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">long</span> code_limit,data_limit,code_base,data_base;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; code_limit = text_size+<a href="../include/linux/mm.h.html#L4" title="include/linux/mm.h:4">PAGE_SIZE</a> -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; code_limit &amp;= <span class="Constant">0xFFFFF000</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; data_limit = <span class="Constant">0x4000000</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; code_base = <a href="../include/linux/sched.h.html#L226" title="include/linux/sched.h:226">get_base</a>(<a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;ldt[<span class="Constant">1</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; data_base = code_base;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/linux/sched.h.html#L211" title="include/linux/sched.h:211">set_base</a>(<a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;ldt[<span class="Constant">1</span>],code_base);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/linux/sched.h.html#L212" title="include/linux/sched.h:212">set_limit</a>(<a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;ldt[<span class="Constant">1</span>],code_limit);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/linux/sched.h.html#L211" title="include/linux/sched.h:211">set_base</a>(<a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;ldt[<span class="Constant">2</span>],data_base);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/linux/sched.h.html#L212" title="include/linux/sched.h:212">set_limit</a>(<a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;ldt[<span class="Constant">2</span>],data_limit);<br/></li>
<li><span class="Comment">/* make sure fs points to the NEW data segment */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; __asm__(<span class="Constant">&quot;pushl $0x17</span><span class="Special">\n\t</span><span class="Constant">pop </span><span class="Special">%%</span><span class="Constant">fs&quot;</span>::);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; data_base += data_limit;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i=<a href="#L39" title="fs/exec.c:39">MAX_ARG_PAGES</a>-<span class="Constant">1</span> ; i&gt;=<span class="Constant">0</span> ; i--) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data_base -= <a href="../include/linux/mm.h.html#L4" title="include/linux/mm.h:4">PAGE_SIZE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (page[i])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mm/memory.c.html#L197" title="mm/memory.c:197">put_page</a>(page[i],data_base);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> data_limit;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * '<a href="#L185" title="fs/exec.c:185">do_execve</a>()' executes a new program.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li><a id="L185">&#x200c;</a></span><span class="Type">int</span> <span class="linkable">do_execve</span>(<span class="Type">unsigned</span> <span class="Type">long</span> * eip,<span class="Type">long</span> tmp,<span class="Type">char</span> * filename,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span> ** <a href="../init/main.c.html#L165" title="init/main.c:165">argv</a>, <span class="Type">char</span> ** <a href="../init/main.c.html#L166" title="init/main.c:166">envp</a>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> <a href="../include/linux/fs.h.html#L93" title="include/linux/fs.h:93">m_inode</a> * inode;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> <a href="../include/linux/fs.h.html#L68" title="include/linux/fs.h:68">buffer_head</a> * bh;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> <a href="../include/a.out.h.html#L6" title="include/a.out.h:6">exec</a> ex;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">long</span> page[<a href="#L39" title="fs/exec.c:39">MAX_ARG_PAGES</a>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> i,argc,envc;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> e_uid, e_gid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> retval;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">int</span> sh_bang = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">long</span> p=<a href="../include/linux/mm.h.html#L4" title="include/linux/mm.h:4">PAGE_SIZE</a>*<a href="#L39" title="fs/exec.c:39">MAX_ARG_PAGES</a>-<span class="Constant">4</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((<span class="Constant">0xffff</span> &amp; eip[<span class="Constant">1</span>]) != <span class="Constant">0x000f</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../kernel/panic.c.html#L16" title="kernel/panic.c:16">panic</a>(<span class="Constant">&quot;execve called from supervisor mode&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i=<span class="Constant">0</span> ; i&lt;<a href="#L39" title="fs/exec.c:39">MAX_ARG_PAGES</a> ; i++)&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* clear page-table */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; page[i]=<span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!(inode=<a href="namei.c.html#L303" title="fs/namei.c:303">namei</a>(filename)))&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* get executables inode */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant"><a href="../include/errno.h.html#L21" title="include/errno.h:21">ENOENT</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; argc = <a href="#L75" title="fs/exec.c:75">count</a>(<a href="../init/main.c.html#L165" title="init/main.c:165">argv</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; envc = <a href="#L75" title="fs/exec.c:75">count</a>(<a href="../init/main.c.html#L166" title="init/main.c:166">envp</a>);<br/></li>
<li><br/></li>
<li><span class="Statement">restart_interp</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="../include/sys/stat.h.html#L30" title="include/sys/stat.h:30">S_ISREG</a>(inode-&gt;i_mode)) {&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* must be regular <a href="../include/linux/fs.h.html#L116" title="include/linux/fs.h:116">file</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retval = -<span class="Constant"><a href="../include/errno.h.html#L32" title="include/errno.h:32">EACCES</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> exec_error2;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; i = inode-&gt;i_mode;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e_uid = (i &amp; <a href="../include/sys/stat.h.html#L26" title="include/sys/stat.h:26">S_ISUID</a>) ? inode-&gt;i_uid : <a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;euid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e_gid = (i &amp; <a href="../include/sys/stat.h.html#L27" title="include/sys/stat.h:27">S_ISGID</a>) ? inode-&gt;i_gid : <a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;egid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;euid == inode-&gt;i_uid)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i &gt;&gt;= <span class="Constant">6</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else</span> <span class="Statement">if</span> (<a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;egid == inode-&gt;i_gid)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i &gt;&gt;= <span class="Constant">3</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!(i &amp; <span class="Constant">1</span>) &amp;&amp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; !((inode-&gt;i_mode &amp; <span class="PreProc">0</span><span class="Constant">111</span>) &amp;&amp; <a href="../include/linux/kernel.h.html#L21" title="include/linux/kernel.h:21">suser</a>())) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retval = -<span class="Constant"><a href="../include/errno.h.html#L27" title="include/errno.h:27">ENOEXEC</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> exec_error2;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!(bh = <a href="buffer.c.html#L267" title="fs/buffer.c:267">bread</a>(inode-&gt;i_dev,inode-&gt;i_zone[<span class="Constant">0</span>]))) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retval = -<span class="Constant"><a href="../include/errno.h.html#L32" title="include/errno.h:32">EACCES</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> exec_error2;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ex = *((<span class="Type">struct</span> <a href="../include/a.out.h.html#L6" title="include/a.out.h:6">exec</a> *) bh-&gt;b_data);&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* read <a href="../include/a.out.h.html#L6" title="include/a.out.h:6">exec</a>-header */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((bh-&gt;b_data[<span class="Constant">0</span>] == <span class="Constant">'#'</span>) &amp;&amp; (bh-&gt;b_data[<span class="Constant">1</span>] == <span class="Constant">'!'</span>) &amp;&amp; (!sh_bang)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * This section does the #! interpretation.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Sorta complicated, but hopefully it will work.&nbsp; -TYT<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">char</span> <a href="../kernel/printk.c.html#L17" title="kernel/printk.c:17">buf</a>[<span class="Constant">1023</span>], *cp, *interp, *i_name, *i_arg;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">unsigned</span> <span class="Type">long</span> old_fs;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/string.h.html#L38" title="include/string.h:38">strncpy</a>(<a href="../kernel/printk.c.html#L17" title="kernel/printk.c:17">buf</a>, bh-&gt;b_data+<span class="Constant">2</span>, <span class="Constant">1022</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="buffer.c.html#L253" title="fs/buffer.c:253">brelse</a>(bh);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="inode.c.html#L150" title="fs/inode.c:150">iput</a>(inode);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../kernel/printk.c.html#L17" title="kernel/printk.c:17">buf</a>[<span class="Constant">1022</span>] = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cp = <a href="../include/string.h.html#L128" title="include/string.h:128">strchr</a>(<a href="../kernel/printk.c.html#L17" title="kernel/printk.c:17">buf</a>, <span class="Special">'\n'</span>)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *cp = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (cp = <a href="../kernel/printk.c.html#L17" title="kernel/printk.c:17">buf</a>; (*cp == <span class="Constant">' '</span>) || (*cp == <span class="Special">'\t'</span>); cp++);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!cp || *cp == <span class="Special">'\0'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retval = -<span class="Constant"><a href="../include/errno.h.html#L27" title="include/errno.h:27">ENOEXEC</a></span>; <span class="Comment">/* No interpreter name found */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> exec_error1;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; interp = i_name = cp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i_arg = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> ( ; *cp &amp;&amp; (*cp != <span class="Constant">' '</span>) &amp;&amp; (*cp != <span class="Special">'\t'</span>); cp++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">if</span> (*cp == <span class="Constant">'/'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i_name = cp+<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*cp) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *cp++ = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i_arg = cp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * OK, we've parsed out the interpreter name and<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * (optional) argument.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sh_bang++ == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = <a href="#L104" title="fs/exec.c:104">copy_strings</a>(envc, <a href="../init/main.c.html#L166" title="init/main.c:166">envp</a>, page, p, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = <a href="#L104" title="fs/exec.c:104">copy_strings</a>(--argc, <a href="../init/main.c.html#L165" title="init/main.c:165">argv</a>+<span class="Constant">1</span>, page, p, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Splice in (1) the interpreter's name for <a href="../init/main.c.html#L165" title="init/main.c:165">argv</a>[0]<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (2) (optional) argument to interpreter<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (3) filename of shell script<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * This is done in reverse order, because of how the<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * user environment and arguments are stored.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = <a href="#L104" title="fs/exec.c:104">copy_strings</a>(<span class="Constant">1</span>, &amp;filename, page, p, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; argc++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i_arg) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = <a href="#L104" title="fs/exec.c:104">copy_strings</a>(<span class="Constant">1</span>, &amp;i_arg, page, p, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; argc++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = <a href="#L104" title="fs/exec.c:104">copy_strings</a>(<span class="Constant">1</span>, &amp;i_name, page, p, <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; argc++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!p) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retval = -<span class="Constant"><a href="../include/errno.h.html#L31" title="include/errno.h:31">ENOMEM</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> exec_error1;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * OK, now restart the process with the interpreter's inode.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; old_fs = <a href="../include/asm/segment.h.html#L47" title="include/asm/segment.h:47">get_fs</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L61" title="include/asm/segment.h:61">set_fs</a>(<a href="../include/asm/segment.h.html#L54" title="include/asm/segment.h:54">get_ds</a>());<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!(inode=<a href="namei.c.html#L303" title="fs/namei.c:303">namei</a>(interp))) { <span class="Comment">/* get executables inode */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L61" title="include/asm/segment.h:61">set_fs</a>(old_fs);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retval = -<span class="Constant"><a href="../include/errno.h.html#L21" title="include/errno.h:21">ENOENT</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> exec_error1;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L61" title="include/asm/segment.h:61">set_fs</a>(old_fs);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> restart_interp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="buffer.c.html#L253" title="fs/buffer.c:253">brelse</a>(bh);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../include/a.out.h.html#L18" title="include/a.out.h:18">N_MAGIC</a>(ex) != <a href="../include/a.out.h.html#L27" title="include/a.out.h:27">ZMAGIC</a> || ex.a_trsize || ex.a_drsize ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ex.a_text+ex.a_data+ex.a_bss&gt;<span class="Constant">0x3000000</span> ||<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inode-&gt;i_size &lt; ex.a_text+ex.a_data+ex.a_syms+<a href="../include/a.out.h.html#L43" title="include/a.out.h:43">N_TXTOFF</a>(ex)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retval = -<span class="Constant"><a href="../include/errno.h.html#L27" title="include/errno.h:27">ENOEXEC</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> exec_error2;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../include/a.out.h.html#L43" title="include/a.out.h:43">N_TXTOFF</a>(ex) != <a href="../include/linux/fs.h.html#L49" title="include/linux/fs.h:49">BLOCK_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../kernel/printk.c.html#L21" title="kernel/printk.c:21">printk</a>(<span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">: <a href="../include/a.out.h.html#L43" title="include/a.out.h:43">N_TXTOFF</a> != <a href="../include/linux/fs.h.html#L49" title="include/linux/fs.h:49">BLOCK_SIZE</a>. See a.out.h.&quot;</span>, filename);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retval = -<span class="Constant"><a href="../include/errno.h.html#L27" title="include/errno.h:27">ENOEXEC</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> exec_error2;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!sh_bang) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = <a href="#L104" title="fs/exec.c:104">copy_strings</a>(envc,<a href="../init/main.c.html#L166" title="init/main.c:166">envp</a>,page,p,<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = <a href="#L104" title="fs/exec.c:104">copy_strings</a>(argc,<a href="../init/main.c.html#L165" title="init/main.c:165">argv</a>,page,p,<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!p) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retval = -<span class="Constant"><a href="../include/errno.h.html#L31" title="include/errno.h:31">ENOMEM</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> exec_error2;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><span class="Comment">/* OK, This is the point of no return */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;executable)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="inode.c.html#L150" title="fs/inode.c:150">iput</a>(<a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;executable);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;executable = inode;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i=<span class="Constant">0</span> ; i&lt;<span class="Constant">32</span> ; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;<a href="../include/signal.h.html#L48" title="include/signal.h:48">sigaction</a>[i].sa_handler = <span class="Constant"><a href="../include/linux/sched.h.html#L26" title="include/linux/sched.h:26">NULL</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i=<span class="Constant">0</span> ; i&lt;<a href="../include/linux/fs.h.html#L43" title="include/linux/fs.h:43">NR_OPEN</a> ; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((<a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;close_on_exec&gt;&gt;i)&amp;<span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="open.c.html#L192" title="fs/open.c:192">sys_close</a>(i);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;close_on_exec = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../mm/memory.c.html#L105" title="mm/memory.c:105">free_page_tables</a>(<a href="../include/linux/sched.h.html#L226" title="include/linux/sched.h:226">get_base</a>(<a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;ldt[<span class="Constant">1</span>]),<a href="../include/linux/sched.h.html#L228" title="include/linux/sched.h:228">get_limit</a>(<span class="Constant">0x0f</span>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../mm/memory.c.html#L105" title="mm/memory.c:105">free_page_tables</a>(<a href="../include/linux/sched.h.html#L226" title="include/linux/sched.h:226">get_base</a>(<a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;ldt[<span class="Constant">2</span>]),<a href="../include/linux/sched.h.html#L228" title="include/linux/sched.h:228">get_limit</a>(<span class="Constant">0x17</span>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../kernel/sched.c.html#L63" title="kernel/sched.c:63">last_task_used_math</a> == <a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../kernel/sched.c.html#L63" title="kernel/sched.c:63">last_task_used_math</a> = <span class="Constant"><a href="../include/linux/sched.h.html#L26" title="include/linux/sched.h:26">NULL</a></span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;used_math = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p += <a href="#L157" title="fs/exec.c:157">change_ldt</a>(ex.a_text,page)-<a href="#L39" title="fs/exec.c:39">MAX_ARG_PAGES</a>*<a href="../include/linux/mm.h.html#L4" title="include/linux/mm.h:4">PAGE_SIZE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = (<span class="Type">unsigned</span> <span class="Type">long</span>) <a href="#L46" title="fs/exec.c:46">create_tables</a>((<span class="Type">char</span> *)p,argc,envc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;brk = ex.a_bss +<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;end_data = ex.a_data +<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;end_code = ex.a_text));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;start_stack = p &amp; <span class="Constant">0xfffff000</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;euid = e_uid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../kernel/sched.c.html#L62" title="kernel/sched.c:62">current</a>-&gt;egid = e_gid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; i = ex.a_text+ex.a_data;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (i&amp;<span class="Constant">0xfff</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../include/asm/segment.h.html#L25" title="include/asm/segment.h:25">put_fs_byte</a>(<span class="Constant">0</span>,(<span class="Type">char</span> *) (i++));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; eip[<span class="Constant">0</span>] = ex.a_entry;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* eip, magic happens :-) */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; eip[<span class="Constant">3</span>] = p;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* stack pointer */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li><span class="Statement">exec_error2</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="inode.c.html#L150" title="fs/inode.c:150">iput</a>(inode);<br/></li>
<li><span class="Statement">exec_error1</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i=<span class="Constant">0</span> ; i&lt;<a href="#L39" title="fs/exec.c:39">MAX_ARG_PAGES</a> ; i++)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../mm/memory.c.html#L89" title="mm/memory.c:89">free_page</a>(page[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>(retval);<br/></li>
<li>}<br/></li>
</ol></code>
 </body>
</html>

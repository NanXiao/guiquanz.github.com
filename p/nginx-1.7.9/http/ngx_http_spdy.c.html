<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>http/ngx_http_spdy.c - src</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>http/ngx_http_spdy.c - src</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Global variables defined</h4>
 <ul>
<li><a href="#L189">ngx_http_spdy_dict</a></li>
<li><a href="#L371">ngx_http_spdy_request_headers</a></li>
</ul>
 <h4>Data types defined</h4>
 <ul>
<li><a href="#L91">ngx_http_spdy_request_header_t</a></li>
</ul>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L3625">ngx_http_spdy_adjust_windows</a></li>
<li><a href="#L2636">ngx_http_spdy_alloc_large_header_buffer</a></li>
<li><a href="#L3318">ngx_http_spdy_close_stream</a></li>
<li><a href="#L3302">ngx_http_spdy_close_stream_handler</a></li>
<li><a href="#L3034">ngx_http_spdy_construct_request_line</a></li>
<li><a href="#L2308">ngx_http_spdy_create_stream</a></li>
<li><a href="#L2289">ngx_http_spdy_ctl_frame_handler</a></li>
<li><a href="#L3556">ngx_http_spdy_finalize_connection</a></li>
<li><a href="#L2232">ngx_http_spdy_get_ctl_frame</a></li>
<li><a href="#L2439">ngx_http_spdy_get_stream_by_id</a></li>
<li><a href="#L758">ngx_http_spdy_handle_connection</a></li>
<li><a href="#L3472">ngx_http_spdy_handle_connection_handler</a></li>
<li><a href="#L2705">ngx_http_spdy_handle_request_header</a></li>
<li><a href="#L385">ngx_http_spdy_init</a></li>
<li><a href="#L3141">ngx_http_spdy_init_request_body</a></li>
<li><a href="#L3490">ngx_http_spdy_keepalive_handler</a></li>
<li><a href="#L2463">ngx_http_spdy_parse_header</a></li>
<li><a href="#L2888">ngx_http_spdy_parse_host</a></li>
<li><a href="#L2782">ngx_http_spdy_parse_method</a></li>
<li><a href="#L2921">ngx_http_spdy_parse_path</a></li>
<li><a href="#L2871">ngx_http_spdy_parse_scheme</a></li>
<li><a href="#L2954">ngx_http_spdy_parse_version</a></li>
<li><a href="#L3680">ngx_http_spdy_pool_cleanup</a></li>
<li><a href="#L818">ngx_http_spdy_proxy_protocol</a></li>
<li><a href="#L517">ngx_http_spdy_read_handler</a></li>
<li><a href="#L3229">ngx_http_spdy_read_request_body</a></li>
<li><a href="#L2769">ngx_http_spdy_request_headers_init</a></li>
<li><a href="#L3077">ngx_http_spdy_run_request</a></li>
<li><a href="#L663">ngx_http_spdy_send_output_queue</a></li>
<li><a href="#L2069">ngx_http_spdy_send_rst_stream</a></li>
<li><a href="#L2143">ngx_http_spdy_send_settings</a></li>
<li><a href="#L2034">ngx_http_spdy_send_window_update</a></li>
<li><a href="#L2214">ngx_http_spdy_settings_frame_handler</a></li>
<li><a href="#L1930">ngx_http_spdy_state_complete</a></li>
<li><a href="#L1439">ngx_http_spdy_state_data</a></li>
<li><a href="#L839">ngx_http_spdy_state_head</a></li>
<li><a href="#L1005">ngx_http_spdy_state_headers</a></li>
<li><a href="#L1298">ngx_http_spdy_state_headers_error</a></li>
<li><a href="#L1244">ngx_http_spdy_state_headers_skip</a></li>
<li><a href="#L1982">ngx_http_spdy_state_inflate_error</a></li>
<li><a href="#L2017">ngx_http_spdy_state_internal_error</a></li>
<li><a href="#L1776">ngx_http_spdy_state_ping</a></li>
<li><a href="#L2000">ngx_http_spdy_state_protocol_error</a></li>
<li><a href="#L1531">ngx_http_spdy_state_read_data</a></li>
<li><a href="#L1701">ngx_http_spdy_state_rst_stream</a></li>
<li><a href="#L1952">ngx_http_spdy_state_save</a></li>
<li><a href="#L1846">ngx_http_spdy_state_settings</a></li>
<li><a href="#L1825">ngx_http_spdy_state_skip</a></li>
<li><a href="#L918">ngx_http_spdy_state_syn_stream</a></li>
<li><a href="#L1325">ngx_http_spdy_state_window_update</a></li>
<li><a href="#L3276">ngx_http_spdy_terminate_stream</a></li>
<li><a href="#L607">ngx_http_spdy_write_handler</a></li>
<li><a href="#L3691">ngx_http_spdy_zalloc</a></li>
<li><a href="#L3700">ngx_http_spdy_zfree</a></li>
</ul>
 <h4>Macros defined</h4>
 <ul>
<li><a href="#L67">NGX_SPDY_CANCEL</a></li>
<li><a href="#L82">NGX_SPDY_CONNECTION_WINDOW</a></li>
<li><a href="#L61">NGX_SPDY_CTL_FRAME_BUFFER_SIZE</a></li>
<li><a href="#L69">NGX_SPDY_FLOW_CONTROL_ERROR</a></li>
<li><a href="#L73">NGX_SPDY_FRAME_TOO_LARGE</a></li>
<li><a href="#L83">NGX_SPDY_INIT_STREAM_WINDOW</a></li>
<li><a href="#L68">NGX_SPDY_INTERNAL_ERROR</a></li>
<li><a href="#L64">NGX_SPDY_INVALID_STREAM</a></li>
<li><a href="#L81">NGX_SPDY_MAX_WINDOW</a></li>
<li><a href="#L63">NGX_SPDY_PROTOCOL_ERROR</a></li>
<li><a href="#L65">NGX_SPDY_REFUSED_STREAM</a></li>
<li><a href="#L379">NGX_SPDY_REQUEST_HEADERS</a></li>
<li><a href="#L78">NGX_SPDY_SETTINGS_FLAG_PERSIST</a></li>
<li><a href="#L79">NGX_SPDY_SETTINGS_FLAG_PERSISTED</a></li>
<li><a href="#L76">NGX_SPDY_SETTINGS_INIT_WINDOW</a></li>
<li><a href="#L75">NGX_SPDY_SETTINGS_MAX_STREAMS</a></li>
<li><a href="#L60">NGX_SPDY_SKIP_HEADERS_BUFFER_SIZE</a></li>
<li><a href="#L71">NGX_SPDY_STREAM_ALREADY_CLOSED</a></li>
<li><a href="#L70">NGX_SPDY_STREAM_IN_USE</a></li>
<li><a href="#L84">NGX_SPDY_STREAM_WINDOW</a></li>
<li><a href="#L66">NGX_SPDY_UNSUPPORTED_VERSION</a></li>
<li><a href="#L153">ngx_http_spdy_stream_index</a></li>
<li><a href="#L152">ngx_http_spdy_streams_index_size</a></li>
<li><a href="#L49">ngx_spdy_ctl_frame_check</a></li>
<li><a href="#L54">ngx_spdy_ctl_frame_type</a></li>
<li><a href="#L51">ngx_spdy_data_frame_check</a></li>
<li><a href="#L55">ngx_spdy_frame_flags</a></li>
<li><a href="#L57">ngx_spdy_frame_id</a></li>
<li><a href="#L56">ngx_spdy_frame_length</a></li>
<li><a href="#L45">ngx_spdy_frame_parse_delta</a></li>
<li><a href="#L43">ngx_spdy_frame_parse_sid</a></li>
<li><a href="#L32">ngx_spdy_frame_parse_uint16</a></li>
<li><a href="#L37">ngx_spdy_frame_parse_uint16</a></li>
<li><a href="#L33">ngx_spdy_frame_parse_uint32</a></li>
<li><a href="#L38">ngx_spdy_frame_parse_uint32</a></li>
<li><a href="#L18">ngx_str5cmp</a></li>
<li><a href="#L24">ngx_str5cmp</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Copyright (C) Nginx, Inc.<br/></li>
<li></span><span class="Comment"> * Copyright (C) Valentin V. Bartenev<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;ngx_config.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_core.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_http.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;<a href="ngx_http_spdy_module.c.html#L131" title="http/ngx_http_spdy_module.c:131">ngx_http_spdy_module</a>.h&gt;<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;zlib.h&gt;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_LITTLE_ENDIAN &amp;&amp; NGX_HAVE_NONALIGNED)<br/></li>
<li></span><br/></li>
<li><a id="L18">&#x200c;</a><span class="PreProc">#define <span class="linkable">ngx_str5cmp</span>(m, c0, c1, c2, c3, c4)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; *(</span><span class="Type">uint32_t</span><span class="PreProc"> *) m == (c3 &lt;&lt; </span><span class="Constant">24</span><span class="PreProc"> | c2 &lt;&lt; </span><span class="Constant">16</span><span class="PreProc"> | c1 &lt;&lt; </span><span class="Constant">8</span><span class="PreProc"> | c0)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; m[</span><span class="Constant">4</span><span class="PreProc">] == c4<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span><br/></li>
<li><a id="L24">&#x200c;</a><span class="PreProc">#define <span class="linkable">ngx_str5cmp</span>(m, c0, c1, c2, c3, c4)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; m[</span><span class="Constant">0</span><span class="PreProc">] == c0 &amp;&amp; m[</span><span class="Constant">1</span><span class="PreProc">] == c1 &amp;&amp; m[</span><span class="Constant">2</span><span class="PreProc">] == c2 &amp;&amp; m[</span><span class="Constant">3</span><span class="PreProc">] == c3 &amp;&amp; m[</span><span class="Constant">4</span><span class="PreProc">] == c4<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_NONALIGNED)<br/></li>
<li></span><br/></li>
<li><a id="L32">&#x200c;</a><span class="PreProc">#define <span class="linkable">ngx_spdy_frame_parse_uint16</span>(p)&nbsp; ntohs(*(</span><span class="Type">uint16_t</span><span class="PreProc"> *) (p))<br/></li>
<li><a id="L33">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ngx_spdy_frame_parse_uint32</span>(p)&nbsp; ntohl(*(</span><span class="Type">uint32_t</span><span class="PreProc"> *) (p))<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span><br/></li>
<li><a id="L37">&#x200c;</a><span class="PreProc">#define <span class="linkable">ngx_spdy_frame_parse_uint16</span>(p) ((p)[</span><span class="Constant">0</span><span class="PreProc">] &lt;&lt; </span><span class="Constant">8</span><span class="PreProc"> | (p)[</span><span class="Constant">1</span><span class="PreProc">])<br/></li>
<li><a id="L38">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ngx_spdy_frame_parse_uint32</span>(p)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; ((p)[</span><span class="Constant">0</span><span class="PreProc">] &lt;&lt; </span><span class="Constant">24</span><span class="PreProc"> | (p)[</span><span class="Constant">1</span><span class="PreProc">] &lt;&lt; </span><span class="Constant">16</span><span class="PreProc"> | (p)[</span><span class="Constant">2</span><span class="PreProc">] &lt;&lt; </span><span class="Constant">8</span><span class="PreProc"> | (p)[</span><span class="Constant">3</span><span class="PreProc">])<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><a id="L43">&#x200c;</a><span class="PreProc">#define <span class="linkable">ngx_spdy_frame_parse_sid</span>(p)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (<a href="#L33" title="http/ngx_http_spdy.c:33">ngx_spdy_frame_parse_uint32</a>(p) &amp; </span><span class="Constant">0x7fffffff</span><span class="PreProc">)<br/></li>
<li><a id="L45">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ngx_spdy_frame_parse_delta</span>(p)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (<a href="#L33" title="http/ngx_http_spdy.c:33">ngx_spdy_frame_parse_uint32</a>(p) &amp; </span><span class="Constant">0x7fffffff</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L49">&#x200c;</a><span class="PreProc">#define <span class="linkable">ngx_spdy_ctl_frame_check</span>(h)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (((h) &amp; </span><span class="Constant">0xffff0000</span><span class="PreProc">) == <a href="ngx_http_spdy.h.html#L247" title="http/ngx_http_spdy.h:247">ngx_spdy_ctl_frame_head</a>(</span><span class="Constant">0</span><span class="PreProc">))<br/></li>
<li><a id="L51">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ngx_spdy_data_frame_check</span>(h)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (!((h) &amp; (</span><span class="Type">uint32_t</span><span class="PreProc">) <a href="ngx_http_spdy.h.html#L25" title="http/ngx_http_spdy.h:25">NGX_SPDY_CTL_BIT</a> &lt;&lt; </span><span class="Constant">31</span><span class="PreProc">))<br/></li>
<li></span><br/></li>
<li><a id="L54">&#x200c;</a><span class="PreProc">#define <span class="linkable">ngx_spdy_ctl_frame_type</span>(h)&nbsp;&nbsp; ((h) &amp; </span><span class="Constant">0x0000ffff</span><span class="PreProc">)<br/></li>
<li><a id="L55">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ngx_spdy_frame_flags</span>(p)&nbsp; &nbsp; &nbsp; ((p) &gt;&gt; </span><span class="Constant">24</span><span class="PreProc">)<br/></li>
<li><a id="L56">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ngx_spdy_frame_length</span>(p)&nbsp; &nbsp;&nbsp; ((p) &amp; </span><span class="Constant">0x00ffffff</span><span class="PreProc">)<br/></li>
<li><a id="L57">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ngx_spdy_frame_id</span>(p)&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ((p) &amp; </span><span class="Constant">0x00ffffff</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L60">&#x200c;</a><span class="PreProc">#define <span class="linkable">NGX_SPDY_SKIP_HEADERS_BUFFER_SIZE</span>&nbsp; </span><span class="Constant">4096<br/></li>
<li><a id="L61">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_SPDY_CTL_FRAME_BUFFER_SIZE</span>&nbsp; &nbsp;&nbsp; </span><span class="Constant">16<br/></li>
<li></span><br/></li>
<li><a id="L63">&#x200c;</a><span class="PreProc">#define <span class="linkable">NGX_SPDY_PROTOCOL_ERROR</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">1<br/></li>
<li><a id="L64">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_SPDY_INVALID_STREAM</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">2<br/></li>
<li><a id="L65">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_SPDY_REFUSED_STREAM</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">3<br/></li>
<li><a id="L66">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_SPDY_UNSUPPORTED_VERSION</span>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">4<br/></li>
<li><a id="L67">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_SPDY_CANCEL</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">5<br/></li>
<li><a id="L68">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_SPDY_INTERNAL_ERROR</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">6<br/></li>
<li><a id="L69">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_SPDY_FLOW_CONTROL_ERROR</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">7<br/></li>
<li><a id="L70">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_SPDY_STREAM_IN_USE</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">8<br/></li>
<li><a id="L71">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_SPDY_STREAM_ALREADY_CLOSED</span>&nbsp; &nbsp;&nbsp; </span><span class="Constant">9<br/></li>
<li></span><span class="Comment">/* deprecated&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10 */<br/></li>
<li><a id="L73">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_SPDY_FRAME_TOO_LARGE</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">11<br/></li>
<li></span><br/></li>
<li><a id="L75">&#x200c;</a><span class="PreProc">#define <span class="linkable">NGX_SPDY_SETTINGS_MAX_STREAMS</span>&nbsp; &nbsp; &nbsp; </span><span class="Constant">4<br/></li>
<li><a id="L76">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_SPDY_SETTINGS_INIT_WINDOW</span>&nbsp; &nbsp; &nbsp; </span><span class="Constant">7<br/></li>
<li></span><br/></li>
<li><a id="L78">&#x200c;</a><span class="PreProc">#define <span class="linkable">NGX_SPDY_SETTINGS_FLAG_PERSIST</span>&nbsp; &nbsp;&nbsp; </span><span class="Constant">0x01<br/></li>
<li><a id="L79">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_SPDY_SETTINGS_FLAG_PERSISTED</span>&nbsp;&nbsp; </span><span class="Constant">0x02<br/></li>
<li></span><br/></li>
<li><a id="L81">&#x200c;</a><span class="PreProc">#define <span class="linkable">NGX_SPDY_MAX_WINDOW</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_config.h.html#L131" title="core/ngx_config.h:131">NGX_MAX_INT32_VALUE</a><br/></li>
<li><a id="L82">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_SPDY_CONNECTION_WINDOW</span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">65536<br/></li>
<li><a id="L83">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_SPDY_INIT_STREAM_WINDOW</span>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Constant">65536<br/></li>
<li><a id="L84">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_SPDY_STREAM_WINDOW</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L81" title="http/ngx_http_spdy.c:81">NGX_SPDY_MAX_WINDOW</a><br/></li>
<li></span><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct</span> {<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; hash;<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; header[<span class="Constant">7</span>];<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp;&nbsp; (*handler)(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r);<br/></li>
<li><a id="L91">&#x200c;</a>} <span class="linkable">ngx_http_spdy_request_header_t</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L517" title="http/ngx_http_spdy.c:517">ngx_http_spdy_read_handler</a>(<a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a> *rev);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L607" title="http/ngx_http_spdy.c:607">ngx_http_spdy_write_handler</a>(<a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a> *wev);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L758" title="http/ngx_http_spdy.c:758">ngx_http_spdy_handle_connection</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<a href="#L818" title="http/ngx_http_spdy.c:818">ngx_http_spdy_proxy_protocol</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L839" title="http/ngx_http_spdy.c:839">ngx_http_spdy_state_head</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L918" title="http/ngx_http_spdy.c:918">ngx_http_spdy_state_syn_stream</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L1005" title="http/ngx_http_spdy.c:1005">ngx_http_spdy_state_headers</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L1244" title="http/ngx_http_spdy.c:1244">ngx_http_spdy_state_headers_skip</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L1298" title="http/ngx_http_spdy.c:1298">ngx_http_spdy_state_headers_error</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L1325" title="http/ngx_http_spdy.c:1325">ngx_http_spdy_state_window_update</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L1439" title="http/ngx_http_spdy.c:1439">ngx_http_spdy_state_data</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L1531" title="http/ngx_http_spdy.c:1531">ngx_http_spdy_state_read_data</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L1701" title="http/ngx_http_spdy.c:1701">ngx_http_spdy_state_rst_stream</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L1776" title="http/ngx_http_spdy.c:1776">ngx_http_spdy_state_ping</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L1825" title="http/ngx_http_spdy.c:1825">ngx_http_spdy_state_skip</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L1846" title="http/ngx_http_spdy.c:1846">ngx_http_spdy_state_settings</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L1930" title="http/ngx_http_spdy.c:1930">ngx_http_spdy_state_complete</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end, <a href="ngx_http_spdy.h.html#L75" title="http/ngx_http_spdy.h:75">ngx_http_spdy_handler_pt</a> handler);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<a href="#L1982" title="http/ngx_http_spdy.c:1982">ngx_http_spdy_state_inflate_error</a>(<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, <span class="Type">int</span> rc);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc);<br/></li>
<li><span class="Type">static</span> u_char *<a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L2034" title="http/ngx_http_spdy.c:2034">ngx_http_spdy_send_window_update</a>(<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> sid, <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> delta);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L2069" title="http/ngx_http_spdy.c:2069">ngx_http_spdy_send_rst_stream</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> sid, <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> status, <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> priority);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L2143" title="http/ngx_http_spdy.c:2143">ngx_http_spdy_send_settings</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L2214" title="http/ngx_http_spdy.c:2214">ngx_http_spdy_settings_frame_handler</a>(<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, <a href="ngx_http_spdy.h.html#L72" title="http/ngx_http_spdy.h:72">ngx_http_spdy_out_frame_t</a> *frame);<br/></li>
<li><span class="Type">static</span> <a href="ngx_http_spdy.h.html#L72" title="http/ngx_http_spdy.h:72">ngx_http_spdy_out_frame_t</a> *<a href="#L2232" title="http/ngx_http_spdy.c:2232">ngx_http_spdy_get_ctl_frame</a>(<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, <span class="Type">size_t</span> size, <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> priority);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L2289" title="http/ngx_http_spdy.c:2289">ngx_http_spdy_ctl_frame_handler</a>(<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, <a href="ngx_http_spdy.h.html#L72" title="http/ngx_http_spdy.h:72">ngx_http_spdy_out_frame_t</a> *frame);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a> *<a href="#L2308" title="http/ngx_http_spdy.c:2308">ngx_http_spdy_create_stream</a>(<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> id, <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> priority);<br/></li>
<li><span class="Type">static</span> <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a> *<a href="#L2439" title="http/ngx_http_spdy.c:2439">ngx_http_spdy_get_stream_by_id</a>(<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> sid);<br/></li>
<li><a id="L152">&#x200c;</a><span class="PreProc">#define <span class="linkable">ngx_http_spdy_streams_index_size</span>(sscf)&nbsp; (sscf-&gt;streams_index_mask + </span><span class="Constant">1</span><span class="PreProc">)<br/></li>
<li><a id="L153">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">ngx_http_spdy_stream_index</span>(sscf, sid)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; ((sid &gt;&gt; </span><span class="Constant">1</span><span class="PreProc">) &amp; sscf-&gt;streams_index_mask)<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L2463" title="http/ngx_http_spdy.c:2463">ngx_http_spdy_parse_header</a>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L2636" title="http/ngx_http_spdy.c:2636">ngx_http_spdy_alloc_large_header_buffer</a>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L2705" title="http/ngx_http_spdy.c:2705">ngx_http_spdy_handle_request_header</a>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L2782" title="http/ngx_http_spdy.c:2782">ngx_http_spdy_parse_method</a>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L2871" title="http/ngx_http_spdy.c:2871">ngx_http_spdy_parse_scheme</a>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L2888" title="http/ngx_http_spdy.c:2888">ngx_http_spdy_parse_host</a>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L2921" title="http/ngx_http_spdy.c:2921">ngx_http_spdy_parse_path</a>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L2954" title="http/ngx_http_spdy.c:2954">ngx_http_spdy_parse_version</a>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L3034" title="http/ngx_http_spdy.c:3034">ngx_http_spdy_construct_request_line</a>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L3077" title="http/ngx_http_spdy.c:3077">ngx_http_spdy_run_request</a>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L3141" title="http/ngx_http_spdy.c:3141">ngx_http_spdy_init_request_body</a>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L3276" title="http/ngx_http_spdy.c:3276">ngx_http_spdy_terminate_stream</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a> *stream, <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> status);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L3302" title="http/ngx_http_spdy.c:3302">ngx_http_spdy_close_stream_handler</a>(<a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a> *ev);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L3472" title="http/ngx_http_spdy.c:3472">ngx_http_spdy_handle_connection_handler</a>(<a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a> *rev);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L3490" title="http/ngx_http_spdy.c:3490">ngx_http_spdy_keepalive_handler</a>(<a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a> *rev);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L3556" title="http/ngx_http_spdy.c:3556">ngx_http_spdy_finalize_connection</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> rc);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L3625" title="http/ngx_http_spdy.c:3625">ngx_http_spdy_adjust_windows</a>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">ssize_t</span> delta);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L3680" title="http/ngx_http_spdy.c:3680">ngx_http_spdy_pool_cleanup</a>(<span class="Type">void</span> *data);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> *<a href="#L3691" title="http/ngx_http_spdy.c:3691">ngx_http_spdy_zalloc</a>(<span class="Type">void</span> *opaque, u_int items, u_int size);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L3700" title="http/ngx_http_spdy.c:3700">ngx_http_spdy_zfree</a>(<span class="Type">void</span> *opaque, <span class="Type">void</span> *address);<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L189">&#x200c;</a><span class="Type">static</span> <span class="Type">const</span> u_char <span class="linkable">ngx_http_spdy_dict</span>[] = {<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x07</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x70</span>, <span class="Constant">0x74</span>, <span class="Constant">0x69</span>,&nbsp;&nbsp; <span class="Comment">/* - - - - o p t i */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x73</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x04</span>, <span class="Constant">0x68</span>,&nbsp;&nbsp; <span class="Comment">/* o n s - - - - h */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x61</span>, <span class="Constant">0x64</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x04</span>, <span class="Constant">0x70</span>,&nbsp;&nbsp; <span class="Comment">/* e a d - - - - p */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6f</span>, <span class="Constant">0x73</span>, <span class="Constant">0x74</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x03</span>, <span class="Constant">0x70</span>,&nbsp;&nbsp; <span class="Comment">/* o s t - - - - p */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x75</span>, <span class="Constant">0x74</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x06</span>, <span class="Constant">0x64</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* u t - - - - d e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6c</span>, <span class="Constant">0x65</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x05</span>,&nbsp;&nbsp; <span class="Comment">/* l e t e - - - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x74</span>, <span class="Constant">0x72</span>, <span class="Constant">0x61</span>, <span class="Constant">0x63</span>, <span class="Constant">0x65</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* t r a c e - - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x06</span>, <span class="Constant">0x61</span>, <span class="Constant">0x63</span>, <span class="Constant">0x63</span>, <span class="Constant">0x65</span>, <span class="Constant">0x70</span>, <span class="Constant">0x74</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* - a c c e p t - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x0e</span>, <span class="Constant">0x61</span>, <span class="Constant">0x63</span>, <span class="Constant">0x63</span>, <span class="Constant">0x65</span>, <span class="Constant">0x70</span>,&nbsp;&nbsp; <span class="Comment">/* - - - a c c e p */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x74</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x63</span>, <span class="Constant">0x68</span>, <span class="Constant">0x61</span>, <span class="Constant">0x72</span>, <span class="Constant">0x73</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* t - c h a r s e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x74</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x0f</span>, <span class="Constant">0x61</span>, <span class="Constant">0x63</span>, <span class="Constant">0x63</span>,&nbsp;&nbsp; <span class="Comment">/* t - - - - a c c */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x70</span>, <span class="Constant">0x74</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x63</span>, <span class="Constant">0x6f</span>,&nbsp;&nbsp; <span class="Comment">/* e p t - e n c o */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x64</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x67</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x0f</span>,&nbsp;&nbsp; <span class="Comment">/* d i n g - - - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x61</span>, <span class="Constant">0x63</span>, <span class="Constant">0x63</span>, <span class="Constant">0x65</span>, <span class="Constant">0x70</span>, <span class="Constant">0x74</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x6c</span>,&nbsp;&nbsp; <span class="Comment">/* a c c e p t - l */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x61</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x67</span>, <span class="Constant">0x75</span>, <span class="Constant">0x61</span>, <span class="Constant">0x67</span>, <span class="Constant">0x65</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* a n g u a g e - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x0d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x63</span>, <span class="Constant">0x63</span>, <span class="Constant">0x65</span>, <span class="Constant">0x70</span>,&nbsp;&nbsp; <span class="Comment">/* - - - a c c e p */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x74</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x72</span>, <span class="Constant">0x61</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x67</span>, <span class="Constant">0x65</span>, <span class="Constant">0x73</span>,&nbsp;&nbsp; <span class="Comment">/* t - r a n g e s */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x03</span>, <span class="Constant">0x61</span>, <span class="Constant">0x67</span>, <span class="Constant">0x65</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* - - - - a g e - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x05</span>, <span class="Constant">0x61</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x77</span>,&nbsp;&nbsp; <span class="Comment">/* - - - a l l o w */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x0d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x75</span>, <span class="Constant">0x74</span>, <span class="Constant">0x68</span>,&nbsp;&nbsp; <span class="Comment">/* - - - - a u t h */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6f</span>, <span class="Constant">0x72</span>, <span class="Constant">0x69</span>, <span class="Constant">0x7a</span>, <span class="Constant">0x61</span>, <span class="Constant">0x74</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6f</span>,&nbsp;&nbsp; <span class="Comment">/* o r i z a t i o */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6e</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x0d</span>, <span class="Constant">0x63</span>, <span class="Constant">0x61</span>, <span class="Constant">0x63</span>,&nbsp;&nbsp; <span class="Comment">/* n - - - - c a c */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x68</span>, <span class="Constant">0x65</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x63</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x72</span>,&nbsp;&nbsp; <span class="Comment">/* h e - c o n t r */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6f</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x0a</span>, <span class="Constant">0x63</span>, <span class="Constant">0x6f</span>,&nbsp;&nbsp; <span class="Comment">/* o l - - - - c o */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6e</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x65</span>, <span class="Constant">0x63</span>, <span class="Constant">0x74</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>,&nbsp;&nbsp; <span class="Comment">/* n n e c t i o n */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x0c</span>, <span class="Constant">0x63</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>,&nbsp;&nbsp; <span class="Comment">/* - - - - c o n t */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x62</span>, <span class="Constant">0x61</span>, <span class="Constant">0x73</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* e n t - b a s e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x10</span>, <span class="Constant">0x63</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>,&nbsp;&nbsp; <span class="Comment">/* - - - - c o n t */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x63</span>, <span class="Constant">0x6f</span>,&nbsp;&nbsp; <span class="Comment">/* e n t - e n c o */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x64</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x67</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x10</span>,&nbsp;&nbsp; <span class="Comment">/* d i n g - - - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x63</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x2d</span>,&nbsp;&nbsp; <span class="Comment">/* c o n t e n t - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6c</span>, <span class="Constant">0x61</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x67</span>, <span class="Constant">0x75</span>, <span class="Constant">0x61</span>, <span class="Constant">0x67</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* l a n g u a g e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x0e</span>, <span class="Constant">0x63</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>,&nbsp;&nbsp; <span class="Comment">/* - - - - c o n t */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x67</span>,&nbsp;&nbsp; <span class="Comment">/* e n t - l e n g */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x74</span>, <span class="Constant">0x68</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x10</span>, <span class="Constant">0x63</span>, <span class="Constant">0x6f</span>,&nbsp;&nbsp; <span class="Comment">/* t h - - - - c o */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x6f</span>,&nbsp;&nbsp; <span class="Comment">/* n t e n t - l o */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x63</span>, <span class="Constant">0x61</span>, <span class="Constant">0x74</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* c a t i o n - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x0b</span>, <span class="Constant">0x63</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>,&nbsp;&nbsp; <span class="Comment">/* - - c o n t e n */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x74</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x64</span>, <span class="Constant">0x35</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* t - m d 5 - - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x0d</span>, <span class="Constant">0x63</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>,&nbsp;&nbsp; <span class="Comment">/* - c o n t e n t */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x2d</span>, <span class="Constant">0x72</span>, <span class="Constant">0x61</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x67</span>, <span class="Constant">0x65</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* - r a n g e - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x0c</span>, <span class="Constant">0x63</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>,&nbsp;&nbsp; <span class="Comment">/* - - c o n t e n */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x74</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x74</span>, <span class="Constant">0x79</span>, <span class="Constant">0x70</span>, <span class="Constant">0x65</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* t - t y p e - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x04</span>, <span class="Constant">0x64</span>, <span class="Constant">0x61</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* - - d a t e - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x04</span>, <span class="Constant">0x65</span>, <span class="Constant">0x74</span>, <span class="Constant">0x61</span>, <span class="Constant">0x67</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* - - e t a g - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x06</span>, <span class="Constant">0x65</span>, <span class="Constant">0x78</span>, <span class="Constant">0x70</span>, <span class="Constant">0x65</span>, <span class="Constant">0x63</span>, <span class="Constant">0x74</span>,&nbsp;&nbsp; <span class="Comment">/* - - e x p e c t */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x07</span>, <span class="Constant">0x65</span>, <span class="Constant">0x78</span>, <span class="Constant">0x70</span>, <span class="Constant">0x69</span>,&nbsp;&nbsp; <span class="Comment">/* - - - - e x p i */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x72</span>, <span class="Constant">0x65</span>, <span class="Constant">0x73</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x04</span>, <span class="Constant">0x66</span>,&nbsp;&nbsp; <span class="Comment">/* r e s - - - - f */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x72</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x04</span>, <span class="Constant">0x68</span>,&nbsp;&nbsp; <span class="Comment">/* r o m - - - - h */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6f</span>, <span class="Constant">0x73</span>, <span class="Constant">0x74</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x08</span>, <span class="Constant">0x69</span>,&nbsp;&nbsp; <span class="Comment">/* o s t - - - - i */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x66</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x74</span>, <span class="Constant">0x63</span>, <span class="Constant">0x68</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* f - m a t c h - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x11</span>, <span class="Constant">0x69</span>, <span class="Constant">0x66</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x6f</span>,&nbsp;&nbsp; <span class="Comment">/* - - - i f - m o */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x64</span>, <span class="Constant">0x69</span>, <span class="Constant">0x66</span>, <span class="Constant">0x69</span>, <span class="Constant">0x65</span>, <span class="Constant">0x64</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x73</span>,&nbsp;&nbsp; <span class="Comment">/* d i f i e d - s */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x69</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x63</span>, <span class="Constant">0x65</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x0d</span>,&nbsp;&nbsp; <span class="Comment">/* i n c e - - - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x69</span>, <span class="Constant">0x66</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x65</span>, <span class="Constant">0x2d</span>,&nbsp;&nbsp; <span class="Comment">/* i f - n o n e - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x74</span>, <span class="Constant">0x63</span>, <span class="Constant">0x68</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* m a t c h - - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x08</span>, <span class="Constant">0x69</span>, <span class="Constant">0x66</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x72</span>, <span class="Constant">0x61</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x67</span>,&nbsp;&nbsp; <span class="Comment">/* - i f - r a n g */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x13</span>, <span class="Constant">0x69</span>, <span class="Constant">0x66</span>, <span class="Constant">0x2d</span>,&nbsp;&nbsp; <span class="Comment">/* e - - - - i f - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x75</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x64</span>, <span class="Constant">0x69</span>, <span class="Constant">0x66</span>, <span class="Constant">0x69</span>,&nbsp;&nbsp; <span class="Comment">/* u n m o d i f i */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x64</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x73</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x63</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* e d - s i n c e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x0d</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x61</span>, <span class="Constant">0x73</span>, <span class="Constant">0x74</span>,&nbsp;&nbsp; <span class="Comment">/* - - - - l a s t */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x2d</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x64</span>, <span class="Constant">0x69</span>, <span class="Constant">0x66</span>, <span class="Constant">0x69</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* - m o d i f i e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x64</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x08</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x63</span>,&nbsp;&nbsp; <span class="Comment">/* d - - - - l o c */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x61</span>, <span class="Constant">0x74</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* a t i o n - - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x0c</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x78</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x66</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x72</span>,&nbsp;&nbsp; <span class="Comment">/* - m a x - f o r */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x77</span>, <span class="Constant">0x61</span>, <span class="Constant">0x72</span>, <span class="Constant">0x64</span>, <span class="Constant">0x73</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* w a r d s - - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x06</span>, <span class="Constant">0x70</span>, <span class="Constant">0x72</span>, <span class="Constant">0x61</span>, <span class="Constant">0x67</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* - p r a g m a - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x12</span>, <span class="Constant">0x70</span>, <span class="Constant">0x72</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x78</span>, <span class="Constant">0x79</span>,&nbsp;&nbsp; <span class="Comment">/* - - - p r o x y */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x2d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x75</span>, <span class="Constant">0x74</span>, <span class="Constant">0x68</span>, <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>,&nbsp;&nbsp; <span class="Comment">/* - a u t h e n t */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x69</span>, <span class="Constant">0x63</span>, <span class="Constant">0x61</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* i c a t e - - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x13</span>, <span class="Constant">0x70</span>, <span class="Constant">0x72</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x78</span>, <span class="Constant">0x79</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x61</span>,&nbsp;&nbsp; <span class="Comment">/* - p r o x y - a */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x75</span>, <span class="Constant">0x74</span>, <span class="Constant">0x68</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x72</span>, <span class="Constant">0x69</span>, <span class="Constant">0x7a</span>, <span class="Constant">0x61</span>,&nbsp;&nbsp; <span class="Comment">/* u t h o r i z a */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x74</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x05</span>,&nbsp;&nbsp; <span class="Comment">/* t i o n - - - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x72</span>, <span class="Constant">0x61</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x67</span>, <span class="Constant">0x65</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* r a n g e - - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x07</span>, <span class="Constant">0x72</span>, <span class="Constant">0x65</span>, <span class="Constant">0x66</span>, <span class="Constant">0x65</span>, <span class="Constant">0x72</span>, <span class="Constant">0x65</span>, <span class="Constant">0x72</span>,&nbsp;&nbsp; <span class="Comment">/* - r e f e r e r */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x0b</span>, <span class="Constant">0x72</span>, <span class="Constant">0x65</span>, <span class="Constant">0x74</span>, <span class="Constant">0x72</span>,&nbsp;&nbsp; <span class="Comment">/* - - - - r e t r */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x79</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x66</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x72</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* y - a f t e r - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x06</span>, <span class="Constant">0x73</span>, <span class="Constant">0x65</span>, <span class="Constant">0x72</span>, <span class="Constant">0x76</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* - - - s e r v e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x72</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x02</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* r - - - - t e - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x07</span>, <span class="Constant">0x74</span>, <span class="Constant">0x72</span>, <span class="Constant">0x61</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6c</span>,&nbsp;&nbsp; <span class="Comment">/* - - - t r a i l */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x72</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x11</span>, <span class="Constant">0x74</span>, <span class="Constant">0x72</span>,&nbsp;&nbsp; <span class="Comment">/* e r - - - - t r */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x61</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x73</span>, <span class="Constant">0x66</span>, <span class="Constant">0x65</span>, <span class="Constant">0x72</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* a n s f e r - e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6e</span>, <span class="Constant">0x63</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x64</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x67</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* n c o d i n g - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x07</span>, <span class="Constant">0x75</span>, <span class="Constant">0x70</span>, <span class="Constant">0x67</span>, <span class="Constant">0x72</span>, <span class="Constant">0x61</span>,&nbsp;&nbsp; <span class="Comment">/* - - - u p g r a */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x64</span>, <span class="Constant">0x65</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x0a</span>, <span class="Constant">0x75</span>, <span class="Constant">0x73</span>,&nbsp;&nbsp; <span class="Comment">/* d e - - - - u s */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x72</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x67</span>, <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>,&nbsp;&nbsp; <span class="Comment">/* e r - a g e n t */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x04</span>, <span class="Constant">0x76</span>, <span class="Constant">0x61</span>, <span class="Constant">0x72</span>, <span class="Constant">0x79</span>,&nbsp;&nbsp; <span class="Comment">/* - - - - v a r y */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x03</span>, <span class="Constant">0x76</span>, <span class="Constant">0x69</span>, <span class="Constant">0x61</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* - - - - v i a - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x07</span>, <span class="Constant">0x77</span>, <span class="Constant">0x61</span>, <span class="Constant">0x72</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x69</span>,&nbsp;&nbsp; <span class="Comment">/* - - - w a r n i */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6e</span>, <span class="Constant">0x67</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x10</span>, <span class="Constant">0x77</span>, <span class="Constant">0x77</span>,&nbsp;&nbsp; <span class="Comment">/* n g - - - - w w */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x77</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x75</span>, <span class="Constant">0x74</span>, <span class="Constant">0x68</span>, <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>,&nbsp;&nbsp; <span class="Comment">/* w - a u t h e n */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x74</span>, <span class="Constant">0x69</span>, <span class="Constant">0x63</span>, <span class="Constant">0x61</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* t i c a t e - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x06</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x65</span>, <span class="Constant">0x74</span>, <span class="Constant">0x68</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x64</span>,&nbsp;&nbsp; <span class="Comment">/* - - m e t h o d */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x03</span>, <span class="Constant">0x67</span>, <span class="Constant">0x65</span>, <span class="Constant">0x74</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* - - - - g e t - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x06</span>, <span class="Constant">0x73</span>, <span class="Constant">0x74</span>, <span class="Constant">0x61</span>, <span class="Constant">0x74</span>, <span class="Constant">0x75</span>,&nbsp;&nbsp; <span class="Comment">/* - - - s t a t u */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x73</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x06</span>, <span class="Constant">0x32</span>, <span class="Constant">0x30</span>, <span class="Constant">0x30</span>,&nbsp;&nbsp; <span class="Comment">/* s - - - - 2 0 0 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x20</span>, <span class="Constant">0x4f</span>, <span class="Constant">0x4b</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x07</span>, <span class="Constant">0x76</span>,&nbsp;&nbsp; <span class="Comment">/* - O K - - - - v */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x72</span>, <span class="Constant">0x73</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* e r s i o n - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x08</span>, <span class="Constant">0x48</span>, <span class="Constant">0x54</span>, <span class="Constant">0x54</span>, <span class="Constant">0x50</span>, <span class="Constant">0x2f</span>, <span class="Constant">0x31</span>,&nbsp;&nbsp; <span class="Comment">/* - - <a href="../core/ngx_md5.c.html#L128" title="core/ngx_md5.c:128">H</a> T T P - 1 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x2e</span>, <span class="Constant">0x31</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x03</span>, <span class="Constant">0x75</span>, <span class="Constant">0x72</span>,&nbsp;&nbsp; <span class="Comment">/* - 1 - - - - u r */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6c</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x06</span>, <span class="Constant">0x70</span>, <span class="Constant">0x75</span>, <span class="Constant">0x62</span>,&nbsp;&nbsp; <span class="Comment">/* l - - - - p u b */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6c</span>, <span class="Constant">0x69</span>, <span class="Constant">0x63</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x0a</span>, <span class="Constant">0x73</span>,&nbsp;&nbsp; <span class="Comment">/* l i c - - - - s */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x74</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x63</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6b</span>, <span class="Constant">0x69</span>,&nbsp;&nbsp; <span class="Comment">/* e t - c o o k i */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x0a</span>, <span class="Constant">0x6b</span>, <span class="Constant">0x65</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* e - - - - k e e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x70</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x69</span>, <span class="Constant">0x76</span>, <span class="Constant">0x65</span>, <span class="Constant">0x00</span>,&nbsp;&nbsp; <span class="Comment">/* p - a l i v e - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x00</span>, <span class="Constant">0x00</span>, <span class="Constant">0x06</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x72</span>, <span class="Constant">0x69</span>, <span class="Constant">0x67</span>, <span class="Constant">0x69</span>,&nbsp;&nbsp; <span class="Comment">/* - - - o r i g i */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6e</span>, <span class="Constant">0x31</span>, <span class="Constant">0x30</span>, <span class="Constant">0x30</span>, <span class="Constant">0x31</span>, <span class="Constant">0x30</span>, <span class="Constant">0x31</span>, <span class="Constant">0x32</span>,&nbsp;&nbsp; <span class="Comment">/* n 1 0 0 1 0 1 2 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x30</span>, <span class="Constant">0x31</span>, <span class="Constant">0x32</span>, <span class="Constant">0x30</span>, <span class="Constant">0x32</span>, <span class="Constant">0x32</span>, <span class="Constant">0x30</span>, <span class="Constant">0x35</span>,&nbsp;&nbsp; <span class="Comment">/* 0 1 2 0 2 2 0 5 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x32</span>, <span class="Constant">0x30</span>, <span class="Constant">0x36</span>, <span class="Constant">0x33</span>, <span class="Constant">0x30</span>, <span class="Constant">0x30</span>, <span class="Constant">0x33</span>, <span class="Constant">0x30</span>,&nbsp;&nbsp; <span class="Comment">/* 2 0 6 3 0 0 3 0 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x32</span>, <span class="Constant">0x33</span>, <span class="Constant">0x30</span>, <span class="Constant">0x33</span>, <span class="Constant">0x33</span>, <span class="Constant">0x30</span>, <span class="Constant">0x34</span>, <span class="Constant">0x33</span>,&nbsp;&nbsp; <span class="Comment">/* 2 3 0 3 3 0 4 3 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x30</span>, <span class="Constant">0x35</span>, <span class="Constant">0x33</span>, <span class="Constant">0x30</span>, <span class="Constant">0x36</span>, <span class="Constant">0x33</span>, <span class="Constant">0x30</span>, <span class="Constant">0x37</span>,&nbsp;&nbsp; <span class="Comment">/* 0 5 3 0 6 3 0 7 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x34</span>, <span class="Constant">0x30</span>, <span class="Constant">0x32</span>, <span class="Constant">0x34</span>, <span class="Constant">0x30</span>, <span class="Constant">0x35</span>, <span class="Constant">0x34</span>, <span class="Constant">0x30</span>,&nbsp;&nbsp; <span class="Comment">/* 4 0 2 4 0 5 4 0 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x36</span>, <span class="Constant">0x34</span>, <span class="Constant">0x30</span>, <span class="Constant">0x37</span>, <span class="Constant">0x34</span>, <span class="Constant">0x30</span>, <span class="Constant">0x38</span>, <span class="Constant">0x34</span>,&nbsp;&nbsp; <span class="Comment">/* 6 4 0 7 4 0 8 4 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x30</span>, <span class="Constant">0x39</span>, <span class="Constant">0x34</span>, <span class="Constant">0x31</span>, <span class="Constant">0x30</span>, <span class="Constant">0x34</span>, <span class="Constant">0x31</span>, <span class="Constant">0x31</span>,&nbsp;&nbsp; <span class="Comment">/* 0 9 4 1 0 4 1 1 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x34</span>, <span class="Constant">0x31</span>, <span class="Constant">0x32</span>, <span class="Constant">0x34</span>, <span class="Constant">0x31</span>, <span class="Constant">0x33</span>, <span class="Constant">0x34</span>, <span class="Constant">0x31</span>,&nbsp;&nbsp; <span class="Comment">/* 4 1 2 4 1 3 4 1 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x34</span>, <span class="Constant">0x34</span>, <span class="Constant">0x31</span>, <span class="Constant">0x35</span>, <span class="Constant">0x34</span>, <span class="Constant">0x31</span>, <span class="Constant">0x36</span>, <span class="Constant">0x34</span>,&nbsp;&nbsp; <span class="Comment">/* 4 4 1 5 4 1 6 4 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x31</span>, <span class="Constant">0x37</span>, <span class="Constant">0x35</span>, <span class="Constant">0x30</span>, <span class="Constant">0x32</span>, <span class="Constant">0x35</span>, <span class="Constant">0x30</span>, <span class="Constant">0x34</span>,&nbsp;&nbsp; <span class="Comment">/* 1 7 5 0 2 5 0 4 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x35</span>, <span class="Constant">0x30</span>, <span class="Constant">0x35</span>, <span class="Constant">0x32</span>, <span class="Constant">0x30</span>, <span class="Constant">0x33</span>, <span class="Constant">0x20</span>, <span class="Constant">0x4e</span>,&nbsp;&nbsp; <span class="Comment">/* 5 0 5 2 0 3 - N */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x41</span>, <span class="Constant">0x75</span>, <span class="Constant">0x74</span>, <span class="Constant">0x68</span>, <span class="Constant">0x6f</span>,&nbsp;&nbsp; <span class="Comment">/* o n - A u t h o */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x72</span>, <span class="Constant">0x69</span>, <span class="Constant">0x74</span>, <span class="Constant">0x61</span>, <span class="Constant">0x74</span>, <span class="Constant">0x69</span>, <span class="Constant">0x76</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* r i t a t i v e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x20</span>, <span class="Constant">0x49</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x66</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x72</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x61</span>,&nbsp;&nbsp; <span class="Comment">/* - <a href="../core/ngx_md5.c.html#L129" title="core/ngx_md5.c:129">I</a> n f o r m a */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x74</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x32</span>, <span class="Constant">0x30</span>, <span class="Constant">0x34</span>, <span class="Constant">0x20</span>,&nbsp;&nbsp; <span class="Comment">/* t i o n 2 0 4 - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x4e</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x20</span>, <span class="Constant">0x43</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* N o - C o n t e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x33</span>, <span class="Constant">0x30</span>, <span class="Constant">0x31</span>, <span class="Constant">0x20</span>, <span class="Constant">0x4d</span>, <span class="Constant">0x6f</span>,&nbsp;&nbsp; <span class="Comment">/* n t 3 0 1 - M o */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x76</span>, <span class="Constant">0x65</span>, <span class="Constant">0x64</span>, <span class="Constant">0x20</span>, <span class="Constant">0x50</span>, <span class="Constant">0x65</span>, <span class="Constant">0x72</span>, <span class="Constant">0x6d</span>,&nbsp;&nbsp; <span class="Comment">/* v e d - P e r m */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x61</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x79</span>, <span class="Constant">0x34</span>,&nbsp;&nbsp; <span class="Comment">/* a n e n t l y 4 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x30</span>, <span class="Constant">0x30</span>, <span class="Constant">0x20</span>, <span class="Constant">0x42</span>, <span class="Constant">0x61</span>, <span class="Constant">0x64</span>, <span class="Constant">0x20</span>, <span class="Constant">0x52</span>,&nbsp;&nbsp; <span class="Comment">/* 0 0 - B a d - R */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x71</span>, <span class="Constant">0x75</span>, <span class="Constant">0x65</span>, <span class="Constant">0x73</span>, <span class="Constant">0x74</span>, <span class="Constant">0x34</span>, <span class="Constant">0x30</span>,&nbsp;&nbsp; <span class="Comment">/* e q u e s t 4 0 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x31</span>, <span class="Constant">0x20</span>, <span class="Constant">0x55</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x61</span>, <span class="Constant">0x75</span>, <span class="Constant">0x74</span>, <span class="Constant">0x68</span>,&nbsp;&nbsp; <span class="Comment">/* 1 - U n a u t h */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6f</span>, <span class="Constant">0x72</span>, <span class="Constant">0x69</span>, <span class="Constant">0x7a</span>, <span class="Constant">0x65</span>, <span class="Constant">0x64</span>, <span class="Constant">0x34</span>, <span class="Constant">0x30</span>,&nbsp;&nbsp; <span class="Comment">/* o r i z e d 4 0 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x33</span>, <span class="Constant">0x20</span>, <span class="Constant">0x46</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x72</span>, <span class="Constant">0x62</span>, <span class="Constant">0x69</span>, <span class="Constant">0x64</span>,&nbsp;&nbsp; <span class="Comment">/* 3 - <a href="../core/ngx_md5.c.html#L126" title="core/ngx_md5.c:126">F</a> o r b i d */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x64</span>, <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x34</span>, <span class="Constant">0x30</span>, <span class="Constant">0x34</span>, <span class="Constant">0x20</span>, <span class="Constant">0x4e</span>,&nbsp;&nbsp; <span class="Comment">/* d e n 4 0 4 - N */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6f</span>, <span class="Constant">0x74</span>, <span class="Constant">0x20</span>, <span class="Constant">0x46</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x75</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x64</span>,&nbsp;&nbsp; <span class="Comment">/* o t - <a href="../core/ngx_md5.c.html#L126" title="core/ngx_md5.c:126">F</a> o u n d */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x35</span>, <span class="Constant">0x30</span>, <span class="Constant">0x30</span>, <span class="Constant">0x20</span>, <span class="Constant">0x49</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* 5 0 0 - <a href="../core/ngx_md5.c.html#L129" title="core/ngx_md5.c:129">I</a> n t e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x72</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x61</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x20</span>, <span class="Constant">0x53</span>, <span class="Constant">0x65</span>, <span class="Constant">0x72</span>,&nbsp;&nbsp; <span class="Comment">/* r n a l - S e r */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x76</span>, <span class="Constant">0x65</span>, <span class="Constant">0x72</span>, <span class="Constant">0x20</span>, <span class="Constant">0x45</span>, <span class="Constant">0x72</span>, <span class="Constant">0x72</span>, <span class="Constant">0x6f</span>,&nbsp;&nbsp; <span class="Comment">/* v e r - E r r o */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x72</span>, <span class="Constant">0x35</span>, <span class="Constant">0x30</span>, <span class="Constant">0x31</span>, <span class="Constant">0x20</span>, <span class="Constant">0x4e</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x74</span>,&nbsp;&nbsp; <span class="Comment">/* r 5 0 1 - N o t */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x20</span>, <span class="Constant">0x49</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x70</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x65</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* - <a href="../core/ngx_md5.c.html#L129" title="core/ngx_md5.c:129">I</a> m p l e m e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6e</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x64</span>, <span class="Constant">0x35</span>, <span class="Constant">0x30</span>, <span class="Constant">0x33</span>, <span class="Constant">0x20</span>,&nbsp;&nbsp; <span class="Comment">/* n t e d 5 0 3 - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x53</span>, <span class="Constant">0x65</span>, <span class="Constant">0x72</span>, <span class="Constant">0x76</span>, <span class="Constant">0x69</span>, <span class="Constant">0x63</span>, <span class="Constant">0x65</span>, <span class="Constant">0x20</span>,&nbsp;&nbsp; <span class="Comment">/* S e r v i c e - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x55</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x61</span>, <span class="Constant">0x76</span>, <span class="Constant">0x61</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x61</span>,&nbsp;&nbsp; <span class="Comment">/* U n a v a i l a */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x62</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x65</span>, <span class="Constant">0x4a</span>, <span class="Constant">0x61</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x20</span>, <span class="Constant">0x46</span>,&nbsp;&nbsp; <span class="Comment">/* b l e J a n - <a href="../core/ngx_md5.c.html#L126" title="core/ngx_md5.c:126">F</a> */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x62</span>, <span class="Constant">0x20</span>, <span class="Constant">0x4d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x72</span>, <span class="Constant">0x20</span>, <span class="Constant">0x41</span>,&nbsp;&nbsp; <span class="Comment">/* e b - M a r - A */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x70</span>, <span class="Constant">0x72</span>, <span class="Constant">0x20</span>, <span class="Constant">0x4d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x79</span>, <span class="Constant">0x20</span>, <span class="Constant">0x4a</span>,&nbsp;&nbsp; <span class="Comment">/* p r - M a y - J */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x75</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x20</span>, <span class="Constant">0x4a</span>, <span class="Constant">0x75</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x20</span>, <span class="Constant">0x41</span>,&nbsp;&nbsp; <span class="Comment">/* u n - J u l - A */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x75</span>, <span class="Constant">0x67</span>, <span class="Constant">0x20</span>, <span class="Constant">0x53</span>, <span class="Constant">0x65</span>, <span class="Constant">0x70</span>, <span class="Constant">0x74</span>, <span class="Constant">0x20</span>,&nbsp;&nbsp; <span class="Comment">/* u g - S e p t - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x4f</span>, <span class="Constant">0x63</span>, <span class="Constant">0x74</span>, <span class="Constant">0x20</span>, <span class="Constant">0x4e</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x76</span>, <span class="Constant">0x20</span>,&nbsp;&nbsp; <span class="Comment">/* O c t - N o v - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x44</span>, <span class="Constant">0x65</span>, <span class="Constant">0x63</span>, <span class="Constant">0x20</span>, <span class="Constant">0x30</span>, <span class="Constant">0x30</span>, <span class="Constant">0x3a</span>, <span class="Constant">0x30</span>,&nbsp;&nbsp; <span class="Comment">/* D e c - 0 0 - 0 */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x30</span>, <span class="Constant">0x3a</span>, <span class="Constant">0x30</span>, <span class="Constant">0x30</span>, <span class="Constant">0x20</span>, <span class="Constant">0x4d</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>,&nbsp;&nbsp; <span class="Comment">/* 0 - 0 0 - M o n */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x2c</span>, <span class="Constant">0x20</span>, <span class="Constant">0x54</span>, <span class="Constant">0x75</span>, <span class="Constant">0x65</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x20</span>, <span class="Constant">0x57</span>,&nbsp;&nbsp; <span class="Comment">/* - - T u e - - W */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x64</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x20</span>, <span class="Constant">0x54</span>, <span class="Constant">0x68</span>, <span class="Constant">0x75</span>, <span class="Constant">0x2c</span>,&nbsp;&nbsp; <span class="Comment">/* e d - - T h u - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x20</span>, <span class="Constant">0x46</span>, <span class="Constant">0x72</span>, <span class="Constant">0x69</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x20</span>, <span class="Constant">0x53</span>, <span class="Constant">0x61</span>,&nbsp;&nbsp; <span class="Comment">/* - <a href="../core/ngx_md5.c.html#L126" title="core/ngx_md5.c:126">F</a> r i - - S a */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x74</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x20</span>, <span class="Constant">0x53</span>, <span class="Constant">0x75</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x20</span>,&nbsp;&nbsp; <span class="Comment">/* t - - S u n - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x47</span>, <span class="Constant">0x4d</span>, <span class="Constant">0x54</span>, <span class="Constant">0x63</span>, <span class="Constant">0x68</span>, <span class="Constant">0x75</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x6b</span>,&nbsp;&nbsp; <span class="Comment">/* <a href="../core/ngx_md5.c.html#L127" title="core/ngx_md5.c:127">G</a> M T c h u n k */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x64</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x78</span>, <span class="Constant">0x74</span>, <span class="Constant">0x2f</span>,&nbsp;&nbsp; <span class="Comment">/* e d - t e x t - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x68</span>, <span class="Constant">0x74</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x61</span>,&nbsp;&nbsp; <span class="Comment">/* h t m l - i m a */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x67</span>, <span class="Constant">0x65</span>, <span class="Constant">0x2f</span>, <span class="Constant">0x70</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x67</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x69</span>,&nbsp;&nbsp; <span class="Comment">/* g e - p n g - i */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x67</span>, <span class="Constant">0x65</span>, <span class="Constant">0x2f</span>, <span class="Constant">0x6a</span>, <span class="Constant">0x70</span>, <span class="Constant">0x67</span>,&nbsp;&nbsp; <span class="Comment">/* m a g e - j p g */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x2c</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x67</span>, <span class="Constant">0x65</span>, <span class="Constant">0x2f</span>, <span class="Constant">0x67</span>,&nbsp;&nbsp; <span class="Comment">/* - i m a g e - g */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x69</span>, <span class="Constant">0x66</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x61</span>, <span class="Constant">0x70</span>, <span class="Constant">0x70</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x69</span>,&nbsp;&nbsp; <span class="Comment">/* i f - a p p l i */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x63</span>, <span class="Constant">0x61</span>, <span class="Constant">0x74</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x2f</span>, <span class="Constant">0x78</span>,&nbsp;&nbsp; <span class="Comment">/* c a t i o n - x */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x6d</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x61</span>, <span class="Constant">0x70</span>, <span class="Constant">0x70</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x69</span>,&nbsp;&nbsp; <span class="Comment">/* m l - a p p l i */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x63</span>, <span class="Constant">0x61</span>, <span class="Constant">0x74</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x2f</span>, <span class="Constant">0x78</span>,&nbsp;&nbsp; <span class="Comment">/* c a t i o n - x */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x68</span>, <span class="Constant">0x74</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x2b</span>, <span class="Constant">0x78</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x6c</span>,&nbsp;&nbsp; <span class="Comment">/* h t m l - x m l */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x2c</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x78</span>, <span class="Constant">0x74</span>, <span class="Constant">0x2f</span>, <span class="Constant">0x70</span>, <span class="Constant">0x6c</span>,&nbsp;&nbsp; <span class="Comment">/* - t e x t - p l */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x61</span>, <span class="Constant">0x69</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x78</span>, <span class="Constant">0x74</span>,&nbsp;&nbsp; <span class="Comment">/* a i n - t e x t */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x2f</span>, <span class="Constant">0x6a</span>, <span class="Constant">0x61</span>, <span class="Constant">0x76</span>, <span class="Constant">0x61</span>, <span class="Constant">0x73</span>, <span class="Constant">0x63</span>, <span class="Constant">0x72</span>,&nbsp;&nbsp; <span class="Comment">/* - j a v a s c r */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x69</span>, <span class="Constant">0x70</span>, <span class="Constant">0x74</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x70</span>, <span class="Constant">0x75</span>, <span class="Constant">0x62</span>, <span class="Constant">0x6c</span>,&nbsp;&nbsp; <span class="Comment">/* i p t - p u b l */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x69</span>, <span class="Constant">0x63</span>, <span class="Constant">0x70</span>, <span class="Constant">0x72</span>, <span class="Constant">0x69</span>, <span class="Constant">0x76</span>, <span class="Constant">0x61</span>, <span class="Constant">0x74</span>,&nbsp;&nbsp; <span class="Comment">/* i c p r i v a t */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x65</span>, <span class="Constant">0x6d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x78</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x61</span>, <span class="Constant">0x67</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* e m a x - a g e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x3d</span>, <span class="Constant">0x67</span>, <span class="Constant">0x7a</span>, <span class="Constant">0x69</span>, <span class="Constant">0x70</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x64</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* - g z i p - d e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x66</span>, <span class="Constant">0x6c</span>, <span class="Constant">0x61</span>, <span class="Constant">0x74</span>, <span class="Constant">0x65</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x73</span>, <span class="Constant">0x64</span>,&nbsp;&nbsp; <span class="Comment">/* f l a t e - s d */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x63</span>, <span class="Constant">0x68</span>, <span class="Constant">0x63</span>, <span class="Constant">0x68</span>, <span class="Constant">0x61</span>, <span class="Constant">0x72</span>, <span class="Constant">0x73</span>, <span class="Constant">0x65</span>,&nbsp;&nbsp; <span class="Comment">/* c h c h a r s e */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x74</span>, <span class="Constant">0x3d</span>, <span class="Constant">0x75</span>, <span class="Constant">0x74</span>, <span class="Constant">0x66</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x38</span>, <span class="Constant">0x63</span>,&nbsp;&nbsp; <span class="Comment">/* t - u t f - 8 c */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x68</span>, <span class="Constant">0x61</span>, <span class="Constant">0x72</span>, <span class="Constant">0x73</span>, <span class="Constant">0x65</span>, <span class="Constant">0x74</span>, <span class="Constant">0x3d</span>, <span class="Constant">0x69</span>,&nbsp;&nbsp; <span class="Comment">/* h a r s e t - i */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x73</span>, <span class="Constant">0x6f</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x38</span>, <span class="Constant">0x38</span>, <span class="Constant">0x35</span>, <span class="Constant">0x39</span>, <span class="Constant">0x2d</span>,&nbsp;&nbsp; <span class="Comment">/* s o - 8 8 5 9 - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x31</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x75</span>, <span class="Constant">0x74</span>, <span class="Constant">0x66</span>, <span class="Constant">0x2d</span>, <span class="Constant">0x2c</span>, <span class="Constant">0x2a</span>,&nbsp;&nbsp; <span class="Comment">/* 1 - u t f - - - */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">0x2c</span>, <span class="Constant">0x65</span>, <span class="Constant">0x6e</span>, <span class="Constant">0x71</span>, <span class="Constant">0x3d</span>, <span class="Constant">0x30</span>, <span class="Constant">0x2e</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* - e n q - 0 -&nbsp;&nbsp; */<br/></li>
<li></span>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L371">&#x200c;</a><span class="Type">static</span> <a href="#L91" title="http/ngx_http_spdy.c:91">ngx_http_spdy_request_header_t</a> <span class="linkable">ngx_http_spdy_request_headers</span>[] = {<br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">0</span>, <span class="Constant">6</span>, <span class="Constant">&quot;method&quot;</span>, <a href="#L2782" title="http/ngx_http_spdy.c:2782">ngx_http_spdy_parse_method</a> },<br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">0</span>, <span class="Constant">6</span>, <span class="Constant">&quot;scheme&quot;</span>, <a href="#L2871" title="http/ngx_http_spdy.c:2871">ngx_http_spdy_parse_scheme</a> },<br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">0</span>, <span class="Constant">4</span>, <span class="Constant">&quot;host&quot;</span>, <a href="#L2888" title="http/ngx_http_spdy.c:2888">ngx_http_spdy_parse_host</a> },<br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">0</span>, <span class="Constant">4</span>, <span class="Constant">&quot;path&quot;</span>, <a href="#L2921" title="http/ngx_http_spdy.c:2921">ngx_http_spdy_parse_path</a> },<br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">0</span>, <span class="Constant">7</span>, <span class="Constant">&quot;version&quot;</span>, <a href="#L2954" title="http/ngx_http_spdy.c:2954">ngx_http_spdy_parse_version</a> },<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><a id="L379">&#x200c;</a><span class="PreProc">#define <span class="linkable">NGX_SPDY_REQUEST_HEADERS</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp; (</span><span class="Statement">sizeof</span><span class="PreProc">(<a href="#L371" title="http/ngx_http_spdy.c:371">ngx_http_spdy_request_headers</a>)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \<br/></li>
<li></span><span class="PreProc">&nbsp; &nbsp;&nbsp; / </span><span class="Statement">sizeof</span><span class="PreProc">(<a href="#L91" title="http/ngx_http_spdy.c:91">ngx_http_spdy_request_header_t</a>))<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L385">&#x200c;</a></span><span class="linkable">ngx_http_spdy_init</span>(<a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a> *rev)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rc;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *c;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_palloc.h.html#L32" title="core/ngx_palloc.h:32">ngx_pool_cleanup_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *cln;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_request.h.html#L315" title="http/ngx_http_request.h:315">ngx_http_connection_t</a>&nbsp; &nbsp; &nbsp;&nbsp; *hc;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy_module.h.html#L30" title="http/ngx_http_spdy_module.h:30">ngx_http_spdy_srv_conf_t</a>&nbsp; &nbsp; *sscf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy_module.h.html#L20" title="http/ngx_http_spdy_module.h:20">ngx_http_spdy_main_conf_t</a>&nbsp;&nbsp; *smcf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a>&nbsp; *sc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c = rev-&gt;data;<br/></li>
<li>&nbsp; &nbsp; hc = c-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, c-&gt;log, <span class="Constant">0</span>, <span class="Constant">&quot;init spdy request&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c-&gt;log-&gt;action = <span class="Constant">&quot;processing SPDY&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; smcf = <a href="ngx_http_config.h.html#L55" title="http/ngx_http_config.h:55">ngx_http_get_module_main_conf</a>(hc-&gt;conf_ctx, <a href="ngx_http_spdy_module.c.html#L131" title="http/ngx_http_spdy_module.c:131">ngx_http_spdy_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (smcf-&gt;recv_buffer == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; smcf-&gt;recv_buffer = <a href="../core/ngx_palloc.c.html#L120" title="core/ngx_palloc.c:120">ngx_palloc</a>(<a href="../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;pool, smcf-&gt;recv_buffer_size);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (smcf-&gt;recv_buffer == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc = <a href="../core/ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(c-&gt;pool, <span class="Statement">sizeof</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;connection = c;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;http_connection = hc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;send_window = <a href="#L82" title="http/ngx_http_spdy.c:82">NGX_SPDY_CONNECTION_WINDOW</a>;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;recv_window = <a href="#L82" title="http/ngx_http_spdy.c:82">NGX_SPDY_CONNECTION_WINDOW</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;init_window = <a href="#L83" title="http/ngx_http_spdy.c:83">NGX_SPDY_INIT_STREAM_WINDOW</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;handler = hc-&gt;proxy_protocol ? <a href="#L818" title="http/ngx_http_spdy.c:818">ngx_http_spdy_proxy_protocol</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; : <a href="#L839" title="http/ngx_http_spdy.c:839">ngx_http_spdy_state_head</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;zstream_in.zalloc = <a href="#L3691" title="http/ngx_http_spdy.c:3691">ngx_http_spdy_zalloc</a>;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;zstream_in.zfree = <a href="#L3700" title="http/ngx_http_spdy.c:3700">ngx_http_spdy_zfree</a>;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;zstream_in.opaque = sc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rc = inflateInit(&amp;sc-&gt;zstream_in);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rc != Z_OK) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, c-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;inflateInit() failed: </span><span class="Special">%d</span><span class="Constant">&quot;</span>, rc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;zstream_out.zalloc = <a href="#L3691" title="http/ngx_http_spdy.c:3691">ngx_http_spdy_zalloc</a>;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;zstream_out.zfree = <a href="#L3700" title="http/ngx_http_spdy.c:3700">ngx_http_spdy_zfree</a>;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;zstream_out.opaque = sc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sscf = <a href="ngx_http_config.h.html#L57" title="http/ngx_http_config.h:57">ngx_http_get_module_srv_conf</a>(hc-&gt;conf_ctx, <a href="ngx_http_spdy_module.c.html#L131" title="http/ngx_http_spdy_module.c:131">ngx_http_spdy_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rc = deflateInit2(&amp;sc-&gt;zstream_out, (<span class="Type">int</span>) sscf-&gt;headers_comp,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Z_DEFLATED, <span class="Constant">11</span>, <span class="Constant">4</span>, Z_DEFAULT_STRATEGY);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rc != Z_OK) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, c-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;deflateInit2() failed: </span><span class="Special">%d</span><span class="Constant">&quot;</span>, rc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rc = deflateSetDictionary(&amp;sc-&gt;zstream_out, <a href="#L189" title="http/ngx_http_spdy.c:189">ngx_http_spdy_dict</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<a href="#L189" title="http/ngx_http_spdy.c:189">ngx_http_spdy_dict</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rc != Z_OK) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, c-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;deflateSetDictionary() failed: </span><span class="Special">%d</span><span class="Constant">&quot;</span>, rc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;pool = <a href="../core/ngx_palloc.c.html#L17" title="core/ngx_palloc.c:17">ngx_create_pool</a>(sscf-&gt;pool_size, sc-&gt;connection-&gt;log);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;pool == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cln = <a href="../core/ngx_palloc.c.html#L314" title="core/ngx_palloc.c:314">ngx_pool_cleanup_add</a>(c-&gt;pool, <span class="Statement">sizeof</span>(<a href="../core/ngx_palloc.h.html#L72" title="core/ngx_palloc.h:72">ngx_pool_cleanup_file_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cln == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cln-&gt;handler = <a href="#L3680" title="http/ngx_http_spdy.c:3680">ngx_http_spdy_pool_cleanup</a>;<br/></li>
<li>&nbsp; &nbsp; cln-&gt;data = sc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;streams_index = <a href="../core/ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(sc-&gt;pool,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L152" title="http/ngx_http_spdy.c:152">ngx_http_spdy_streams_index_size</a>(sscf)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * <span class="Statement">sizeof</span>(<a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a> *));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;streams_index == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2143" title="http/ngx_http_spdy.c:2143">ngx_http_spdy_send_settings</a>(sc) == <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2034" title="http/ngx_http_spdy.c:2034">ngx_http_spdy_send_window_update</a>(sc, <span class="Constant">0</span>, <a href="#L81" title="http/ngx_http_spdy.c:81">NGX_SPDY_MAX_WINDOW</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - sc-&gt;recv_window)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; == <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;recv_window = <a href="#L81" title="http/ngx_http_spdy.c:81">NGX_SPDY_MAX_WINDOW</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_queue.h.html#L24" title="core/ngx_queue.h:24">ngx_queue_init</a>(&amp;sc-&gt;waiting);<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_queue.h.html#L24" title="core/ngx_queue.h:24">ngx_queue_init</a>(&amp;sc-&gt;posted);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c-&gt;data = sc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rev-&gt;handler = <a href="#L517" title="http/ngx_http_spdy.c:517">ngx_http_spdy_read_handler</a>;<br/></li>
<li>&nbsp; &nbsp; c-&gt;write-&gt;handler = <a href="#L607" title="http/ngx_http_spdy.c:607">ngx_http_spdy_write_handler</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L517" title="http/ngx_http_spdy.c:517">ngx_http_spdy_read_handler</a>(rev);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L517">&#x200c;</a></span><span class="linkable">ngx_http_spdy_read_handler</span>(<a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a> *rev)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p, *end;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; available;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">ssize_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *c;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy_module.h.html#L20" title="http/ngx_http_spdy_module.h:20">ngx_http_spdy_main_conf_t</a>&nbsp;&nbsp; *smcf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a>&nbsp; *sc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c = rev-&gt;data;<br/></li>
<li>&nbsp; &nbsp; sc = c-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rev-&gt;timedout) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, c-&gt;log, <a href="../os/unix/ngx_errno.h.html#L43" title="os/unix/ngx_errno.h:43">NGX_ETIMEDOUT</a>, <span class="Constant">&quot;client timed out&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L3556" title="http/ngx_http_spdy.c:3556">ngx_http_spdy_finalize_connection</a>(sc, <a href="ngx_http_request.h.html#L89" title="http/ngx_http_request.h:89">NGX_HTTP_REQUEST_TIME_OUT</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, c-&gt;log, <span class="Constant">0</span>, <span class="Constant">&quot;spdy read handler&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;blocked = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; smcf = <a href="ngx_http_config.h.html#L55" title="http/ngx_http_config.h:55">ngx_http_get_module_main_conf</a>(sc-&gt;http_connection-&gt;conf_ctx,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="ngx_http_spdy_module.c.html#L131" title="http/ngx_http_spdy_module.c:131">ngx_http_spdy_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; available = smcf-&gt;recv_buffer_size - <span class="Constant">2</span> * <a href="ngx_http_spdy.h.html#L23" title="http/ngx_http_spdy.h:23">NGX_SPDY_STATE_BUFFER_SIZE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = smcf-&gt;recv_buffer;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_string.c.html#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(p, sc-&gt;buffer, <a href="ngx_http_spdy.h.html#L23" title="http/ngx_http_spdy.h:23">NGX_SPDY_STATE_BUFFER_SIZE</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; end = p + sc-&gt;buffer_used;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = c-&gt;recv(c, end, available);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n == <a href="../core/ngx_core.h.html#L31" title="core/ngx_core.h:31">NGX_AGAIN</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span> &amp;&amp; (sc-&gt;incomplete || sc-&gt;processing)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, c-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client prematurely closed connection&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span> || n == <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L3556" title="http/ngx_http_spdy.c:3556">ngx_http_spdy_finalize_connection</a>(sc,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.h.html#L125" title="http/ngx_http_request.h:125">NGX_HTTP_CLIENT_CLOSED_REQUEST</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; end += n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;buffer_used = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;incomplete = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = sc-&gt;handler(sc, p, end);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> (p != end);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">while</span> (rev-&gt;ready);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../event/ngx_event.c.html#L270" title="event/ngx_event.c:270">ngx_handle_read_event</a>(rev, <span class="Constant">0</span>) != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L3556" title="http/ngx_http_spdy.c:3556">ngx_http_spdy_finalize_connection</a>(sc, <a href="ngx_http_request.h.html#L128" title="http/ngx_http_request.h:128">NGX_HTTP_INTERNAL_SERVER_ERROR</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;last_out &amp;&amp; <a href="#L663" title="http/ngx_http_spdy.c:663">ngx_http_spdy_send_output_queue</a>(sc) == <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L3556" title="http/ngx_http_spdy.c:3556">ngx_http_spdy_finalize_connection</a>(sc, <a href="ngx_http_request.h.html#L125" title="http/ngx_http_request.h:125">NGX_HTTP_CLIENT_CLOSED_REQUEST</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;blocked = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;processing) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rev-&gt;timer_set) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../event/ngx_event.h.html#L428" title="event/ngx_event.h:428">ngx_del_timer</a>(rev);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L758" title="http/ngx_http_spdy.c:758">ngx_http_spdy_handle_connection</a>(sc);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L607">&#x200c;</a></span><span class="linkable">ngx_http_spdy_write_handler</span>(<a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a> *wev)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rc;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_queue.h.html#L16" title="core/ngx_queue.h:16">ngx_queue_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *q;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *c;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>&nbsp; &nbsp; &nbsp; *stream;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a>&nbsp; *sc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c = wev-&gt;data;<br/></li>
<li>&nbsp; &nbsp; sc = c-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (wev-&gt;timedout) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, c-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy write event timed out&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L3556" title="http/ngx_http_spdy.c:3556">ngx_http_spdy_finalize_connection</a>(sc, <a href="ngx_http_request.h.html#L125" title="http/ngx_http_request.h:125">NGX_HTTP_CLIENT_CLOSED_REQUEST</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, c-&gt;log, <span class="Constant">0</span>, <span class="Constant">&quot;spdy write handler&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;blocked = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rc = <a href="#L663" title="http/ngx_http_spdy.c:663">ngx_http_spdy_send_output_queue</a>(sc);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rc == <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L3556" title="http/ngx_http_spdy.c:3556">ngx_http_spdy_finalize_connection</a>(sc, <a href="ngx_http_request.h.html#L125" title="http/ngx_http_request.h:125">NGX_HTTP_CLIENT_CLOSED_REQUEST</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (!<a href="../core/ngx_queue.h.html#L29" title="core/ngx_queue.h:29">ngx_queue_empty</a>(&amp;sc-&gt;posted)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; q = <a href="../core/ngx_queue.h.html#L50" title="core/ngx_queue.h:50">ngx_queue_head</a>(&amp;sc-&gt;posted);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_queue.h.html#L72" title="core/ngx_queue.h:72">ngx_queue_remove</a>(q);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; stream = <a href="../core/ngx_queue.h.html#L103" title="core/ngx_queue.h:103">ngx_queue_data</a>(q, <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>, queue);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;handled = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, c-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;run spdy stream </span><span class="Special">%u</span><span class="Constant">i&quot;</span>, stream-&gt;id);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; wev = stream-&gt;request-&gt;connection-&gt;write;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; wev-&gt;handler(wev);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;blocked = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rc == <a href="../core/ngx_core.h.html#L31" title="core/ngx_core.h:31">NGX_AGAIN</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L758" title="http/ngx_http_spdy.c:758">ngx_http_spdy_handle_connection</a>(sc);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L663">&#x200c;</a><span class="linkable">ngx_http_spdy_send_output_queue</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L16" title="core/ngx_core.h:16">ngx_chain_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *cl;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *wev;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *c;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_core_module.h.html#L53" title="http/ngx_http_core_module.h:53">ngx_http_core_loc_conf_t</a>&nbsp;&nbsp; *clcf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L72" title="http/ngx_http_spdy.h:72">ngx_http_spdy_out_frame_t</a>&nbsp; *out, *frame, *fn;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c = sc-&gt;connection;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (c-&gt;error) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; wev = c-&gt;write;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!wev-&gt;ready) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cl = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; out = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (frame = sc-&gt;last_out; frame; frame = fn) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; frame-&gt;last-&gt;next = cl;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cl = frame-&gt;first;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fn = frame-&gt;next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; frame-&gt;next = out;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; out = frame;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L147" title="core/ngx_log.h:147">ngx_log_debug5</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, c-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy frame out: </span><span class="Special">%p</span><span class="Constant"> sid:</span><span class="Special">%u</span><span class="Constant">i prio:</span><span class="Special">%u</span><span class="Constant">i bl:</span><span class="Special">%d</span><span class="Constant"> len:</span><span class="Special">%u</span><span class="Constant">z&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; out, out-&gt;stream ? out-&gt;stream-&gt;id : <span class="Constant">0</span>, out-&gt;priority,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; out-&gt;blocked, out-&gt;length);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cl = c-&gt;send_chain(c, cl, <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cl == <a href="../core/ngx_buf.h.html#L120" title="core/ngx_buf.h:120">NGX_CHAIN_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c-&gt;error = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!sc-&gt;blocked) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../event/ngx_event_posted.h.html#L17" title="event/ngx_event_posted.h:17">ngx_post_event</a>(wev, &amp;<a href="../event/ngx_event_posted.c.html#L14" title="event/ngx_event_posted.c:14">ngx_posted_events</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; clcf = <a href="ngx_http_config.h.html#L58" title="http/ngx_http_config.h:58">ngx_http_get_module_loc_conf</a>(sc-&gt;http_connection-&gt;conf_ctx,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_core_module.c.html#L811" title="http/ngx_http_core_module.c:811">ngx_http_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../event/ngx_event.c.html#L338" title="event/ngx_event.c:338">ngx_handle_write_event</a>(wev, clcf-&gt;send_lowat) != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>; <span class="Comment">/* </span><span class="Todo">FIXME</span><span class="Comment"> */<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cl) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../event/ngx_event.h.html#L427" title="event/ngx_event.h:427">ngx_add_timer</a>(wev, clcf-&gt;send_timeout);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (wev-&gt;timer_set) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../event/ngx_event.h.html#L428" title="event/ngx_event.h:428">ngx_del_timer</a>(wev);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> ( <span class="Comment">/* void */</span> ; out; out = fn) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fn = out-&gt;next;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (out-&gt;handler(sc, out) != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;blocked = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out-&gt;priority = <a href="ngx_http_spdy.h.html#L57" title="http/ngx_http_spdy.h:57">NGX_SPDY_HIGHEST_PRIORITY</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L144" title="core/ngx_log.h:144">ngx_log_debug4</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, c-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy frame sent: </span><span class="Special">%p</span><span class="Constant"> sid:</span><span class="Special">%u</span><span class="Constant">i bl:</span><span class="Special">%d</span><span class="Constant"> len:</span><span class="Special">%u</span><span class="Constant">z&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; out, out-&gt;stream ? out-&gt;stream-&gt;id : <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; out-&gt;blocked, out-&gt;length);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; frame = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> ( <span class="Comment">/* void */</span> ; out; out = fn) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fn = out-&gt;next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; out-&gt;next = frame;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; frame = out;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;last_out = frame;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L758">&#x200c;</a></span><span class="linkable">ngx_http_spdy_handle_connection</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *c;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy_module.h.html#L30" title="http/ngx_http_spdy_module.h:30">ngx_http_spdy_srv_conf_t</a>&nbsp; *sscf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;last_out || sc-&gt;processing) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c = sc-&gt;connection;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (c-&gt;error) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (c-&gt;buffered) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sscf = <a href="ngx_http_config.h.html#L57" title="http/ngx_http_config.h:57">ngx_http_get_module_srv_conf</a>(sc-&gt;http_connection-&gt;conf_ctx,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_spdy_module.c.html#L131" title="http/ngx_http_spdy_module.c:131">ngx_http_spdy_module</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;incomplete) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../event/ngx_event.h.html#L427" title="event/ngx_event.h:427">ngx_add_timer</a>(c-&gt;read, sscf-&gt;recv_timeout);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/unix/ngx_process_cycle.c.html#L42" title="os/unix/ngx_process_cycle.c:42">ngx_terminate</a> || <a href="../os/unix/ngx_process_cycle.c.html#L45" title="os/unix/ngx_process_cycle.c:45">ngx_exiting</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_palloc.c.html#L45" title="core/ngx_palloc.c:45">ngx_destroy_pool</a>(sc-&gt;pool);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;pool = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;free_ctl_frames = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;free_fake_connections = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HTTP_SSL)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (c-&gt;ssl) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../event/ngx_event_openssl.c.html#L1738" title="event/ngx_event_openssl.c:1738">ngx_ssl_free_buffer</a>(c);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; c-&gt;destroyed = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; c-&gt;idle = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_connection.c.html#L1011" title="core/ngx_connection.c:1011">ngx_reusable_connection</a>(c, <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c-&gt;write-&gt;handler = <a href="ngx_http_request.c.html#L3288" title="http/ngx_http_request.c:3288">ngx_http_empty_handler</a>;<br/></li>
<li>&nbsp; &nbsp; c-&gt;read-&gt;handler = <a href="#L3490" title="http/ngx_http_spdy.c:3490">ngx_http_spdy_keepalive_handler</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (c-&gt;write-&gt;timer_set) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../event/ngx_event.h.html#L428" title="event/ngx_event.h:428">ngx_del_timer</a>(c-&gt;write);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../event/ngx_event.h.html#L427" title="event/ngx_event.h:427">ngx_add_timer</a>(c-&gt;read, sscf-&gt;keepalive_timeout);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L818">&#x200c;</a><span class="linkable">ngx_http_spdy_proxy_protocol</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, u_char *pos,<br/></li>
<li>&nbsp; &nbsp; u_char *end)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L17" title="core/ngx_core.h:17">ngx_log_t</a>&nbsp; *log;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; log = sc-&gt;connection-&gt;log;<br/></li>
<li>&nbsp; &nbsp; log-&gt;action = <span class="Constant">&quot;reading PROXY protocol&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; pos = <a href="../core/ngx_proxy_protocol.c.html#L13" title="core/ngx_proxy_protocol.c:13">ngx_proxy_protocol_parse</a>(sc-&gt;connection, pos, end);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; log-&gt;action = <span class="Constant">&quot;processing SPDY&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (pos == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1930" title="http/ngx_http_spdy.c:1930">ngx_http_spdy_state_complete</a>(sc, pos, end);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L839">&#x200c;</a><span class="linkable">ngx_http_spdy_state_head</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, u_char *pos,<br/></li>
<li>&nbsp; &nbsp; u_char *end)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">uint32_t</span>&nbsp; &nbsp; head, flen;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; type;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (end - pos &lt; <a href="ngx_http_spdy.h.html#L36" title="http/ngx_http_spdy.h:36">NGX_SPDY_FRAME_HEADER_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(sc, pos, end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L839" title="http/ngx_http_spdy.c:839">ngx_http_spdy_state_head</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; head = <a href="#L33" title="http/ngx_http_spdy.c:33">ngx_spdy_frame_parse_uint32</a>(pos);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; pos += <span class="Statement">sizeof</span>(<span class="Type">uint32_t</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; flen = <a href="#L33" title="http/ngx_http_spdy.c:33">ngx_spdy_frame_parse_uint32</a>(pos);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;flags = <a href="#L55" title="http/ngx_http_spdy.c:55">ngx_spdy_frame_flags</a>(flen);<br/></li>
<li>&nbsp; &nbsp; sc-&gt;length = <a href="#L56" title="http/ngx_http_spdy.c:56">ngx_spdy_frame_length</a>(flen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; pos += <span class="Statement">sizeof</span>(<span class="Type">uint32_t</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L141" title="core/ngx_log.h:141">ngx_log_debug3</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;process spdy frame head:</span><span class="Special">%08X</span><span class="Constant">D f:</span><span class="Special">%X</span><span class="Constant">d l:</span><span class="Special">%u</span><span class="Constant">z&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; head, sc-&gt;flags, sc-&gt;length);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L49" title="http/ngx_http_spdy.c:49">ngx_spdy_ctl_frame_check</a>(head)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; type = <a href="#L54" title="http/ngx_http_spdy.c:54">ngx_spdy_ctl_frame_type</a>(head);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (type) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_http_spdy.h.html#L27" title="http/ngx_http_spdy.h:27">NGX_SPDY_SYN_STREAM</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L918" title="http/ngx_http_spdy.c:918">ngx_http_spdy_state_syn_stream</a>(sc, pos, end);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_http_spdy.h.html#L28" title="http/ngx_http_spdy.h:28">NGX_SPDY_SYN_REPLY</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent unexpected SYN_REPLY frame&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(sc);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_http_spdy.h.html#L29" title="http/ngx_http_spdy.h:29">NGX_SPDY_RST_STREAM</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1701" title="http/ngx_http_spdy.c:1701">ngx_http_spdy_state_rst_stream</a>(sc, pos, end);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_http_spdy.h.html#L30" title="http/ngx_http_spdy.h:30">NGX_SPDY_SETTINGS</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1846" title="http/ngx_http_spdy.c:1846">ngx_http_spdy_state_settings</a>(sc, pos, end);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_http_spdy.h.html#L31" title="http/ngx_http_spdy.h:31">NGX_SPDY_PING</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1776" title="http/ngx_http_spdy.c:1776">ngx_http_spdy_state_ping</a>(sc, pos, end);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_http_spdy.h.html#L32" title="http/ngx_http_spdy.h:32">NGX_SPDY_GOAWAY</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1825" title="http/ngx_http_spdy.c:1825">ngx_http_spdy_state_skip</a>(sc, pos, end); <span class="Comment">/* </span><span class="Todo">TODO</span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_http_spdy.h.html#L33" title="http/ngx_http_spdy.h:33">NGX_SPDY_HEADERS</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent unexpected HEADERS frame&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(sc);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_http_spdy.h.html#L34" title="http/ngx_http_spdy.h:34">NGX_SPDY_WINDOW_UPDATE</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1325" title="http/ngx_http_spdy.c:1325">ngx_http_spdy_state_window_update</a>(sc, pos, end);<br/></li>
<li><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy control frame with unknown type </span><span class="Special">%u</span><span class="Constant">i&quot;</span>, type);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1825" title="http/ngx_http_spdy.c:1825">ngx_http_spdy_state_skip</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L51" title="http/ngx_http_spdy.c:51">ngx_spdy_data_frame_check</a>(head)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;stream = <a href="#L2439" title="http/ngx_http_spdy.c:2439">ngx_http_spdy_get_stream_by_id</a>(sc, head);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1439" title="http/ngx_http_spdy.c:1439">ngx_http_spdy_state_data</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent invalid frame&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(sc);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L918">&#x200c;</a><span class="linkable">ngx_http_spdy_state_syn_stream</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, u_char *pos,<br/></li>
<li>&nbsp; &nbsp; u_char *end)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; sid, prio;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>&nbsp; &nbsp; *stream;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy_module.h.html#L30" title="http/ngx_http_spdy_module.h:30">ngx_http_spdy_srv_conf_t</a>&nbsp; *sscf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (end - pos &lt; <a href="ngx_http_spdy.h.html#L41" title="http/ngx_http_spdy.h:41">NGX_SPDY_SYN_STREAM_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(sc, pos, end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L918" title="http/ngx_http_spdy.c:918">ngx_http_spdy_state_syn_stream</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;length &lt;= <a href="ngx_http_spdy.h.html#L41" title="http/ngx_http_spdy.h:41">NGX_SPDY_SYN_STREAM_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent SYN_STREAM frame with incorrect length </span><span class="Special">%u</span><span class="Constant">z&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;length);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;length -= <a href="ngx_http_spdy.h.html#L41" title="http/ngx_http_spdy.h:41">NGX_SPDY_SYN_STREAM_SIZE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sid = <a href="#L43" title="http/ngx_http_spdy.c:43">ngx_spdy_frame_parse_sid</a>(pos);<br/></li>
<li>&nbsp; &nbsp; prio = pos[<span class="Constant">8</span>] &gt;&gt; <span class="Constant">5</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; pos += <a href="ngx_http_spdy.h.html#L41" title="http/ngx_http_spdy.h:41">NGX_SPDY_SYN_STREAM_SIZE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy SYN_STREAM frame sid:</span><span class="Special">%u</span><span class="Constant">i prio:</span><span class="Special">%u</span><span class="Constant">i&quot;</span>, sid, prio);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sid % <span class="Constant">2</span> == <span class="Constant">0</span> || sid &lt;= sc-&gt;last_sid) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent SYN_STREAM frame &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;with invalid Stream-ID </span><span class="Special">%u</span><span class="Constant">i&quot;</span>, sid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; stream = <a href="#L2439" title="http/ngx_http_spdy.c:2439">ngx_http_spdy_get_stream_by_id</a>(sc, sid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (stream) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L3276" title="http/ngx_http_spdy.c:3276">ngx_http_spdy_terminate_stream</a>(sc, stream,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L63" title="http/ngx_http_spdy.c:63">NGX_SPDY_PROTOCOL_ERROR</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;last_sid = sid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sscf = <a href="ngx_http_config.h.html#L57" title="http/ngx_http_config.h:57">ngx_http_get_module_srv_conf</a>(sc-&gt;http_connection-&gt;conf_ctx,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_spdy_module.c.html#L131" title="http/ngx_http_spdy_module.c:131">ngx_http_spdy_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;processing &gt;= sscf-&gt;concurrent_streams) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;concurrent streams exceeded </span><span class="Special">%u</span><span class="Constant">i&quot;</span>, sc-&gt;processing);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2069" title="http/ngx_http_spdy.c:2069">ngx_http_spdy_send_rst_stream</a>(sc, sid, <a href="#L65" title="http/ngx_http_spdy.c:65">NGX_SPDY_REFUSED_STREAM</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; prio)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1244" title="http/ngx_http_spdy.c:1244">ngx_http_spdy_state_headers_skip</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream = <a href="#L2308" title="http/ngx_http_spdy.c:2308">ngx_http_spdy_create_stream</a>(sc, sid, prio);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (stream == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream-&gt;in_closed = (sc-&gt;flags &amp; <a href="ngx_http_spdy.h.html#L60" title="http/ngx_http_spdy.h:60">NGX_SPDY_FLAG_FIN</a>) ? <span class="Constant">1</span> : <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream-&gt;request-&gt;request_length = <a href="ngx_http_spdy.h.html#L36" title="http/ngx_http_spdy.h:36">NGX_SPDY_FRAME_HEADER_SIZE</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + <a href="ngx_http_spdy.h.html#L41" title="http/ngx_http_spdy.h:41">NGX_SPDY_SYN_STREAM_SIZE</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + sc-&gt;length;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;stream = stream;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1005" title="http/ngx_http_spdy.c:1005">ngx_http_spdy_state_headers</a>(sc, pos, end);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L1005">&#x200c;</a><span class="linkable">ngx_http_spdy_state_headers</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, u_char *pos,<br/></li>
<li>&nbsp; &nbsp; u_char *end)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; z;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; size;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_buf.h.html#L18" title="core/ngx_buf.h:18">ngx_buf_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *buf;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rc;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a>&nbsp; *r;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; size = end - pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (size == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(sc, pos, end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1005" title="http/ngx_http_spdy.c:1005">ngx_http_spdy_state_headers</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (size &gt; sc-&gt;length) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; size = sc-&gt;length;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r = sc-&gt;stream-&gt;request;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;process spdy header block </span><span class="Special">%u</span><span class="Constant">z of </span><span class="Special">%u</span><span class="Constant">z&quot;</span>, size, sc-&gt;length);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; buf = r-&gt;header_in;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;zstream_in.next_in = pos;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;zstream_in.avail_in = size;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;zstream_in.next_out = buf-&gt;last;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* one byte is reserved for null-termination of the last header value */<br/></li>
<li></span>&nbsp; &nbsp; sc-&gt;zstream_in.avail_out = buf-&gt;end - buf-&gt;last - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; z = inflate(&amp;sc-&gt;zstream_in, Z_NO_FLUSH);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (z == Z_NEED_DICT) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; z = inflateSetDictionary(&amp;sc-&gt;zstream_in, <a href="#L189" title="http/ngx_http_spdy.c:189">ngx_http_spdy_dict</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<a href="#L189" title="http/ngx_http_spdy.c:189">ngx_http_spdy_dict</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (z != Z_OK) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (z == Z_DATA_ERROR) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent SYN_STREAM frame with header &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;block encoded using wrong dictionary: </span><span class="Special">%u</span><span class="Constant">l&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (u_long) sc-&gt;zstream_in.adler);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L20" title="core/ngx_log.h:20">NGX_LOG_ERR</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;inflateSetDictionary() failed: </span><span class="Special">%d</span><span class="Constant">&quot;</span>, z);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy inflateSetDictionary(): </span><span class="Special">%d</span><span class="Constant">&quot;</span>, z);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; z = sc-&gt;zstream_in.avail_in ? inflate(&amp;sc-&gt;zstream_in, Z_NO_FLUSH)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : Z_OK;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L147" title="core/ngx_log.h:147">ngx_log_debug5</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy inflate out: ni:</span><span class="Special">%p</span><span class="Constant"> no:</span><span class="Special">%p</span><span class="Constant"> ai:</span><span class="Special">%u</span><span class="Constant">d ao:</span><span class="Special">%u</span><span class="Constant">d rc:</span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; sc-&gt;zstream_in.next_in, sc-&gt;zstream_in.next_out,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; sc-&gt;zstream_in.avail_in, sc-&gt;zstream_in.avail_out,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; z);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (z != Z_OK) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1982" title="http/ngx_http_spdy.c:1982">ngx_http_spdy_state_inflate_error</a>(sc, z);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;length -= sc-&gt;zstream_in.next_in - pos;<br/></li>
<li>&nbsp; &nbsp; pos = sc-&gt;zstream_in.next_in;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; buf-&gt;last = sc-&gt;zstream_in.next_out;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_in.headers.part.elts == <span class="Constant">NULL</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (buf-&gt;last - buf-&gt;pos &lt; <a href="ngx_http_spdy.h.html#L47" title="http/ngx_http_spdy.h:47">NGX_SPDY_NV_NUM_SIZE</a>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;length == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;premature end of spdy header block&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1298" title="http/ngx_http_spdy.c:1298">ngx_http_spdy_state_headers_error</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(sc, pos, end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1005" title="http/ngx_http_spdy.c:1005">ngx_http_spdy_state_headers</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;entries = <a href="#L33" title="http/ngx_http_spdy.c:33">ngx_spdy_frame_parse_uint32</a>(buf-&gt;pos);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; buf-&gt;pos += <a href="ngx_http_spdy.h.html#L47" title="http/ngx_http_spdy.h:47">NGX_SPDY_NV_NUM_SIZE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy header block has </span><span class="Special">%u</span><span class="Constant">i entries&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; sc-&gt;entries);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../core/ngx_list.h.html#L37" title="core/ngx_list.h:37">ngx_list_init</a>(&amp;r-&gt;headers_in.headers, r-&gt;pool, <span class="Constant">20</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<a href="../core/ngx_hash.h.html#L97" title="core/ngx_hash.h:97">ngx_table_elt_t</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L3318" title="http/ngx_http_spdy.c:3318">ngx_http_spdy_close_stream</a>(sc-&gt;stream,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="ngx_http_request.h.html#L128" title="http/ngx_http_request.h:128">NGX_HTTP_INTERNAL_SERVER_ERROR</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1244" title="http/ngx_http_spdy.c:1244">ngx_http_spdy_state_headers_skip</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../core/ngx_array.h.html#L32" title="core/ngx_array.h:32">ngx_array_init</a>(&amp;r-&gt;headers_in.cookies, r-&gt;pool, <span class="Constant">2</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<a href="../core/ngx_hash.h.html#L97" title="core/ngx_hash.h:97">ngx_table_elt_t</a> *))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L3318" title="http/ngx_http_spdy.c:3318">ngx_http_spdy_close_stream</a>(sc-&gt;stream,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="ngx_http_request.h.html#L128" title="http/ngx_http_request.h:128">NGX_HTTP_INTERNAL_SERVER_ERROR</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1244" title="http/ngx_http_spdy.c:1244">ngx_http_spdy_state_headers_skip</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (sc-&gt;entries) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rc = <a href="#L2463" title="http/ngx_http_spdy.c:2463">ngx_http_spdy_parse_header</a>(r);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (rc) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../core/ngx_core.h.html#L33" title="core/ngx_core.h:33">NGX_DONE</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;entries--;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../core/ngx_core.h.html#L31" title="core/ngx_core.h:31">NGX_AGAIN</a>:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;zstream_in.avail_in) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rc = <a href="#L2636" title="http/ngx_http_spdy.c:2636">ngx_http_spdy_alloc_large_header_buffer</a>(r);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rc == <a href="../core/ngx_core.h.html#L34" title="core/ngx_core.h:34">NGX_DECLINED</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L2249" title="http/ngx_http_request.c:2249">ngx_http_finalize_request</a>(r,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.h.html#L106" title="http/ngx_http_request.h:106">NGX_HTTP_REQUEST_HEADER_TOO_LARGE</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1244" title="http/ngx_http_spdy.c:1244">ngx_http_spdy_state_headers_skip</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rc != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L3318" title="http/ngx_http_spdy.c:3318">ngx_http_spdy_close_stream</a>(sc-&gt;stream,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="ngx_http_request.h.html#L128" title="http/ngx_http_request.h:128">NGX_HTTP_INTERNAL_SERVER_ERROR</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1244" title="http/ngx_http_spdy.c:1244">ngx_http_spdy_state_headers_skip</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* null-terminate the last processed header name or value */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf-&gt;pos = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf = r-&gt;header_in;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;zstream_in.next_out = buf-&gt;last;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* one byte is reserved for null-termination */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;zstream_in.avail_out = buf-&gt;end - buf-&gt;last - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; z = inflate(&amp;sc-&gt;zstream_in, Z_NO_FLUSH);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L147" title="core/ngx_log.h:147">ngx_log_debug5</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy inflate out: ni:</span><span class="Special">%p</span><span class="Constant"> no:</span><span class="Special">%p</span><span class="Constant"> ai:</span><span class="Special">%u</span><span class="Constant">d ao:</span><span class="Special">%u</span><span class="Constant">d rc:</span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; sc-&gt;zstream_in.next_in, sc-&gt;zstream_in.next_out,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; sc-&gt;zstream_in.avail_in, sc-&gt;zstream_in.avail_out,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; z);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (z != Z_OK) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1982" title="http/ngx_http_spdy.c:1982">ngx_http_spdy_state_inflate_error</a>(sc, z);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;length -= sc-&gt;zstream_in.next_in - pos;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos = sc-&gt;zstream_in.next_in;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf-&gt;last = sc-&gt;zstream_in.next_out;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;length == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;premature end of spdy header block&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1298" title="http/ngx_http_spdy.c:1298">ngx_http_spdy_state_headers_error</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(sc, pos, end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1005" title="http/ngx_http_spdy.c:1005">ngx_http_spdy_state_headers</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_http_request.h.html#L58" title="http/ngx_http_request.h:58">NGX_HTTP_PARSE_INVALID_HEADER</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L2249" title="http/ngx_http_request.c:2249">ngx_http_finalize_request</a>(r, <a href="ngx_http_request.h.html#L84" title="http/ngx_http_request.h:84">NGX_HTTP_BAD_REQUEST</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1244" title="http/ngx_http_spdy.c:1244">ngx_http_spdy_state_headers_skip</a>(sc, pos, end);<br/></li>
<li><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> <span class="Comment">/* <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a> */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1298" title="http/ngx_http_spdy.c:1298">ngx_http_spdy_state_headers_error</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* a header line has been parsed successfully */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rc = <a href="#L2705" title="http/ngx_http_spdy.c:2705">ngx_http_spdy_handle_request_header</a>(r);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rc != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rc == <a href="ngx_http_request.h.html#L58" title="http/ngx_http_request.h:58">NGX_HTTP_PARSE_INVALID_HEADER</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L2249" title="http/ngx_http_request.c:2249">ngx_http_finalize_request</a>(r, <a href="ngx_http_request.h.html#L84" title="http/ngx_http_request.h:84">NGX_HTTP_BAD_REQUEST</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1244" title="http/ngx_http_spdy.c:1244">ngx_http_spdy_state_headers_skip</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rc != <a href="../core/ngx_core.h.html#L35" title="core/ngx_core.h:35">NGX_ABORT</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L3318" title="http/ngx_http_spdy.c:3318">ngx_http_spdy_close_stream</a>(sc-&gt;stream,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="ngx_http_request.h.html#L128" title="http/ngx_http_request.h:128">NGX_HTTP_INTERNAL_SERVER_ERROR</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1244" title="http/ngx_http_spdy.c:1244">ngx_http_spdy_state_headers_skip</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (buf-&gt;pos != buf-&gt;last || sc-&gt;zstream_in.avail_in) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;incorrect number of spdy header block entries&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1298" title="http/ngx_http_spdy.c:1298">ngx_http_spdy_state_headers_error</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;length) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(sc, pos, end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1005" title="http/ngx_http_spdy.c:1005">ngx_http_spdy_state_headers</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* null-terminate the last header value */<br/></li>
<li></span>&nbsp; &nbsp; *buf-&gt;pos = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L3077" title="http/ngx_http_spdy.c:3077">ngx_http_spdy_run_request</a>(r);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1930" title="http/ngx_http_spdy.c:1930">ngx_http_spdy_state_complete</a>(sc, pos, end);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L1244">&#x200c;</a><span class="linkable">ngx_http_spdy_state_headers_skip</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, u_char *pos,<br/></li>
<li>&nbsp; &nbsp; u_char *end)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp;&nbsp; n;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; size;<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; buffer[<a href="#L60" title="http/ngx_http_spdy.c:60">NGX_SPDY_SKIP_HEADERS_BUFFER_SIZE</a>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;length == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1930" title="http/ngx_http_spdy.c:1930">ngx_http_spdy_state_complete</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; size = end - pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (size == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(sc, pos, end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1244" title="http/ngx_http_spdy.c:1244">ngx_http_spdy_state_headers_skip</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy header block skip </span><span class="Special">%u</span><span class="Constant">z of </span><span class="Special">%u</span><span class="Constant">z&quot;</span>, size, sc-&gt;length);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;zstream_in.next_in = pos;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;zstream_in.avail_in = (size &lt; sc-&gt;length) ? size : sc-&gt;length;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (sc-&gt;zstream_in.avail_in) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;zstream_in.next_out = buffer;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;zstream_in.avail_out = <a href="#L60" title="http/ngx_http_spdy.c:60">NGX_SPDY_SKIP_HEADERS_BUFFER_SIZE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = inflate(&amp;sc-&gt;zstream_in, Z_NO_FLUSH);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L147" title="core/ngx_log.h:147">ngx_log_debug5</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy inflate out: ni:</span><span class="Special">%p</span><span class="Constant"> no:</span><span class="Special">%p</span><span class="Constant"> ai:</span><span class="Special">%u</span><span class="Constant">d ao:</span><span class="Special">%u</span><span class="Constant">d rc:</span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; sc-&gt;zstream_in.next_in, sc-&gt;zstream_in.next_out,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; sc-&gt;zstream_in.avail_in, sc-&gt;zstream_in.avail_out,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; n);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n != Z_OK) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1982" title="http/ngx_http_spdy.c:1982">ngx_http_spdy_state_inflate_error</a>(sc, n);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; pos = sc-&gt;zstream_in.next_in;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (size &lt; sc-&gt;length) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;length -= size;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(sc, pos, end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1244" title="http/ngx_http_spdy.c:1244">ngx_http_spdy_state_headers_skip</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1930" title="http/ngx_http_spdy.c:1930">ngx_http_spdy_state_complete</a>(sc, pos, end);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L1298">&#x200c;</a><span class="linkable">ngx_http_spdy_state_headers_error</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, u_char *pos,<br/></li>
<li>&nbsp; &nbsp; u_char *end)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>&nbsp; *stream;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream = sc-&gt;stream;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent SYN_STREAM frame for stream </span><span class="Special">%u</span><span class="Constant">i &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;with invalid header block&quot;</span>, stream-&gt;id);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2069" title="http/ngx_http_spdy.c:2069">ngx_http_spdy_send_rst_stream</a>(sc, stream-&gt;id, <a href="#L63" title="http/ngx_http_spdy.c:63">NGX_SPDY_PROTOCOL_ERROR</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;priority)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream-&gt;out_closed = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L3318" title="http/ngx_http_spdy.c:3318">ngx_http_spdy_close_stream</a>(stream, <a href="ngx_http_request.h.html#L84" title="http/ngx_http_request.h:84">NGX_HTTP_BAD_REQUEST</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1244" title="http/ngx_http_spdy.c:1244">ngx_http_spdy_state_headers_skip</a>(sc, pos, end);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L1325">&#x200c;</a><span class="linkable">ngx_http_spdy_state_window_update</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, u_char *pos,<br/></li>
<li>&nbsp; &nbsp; u_char *end)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; delta;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; sid;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *wev;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_queue.h.html#L16" title="core/ngx_queue.h:16">ngx_queue_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *q;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>&nbsp; *stream;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (end - pos &lt; <a href="ngx_http_spdy.h.html#L46" title="http/ngx_http_spdy.h:46">NGX_SPDY_WINDOW_UPDATE_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(sc, pos, end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1325" title="http/ngx_http_spdy.c:1325">ngx_http_spdy_state_window_update</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;length != <a href="ngx_http_spdy.h.html#L46" title="http/ngx_http_spdy.h:46">NGX_SPDY_WINDOW_UPDATE_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent WINDOW_UPDATE frame &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;with incorrect length </span><span class="Special">%u</span><span class="Constant">z&quot;</span>, sc-&gt;length);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sid = <a href="#L43" title="http/ngx_http_spdy.c:43">ngx_spdy_frame_parse_sid</a>(pos);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; pos += <a href="ngx_http_spdy.h.html#L38" title="http/ngx_http_spdy.h:38">NGX_SPDY_SID_SIZE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; delta = <a href="#L45" title="http/ngx_http_spdy.c:45">ngx_spdy_frame_parse_delta</a>(pos);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; pos += <a href="ngx_http_spdy.h.html#L39" title="http/ngx_http_spdy.h:39">NGX_SPDY_DELTA_SIZE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy WINDOW_UPDATE sid:</span><span class="Special">%u</span><span class="Constant">i delta:</span><span class="Special">%u</span><span class="Constant">i&quot;</span>, sid, delta);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sid) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; stream = <a href="#L2439" title="http/ngx_http_spdy.c:2439">ngx_http_spdy_get_stream_by_id</a>(sc, sid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (stream == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;unknown spdy stream&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1930" title="http/ngx_http_spdy.c:1930">ngx_http_spdy_state_complete</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (stream-&gt;send_window &gt; (<span class="Type">ssize_t</span>) (<a href="#L81" title="http/ngx_http_spdy.c:81">NGX_SPDY_MAX_WINDOW</a> - delta)) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client violated flow control for stream </span><span class="Special">%u</span><span class="Constant">i: &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;received WINDOW_UPDATE frame with delta </span><span class="Special">%u</span><span class="Constant">z &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;not allowed for window %z&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sid, delta, stream-&gt;send_window);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L3276" title="http/ngx_http_spdy.c:3276">ngx_http_spdy_terminate_stream</a>(sc, stream,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L69" title="http/ngx_http_spdy.c:69">NGX_SPDY_FLOW_CONTROL_ERROR</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; == <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1930" title="http/ngx_http_spdy.c:1930">ngx_http_spdy_state_complete</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;send_window += delta;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (stream-&gt;exhausted) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;exhausted = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wev = stream-&gt;request-&gt;connection-&gt;write;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!wev-&gt;timer_set) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wev-&gt;delayed = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wev-&gt;handler(wev);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;send_window += delta;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;send_window &gt; <a href="#L81" title="http/ngx_http_spdy.c:81">NGX_SPDY_MAX_WINDOW</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client violated connection flow control: &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;received WINDOW_UPDATE frame with delta </span><span class="Special">%u</span><span class="Constant">z &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;not allowed for window </span><span class="Special">%u</span><span class="Constant">z&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delta, sc-&gt;send_window);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (!<a href="../core/ngx_queue.h.html#L29" title="core/ngx_queue.h:29">ngx_queue_empty</a>(&amp;sc-&gt;waiting)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; q = <a href="../core/ngx_queue.h.html#L50" title="core/ngx_queue.h:50">ngx_queue_head</a>(&amp;sc-&gt;waiting);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_queue.h.html#L72" title="core/ngx_queue.h:72">ngx_queue_remove</a>(q);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream = <a href="../core/ngx_queue.h.html#L103" title="core/ngx_queue.h:103">ngx_queue_data</a>(q, <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>, queue);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;handled = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wev = stream-&gt;request-&gt;connection-&gt;write;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!wev-&gt;timer_set) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wev-&gt;delayed = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wev-&gt;handler(wev);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;send_window == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1930" title="http/ngx_http_spdy.c:1930">ngx_http_spdy_state_complete</a>(sc, pos, end);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L1439">&#x200c;</a><span class="linkable">ngx_http_spdy_state_data</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, u_char *pos,<br/></li>
<li>&nbsp; &nbsp; u_char *end)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>&nbsp; *stream;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy DATA frame&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;length &gt; sc-&gt;recv_window) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client violated connection flow control: &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;received DATA frame length </span><span class="Special">%u</span><span class="Constant">z, available window </span><span class="Special">%u</span><span class="Constant">z&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;length, sc-&gt;recv_window);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;recv_window -= sc-&gt;length;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;recv_window &lt; <a href="#L81" title="http/ngx_http_spdy.c:81">NGX_SPDY_MAX_WINDOW</a> / <span class="Constant">4</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2034" title="http/ngx_http_spdy.c:2034">ngx_http_spdy_send_window_update</a>(sc, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L81" title="http/ngx_http_spdy.c:81">NGX_SPDY_MAX_WINDOW</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - sc-&gt;recv_window)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; == <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;recv_window = <a href="#L81" title="http/ngx_http_spdy.c:81">NGX_SPDY_MAX_WINDOW</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream = sc-&gt;stream;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (stream == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;unknown spdy stream&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1825" title="http/ngx_http_spdy.c:1825">ngx_http_spdy_state_skip</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;length &gt; stream-&gt;recv_window) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client violated flow control for stream </span><span class="Special">%u</span><span class="Constant">i: &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;received DATA frame length </span><span class="Special">%u</span><span class="Constant">z, available window </span><span class="Special">%u</span><span class="Constant">z&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;id, sc-&gt;length, stream-&gt;recv_window);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L3276" title="http/ngx_http_spdy.c:3276">ngx_http_spdy_terminate_stream</a>(sc, stream,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L69" title="http/ngx_http_spdy.c:69">NGX_SPDY_FLOW_CONTROL_ERROR</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; == <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1825" title="http/ngx_http_spdy.c:1825">ngx_http_spdy_state_skip</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream-&gt;recv_window -= sc-&gt;length;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (stream-&gt;recv_window &lt; <a href="#L84" title="http/ngx_http_spdy.c:84">NGX_SPDY_STREAM_WINDOW</a> / <span class="Constant">4</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2034" title="http/ngx_http_spdy.c:2034">ngx_http_spdy_send_window_update</a>(sc, stream-&gt;id,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L84" title="http/ngx_http_spdy.c:84">NGX_SPDY_STREAM_WINDOW</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - stream-&gt;recv_window)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; == <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;recv_window = <a href="#L84" title="http/ngx_http_spdy.c:84">NGX_SPDY_STREAM_WINDOW</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (stream-&gt;in_closed) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent DATA frame for half-closed stream </span><span class="Special">%u</span><span class="Constant">i&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;id);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L3276" title="http/ngx_http_spdy.c:3276">ngx_http_spdy_terminate_stream</a>(sc, stream,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L71" title="http/ngx_http_spdy.c:71">NGX_SPDY_STREAM_ALREADY_CLOSED</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; == <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1825" title="http/ngx_http_spdy.c:1825">ngx_http_spdy_state_skip</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1531" title="http/ngx_http_spdy.c:1531">ngx_http_spdy_state_read_data</a>(sc, pos, end);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L1531">&#x200c;</a><span class="linkable">ngx_http_spdy_state_read_data</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, u_char *pos,<br/></li>
<li>&nbsp; &nbsp; u_char *end)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; size;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">ssize_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_buf.h.html#L18" title="core/ngx_buf.h:18">ngx_buf_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *buf;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rc;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_file.h.html#L74" title="core/ngx_file.h:74">ngx_temp_file_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *tf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *r;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>&nbsp; &nbsp; *stream;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_request.h.html#L289" title="http/ngx_http_request.h:289">ngx_http_request_body_t</a>&nbsp;&nbsp; *rb;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_core_module.h.html#L53" title="http/ngx_http_core_module.h:53">ngx_http_core_loc_conf_t</a>&nbsp; *clcf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream = sc-&gt;stream;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (stream == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1825" title="http/ngx_http_spdy.c:1825">ngx_http_spdy_state_skip</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (stream-&gt;skip_data) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;flags &amp; <a href="ngx_http_spdy.h.html#L60" title="http/ngx_http_spdy.h:60">NGX_SPDY_FLAG_FIN</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;in_closed = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;skipping spdy DATA frame, reason: </span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; stream-&gt;skip_data);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1825" title="http/ngx_http_spdy.c:1825">ngx_http_spdy_state_skip</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; size = end - pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (size &gt; sc-&gt;length) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; size = sc-&gt;length;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r = stream-&gt;request;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;request_body == <span class="Constant">NULL<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; <a href="#L3141" title="http/ngx_http_spdy.c:3141">ngx_http_spdy_init_request_body</a>(r) != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;skip_data = <a href="ngx_http_spdy.h.html#L68" title="http/ngx_http_spdy.h:68">NGX_SPDY_DATA_INTERNAL_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1825" title="http/ngx_http_spdy.c:1825">ngx_http_spdy_state_skip</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rb = r-&gt;request_body;<br/></li>
<li>&nbsp; &nbsp; tf = rb-&gt;temp_file;<br/></li>
<li>&nbsp; &nbsp; buf = rb-&gt;buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (size) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rb-&gt;rest += size;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_in.content_length_n != -<span class="Constant">1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; r-&gt;headers_in.content_length_n &lt; rb-&gt;rest)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client intended to send body data &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;larger than declared&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;skip_data = <a href="ngx_http_spdy.h.html#L67" title="http/ngx_http_spdy.h:67">NGX_SPDY_DATA_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> error;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clcf = <a href="ngx_http_config.h.html#L58" title="http/ngx_http_config.h:58">ngx_http_get_module_loc_conf</a>(r, <a href="ngx_http_core_module.c.html#L811" title="http/ngx_http_core_module.c:811">ngx_http_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (clcf-&gt;client_max_body_size<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; clcf-&gt;client_max_body_size &lt; rb-&gt;rest)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L20" title="core/ngx_log.h:20">NGX_LOG_ERR</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client intended to send &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;too large chunked body: </span><span class="Special">%O</span><span class="Constant"> bytes&quot;</span>, rb-&gt;rest);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;skip_data = <a href="ngx_http_spdy.h.html#L67" title="http/ngx_http_spdy.h:67">NGX_SPDY_DATA_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> error;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;length -= size;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tf) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf-&gt;start = pos;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf-&gt;pos = pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos += size;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf-&gt;end = pos;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf-&gt;last = pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = <a href="../core/ngx_file.c.html#L109" title="core/ngx_file.c:109">ngx_write_chain_to_temp_file</a>(tf, rb-&gt;bufs);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* </span><span class="Todo">TODO</span><span class="Comment">: n == 0 or not complete and level event */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n == <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;skip_data = <a href="ngx_http_spdy.h.html#L68" title="http/ngx_http_spdy.h:68">NGX_SPDY_DATA_INTERNAL_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> error;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tf-&gt;offset += n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf-&gt;last = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(buf-&gt;last, pos, size);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos += size;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;request_length += size;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;length) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(sc, pos, end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1531" title="http/ngx_http_spdy.c:1531">ngx_http_spdy_state_read_data</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;flags &amp; <a href="ngx_http_spdy.h.html#L60" title="http/ngx_http_spdy.h:60">NGX_SPDY_FLAG_FIN</a>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;in_closed = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_in.content_length_n &lt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_in.content_length_n = rb-&gt;rest;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (r-&gt;headers_in.content_length_n != rb-&gt;rest) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client prematurely closed stream: &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;only </span><span class="Special">%O</span><span class="Constant"> out of </span><span class="Special">%O</span><span class="Constant"> bytes of request body received&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rb-&gt;rest, r-&gt;headers_in.content_length_n);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;skip_data = <a href="ngx_http_spdy.h.html#L67" title="http/ngx_http_spdy.h:67">NGX_SPDY_DATA_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> error;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tf) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_string.h.html#L86" title="core/ngx_string.h:86">ngx_memzero</a>(buf, <span class="Statement">sizeof</span>(<a href="../core/ngx_buf.h.html#L18" title="core/ngx_buf.h:18">ngx_buf_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf-&gt;in_file = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf-&gt;file_last = tf-&gt;file.offset;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf-&gt;file = &amp;tf-&gt;file;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rb-&gt;buf = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rb-&gt;post_handler) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;read_event_handler = <a href="ngx_http_request.c.html#L2691" title="http/ngx_http_request.c:2691">ngx_http_block_reading</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rb-&gt;post_handler(r);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1930" title="http/ngx_http_spdy.c:1930">ngx_http_spdy_state_complete</a>(sc, pos, end);<br/></li>
<li><br/></li>
<li><span class="Statement">error</span><span class="cUserCont">:<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rb-&gt;post_handler) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (stream-&gt;skip_data == <a href="ngx_http_spdy.h.html#L67" title="http/ngx_http_spdy.h:67">NGX_SPDY_DATA_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rc = (r-&gt;headers_in.content_length_n == -<span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ? <a href="ngx_http_request.h.html#L93" title="http/ngx_http_request.h:93">NGX_HTTP_REQUEST_ENTITY_TOO_LARGE</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; : <a href="ngx_http_request.h.html#L84" title="http/ngx_http_request.h:84">NGX_HTTP_BAD_REQUEST</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rc = <a href="ngx_http_request.h.html#L128" title="http/ngx_http_request.h:128">NGX_HTTP_INTERNAL_SERVER_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L2249" title="http/ngx_http_request.c:2249">ngx_http_finalize_request</a>(r, rc);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1825" title="http/ngx_http_spdy.c:1825">ngx_http_spdy_state_skip</a>(sc, pos, end);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L1701">&#x200c;</a><span class="linkable">ngx_http_spdy_state_rst_stream</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, u_char *pos,<br/></li>
<li>&nbsp; &nbsp; u_char *end)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; sid, status;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *ev;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *fc;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>&nbsp; *stream;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (end - pos &lt; <a href="ngx_http_spdy.h.html#L43" title="http/ngx_http_spdy.h:43">NGX_SPDY_RST_STREAM_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(sc, pos, end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1701" title="http/ngx_http_spdy.c:1701">ngx_http_spdy_state_rst_stream</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;length != <a href="ngx_http_spdy.h.html#L43" title="http/ngx_http_spdy.h:43">NGX_SPDY_RST_STREAM_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent RST_STREAM frame with incorrect length </span><span class="Special">%u</span><span class="Constant">z&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;length);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sid = <a href="#L43" title="http/ngx_http_spdy.c:43">ngx_spdy_frame_parse_sid</a>(pos);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; pos += <a href="ngx_http_spdy.h.html#L38" title="http/ngx_http_spdy.h:38">NGX_SPDY_SID_SIZE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; status = <a href="#L33" title="http/ngx_http_spdy.c:33">ngx_spdy_frame_parse_uint32</a>(pos);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; pos += <span class="Statement">sizeof</span>(<span class="Type">uint32_t</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy RST_STREAM sid:</span><span class="Special">%u</span><span class="Constant">i st:</span><span class="Special">%u</span><span class="Constant">i&quot;</span>, sid, status);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream = <a href="#L2439" title="http/ngx_http_spdy.c:2439">ngx_http_spdy_get_stream_by_id</a>(sc, sid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (stream == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;unknown spdy stream&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1930" title="http/ngx_http_spdy.c:1930">ngx_http_spdy_state_complete</a>(sc, pos, end);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream-&gt;in_closed = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; stream-&gt;out_closed = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; fc = stream-&gt;request-&gt;connection;<br/></li>
<li>&nbsp; &nbsp; fc-&gt;error = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (status) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="#L67" title="http/ngx_http_spdy.c:67">NGX_SPDY_CANCEL</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, fc-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client canceled stream </span><span class="Special">%u</span><span class="Constant">i&quot;</span>, sid);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="#L68" title="http/ngx_http_spdy.c:68">NGX_SPDY_INTERNAL_ERROR</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, fc-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client terminated stream </span><span class="Special">%u</span><span class="Constant">i due to internal error&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sid);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, fc-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client terminated stream </span><span class="Special">%u</span><span class="Constant">i with status </span><span class="Special">%u</span><span class="Constant">i&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sid, status);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ev = fc-&gt;read;<br/></li>
<li>&nbsp; &nbsp; ev-&gt;handler(ev);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1930" title="http/ngx_http_spdy.c:1930">ngx_http_spdy_state_complete</a>(sc, pos, end);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L1776">&#x200c;</a><span class="linkable">ngx_http_spdy_state_ping</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, u_char *pos,<br/></li>
<li>&nbsp; &nbsp; u_char *end)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_buf.h.html#L18" title="core/ngx_buf.h:18">ngx_buf_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L72" title="http/ngx_http_spdy.h:72">ngx_http_spdy_out_frame_t</a>&nbsp; *frame;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (end - pos &lt; <a href="ngx_http_spdy.h.html#L44" title="http/ngx_http_spdy.h:44">NGX_SPDY_PING_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(sc, pos, end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1776" title="http/ngx_http_spdy.c:1776">ngx_http_spdy_state_ping</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;length != <a href="ngx_http_spdy.h.html#L44" title="http/ngx_http_spdy.h:44">NGX_SPDY_PING_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent PING frame with incorrect length </span><span class="Special">%u</span><span class="Constant">z&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;length);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy PING frame&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; frame = <a href="#L2232" title="http/ngx_http_spdy.c:2232">ngx_http_spdy_get_ctl_frame</a>(sc, <a href="ngx_http_spdy.h.html#L44" title="http/ngx_http_spdy.h:44">NGX_SPDY_PING_SIZE</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L57" title="http/ngx_http_spdy.h:57">NGX_SPDY_HIGHEST_PRIORITY</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (frame == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; buf = frame-&gt;first-&gt;buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = buf-&gt;pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L250" title="http/ngx_http_spdy.h:250">ngx_spdy_frame_write_head</a>(p, <a href="ngx_http_spdy.h.html#L31" title="http/ngx_http_spdy.h:31">NGX_SPDY_PING</a>);<br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L253" title="http/ngx_http_spdy.h:253">ngx_spdy_frame_write_flags_and_len</a>(p, <span class="Constant">0</span>, <a href="ngx_http_spdy.h.html#L44" title="http/ngx_http_spdy.h:44">NGX_SPDY_PING_SIZE</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(p, pos, <a href="ngx_http_spdy.h.html#L44" title="http/ngx_http_spdy.h:44">NGX_SPDY_PING_SIZE</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; buf-&gt;last = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L170" title="http/ngx_http_spdy.h:170">ngx_http_spdy_queue_frame</a>(sc, frame);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; pos += <a href="ngx_http_spdy.h.html#L44" title="http/ngx_http_spdy.h:44">NGX_SPDY_PING_SIZE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1930" title="http/ngx_http_spdy.c:1930">ngx_http_spdy_state_complete</a>(sc, pos, end);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L1825">&#x200c;</a><span class="linkable">ngx_http_spdy_state_skip</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, u_char *pos,<br/></li>
<li>&nbsp; &nbsp; u_char *end)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; size;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; size = end - pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy frame skip </span><span class="Special">%u</span><span class="Constant">z of </span><span class="Special">%u</span><span class="Constant">z&quot;</span>, size, sc-&gt;length);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (size &lt; sc-&gt;length) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;length -= size;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(sc, end, end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1825" title="http/ngx_http_spdy.c:1825">ngx_http_spdy_state_skip</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1930" title="http/ngx_http_spdy.c:1930">ngx_http_spdy_state_complete</a>(sc, pos + sc-&gt;length, end);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L1846">&#x200c;</a><span class="linkable">ngx_http_spdy_state_settings</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, u_char *pos,<br/></li>
<li>&nbsp; &nbsp; u_char *end)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; fid, val;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;entries == <span class="Constant">0</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (end - pos &lt; <a href="ngx_http_spdy.h.html#L50" title="http/ngx_http_spdy.h:50">NGX_SPDY_SETTINGS_NUM_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(sc, pos, end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1846" title="http/ngx_http_spdy.c:1846">ngx_http_spdy_state_settings</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;entries = <a href="#L33" title="http/ngx_http_spdy.c:33">ngx_spdy_frame_parse_uint32</a>(pos);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pos += <a href="ngx_http_spdy.h.html#L50" title="http/ngx_http_spdy.h:50">NGX_SPDY_SETTINGS_NUM_SIZE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;length -= <a href="ngx_http_spdy.h.html#L50" title="http/ngx_http_spdy.h:50">NGX_SPDY_SETTINGS_NUM_SIZE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;length &lt; sc-&gt;entries * <a href="ngx_http_spdy.h.html#L54" title="http/ngx_http_spdy.h:54">NGX_SPDY_SETTINGS_PAIR_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent SETTINGS frame with incorrect &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;length </span><span class="Special">%u</span><span class="Constant">z or number of entries </span><span class="Special">%u</span><span class="Constant">i&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;length, sc-&gt;entries);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy SETTINGS frame has </span><span class="Special">%u</span><span class="Constant">i entries&quot;</span>, sc-&gt;entries);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (sc-&gt;entries) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (end - pos &lt; <a href="ngx_http_spdy.h.html#L54" title="http/ngx_http_spdy.h:54">NGX_SPDY_SETTINGS_PAIR_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1952" title="http/ngx_http_spdy.c:1952">ngx_http_spdy_state_save</a>(sc, pos, end,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1846" title="http/ngx_http_spdy.c:1846">ngx_http_spdy_state_settings</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;entries--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;length -= <a href="ngx_http_spdy.h.html#L54" title="http/ngx_http_spdy.h:54">NGX_SPDY_SETTINGS_PAIR_SIZE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fid = <a href="#L33" title="http/ngx_http_spdy.c:33">ngx_spdy_frame_parse_uint32</a>(pos);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pos += <a href="ngx_http_spdy.h.html#L51" title="http/ngx_http_spdy.h:51">NGX_SPDY_SETTINGS_FID_SIZE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; val = <a href="#L33" title="http/ngx_http_spdy.c:33">ngx_spdy_frame_parse_uint32</a>(pos);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pos += <a href="ngx_http_spdy.h.html#L52" title="http/ngx_http_spdy.h:52">NGX_SPDY_SETTINGS_VAL_SIZE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L141" title="core/ngx_log.h:141">ngx_log_debug3</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy SETTINGS entry fl:</span><span class="Special">%u</span><span class="Constant">i id:</span><span class="Special">%u</span><span class="Constant">i val:</span><span class="Special">%u</span><span class="Constant">i&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L55" title="http/ngx_http_spdy.c:55">ngx_spdy_frame_flags</a>(fid), <a href="#L57" title="http/ngx_http_spdy.c:57">ngx_spdy_frame_id</a>(fid), val);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L55" title="http/ngx_http_spdy.c:55">ngx_spdy_frame_flags</a>(fid) == <a href="#L79" title="http/ngx_http_spdy.c:79">NGX_SPDY_SETTINGS_FLAG_PERSISTED</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (<a href="#L57" title="http/ngx_http_spdy.c:57">ngx_spdy_frame_id</a>(fid)) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="#L76" title="http/ngx_http_spdy.c:76">NGX_SPDY_SETTINGS_INIT_WINDOW</a>:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (val &gt; <a href="#L81" title="http/ngx_http_spdy.c:81">NGX_SPDY_MAX_WINDOW</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent SETTINGS frame with &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;incorrect INIT_WINDOW value: </span><span class="Special">%u</span><span class="Constant">i&quot;</span>, val);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L3625" title="http/ngx_http_spdy.c:3625">ngx_http_spdy_adjust_windows</a>(sc, val - sc-&gt;init_window)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;init_window = val;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1930" title="http/ngx_http_spdy.c:1930">ngx_http_spdy_state_complete</a>(sc, pos, end);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L1930">&#x200c;</a><span class="linkable">ngx_http_spdy_state_complete</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, u_char *pos,<br/></li>
<li>&nbsp; &nbsp; u_char *end)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy frame complete pos:</span><span class="Special">%p</span><span class="Constant"> end:</span><span class="Special">%p</span><span class="Constant">&quot;</span>, pos, end);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (pos &gt; end) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;receive buffer overrun&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/unix/ngx_process.c.html#L594" title="os/unix/ngx_process.c:594">ngx_debug_point</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;handler = <a href="#L839" title="http/ngx_http_spdy.c:839">ngx_http_spdy_state_head</a>;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;stream = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> pos;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L1952">&#x200c;</a><span class="linkable">ngx_http_spdy_state_save</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; u_char *pos, u_char *end, <a href="ngx_http_spdy.h.html#L75" title="http/ngx_http_spdy.h:75">ngx_http_spdy_handler_pt</a> handler)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; size;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L141" title="core/ngx_log.h:141">ngx_log_debug3</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy frame state save pos:</span><span class="Special">%p</span><span class="Constant"> end:</span><span class="Special">%p</span><span class="Constant"> handler:</span><span class="Special">%p</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; pos, end, handler);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; size = end - pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (size &gt; <a href="ngx_http_spdy.h.html#L23" title="http/ngx_http_spdy.h:23">NGX_SPDY_STATE_BUFFER_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;state buffer <a href="../event/modules/ngx_rtsig_module.c.html#L76" title="event/modules/ngx_rtsig_module.c:76">overflow</a>: </span><span class="Special">%u</span><span class="Constant">z bytes required&quot;</span>, size);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/unix/ngx_process.c.html#L594" title="os/unix/ngx_process.c:594">ngx_debug_point</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.c.html#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(sc-&gt;buffer, pos, <a href="ngx_http_spdy.h.html#L23" title="http/ngx_http_spdy.h:23">NGX_SPDY_STATE_BUFFER_SIZE</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;buffer_used = size;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;handler = handler;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;incomplete = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> end;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L1982">&#x200c;</a><span class="linkable">ngx_http_spdy_state_inflate_error</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, <span class="Type">int</span> rc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rc == Z_DATA_ERROR || rc == Z_STREAM_END) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent SYN_STREAM frame with &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;corrupted header block, inflate() failed: </span><span class="Special">%d</span><span class="Constant">&quot;</span>, rc);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2000" title="http/ngx_http_spdy.c:2000">ngx_http_spdy_state_protocol_error</a>(sc);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L20" title="core/ngx_log.h:20">NGX_LOG_ERR</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;inflate() failed: </span><span class="Special">%d</span><span class="Constant">&quot;</span>, rc);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L2017" title="http/ngx_http_spdy.c:2017">ngx_http_spdy_state_internal_error</a>(sc);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L2000">&#x200c;</a><span class="linkable">ngx_http_spdy_state_protocol_error</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy state protocol error&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;stream) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;stream-&gt;out_closed = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L3318" title="http/ngx_http_spdy.c:3318">ngx_http_spdy_close_stream</a>(sc-&gt;stream, <a href="ngx_http_request.h.html#L84" title="http/ngx_http_request.h:84">NGX_HTTP_BAD_REQUEST</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L3556" title="http/ngx_http_spdy.c:3556">ngx_http_spdy_finalize_connection</a>(sc, <a href="ngx_http_request.h.html#L125" title="http/ngx_http_request.h:125">NGX_HTTP_CLIENT_CLOSED_REQUEST</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L2017">&#x200c;</a><span class="linkable">ngx_http_spdy_state_internal_error</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy state internal error&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;stream) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;stream-&gt;out_closed = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L3318" title="http/ngx_http_spdy.c:3318">ngx_http_spdy_close_stream</a>(sc-&gt;stream, <a href="ngx_http_request.h.html#L128" title="http/ngx_http_request.h:128">NGX_HTTP_INTERNAL_SERVER_ERROR</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L3556" title="http/ngx_http_spdy.c:3556">ngx_http_spdy_finalize_connection</a>(sc, <a href="ngx_http_request.h.html#L128" title="http/ngx_http_request.h:128">NGX_HTTP_INTERNAL_SERVER_ERROR</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L2034">&#x200c;</a><span class="linkable">ngx_http_spdy_send_window_update</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> sid,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> delta)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_buf.h.html#L18" title="core/ngx_buf.h:18">ngx_buf_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L72" title="http/ngx_http_spdy.h:72">ngx_http_spdy_out_frame_t</a>&nbsp; *frame;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy send WINDOW_UPDATE sid:</span><span class="Special">%u</span><span class="Constant">i delta:</span><span class="Special">%u</span><span class="Constant">i&quot;</span>, sid, delta);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; frame = <a href="#L2232" title="http/ngx_http_spdy.c:2232">ngx_http_spdy_get_ctl_frame</a>(sc, <a href="ngx_http_spdy.h.html#L46" title="http/ngx_http_spdy.h:46">NGX_SPDY_WINDOW_UPDATE_SIZE</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L57" title="http/ngx_http_spdy.h:57">NGX_SPDY_HIGHEST_PRIORITY</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (frame == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; buf = frame-&gt;first-&gt;buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = buf-&gt;pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L250" title="http/ngx_http_spdy.h:250">ngx_spdy_frame_write_head</a>(p, <a href="ngx_http_spdy.h.html#L34" title="http/ngx_http_spdy.h:34">NGX_SPDY_WINDOW_UPDATE</a>);<br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L253" title="http/ngx_http_spdy.h:253">ngx_spdy_frame_write_flags_and_len</a>(p, <span class="Constant">0</span>, <a href="ngx_http_spdy.h.html#L46" title="http/ngx_http_spdy.h:46">NGX_SPDY_WINDOW_UPDATE_SIZE</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L258" title="http/ngx_http_spdy.h:258">ngx_spdy_frame_write_sid</a>(p, sid);<br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L222" title="http/ngx_http_spdy.h:222">ngx_spdy_frame_aligned_write_uint32</a>(p, delta);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; buf-&gt;last = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L170" title="http/ngx_http_spdy.h:170">ngx_http_spdy_queue_frame</a>(sc, frame);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L2069">&#x200c;</a><span class="linkable">ngx_http_spdy_send_rst_stream</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> sid,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> status, <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> priority)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_buf.h.html#L18" title="core/ngx_buf.h:18">ngx_buf_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L72" title="http/ngx_http_spdy.h:72">ngx_http_spdy_out_frame_t</a>&nbsp; *frame;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;connection-&gt;error) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy send RST_STREAM sid:</span><span class="Special">%u</span><span class="Constant">i st:</span><span class="Special">%u</span><span class="Constant">i&quot;</span>, sid, status);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; frame = <a href="#L2232" title="http/ngx_http_spdy.c:2232">ngx_http_spdy_get_ctl_frame</a>(sc, <a href="ngx_http_spdy.h.html#L43" title="http/ngx_http_spdy.h:43">NGX_SPDY_RST_STREAM_SIZE</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; priority);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (frame == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; buf = frame-&gt;first-&gt;buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = buf-&gt;pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L250" title="http/ngx_http_spdy.h:250">ngx_spdy_frame_write_head</a>(p, <a href="ngx_http_spdy.h.html#L29" title="http/ngx_http_spdy.h:29">NGX_SPDY_RST_STREAM</a>);<br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L253" title="http/ngx_http_spdy.h:253">ngx_spdy_frame_write_flags_and_len</a>(p, <span class="Constant">0</span>, <a href="ngx_http_spdy.h.html#L43" title="http/ngx_http_spdy.h:43">NGX_SPDY_RST_STREAM_SIZE</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L258" title="http/ngx_http_spdy.h:258">ngx_spdy_frame_write_sid</a>(p, sid);<br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L222" title="http/ngx_http_spdy.h:222">ngx_spdy_frame_aligned_write_uint32</a>(p, status);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; buf-&gt;last = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L170" title="http/ngx_http_spdy.h:170">ngx_http_spdy_queue_frame</a>(sc, frame);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">#if 0<br/></li>
<li></span><span class="Comment">static <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li></span><span class="Comment">ngx_http_spdy_send_goaway(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc)<br/></li>
<li></span><span class="Comment">{<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; <a href="../core/ngx_buf.h.html#L18" title="core/ngx_buf.h:18">ngx_buf_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L72" title="http/ngx_http_spdy.h:72">ngx_http_spdy_out_frame_t</a>&nbsp; *frame;<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, 0,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &quot;spdy send GOAWAY sid:%ui&quot;, sc-&gt;last_sid);<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; frame = <a href="#L2232" title="http/ngx_http_spdy.c:2232">ngx_http_spdy_get_ctl_frame</a>(sc, <a href="ngx_http_spdy.h.html#L45" title="http/ngx_http_spdy.h:45">NGX_SPDY_GOAWAY_SIZE</a>,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L57" title="http/ngx_http_spdy.h:57">NGX_SPDY_HIGHEST_PRIORITY</a>);<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; if (frame == NULL) {<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; return <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; }<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; buf = frame-&gt;first-&gt;buf;<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; p = buf-&gt;pos;<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L250" title="http/ngx_http_spdy.h:250">ngx_spdy_frame_write_head</a>(p, <a href="ngx_http_spdy.h.html#L32" title="http/ngx_http_spdy.h:32">NGX_SPDY_GOAWAY</a>);<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L253" title="http/ngx_http_spdy.h:253">ngx_spdy_frame_write_flags_and_len</a>(p, 0, <a href="ngx_http_spdy.h.html#L45" title="http/ngx_http_spdy.h:45">NGX_SPDY_GOAWAY_SIZE</a>);<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L258" title="http/ngx_http_spdy.h:258">ngx_spdy_frame_write_sid</a>(p, sc-&gt;last_sid);<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; buf-&gt;last = p;<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L170" title="http/ngx_http_spdy.h:170">ngx_http_spdy_queue_frame</a>(sc, frame);<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; return <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li></span><span class="Comment">}<br/></li>
<li></span><span class="Comment">#endif<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L2143">&#x200c;</a><span class="linkable">ngx_http_spdy_send_settings</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_buf.h.html#L18" title="core/ngx_buf.h:18">ngx_buf_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L16" title="core/ngx_core.h:16">ngx_chain_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *cl;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy_module.h.html#L30" title="http/ngx_http_spdy_module.h:30">ngx_http_spdy_srv_conf_t</a>&nbsp;&nbsp; *sscf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L72" title="http/ngx_http_spdy.h:72">ngx_http_spdy_out_frame_t</a>&nbsp; *frame;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy send SETTINGS frame&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; frame = <a href="../core/ngx_palloc.c.html#L120" title="core/ngx_palloc.c:120">ngx_palloc</a>(sc-&gt;pool, <span class="Statement">sizeof</span>(<a href="ngx_http_spdy.h.html#L72" title="http/ngx_http_spdy.h:72">ngx_http_spdy_out_frame_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (frame == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cl = <a href="../core/ngx_buf.c.html#L48" title="core/ngx_buf.c:48">ngx_alloc_chain_link</a>(sc-&gt;pool);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cl == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; buf = <a href="../core/ngx_buf.c.html#L13" title="core/ngx_buf.c:13">ngx_create_temp_buf</a>(sc-&gt;pool, <a href="ngx_http_spdy.h.html#L36" title="http/ngx_http_spdy.h:36">NGX_SPDY_FRAME_HEADER_SIZE</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + <a href="ngx_http_spdy.h.html#L50" title="http/ngx_http_spdy.h:50">NGX_SPDY_SETTINGS_NUM_SIZE</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + <span class="Constant">2</span> * <a href="ngx_http_spdy.h.html#L54" title="http/ngx_http_spdy.h:54">NGX_SPDY_SETTINGS_PAIR_SIZE</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (buf == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; buf-&gt;last_buf = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cl-&gt;buf = buf;<br/></li>
<li>&nbsp; &nbsp; cl-&gt;next = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; frame-&gt;first = cl;<br/></li>
<li>&nbsp; &nbsp; frame-&gt;last = cl;<br/></li>
<li>&nbsp; &nbsp; frame-&gt;handler = <a href="#L2214" title="http/ngx_http_spdy.c:2214">ngx_http_spdy_settings_frame_handler</a>;<br/></li>
<li>&nbsp; &nbsp; frame-&gt;stream = <span class="Constant">NULL</span>;<br/></li>
<li><span class="PreProc">#if (NGX_DEBUG)<br/></li>
<li></span>&nbsp; &nbsp; frame-&gt;length = <a href="ngx_http_spdy.h.html#L50" title="http/ngx_http_spdy.h:50">NGX_SPDY_SETTINGS_NUM_SIZE</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + <span class="Constant">2</span> * <a href="ngx_http_spdy.h.html#L54" title="http/ngx_http_spdy.h:54">NGX_SPDY_SETTINGS_PAIR_SIZE</a>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; frame-&gt;priority = <a href="ngx_http_spdy.h.html#L57" title="http/ngx_http_spdy.h:57">NGX_SPDY_HIGHEST_PRIORITY</a>;<br/></li>
<li>&nbsp; &nbsp; frame-&gt;blocked = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = buf-&gt;pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L250" title="http/ngx_http_spdy.h:250">ngx_spdy_frame_write_head</a>(p, <a href="ngx_http_spdy.h.html#L30" title="http/ngx_http_spdy.h:30">NGX_SPDY_SETTINGS</a>);<br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L253" title="http/ngx_http_spdy.h:253">ngx_spdy_frame_write_flags_and_len</a>(p, <a href="ngx_http_spdy.h.html#L62" title="http/ngx_http_spdy.h:62">NGX_SPDY_FLAG_CLEAR_SETTINGS</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="ngx_http_spdy.h.html#L50" title="http/ngx_http_spdy.h:50">NGX_SPDY_SETTINGS_NUM_SIZE</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; + <span class="Constant">2</span> * <a href="ngx_http_spdy.h.html#L54" title="http/ngx_http_spdy.h:54">NGX_SPDY_SETTINGS_PAIR_SIZE</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L222" title="http/ngx_http_spdy.h:222">ngx_spdy_frame_aligned_write_uint32</a>(p, <span class="Constant">2</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sscf = <a href="ngx_http_config.h.html#L57" title="http/ngx_http_config.h:57">ngx_http_get_module_srv_conf</a>(sc-&gt;http_connection-&gt;conf_ctx,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_spdy_module.c.html#L131" title="http/ngx_http_spdy_module.c:131">ngx_http_spdy_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L255" title="http/ngx_http_spdy.h:255">ngx_spdy_frame_write_flags_and_id</a>(p, <span class="Constant">0</span>, <a href="#L75" title="http/ngx_http_spdy.c:75">NGX_SPDY_SETTINGS_MAX_STREAMS</a>);<br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L222" title="http/ngx_http_spdy.h:222">ngx_spdy_frame_aligned_write_uint32</a>(p, sscf-&gt;concurrent_streams);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L255" title="http/ngx_http_spdy.h:255">ngx_spdy_frame_write_flags_and_id</a>(p, <span class="Constant">0</span>, <a href="#L76" title="http/ngx_http_spdy.c:76">NGX_SPDY_SETTINGS_INIT_WINDOW</a>);<br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_http_spdy.h.html#L222" title="http/ngx_http_spdy.h:222">ngx_spdy_frame_aligned_write_uint32</a>(p, <a href="#L84" title="http/ngx_http_spdy.c:84">NGX_SPDY_STREAM_WINDOW</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; buf-&gt;last = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L170" title="http/ngx_http_spdy.h:170">ngx_http_spdy_queue_frame</a>(sc, frame);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L2214">&#x200c;</a><span class="linkable">ngx_http_spdy_settings_frame_handler</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L72" title="http/ngx_http_spdy.h:72">ngx_http_spdy_out_frame_t</a> *frame)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_buf.h.html#L18" title="core/ngx_buf.h:18">ngx_buf_t</a>&nbsp; *buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; buf = frame-&gt;first-&gt;buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (buf-&gt;pos != buf-&gt;last) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L31" title="core/ngx_core.h:31">NGX_AGAIN</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_buf.h.html#L146" title="core/ngx_buf.h:146">ngx_free_chain</a>(sc-&gt;pool, frame-&gt;first);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="ngx_http_spdy.h.html#L72" title="http/ngx_http_spdy.h:72">ngx_http_spdy_out_frame_t</a> *<br/></li>
<li><a id="L2232">&#x200c;</a><span class="linkable">ngx_http_spdy_get_ctl_frame</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, <span class="Type">size_t</span> length,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> priority)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L16" title="core/ngx_core.h:16">ngx_chain_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *cl;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L72" title="http/ngx_http_spdy.h:72">ngx_http_spdy_out_frame_t</a>&nbsp; *frame;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; frame = sc-&gt;free_ctl_frames;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (frame) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;free_ctl_frames = frame-&gt;next;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cl = frame-&gt;first;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cl-&gt;buf-&gt;pos = cl-&gt;buf-&gt;start;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; frame = <a href="../core/ngx_palloc.c.html#L120" title="core/ngx_palloc.c:120">ngx_palloc</a>(sc-&gt;pool, <span class="Statement">sizeof</span>(<a href="ngx_http_spdy.h.html#L72" title="http/ngx_http_spdy.h:72">ngx_http_spdy_out_frame_t</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (frame == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cl = <a href="../core/ngx_buf.c.html#L48" title="core/ngx_buf.c:48">ngx_alloc_chain_link</a>(sc-&gt;pool);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cl == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cl-&gt;buf = <a href="../core/ngx_buf.c.html#L13" title="core/ngx_buf.c:13">ngx_create_temp_buf</a>(sc-&gt;pool,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L61" title="http/ngx_http_spdy.c:61">NGX_SPDY_CTL_FRAME_BUFFER_SIZE</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cl-&gt;buf == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cl-&gt;buf-&gt;last_buf = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; frame-&gt;first = cl;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; frame-&gt;last = cl;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; frame-&gt;handler = <a href="#L2289" title="http/ngx_http_spdy.c:2289">ngx_http_spdy_ctl_frame_handler</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; frame-&gt;stream = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_DEBUG)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (length &gt; <a href="#L61" title="http/ngx_http_spdy.c:61">NGX_SPDY_CTL_FRAME_BUFFER_SIZE</a> - <a href="ngx_http_spdy.h.html#L36" title="http/ngx_http_spdy.h:36">NGX_SPDY_FRAME_HEADER_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, sc-&gt;pool-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;requested control frame is too large: </span><span class="Special">%u</span><span class="Constant">z&quot;</span>, length);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; frame-&gt;length = length;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; frame-&gt;priority = priority;<br/></li>
<li>&nbsp; &nbsp; frame-&gt;blocked = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> frame;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L2289">&#x200c;</a><span class="linkable">ngx_http_spdy_ctl_frame_handler</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L72" title="http/ngx_http_spdy.h:72">ngx_http_spdy_out_frame_t</a> *frame)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_buf.h.html#L18" title="core/ngx_buf.h:18">ngx_buf_t</a>&nbsp; *buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; buf = frame-&gt;first-&gt;buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (buf-&gt;pos != buf-&gt;last) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L31" title="core/ngx_core.h:31">NGX_AGAIN</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; frame-&gt;next = sc-&gt;free_ctl_frames;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;free_ctl_frames = frame;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a> *<br/></li>
<li><a id="L2308">&#x200c;</a><span class="linkable">ngx_http_spdy_create_stream</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> id,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> priority)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L17" title="core/ngx_core.h:17">ngx_log_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *log;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; index;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *rev, *wev;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *fc;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L20" title="http/ngx_http.h:20">ngx_http_log_ctx_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *ctx;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *r;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>&nbsp; &nbsp; *stream;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_core_module.h.html#L212" title="http/ngx_http_core_module.h:212">ngx_http_core_srv_conf_t</a>&nbsp; *cscf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy_module.h.html#L30" title="http/ngx_http_spdy_module.h:30">ngx_http_spdy_srv_conf_t</a>&nbsp; *sscf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; fc = sc-&gt;free_fake_connections;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fc) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;free_fake_connections = fc-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rev = fc-&gt;read;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; wev = fc-&gt;write;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; log = fc-&gt;log;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ctx = log-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fc = <a href="../core/ngx_palloc.c.html#L120" title="core/ngx_palloc.c:120">ngx_palloc</a>(sc-&gt;pool, <span class="Statement">sizeof</span>(<a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (fc == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rev = <a href="../core/ngx_palloc.c.html#L120" title="core/ngx_palloc.c:120">ngx_palloc</a>(sc-&gt;pool, <span class="Statement">sizeof</span>(<a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rev == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; wev = <a href="../core/ngx_palloc.c.html#L120" title="core/ngx_palloc.c:120">ngx_palloc</a>(sc-&gt;pool, <span class="Statement">sizeof</span>(<a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (wev == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; log = <a href="../core/ngx_palloc.c.html#L120" title="core/ngx_palloc.c:120">ngx_palloc</a>(sc-&gt;pool, <span class="Statement">sizeof</span>(<a href="../core/ngx_core.h.html#L17" title="core/ngx_core.h:17">ngx_log_t</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (log == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ctx = <a href="../core/ngx_palloc.c.html#L120" title="core/ngx_palloc.c:120">ngx_palloc</a>(sc-&gt;pool, <span class="Statement">sizeof</span>(<a href="ngx_http.h.html#L20" title="http/ngx_http.h:20">ngx_http_log_ctx_t</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ctx == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ctx-&gt;connection = fc;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ctx-&gt;request = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.c.html#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(log, sc-&gt;connection-&gt;log, <span class="Statement">sizeof</span>(<a href="../core/ngx_core.h.html#L17" title="core/ngx_core.h:17">ngx_log_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; log-&gt;data = ctx;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L86" title="core/ngx_string.h:86">ngx_memzero</a>(rev, <span class="Statement">sizeof</span>(<a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rev-&gt;data = fc;<br/></li>
<li>&nbsp; &nbsp; rev-&gt;ready = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; rev-&gt;handler = <a href="#L3302" title="http/ngx_http_spdy.c:3302">ngx_http_spdy_close_stream_handler</a>;<br/></li>
<li>&nbsp; &nbsp; rev-&gt;log = log;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.c.html#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(wev, rev, <span class="Statement">sizeof</span>(<a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; wev-&gt;write = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.c.html#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(fc, sc-&gt;connection, <span class="Statement">sizeof</span>(<a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; fc-&gt;data = sc-&gt;http_connection;<br/></li>
<li>&nbsp; &nbsp; fc-&gt;read = rev;<br/></li>
<li>&nbsp; &nbsp; fc-&gt;write = wev;<br/></li>
<li>&nbsp; &nbsp; fc-&gt;sent = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; fc-&gt;log = log;<br/></li>
<li>&nbsp; &nbsp; fc-&gt;buffered = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; fc-&gt;sndlowat = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; fc-&gt;tcp_nodelay = NGX_TCP_NODELAY_DISABLED;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r = <a href="ngx_http_request.c.html#L504" title="http/ngx_http_request.c:504">ngx_http_create_request</a>(fc);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;valid_location = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; fc-&gt;data = r;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;connection-&gt;requests++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cscf = <a href="ngx_http_config.h.html#L57" title="http/ngx_http_config.h:57">ngx_http_get_module_srv_conf</a>(r, <a href="ngx_http_core_module.c.html#L811" title="http/ngx_http_core_module.c:811">ngx_http_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;header_in = <a href="../core/ngx_buf.c.html#L13" title="core/ngx_buf.c:13">ngx_create_temp_buf</a>(r-&gt;pool,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; cscf-&gt;client_header_buffer_size);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;header_in == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3410" title="http/ngx_http_request.c:3410">ngx_http_free_request</a>(r, <a href="ngx_http_request.h.html#L128" title="http/ngx_http_request.h:128">NGX_HTTP_INTERNAL_SERVER_ERROR</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;headers_in.connection_type = <a href="ngx_http_request.h.html#L44" title="http/ngx_http_request.h:44">NGX_HTTP_CONNECTION_CLOSE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream = <a href="../core/ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(r-&gt;pool, <span class="Statement">sizeof</span>(<a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (stream == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3410" title="http/ngx_http_request.c:3410">ngx_http_free_request</a>(r, <a href="ngx_http_request.h.html#L128" title="http/ngx_http_request.h:128">NGX_HTTP_INTERNAL_SERVER_ERROR</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;spdy_stream = stream;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream-&gt;id = id;<br/></li>
<li>&nbsp; &nbsp; stream-&gt;request = r;<br/></li>
<li>&nbsp; &nbsp; stream-&gt;connection = sc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream-&gt;send_window = sc-&gt;init_window;<br/></li>
<li>&nbsp; &nbsp; stream-&gt;recv_window = <a href="#L84" title="http/ngx_http_spdy.c:84">NGX_SPDY_STREAM_WINDOW</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream-&gt;priority = priority;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sscf = <a href="ngx_http_config.h.html#L57" title="http/ngx_http_config.h:57">ngx_http_get_module_srv_conf</a>(r, <a href="ngx_http_spdy_module.c.html#L131" title="http/ngx_http_spdy_module.c:131">ngx_http_spdy_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; index = <a href="#L153" title="http/ngx_http_spdy.c:153">ngx_http_spdy_stream_index</a>(sscf, id);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream-&gt;index = sc-&gt;streams_index[index];<br/></li>
<li>&nbsp; &nbsp; sc-&gt;streams_index[index] = stream;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;processing++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> stream;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a> *<br/></li>
<li><a id="L2439">&#x200c;</a><span class="linkable">ngx_http_spdy_get_stream_by_id</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> sid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>&nbsp; &nbsp; *stream;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy_module.h.html#L30" title="http/ngx_http_spdy_module.h:30">ngx_http_spdy_srv_conf_t</a>&nbsp; *sscf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sscf = <a href="ngx_http_config.h.html#L57" title="http/ngx_http_config.h:57">ngx_http_get_module_srv_conf</a>(sc-&gt;http_connection-&gt;conf_ctx,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_spdy_module.c.html#L131" title="http/ngx_http_spdy_module.c:131">ngx_http_spdy_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream = sc-&gt;streams_index[<a href="#L153" title="http/ngx_http_spdy.c:153">ngx_http_spdy_stream_index</a>(sscf, sid)];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (stream) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (stream-&gt;id == sid) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> stream;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; stream = stream-&gt;index;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L2463">&#x200c;</a><span class="linkable">ngx_http_spdy_parse_header</span>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p, *end, ch;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hash;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_core_module.h.html#L212" title="http/ngx_http_core_module.h:212">ngx_http_core_srv_conf_t</a>&nbsp;&nbsp; *cscf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Type">enum</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sw_name_len = <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sw_name,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sw_value_len,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sw_value<br/></li>
<li>&nbsp; &nbsp; } state;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; state = r-&gt;state;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = r-&gt;header_in-&gt;pos;<br/></li>
<li>&nbsp; &nbsp; end = r-&gt;header_in-&gt;last;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (state) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> sw_name_len:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (end - p &lt; <a href="ngx_http_spdy.h.html#L48" title="http/ngx_http_spdy.h:48">NGX_SPDY_NV_NLEN_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L31" title="core/ngx_core.h:31">NGX_AGAIN</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;lowcase_index = <a href="#L33" title="http/ngx_http_spdy.c:33">ngx_spdy_frame_parse_uint32</a>(p);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;lowcase_index == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* null-terminate the previous header value */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; *p = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p += <a href="ngx_http_spdy.h.html#L48" title="http/ngx_http_spdy.h:48">NGX_SPDY_NV_NLEN_SIZE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;invalid_header = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; state = sw_name;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* fall through */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> sw_name:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((<a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) (end - p) &lt; r-&gt;lowcase_index) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cscf = <a href="ngx_http_config.h.html#L57" title="http/ngx_http_config.h:57">ngx_http_get_module_srv_conf</a>(r, <a href="ngx_http_core_module.c.html#L811" title="http/ngx_http_core_module.c:811">ngx_http_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_name_start = p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_name_end = p + r-&gt;lowcase_index;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p[<span class="Constant">0</span>] == <span class="Constant">':'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; hash = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> ( <span class="Comment">/* void */</span> ; p != r-&gt;header_name_end; p++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch = *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hash = <a href="../core/ngx_hash.h.html#L111" title="core/ngx_hash.h:111">ngx_hash</a>(hash, ch);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((ch &gt;= <span class="Constant">'a'</span> &amp;&amp; ch &lt;= <span class="Constant">'z'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || (ch == <span class="Constant">'-'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || (ch &gt;= <span class="Constant">'0'</span> &amp;&amp; ch &lt;= <span class="Constant">'9'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || (ch == <span class="Constant">'_'</span> &amp;&amp; cscf-&gt;underscores_in_headers))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (ch) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Special">'\0'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../core/ngx_core.h.html#L84" title="core/ngx_core.h:84">LF</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../core/ngx_core.h.html#L85" title="core/ngx_core.h:85">CR</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">':'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent invalid header name: </span><span class="Special">\&quot;%*s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;lowcase_index, r-&gt;header_name_start);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_request.h.html#L58" title="http/ngx_http_request.h:58">NGX_HTTP_PARSE_INVALID_HEADER</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch &gt;= <span class="Constant">'A'</span> &amp;&amp; ch &lt;= <span class="Constant">'Z'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;invalid_header = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_hash = hash;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; state = sw_value_len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* fall through */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> sw_value_len:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (end - p &lt; <a href="ngx_http_spdy.h.html#L49" title="http/ngx_http_spdy.h:49">NGX_SPDY_NV_VLEN_SIZE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;lowcase_index = <a href="#L33" title="http/ngx_http_spdy.c:33">ngx_spdy_frame_parse_uint32</a>(p);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* null-terminate header name */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; *p = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p += <a href="ngx_http_spdy.h.html#L49" title="http/ngx_http_spdy.h:49">NGX_SPDY_NV_VLEN_SIZE</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; state = sw_value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* fall through */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> sw_value:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((<a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) (end - p) &lt; r-&gt;lowcase_index) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_start = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (r-&gt;lowcase_index--) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch = *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Special">'\0'</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p == r-&gt;header_start) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_end = p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_in-&gt;pos = p + <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;state = sw_value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <a href="../core/ngx_core.h.html#L85" title="core/ngx_core.h:85">CR</a> || ch == <a href="../core/ngx_core.h.html#L84" title="core/ngx_core.h:84">LF</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent header </span><span class="Special">\&quot;%*s\&quot;</span><span class="Constant"> with &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;invalid value: </span><span class="Special">\&quot;%*s\\%c</span><span class="Constant">...</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_name_end - r-&gt;header_name_start,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_name_start,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p - r-&gt;header_start,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_start,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch == <a href="../core/ngx_core.h.html#L85" title="core/ngx_core.h:85">CR</a> ? <span class="Constant">'r'</span> : <span class="Constant">'n'</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_request.h.html#L58" title="http/ngx_http_request.h:58">NGX_HTTP_PARSE_INVALID_HEADER</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_end = p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_in-&gt;pos = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;state = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L33" title="core/ngx_core.h:33">NGX_DONE</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;header_in-&gt;pos = p;<br/></li>
<li>&nbsp; &nbsp; r-&gt;state = state;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L31" title="core/ngx_core.h:31">NGX_AGAIN</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L2636">&#x200c;</a><span class="linkable">ngx_http_spdy_alloc_large_header_buffer</span>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *old, *new, *p;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; rest;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_buf.h.html#L18" title="core/ngx_buf.h:18">ngx_buf_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *buf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>&nbsp; &nbsp; *stream;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_core_module.h.html#L212" title="http/ngx_http_core_module.h:212">ngx_http_core_srv_conf_t</a>&nbsp; *cscf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy alloc large header buffer&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream = r-&gt;spdy_stream;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cscf = <a href="ngx_http_config.h.html#L57" title="http/ngx_http_config.h:57">ngx_http_get_module_srv_conf</a>(r, <a href="ngx_http_core_module.c.html#L811" title="http/ngx_http_core_module.c:811">ngx_http_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (stream-&gt;header_buffers<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; == (<a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) cscf-&gt;large_client_header_buffers.num)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent too large request&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L34" title="core/ngx_core.h:34">NGX_DECLINED</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rest = r-&gt;header_in-&gt;last - r-&gt;header_in-&gt;pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * One more byte is needed for null-termination<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * and another one for further progress.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (rest &gt; cscf-&gt;large_client_header_buffers.size - <span class="Constant">2</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = r-&gt;header_in-&gt;pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rest &gt; <a href="../core/ngx_log.h.html#L74" title="core/ngx_log.h:74">NGX_MAX_ERROR_STR</a> - <span class="Constant">300</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rest = <a href="../core/ngx_log.h.html#L74" title="core/ngx_log.h:74">NGX_MAX_ERROR_STR</a> - <span class="Constant">300</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent too long header name or value: </span><span class="Special">\&quot;%*s</span><span class="Constant">...</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rest, p);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L34" title="core/ngx_core.h:34">NGX_DECLINED</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; buf = <a href="../core/ngx_buf.c.html#L13" title="core/ngx_buf.c:13">ngx_create_temp_buf</a>(r-&gt;pool, cscf-&gt;large_client_header_buffers.size);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (buf == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy large header alloc: </span><span class="Special">%p</span><span class="Constant"> </span><span class="Special">%u</span><span class="Constant">z&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; buf-&gt;pos, buf-&gt;end - buf-&gt;last);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; old = r-&gt;header_in-&gt;pos;<br/></li>
<li>&nbsp; &nbsp; new = buf-&gt;pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rest) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; buf-&gt;last = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(new, old, rest);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;header_in = buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream-&gt;header_buffers++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L2705">&#x200c;</a><span class="linkable">ngx_http_spdy_handle_request_header</span>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_hash.h.html#L97" title="core/ngx_hash.h:97">ngx_table_elt_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *h;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_core_module.h.html#L212" title="http/ngx_http_core_module.h:212">ngx_http_core_srv_conf_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *cscf;<br/></li>
<li>&nbsp; &nbsp; <a href="#L91" title="http/ngx_http_spdy.c:91">ngx_http_spdy_request_header_t</a>&nbsp; *sh;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;invalid_header) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cscf = <a href="ngx_http_config.h.html#L57" title="http/ngx_http_config.h:57">ngx_http_get_module_srv_conf</a>(r, <a href="ngx_http_core_module.c.html#L811" title="http/ngx_http_core_module.c:811">ngx_http_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cscf-&gt;ignore_invalid_headers) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent invalid header: </span><span class="Special">\&quot;%*s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_end - r-&gt;header_name_start,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_name_start);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;header_name_start[<span class="Constant">0</span>] == <span class="Constant">':'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_name_start++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; <a href="#L379" title="http/ngx_http_spdy.c:379">NGX_SPDY_REQUEST_HEADERS</a>; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sh = &amp;<a href="#L371" title="http/ngx_http_spdy.c:371">ngx_http_spdy_request_headers</a>[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sh-&gt;hash != r-&gt;header_hash<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || sh-&gt;len != r-&gt;header_name_end - r-&gt;header_name_start<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <a href="../core/ngx_string.h.html#L53" title="core/ngx_string.h:53">ngx_strncmp</a>(sh-&gt;header, r-&gt;header_name_start, sh-&gt;len) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> sh-&gt;handler(r);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent invalid header name: </span><span class="Special">\&quot;</span><span class="Constant">:</span><span class="Special">%*s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_end - r-&gt;header_name_start,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_name_start);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_request.h.html#L58" title="http/ngx_http_request.h:58">NGX_HTTP_PARSE_INVALID_HEADER</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; h = <a href="../core/ngx_list.c.html#L31" title="core/ngx_list.c:31">ngx_list_push</a>(&amp;r-&gt;headers_in.headers);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (h == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; h-&gt;hash = r-&gt;header_hash;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; h-&gt;key.len = r-&gt;header_name_end - r-&gt;header_name_start;<br/></li>
<li>&nbsp; &nbsp; h-&gt;key.data = r-&gt;header_name_start;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; h-&gt;value.len = r-&gt;header_end - r-&gt;header_start;<br/></li>
<li>&nbsp; &nbsp; h-&gt;value.data = r-&gt;header_start;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; h-&gt;lowcase_key = h-&gt;key.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L2769">&#x200c;</a></span><span class="linkable">ngx_http_spdy_request_headers_init</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <a href="#L91" title="http/ngx_http_spdy.c:91">ngx_http_spdy_request_header_t</a>&nbsp; *h;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; <a href="#L379" title="http/ngx_http_spdy.c:379">NGX_SPDY_REQUEST_HEADERS</a>; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; h = &amp;<a href="#L371" title="http/ngx_http_spdy.c:371">ngx_http_spdy_request_headers</a>[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; h-&gt;hash = <a href="../core/ngx_hash.c.html#L603" title="core/ngx_hash.c:603">ngx_hash_key</a>(h-&gt;header, h-&gt;len);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L2782">&#x200c;</a><span class="linkable">ngx_http_spdy_parse_method</span>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; k, len;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp;&nbsp; n;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> u_char&nbsp; *p, *m;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * This array takes less than 256 sequential bytes,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * and if typical CPU cache line size is 64 bytes,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * it is prefetched for 4 load operations.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">const</span> <span class="Type">struct</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">const</span> u_char&nbsp; &nbsp; &nbsp; method[<span class="Constant">11</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">uint32_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value;<br/></li>
<li>&nbsp; &nbsp; } tests[] = {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { <span class="Constant">3</span>, <span class="Constant">&quot;<a href="../core/ngx_md5.c.html#L152" title="core/ngx_md5.c:152">GET</a>&quot;</span>,&nbsp; &nbsp; &nbsp;&nbsp; <a href="ngx_http_request.h.html#L28" title="http/ngx_http_request.h:28">NGX_HTTP_GET</a> },<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { <span class="Constant">4</span>, <span class="Constant">&quot;POST&quot;</span>,&nbsp; &nbsp; &nbsp; <a href="ngx_http_request.h.html#L30" title="http/ngx_http_request.h:30">NGX_HTTP_POST</a> },<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { <span class="Constant">4</span>, <span class="Constant">&quot;HEAD&quot;</span>,&nbsp; &nbsp; &nbsp; <a href="ngx_http_request.h.html#L29" title="http/ngx_http_request.h:29">NGX_HTTP_HEAD</a> },<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { <span class="Constant">7</span>, <span class="Constant">&quot;OPTIONS&quot;</span>,&nbsp;&nbsp; <a href="ngx_http_request.h.html#L36" title="http/ngx_http_request.h:36">NGX_HTTP_OPTIONS</a> },<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { <span class="Constant">8</span>, <span class="Constant">&quot;PROPFIND&quot;</span>,&nbsp; <a href="ngx_http_request.h.html#L37" title="http/ngx_http_request.h:37">NGX_HTTP_PROPFIND</a> },<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { <span class="Constant">3</span>, <span class="Constant">&quot;PUT&quot;</span>,&nbsp; &nbsp; &nbsp;&nbsp; <a href="ngx_http_request.h.html#L31" title="http/ngx_http_request.h:31">NGX_HTTP_PUT</a> },<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { <span class="Constant">5</span>, <span class="Constant">&quot;MKCOL&quot;</span>,&nbsp; &nbsp;&nbsp; <a href="ngx_http_request.h.html#L33" title="http/ngx_http_request.h:33">NGX_HTTP_MKCOL</a> },<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { <span class="Constant">6</span>, <span class="Constant">&quot;DELETE&quot;</span>,&nbsp; &nbsp; <a href="ngx_http_request.h.html#L32" title="http/ngx_http_request.h:32">NGX_HTTP_DELETE</a> },<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { <span class="Constant">4</span>, <span class="Constant">&quot;COPY&quot;</span>,&nbsp; &nbsp; &nbsp; <a href="ngx_http_request.h.html#L34" title="http/ngx_http_request.h:34">NGX_HTTP_COPY</a> },<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { <span class="Constant">4</span>, <span class="Constant">&quot;MOVE&quot;</span>,&nbsp; &nbsp; &nbsp; <a href="ngx_http_request.h.html#L35" title="http/ngx_http_request.h:35">NGX_HTTP_MOVE</a> },<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { <span class="Constant">9</span>, <span class="Constant">&quot;PROPPATCH&quot;</span>, <a href="ngx_http_request.h.html#L38" title="http/ngx_http_request.h:38">NGX_HTTP_PROPPATCH</a> },<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { <span class="Constant">4</span>, <span class="Constant">&quot;LOCK&quot;</span>,&nbsp; &nbsp; &nbsp; <a href="ngx_http_request.h.html#L39" title="http/ngx_http_request.h:39">NGX_HTTP_LOCK</a> },<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { <span class="Constant">6</span>, <span class="Constant">&quot;UNLOCK&quot;</span>,&nbsp; &nbsp; <a href="ngx_http_request.h.html#L40" title="http/ngx_http_request.h:40">NGX_HTTP_UNLOCK</a> },<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { <span class="Constant">5</span>, <span class="Constant">&quot;PATCH&quot;</span>,&nbsp; &nbsp;&nbsp; <a href="ngx_http_request.h.html#L41" title="http/ngx_http_request.h:41">NGX_HTTP_PATCH</a> },<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { <span class="Constant">5</span>, <span class="Constant">&quot;TRACE&quot;</span>,&nbsp; &nbsp;&nbsp; <a href="ngx_http_request.h.html#L42" title="http/ngx_http_request.h:42">NGX_HTTP_TRACE</a> }<br/></li>
<li>&nbsp; &nbsp; }, *test;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;method_name.len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent duplicate :method header&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_request.h.html#L58" title="http/ngx_http_request.h:58">NGX_HTTP_PARSE_INVALID_HEADER</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; len = r-&gt;header_end - r-&gt;header_start;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;method_name.len = len;<br/></li>
<li>&nbsp; &nbsp; r-&gt;method_name.data = r-&gt;header_start;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; test = tests;<br/></li>
<li>&nbsp; &nbsp; n = <span class="Statement">sizeof</span>(tests) / <span class="Statement">sizeof</span>(tests[<span class="Constant">0</span>]);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len == test-&gt;len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = r-&gt;method_name.data;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m = test-&gt;method;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; k = len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*p++ != *m++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> (--k);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;method = test-&gt;value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">next</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; test++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">while</span> (--n);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = r-&gt;method_name.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((*p &lt; <span class="Constant">'A'</span> || *p &gt; <span class="Constant">'Z'</span>) &amp;&amp; *p != <span class="Constant">'_'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent invalid method: </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;r-&gt;method_name);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_request.h.html#L58" title="http/ngx_http_request.h:58">NGX_HTTP_PARSE_INVALID_HEADER</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">while</span> (--len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L2871">&#x200c;</a><span class="linkable">ngx_http_spdy_parse_scheme</span>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;schema_start) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent duplicate :schema header&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_request.h.html#L58" title="http/ngx_http_request.h:58">NGX_HTTP_PARSE_INVALID_HEADER</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;schema_start = r-&gt;header_start;<br/></li>
<li>&nbsp; &nbsp; r-&gt;schema_end = r-&gt;header_end;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L2888">&#x200c;</a><span class="linkable">ngx_http_spdy_parse_host</span>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_hash.h.html#L97" title="core/ngx_hash.h:97">ngx_table_elt_t</a>&nbsp; *h;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_in.host) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent duplicate :host header&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_request.h.html#L58" title="http/ngx_http_request.h:58">NGX_HTTP_PARSE_INVALID_HEADER</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; h = <a href="../core/ngx_list.c.html#L31" title="core/ngx_list.c:31">ngx_list_push</a>(&amp;r-&gt;headers_in.headers);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (h == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;headers_in.host = h;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; h-&gt;hash = r-&gt;header_hash;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; h-&gt;key.len = r-&gt;header_name_end - r-&gt;header_name_start;<br/></li>
<li>&nbsp; &nbsp; h-&gt;key.data = r-&gt;header_name_start;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; h-&gt;value.len = r-&gt;header_end - r-&gt;header_start;<br/></li>
<li>&nbsp; &nbsp; h-&gt;value.data = r-&gt;header_start;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; h-&gt;lowcase_key = h-&gt;key.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L2921">&#x200c;</a><span class="linkable">ngx_http_spdy_parse_path</span>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;unparsed_uri.len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent duplicate :path header&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_request.h.html#L58" title="http/ngx_http_request.h:58">NGX_HTTP_PARSE_INVALID_HEADER</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;uri_start = r-&gt;header_start;<br/></li>
<li>&nbsp; &nbsp; r-&gt;uri_end = r-&gt;header_end;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_http_parse.c.html#L1096" title="http/ngx_http_parse.c:1096">ngx_http_parse_uri</a>(r) != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent invalid URI: </span><span class="Special">\&quot;%*s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;uri_end - r-&gt;uri_start, r-&gt;uri_start);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_request.h.html#L58" title="http/ngx_http_request.h:58">NGX_HTTP_PARSE_INVALID_HEADER</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_http_request.c.html#L1053" title="http/ngx_http_request.c:1053">ngx_http_process_request_uri</a>(r) != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * request has been finalized already<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * in <a href="ngx_http_request.c.html#L1053" title="http/ngx_http_request.c:1053">ngx_http_process_request_uri</a>()<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L35" title="core/ngx_core.h:35">NGX_ABORT</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L2954">&#x200c;</a><span class="linkable">ngx_http_spdy_parse_version</span>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; *p, ch;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;http_protocol.len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent duplicate :version header&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_request.h.html#L58" title="http/ngx_http_request.h:58">NGX_HTTP_PARSE_INVALID_HEADER</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = r-&gt;header_start;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;header_end - p &lt; <span class="Constant">8</span> || !(<a href="ngx_http_parse.c.html#L47" title="http/ngx_http_parse.c:47">ngx_str5cmp</a>(p, <span class="Constant">'<a href="../core/ngx_md5.c.html#L128" title="core/ngx_md5.c:128">H</a>'</span>, <span class="Constant">'T'</span>, <span class="Constant">'T'</span>, <span class="Constant">'P'</span>, <span class="Constant">'/'</span>))) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> invalid;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ch = *(p + <span class="Constant">5</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ch &lt; <span class="Constant">'1'</span> || ch &gt; <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> invalid;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;http_major = ch - <span class="Constant">'0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (p += <span class="Constant">6</span>; p != r-&gt;header_end - <span class="Constant">2</span>; p++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ch = *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">'.'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch &lt; <span class="Constant">'0'</span> || ch &gt; <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> invalid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;http_major = r-&gt;http_major * <span class="Constant">10</span> + ch - <span class="Constant">'0'</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*p != <span class="Constant">'.'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> invalid;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ch = *(p + <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ch &lt; <span class="Constant">'0'</span> || ch &gt; <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> invalid;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;http_minor = ch - <span class="Constant">'0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (p += <span class="Constant">2</span>; p != r-&gt;header_end; p++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ch = *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch &lt; <span class="Constant">'0'</span> || ch &gt; <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> invalid;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;http_minor = r-&gt;http_minor * <span class="Constant">10</span> + ch - <span class="Constant">'0'</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;http_protocol.len = r-&gt;header_end - r-&gt;header_start;<br/></li>
<li>&nbsp; &nbsp; r-&gt;http_protocol.data = r-&gt;header_start;<br/></li>
<li>&nbsp; &nbsp; r-&gt;http_version = r-&gt;http_major * <span class="Constant">1000</span> + r-&gt;http_minor;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li><br/></li>
<li><span class="Statement">invalid</span><span class="cUserCont">:<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client sent invalid http version: </span><span class="Special">\&quot;%*s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_end - r-&gt;header_start, r-&gt;header_start);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_request.h.html#L58" title="http/ngx_http_request.h:58">NGX_HTTP_PARSE_INVALID_HEADER</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L3034">&#x200c;</a><span class="linkable">ngx_http_spdy_construct_request_line</span>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;method_name.len == <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; || r-&gt;unparsed_uri.len == <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; || r-&gt;http_protocol.len == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L2249" title="http/ngx_http_request.c:2249">ngx_http_finalize_request</a>(r, <a href="ngx_http_request.h.html#L84" title="http/ngx_http_request.h:84">NGX_HTTP_BAD_REQUEST</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;request_line.len = r-&gt;method_name.len + <span class="Constant">1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + r-&gt;unparsed_uri.len + <span class="Constant">1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + r-&gt;http_protocol.len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="../core/ngx_palloc.c.html#L150" title="core/ngx_palloc.c:150">ngx_pnalloc</a>(r-&gt;pool, r-&gt;request_line.len + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L3318" title="http/ngx_http_spdy.c:3318">ngx_http_spdy_close_stream</a>(r-&gt;spdy_stream,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="ngx_http_request.h.html#L128" title="http/ngx_http_request.h:128">NGX_HTTP_INTERNAL_SERVER_ERROR</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;request_line.data = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(p, r-&gt;method_name.data, r-&gt;method_name.len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *p++ = <span class="Constant">' '</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(p, r-&gt;unparsed_uri.data, r-&gt;unparsed_uri.len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *p++ = <span class="Constant">' '</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.c.html#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(p, r-&gt;http_protocol.data, r-&gt;http_protocol.len + <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* some modules expect the space character after method name */<br/></li>
<li></span>&nbsp; &nbsp; r-&gt;method_name.data = r-&gt;request_line.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L3077">&#x200c;</a></span><span class="linkable">ngx_http_spdy_run_request</span>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_list.h.html#L16" title="core/ngx_list.h:16">ngx_list_part_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *part;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_hash.h.html#L97" title="core/ngx_hash.h:97">ngx_table_elt_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *h;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_request.h.html#L163" title="http/ngx_http_request.h:163">ngx_http_header_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *hh;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_core_module.h.html#L182" title="http/ngx_http_core_module.h:182">ngx_http_core_main_conf_t</a>&nbsp; *cmcf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L3034" title="http/ngx_http_spdy.c:3034">ngx_http_spdy_construct_request_line</a>(r) != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy http request line: </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>, &amp;r-&gt;request_line);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cmcf = <a href="ngx_http_config.h.html#L55" title="http/ngx_http_config.h:55">ngx_http_get_module_main_conf</a>(r, <a href="ngx_http_core_module.c.html#L811" title="http/ngx_http_core_module.c:811">ngx_http_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; part = &amp;r-&gt;headers_in.headers.part;<br/></li>
<li>&nbsp; &nbsp; h = part-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span> ;; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i &gt;= part-&gt;nelts) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (part-&gt;next == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; part = part-&gt;next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; h = part-&gt;elts;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; hh = <a href="../core/ngx_hash.c.html#L13" title="core/ngx_hash.c:13">ngx_hash_find</a>(&amp;cmcf-&gt;headers_in_hash, h[i].hash,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; h[i].lowcase_key, h[i].key.len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (hh &amp;&amp; hh-&gt;handler(r, &amp;h[i], hh-&gt;offset) != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy http header: </span><span class="Special">\&quot;</span><span class="Constant">%V: %V</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>, &amp;h[i].key, &amp;h[i].value);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;http_state = NGX_HTTP_PROCESS_REQUEST_STATE;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_http_request.c.html#L1756" title="http/ngx_http_request.c:1756">ngx_http_process_request_header</a>(r) != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_in.content_length_n &gt; <span class="Constant">0</span> &amp;&amp; r-&gt;spdy_stream-&gt;in_closed) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;client prematurely closed stream&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;spdy_stream-&gt;skip_data = <a href="ngx_http_spdy.h.html#L67" title="http/ngx_http_spdy.h:67">NGX_SPDY_DATA_ERROR</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L2249" title="http/ngx_http_request.c:2249">ngx_http_finalize_request</a>(r, <a href="ngx_http_request.h.html#L84" title="http/ngx_http_request.h:84">NGX_HTTP_BAD_REQUEST</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_request.c.html#L1826" title="http/ngx_http_request.c:1826">ngx_http_process_request</a>(r);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L3141">&#x200c;</a><span class="linkable">ngx_http_spdy_init_request_body</span>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_buf.h.html#L18" title="core/ngx_buf.h:18">ngx_buf_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *buf;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_file.h.html#L74" title="core/ngx_file.h:74">ngx_temp_file_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *tf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_request.h.html#L289" title="http/ngx_http_request.h:289">ngx_http_request_body_t</a>&nbsp;&nbsp; *rb;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_core_module.h.html#L53" title="http/ngx_http_core_module.h:53">ngx_http_core_loc_conf_t</a>&nbsp; *clcf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rb = <a href="../core/ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(r-&gt;pool, <span class="Statement">sizeof</span>(<a href="ngx_http_request.h.html#L289" title="http/ngx_http_request.h:289">ngx_http_request_body_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rb == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;request_body = rb;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;spdy_stream-&gt;in_closed) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rb-&gt;rest = r-&gt;headers_in.content_length_n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; clcf = <a href="ngx_http_config.h.html#L58" title="http/ngx_http_config.h:58">ngx_http_get_module_loc_conf</a>(r, <a href="ngx_http_core_module.c.html#L811" title="http/ngx_http_core_module.c:811">ngx_http_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;request_body_in_file_only<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; || rb-&gt;rest &gt; (<span class="Type">off_t</span>) clcf-&gt;client_body_buffer_size<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; || rb-&gt;rest &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tf = <a href="../core/ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(r-&gt;pool, <span class="Statement">sizeof</span>(<a href="../core/ngx_file.h.html#L74" title="core/ngx_file.h:74">ngx_temp_file_t</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tf == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tf-&gt;file.fd = <a href="../os/unix/ngx_files.h.html#L49" title="os/unix/ngx_files.h:49">NGX_INVALID_FILE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tf-&gt;file.log = r-&gt;connection-&gt;log;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tf-&gt;path = clcf-&gt;client_body_temp_path;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tf-&gt;pool = r-&gt;pool;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tf-&gt;warn = <span class="Constant">&quot;a client request body is buffered to a temporary file&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tf-&gt;log_level = r-&gt;request_body_file_log_level;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tf-&gt;persistent = r-&gt;request_body_in_persistent_file;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tf-&gt;clean = r-&gt;request_body_in_clean_file;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;request_body_file_group_access) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tf-&gt;access = <span class="PreProc">0</span><span class="Constant">660</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rb-&gt;temp_file = tf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;spdy_stream-&gt;in_closed<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; <a href="../core/ngx_file.c.html#L132" title="core/ngx_file.c:132">ngx_create_temp_file</a>(&amp;tf-&gt;file, tf-&gt;path, tf-&gt;pool,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tf-&gt;persistent, tf-&gt;clean, tf-&gt;access)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; buf = <a href="../core/ngx_buf.h.html#L143" title="core/ngx_buf.h:143">ngx_calloc_buf</a>(r-&gt;pool);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (buf == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rb-&gt;rest == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; buf = <a href="../core/ngx_buf.c.html#L13" title="core/ngx_buf.c:13">ngx_create_temp_buf</a>(r-&gt;pool, (<span class="Type">size_t</span>) rb-&gt;rest);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (buf == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rb-&gt;buf = buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rb-&gt;bufs = <a href="../core/ngx_buf.c.html#L48" title="core/ngx_buf.c:48">ngx_alloc_chain_link</a>(r-&gt;pool);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rb-&gt;bufs == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rb-&gt;bufs-&gt;buf = buf;<br/></li>
<li>&nbsp; &nbsp; rb-&gt;bufs-&gt;next = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rb-&gt;rest = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L3229">&#x200c;</a><span class="linkable">ngx_http_spdy_read_request_body</span>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_request.h.html#L278" title="http/ngx_http_request.h:278">ngx_http_client_body_handler_pt</a> post_handler)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>&nbsp; *stream;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy read request body&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream = r-&gt;spdy_stream;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (stream-&gt;skip_data) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_http_spdy.h.html#L66" title="http/ngx_http_spdy.h:66">NGX_SPDY_DATA_DISCARD</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; post_handler(r);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_http_spdy.h.html#L67" title="http/ngx_http_spdy.h:67">NGX_SPDY_DATA_ERROR</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_in.content_length_n == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_request.h.html#L93" title="http/ngx_http_request.h:93">NGX_HTTP_REQUEST_ENTITY_TOO_LARGE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_request.h.html#L84" title="http/ngx_http_request.h:84">NGX_HTTP_BAD_REQUEST</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_http_spdy.h.html#L68" title="http/ngx_http_spdy.h:68">NGX_SPDY_DATA_INTERNAL_ERROR</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_request.h.html#L128" title="http/ngx_http_request.h:128">NGX_HTTP_INTERNAL_SERVER_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!r-&gt;request_body &amp;&amp; <a href="#L3141" title="http/ngx_http_spdy.c:3141">ngx_http_spdy_init_request_body</a>(r) != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;skip_data = <a href="ngx_http_spdy.h.html#L68" title="http/ngx_http_spdy.h:68">NGX_SPDY_DATA_INTERNAL_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_request.h.html#L128" title="http/ngx_http_request.h:128">NGX_HTTP_INTERNAL_SERVER_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (stream-&gt;in_closed) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; post_handler(r);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;request_body-&gt;post_handler = post_handler;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;read_event_handler = <a href="ngx_http_request.c.html#L2709" title="http/ngx_http_request.c:2709">ngx_http_test_reading</a>;<br/></li>
<li>&nbsp; &nbsp; r-&gt;write_event_handler = <a href="ngx_http_request.c.html#L3297" title="http/ngx_http_request.c:3297">ngx_http_request_empty_handler</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L31" title="core/ngx_core.h:31">NGX_AGAIN</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L3276">&#x200c;</a><span class="linkable">ngx_http_spdy_terminate_stream</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a> *stream, <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> status)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a>&nbsp; &nbsp; &nbsp;&nbsp; *rev;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp; *fc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2069" title="http/ngx_http_spdy.c:2069">ngx_http_spdy_send_rst_stream</a>(sc, stream-&gt;id, status,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L57" title="http/ngx_http_spdy.h:57">NGX_SPDY_HIGHEST_PRIORITY</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; == <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; stream-&gt;out_closed = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; fc = stream-&gt;request-&gt;connection;<br/></li>
<li>&nbsp; &nbsp; fc-&gt;error = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rev = fc-&gt;read;<br/></li>
<li>&nbsp; &nbsp; rev-&gt;handler(rev);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L3302">&#x200c;</a></span><span class="linkable">ngx_http_spdy_close_stream_handler</span>(<a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a> *ev)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp; &nbsp; *fc;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a>&nbsp; *r;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; fc = ev-&gt;data;<br/></li>
<li>&nbsp; &nbsp; r = fc-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy close stream handler&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L3318" title="http/ngx_http_spdy.c:3318">ngx_http_spdy_close_stream</a>(r-&gt;spdy_stream, <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L3318">&#x200c;</a></span><span class="linkable">ngx_http_spdy_close_stream</span>(<a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a> *stream, <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> rc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; tcp_nodelay;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *ev;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *c, *fc;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_core_module.h.html#L53" title="http/ngx_http_core_module.h:53">ngx_http_core_loc_conf_t</a>&nbsp; &nbsp;&nbsp; *clcf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>&nbsp; &nbsp; &nbsp; **index, *s;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy_module.h.html#L30" title="http/ngx_http_spdy_module.h:30">ngx_http_spdy_srv_conf_t</a>&nbsp; &nbsp;&nbsp; *sscf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a>&nbsp;&nbsp; *sc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc = stream-&gt;connection;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L141" title="core/ngx_log.h:141">ngx_log_debug3</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy close stream </span><span class="Special">%u</span><span class="Constant">i, queued </span><span class="Special">%u</span><span class="Constant">i, processing </span><span class="Special">%u</span><span class="Constant">i&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; stream-&gt;id, stream-&gt;queued, sc-&gt;processing);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; fc = stream-&gt;request-&gt;connection;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (stream-&gt;queued) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; fc-&gt;write-&gt;handler = <a href="#L3302" title="http/ngx_http_spdy.c:3302">ngx_http_spdy_close_stream_handler</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!stream-&gt;out_closed) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L2069" title="http/ngx_http_spdy.c:2069">ngx_http_spdy_send_rst_stream</a>(sc, stream-&gt;id,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L68" title="http/ngx_http_spdy.c:68">NGX_SPDY_INTERNAL_ERROR</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;priority)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;connection-&gt;error = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c = sc-&gt;connection;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c-&gt;tcp_nopush == NGX_TCP_NOPUSH_SET) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/unix/ngx_socket.c.html#L65" title="os/unix/ngx_socket.c:65">ngx_tcp_push</a>(c-&gt;fd) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_connection.c.html#L1136" title="core/ngx_connection.c:1136">ngx_connection_error</a>(c, <a href="../os/unix/ngx_errno.h.html#L69" title="os/unix/ngx_errno.h:69">ngx_socket_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../os/unix/ngx_socket.h.html#L47" title="os/unix/ngx_socket.h:47">ngx_tcp_push_n</a> <span class="Constant">&quot; failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c-&gt;error = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp_nodelay = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c-&gt;tcp_nopush = NGX_TCP_NOPUSH_UNSET;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp_nodelay = <a href="../os/unix/ngx_posix_init.c.html#L16" title="os/unix/ngx_posix_init.c:16">ngx_tcp_nodelay_and_tcp_nopush</a> ? <span class="Constant">1</span> : <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp_nodelay = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; clcf = <a href="ngx_http_config.h.html#L58" title="http/ngx_http_config.h:58">ngx_http_get_module_loc_conf</a>(stream-&gt;request,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_core_module.c.html#L811" title="http/ngx_http_core_module.c:811">ngx_http_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tcp_nodelay<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; clcf-&gt;tcp_nodelay<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; c-&gt;tcp_nodelay == NGX_TCP_NODELAY_UNSET)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, c-&gt;log, <span class="Constant">0</span>, <span class="Constant">&quot;tcp_nodelay&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (setsockopt(c-&gt;fd, IPPROTO_TCP, TCP_NODELAY,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<span class="Type">const</span> <span class="Type">void</span> *) &amp;tcp_nodelay, <span class="Statement">sizeof</span>(<span class="Type">int</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; == -<span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li><span class="PreProc">#if (NGX_SOLARIS)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Solaris returns EINVAL if a socket has been shut down */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c-&gt;log_error = NGX_ERROR_IGNORE_EINVAL;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_connection.c.html#L1136" title="core/ngx_connection.c:1136">ngx_connection_error</a>(c, <a href="../os/unix/ngx_errno.h.html#L69" title="os/unix/ngx_errno.h:69">ngx_socket_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;setsockopt(TCP_NODELAY) failed&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c-&gt;log_error = NGX_ERROR_INFO;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c-&gt;error = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c-&gt;tcp_nodelay = NGX_TCP_NODELAY_SET;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;stream == stream) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;stream = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sscf = <a href="ngx_http_config.h.html#L57" title="http/ngx_http_config.h:57">ngx_http_get_module_srv_conf</a>(sc-&gt;http_connection-&gt;conf_ctx,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_spdy_module.c.html#L131" title="http/ngx_http_spdy_module.c:131">ngx_http_spdy_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; index = sc-&gt;streams_index + <a href="#L153" title="http/ngx_http_spdy.c:153">ngx_http_spdy_stream_index</a>(sscf, stream-&gt;id);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> ( ;; ) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s = *index;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s == stream) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *index = s-&gt;index;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; index = &amp;s-&gt;index;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_request.c.html#L3410" title="http/ngx_http_request.c:3410">ngx_http_free_request</a>(stream-&gt;request, rc);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ev = fc-&gt;read;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ev-&gt;active || ev-&gt;disabled) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;fake read event was activated&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ev-&gt;timer_set) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../event/ngx_event.h.html#L428" title="event/ngx_event.h:428">ngx_del_timer</a>(ev);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ev-&gt;posted) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../event/ngx_event_posted.h.html#L31" title="event/ngx_event_posted.h:31">ngx_delete_posted_event</a>(ev);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ev = fc-&gt;write;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ev-&gt;active || ev-&gt;disabled) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;fake write event was activated&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ev-&gt;timer_set) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../event/ngx_event.h.html#L428" title="event/ngx_event.h:428">ngx_del_timer</a>(ev);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ev-&gt;posted) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../event/ngx_event_posted.h.html#L31" title="event/ngx_event_posted.h:31">ngx_delete_posted_event</a>(ev);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; fc-&gt;data = sc-&gt;free_fake_connections;<br/></li>
<li>&nbsp; &nbsp; sc-&gt;free_fake_connections = fc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;processing--;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;processing || sc-&gt;blocked) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ev = sc-&gt;connection-&gt;read;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ev-&gt;handler = <a href="#L3472" title="http/ngx_http_spdy.c:3472">ngx_http_spdy_handle_connection_handler</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="../event/ngx_event_posted.h.html#L17" title="event/ngx_event_posted.h:17">ngx_post_event</a>(ev, &amp;<a href="../event/ngx_event_posted.c.html#L14" title="event/ngx_event_posted.c:14">ngx_posted_events</a>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L3472">&#x200c;</a></span><span class="linkable">ngx_http_spdy_handle_connection_handler</span>(<a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a> *rev)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp; *c;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rev-&gt;handler = <a href="#L517" title="http/ngx_http_spdy.c:517">ngx_http_spdy_read_handler</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rev-&gt;ready) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L517" title="http/ngx_http_spdy.c:517">ngx_http_spdy_read_handler</a>(rev);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c = rev-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L758" title="http/ngx_http_spdy.c:758">ngx_http_spdy_handle_connection</a>(c-&gt;data);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L3490">&#x200c;</a></span><span class="linkable">ngx_http_spdy_keepalive_handler</span>(<a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a> *rev)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *c;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy_module.h.html#L30" title="http/ngx_http_spdy_module.h:30">ngx_http_spdy_srv_conf_t</a>&nbsp; &nbsp; *sscf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a>&nbsp; *sc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c = rev-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, c-&gt;log, <span class="Constant">0</span>, <span class="Constant">&quot;spdy keepalive handler&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rev-&gt;timedout || c-&gt;close) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_KQUEUE)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../event/ngx_event.c.html#L44" title="event/ngx_event.c:44">ngx_event_flags</a> &amp; <a href="../event/ngx_event.h.html#L239" title="event/ngx_event.h:239">NGX_USE_KQUEUE_EVENT</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rev-&gt;pending_eof) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c-&gt;log-&gt;handler = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, c-&gt;log, rev-&gt;kq_errno,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;kevent() reported that client %V closed &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;keepalive connection&quot;</span>, &amp;c-&gt;addr_text);<br/></li>
<li><span class="PreProc">#if (NGX_HTTP_SSL)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c-&gt;ssl) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c-&gt;ssl-&gt;no_send_shutdown = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; c-&gt;destroyed = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; c-&gt;idle = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_connection.c.html#L1011" title="core/ngx_connection.c:1011">ngx_reusable_connection</a>(c, <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc = c-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sscf = <a href="ngx_http_config.h.html#L57" title="http/ngx_http_config.h:57">ngx_http_get_module_srv_conf</a>(sc-&gt;http_connection-&gt;conf_ctx,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_spdy_module.c.html#L131" title="http/ngx_http_spdy_module.c:131">ngx_http_spdy_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;pool = <a href="../core/ngx_palloc.c.html#L17" title="core/ngx_palloc.c:17">ngx_create_pool</a>(sscf-&gt;pool_size, sc-&gt;connection-&gt;log);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;pool == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;streams_index = <a href="../core/ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(sc-&gt;pool,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L152" title="http/ngx_http_spdy.c:152">ngx_http_spdy_streams_index_size</a>(sscf)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * <span class="Statement">sizeof</span>(<a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a> *));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;streams_index == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c-&gt;write-&gt;handler = <a href="#L607" title="http/ngx_http_spdy.c:607">ngx_http_spdy_write_handler</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rev-&gt;handler = <a href="#L517" title="http/ngx_http_spdy.c:517">ngx_http_spdy_read_handler</a>;<br/></li>
<li>&nbsp; &nbsp; <a href="#L517" title="http/ngx_http_spdy.c:517">ngx_http_spdy_read_handler</a>(rev);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L3556">&#x200c;</a></span><span class="linkable">ngx_http_spdy_finalize_connection</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> rc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; i, size;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *ev;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *c, *fc;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *r;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>&nbsp; &nbsp; *stream;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy_module.h.html#L30" title="http/ngx_http_spdy_module.h:30">ngx_http_spdy_srv_conf_t</a>&nbsp; *sscf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c = sc-&gt;connection;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!sc-&gt;processing) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c-&gt;error = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; c-&gt;read-&gt;handler = <a href="ngx_http_request.c.html#L3288" title="http/ngx_http_request.c:3288">ngx_http_empty_handler</a>;<br/></li>
<li>&nbsp; &nbsp; c-&gt;write-&gt;handler = <a href="ngx_http_request.c.html#L3288" title="http/ngx_http_request.c:3288">ngx_http_empty_handler</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;last_out = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;blocked = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sscf = <a href="ngx_http_config.h.html#L57" title="http/ngx_http_config.h:57">ngx_http_get_module_srv_conf</a>(sc-&gt;http_connection-&gt;conf_ctx,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_spdy_module.c.html#L131" title="http/ngx_http_spdy_module.c:131">ngx_http_spdy_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; size = <a href="#L152" title="http/ngx_http_spdy.c:152">ngx_http_spdy_streams_index_size</a>(sscf);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; size; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; stream = sc-&gt;streams_index[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (stream) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;handled = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r = stream-&gt;request;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fc = r-&gt;connection;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fc-&gt;error = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (stream-&gt;queued) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;queued = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ev = fc-&gt;write;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ev-&gt;delayed = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ev = fc-&gt;read;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream = stream-&gt;index;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ev-&gt;eof = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ev-&gt;handler(ev);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;blocked = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;processing) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_request.c.html#L3516" title="http/ngx_http_request.c:3516">ngx_http_close_connection</a>(c);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L3625">&#x200c;</a><span class="linkable">ngx_http_spdy_adjust_windows</span>(<a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc, <span class="Type">ssize_t</span> delta)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; i, size;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *wev;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L24" title="http/ngx_http.h:24">ngx_http_spdy_stream_t</a>&nbsp; &nbsp; *stream, *sn;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy_module.h.html#L30" title="http/ngx_http_spdy_module.h:30">ngx_http_spdy_srv_conf_t</a>&nbsp; *sscf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sscf = <a href="ngx_http_config.h.html#L57" title="http/ngx_http_config.h:57">ngx_http_get_module_srv_conf</a>(sc-&gt;http_connection-&gt;conf_ctx,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_spdy_module.c.html#L131" title="http/ngx_http_spdy_module.c:131">ngx_http_spdy_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; size = <a href="#L152" title="http/ngx_http_spdy.c:152">ngx_http_spdy_streams_index_size</a>(sscf);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; size; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (stream = sc-&gt;streams_index[i]; stream; stream = sn) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sn = stream-&gt;index;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (delta &gt; <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; stream-&gt;send_window<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt; (<span class="Type">ssize_t</span>) (<a href="#L81" title="http/ngx_http_spdy.c:81">NGX_SPDY_MAX_WINDOW</a> - delta))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L3276" title="http/ngx_http_spdy.c:3276">ngx_http_spdy_terminate_stream</a>(sc, stream,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L69" title="http/ngx_http_spdy.c:69">NGX_SPDY_FLOW_CONTROL_ERROR</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; == <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;send_window += delta;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;spdy:</span><span class="Special">%u</span><span class="Constant">i adjust window:%z&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; stream-&gt;id, stream-&gt;send_window);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (stream-&gt;send_window &gt; <span class="Constant">0</span> &amp;&amp; stream-&gt;exhausted) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stream-&gt;exhausted = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wev = stream-&gt;request-&gt;connection-&gt;write;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!wev-&gt;timer_set) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wev-&gt;delayed = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wev-&gt;handler(wev);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L3680">&#x200c;</a></span><span class="linkable">ngx_http_spdy_pool_cleanup</span>(<span class="Type">void</span> *data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a>&nbsp; *sc = data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;pool) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_palloc.c.html#L45" title="core/ngx_palloc.c:45">ngx_destroy_pool</a>(sc-&gt;pool);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> *<br/></li>
<li><a id="L3691">&#x200c;</a><span class="linkable">ngx_http_spdy_zalloc</span>(<span class="Type">void</span> *opaque, u_int items, u_int size)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc = opaque;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_palloc.c.html#L120" title="core/ngx_palloc.c:120">ngx_palloc</a>(sc-&gt;connection-&gt;pool, items * size);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L3700">&#x200c;</a></span><span class="linkable">ngx_http_spdy_zfree</span>(<span class="Type">void</span> *opaque, <span class="Type">void</span> *address)<br/></li>
<li>{<br/></li>
<li><span class="Comment">#if 0<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; <a href="ngx_http_spdy.h.html#L71" title="http/ngx_http_spdy.h:71">ngx_http_spdy_connection_t</a> *sc = opaque;<br/></li>
<li></span><br/></li>
<li><span class="Comment">&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, sc-&gt;connection-&gt;log, 0,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &quot;spdy zfree: %p&quot;, address);<br/></li>
<li></span><span class="Comment">#endif<br/></li>
<li></span>}<br/></li>
</ol></code>
 </body>
</html>

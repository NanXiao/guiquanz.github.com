<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>http/ngx_http_header_filter_module.c - src</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>http/ngx_http_header_filter_module.c - src</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Global variables defined</h4>
 <ul>
<li><a href="#L33">ngx_http_header_filter_module</a></li>
<li><a href="#L18">ngx_http_header_filter_module_ctx</a></li>
<li><a href="#L129">ngx_http_headers_out</a></li>
<li><a href="#L50">ngx_http_server_full_string</a></li>
<li><a href="#L49">ngx_http_server_string</a></li>
<li><a href="#L53">ngx_http_status_lines</a></li>
</ul>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L151">ngx_http_header_filter</a></li>
<li><a href="#L628">ngx_http_header_filter_init</a></li>
</ul>
 <h4>Macros defined</h4>
 <ul>
<li><a href="#L65">NGX_HTTP_LAST_2XX</a></li>
<li><a href="#L78">NGX_HTTP_LAST_3XX</a></li>
<li><a href="#L108">NGX_HTTP_LAST_4XX</a></li>
<li><a href="#L124">NGX_HTTP_LAST_5XX</a></li>
<li><a href="#L66">NGX_HTTP_OFF_3XX</a></li>
<li><a href="#L79">NGX_HTTP_OFF_4XX</a></li>
<li><a href="#L109">NGX_HTTP_OFF_5XX</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Copyright (C) Igor Sysoev<br/></li>
<li></span><span class="Comment"> * Copyright (C) Nginx, Inc.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;ngx_config.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_core.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_http.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;<a href="modules/perl/ngx_http_perl_module.h.html#L21" title="http/modules/perl/ngx_http_perl_module.h:21">nginx</a>.h&gt;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L628" title="http/ngx_http_header_filter_module.c:628">ngx_http_header_filter_init</a>(<a href="../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L151" title="http/ngx_http_header_filter_module.c:151">ngx_http_header_filter</a>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r);<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L18">&#x200c;</a><span class="Type">static</span> <a href="ngx_http_config.h.html#L36" title="http/ngx_http_config.h:36">ngx_http_module_t</a>&nbsp; <span class="linkable">ngx_http_header_filter_module_ctx</span> = {<br/></li>
<li>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* preconfiguration */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L628" title="http/ngx_http_header_filter_module.c:628">ngx_http_header_filter_init</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* postconfiguration */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* create <a href="../core/nginx.c.html#L202" title="core/nginx.c:202">main</a> configuration */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init <a href="../core/nginx.c.html#L202" title="core/nginx.c:202">main</a> configuration */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* create server configuration */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* merge server configuration */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* create location configuration */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* merge location configuration */<br/></li>
<li></span>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L33">&#x200c;</a><a href="../core/ngx_core.h.html#L12" title="core/ngx_core.h:12">ngx_module_t</a>&nbsp; <span class="linkable">ngx_http_header_filter_module</span> = {<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_conf_file.h.html#L99" title="core/ngx_conf_file.h:99">NGX_MODULE_V1</a>,<br/></li>
<li>&nbsp; &nbsp; &amp;<a href="#L18" title="http/ngx_http_header_filter_module.c:18">ngx_http_header_filter_module_ctx</a>,&nbsp; &nbsp; <span class="Comment">/* module context */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* module directives */<br/></li>
<li></span>&nbsp; &nbsp; <a href="ngx_http_config.h.html#L39" title="http/ngx_http_config.h:39">NGX_HTTP_MODULE</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* module type */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init master */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init module */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init process */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init thread */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* exit thread */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* exit process */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* exit master */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../core/ngx_conf_file.h.html#L100" title="core/ngx_conf_file.h:100">NGX_MODULE_V1_PADDING</a><br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L49">&#x200c;</a><span class="Type">static</span> <span class="Type">char</span> <span class="linkable">ngx_http_server_string</span>[] = <span class="Constant">&quot;Server: <a href="modules/perl/ngx_http_perl_module.h.html#L21" title="http/modules/perl/ngx_http_perl_module.h:21">nginx</a>&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>;<br/></li>
<li><a id="L50">&#x200c;</a><span class="Type">static</span> <span class="Type">char</span> <span class="linkable">ngx_http_server_full_string</span>[] = <span class="Constant">&quot;Server: &quot;</span> <a href="../core/nginx.h.html#L14" title="core/nginx.h:14">NGINX_VER</a> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L53">&#x200c;</a><span class="Type">static</span> <a href="../core/ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> <span class="linkable">ngx_http_status_lines</span>[] = {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;200 OK&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;201 Created&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;202 Accepted&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>,&nbsp; <span class="Comment">/* &quot;203 Non-Authoritative Information&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;204 No Content&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>,&nbsp; <span class="Comment">/* &quot;205 Reset Content&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;206 Partial Content&quot;</span>),<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>, */</span>&nbsp; <span class="Comment">/* &quot;207 Multi-Status&quot; */<br/></li>
<li></span><br/></li>
<li><a id="L65">&#x200c;</a><span class="PreProc">#define <span class="linkable">NGX_HTTP_LAST_2XX</span>&nbsp; </span><span class="Constant">207<br/></li>
<li><a id="L66">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_HTTP_OFF_3XX</span>&nbsp;&nbsp; (<a href="#L65" title="http/ngx_http_header_filter_module.c:65">NGX_HTTP_LAST_2XX</a> - </span><span class="Constant">200</span><span class="PreProc">)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>, */</span>&nbsp; <span class="Comment">/* &quot;300 Multiple Choices&quot; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;301 Moved Permanently&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;302 Moved Temporarily&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;303 See Other&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;304 Not Modified&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>,&nbsp; <span class="Comment">/* &quot;305 Use Proxy&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>,&nbsp; <span class="Comment">/* &quot;306 unused&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;307 Temporary Redirect&quot;</span>),<br/></li>
<li><br/></li>
<li><a id="L78">&#x200c;</a><span class="PreProc">#define <span class="linkable">NGX_HTTP_LAST_3XX</span>&nbsp; </span><span class="Constant">308<br/></li>
<li><a id="L79">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_HTTP_OFF_4XX</span>&nbsp;&nbsp; (<a href="#L78" title="http/ngx_http_header_filter_module.c:78">NGX_HTTP_LAST_3XX</a> - </span><span class="Constant">301</span><span class="PreProc"> + <a href="#L66" title="http/ngx_http_header_filter_module.c:66">NGX_HTTP_OFF_3XX</a>)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;400 Bad Request&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;401 Unauthorized&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;402 Payment Required&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;403 Forbidden&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;404 Not Found&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;405 Not Allowed&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;406 Not Acceptable&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>,&nbsp; <span class="Comment">/* &quot;407 Proxy Authentication Required&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;408 Request Time-out&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;409 Conflict&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;410 Gone&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;411 Length Required&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;412 Precondition Failed&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;413 Request Entity Too Large&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;414 Request-URI Too Large&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;415 Unsupported Media Type&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;416 Requested Range Not Satisfiable&quot;</span>),<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>, */</span>&nbsp; <span class="Comment">/* &quot;417 Expectation Failed&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>, */</span>&nbsp; <span class="Comment">/* &quot;418 unused&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>, */</span>&nbsp; <span class="Comment">/* &quot;419 unused&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>, */</span>&nbsp; <span class="Comment">/* &quot;420 unused&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>, */</span>&nbsp; <span class="Comment">/* &quot;421 unused&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>, */</span>&nbsp; <span class="Comment">/* &quot;422 Unprocessable Entity&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>, */</span>&nbsp; <span class="Comment">/* &quot;423 Locked&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>, */</span>&nbsp; <span class="Comment">/* &quot;424 Failed Dependency&quot; */<br/></li>
<li></span><br/></li>
<li><a id="L108">&#x200c;</a><span class="PreProc">#define <span class="linkable">NGX_HTTP_LAST_4XX</span>&nbsp; </span><span class="Constant">417<br/></li>
<li><a id="L109">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">NGX_HTTP_OFF_5XX</span>&nbsp;&nbsp; (<a href="#L108" title="http/ngx_http_header_filter_module.c:108">NGX_HTTP_LAST_4XX</a> - </span><span class="Constant">400</span><span class="PreProc"> + <a href="#L79" title="http/ngx_http_header_filter_module.c:79">NGX_HTTP_OFF_4XX</a>)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;500 Internal Server Error&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;501 Not Implemented&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;502 Bad Gateway&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;503 Service Temporarily Unavailable&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;504 Gateway Time-out&quot;</span>),<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* &quot;505 HTTP Version Not Supported&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* &quot;506 Variant Also Negotiates&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;507 Insufficient Storage&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>, */</span>&nbsp; <span class="Comment">/* &quot;508 unused&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>, */</span>&nbsp; <span class="Comment">/* &quot;509 unused&quot; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Comment">/* <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>, */</span>&nbsp; <span class="Comment">/* &quot;510 Not Extended&quot; */<br/></li>
<li></span><br/></li>
<li><a id="L124">&#x200c;</a><span class="PreProc">#define <span class="linkable">NGX_HTTP_LAST_5XX</span>&nbsp; </span><span class="Constant">508<br/></li>
<li></span><br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L129">&#x200c;</a><a href="ngx_http_request.h.html#L169" title="http/ngx_http_request.h:169">ngx_http_header_out_t</a>&nbsp; <span class="linkable">ngx_http_headers_out</span>[] = {<br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;Server&quot;</span>), offsetof(<a href="ngx_http_request.h.html#L275" title="http/ngx_http_request.h:275">ngx_http_headers_out_t</a>, server) },<br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;Date&quot;</span>), offsetof(<a href="ngx_http_request.h.html#L275" title="http/ngx_http_request.h:275">ngx_http_headers_out_t</a>, date) },<br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;Content-Length&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; offsetof(<a href="ngx_http_request.h.html#L275" title="http/ngx_http_request.h:275">ngx_http_headers_out_t</a>, content_length) },<br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;Content-Encoding&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; offsetof(<a href="ngx_http_request.h.html#L275" title="http/ngx_http_request.h:275">ngx_http_headers_out_t</a>, content_encoding) },<br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;Location&quot;</span>), offsetof(<a href="ngx_http_request.h.html#L275" title="http/ngx_http_request.h:275">ngx_http_headers_out_t</a>, location) },<br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;Last-Modified&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; offsetof(<a href="ngx_http_request.h.html#L275" title="http/ngx_http_request.h:275">ngx_http_headers_out_t</a>, last_modified) },<br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;Accept-Ranges&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; offsetof(<a href="ngx_http_request.h.html#L275" title="http/ngx_http_request.h:275">ngx_http_headers_out_t</a>, accept_ranges) },<br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;Expires&quot;</span>), offsetof(<a href="ngx_http_request.h.html#L275" title="http/ngx_http_request.h:275">ngx_http_headers_out_t</a>, <a href="modules/ngx_http_userid_filter_module.c.html#L76" title="http/modules/ngx_http_userid_filter_module.c:76">expires</a>) },<br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;Cache-Control&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; offsetof(<a href="ngx_http_request.h.html#L275" title="http/ngx_http_request.h:275">ngx_http_headers_out_t</a>, cache_control) },<br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;ETag&quot;</span>), offsetof(<a href="ngx_http_request.h.html#L275" title="http/ngx_http_request.h:275">ngx_http_headers_out_t</a>, etag) },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>, <span class="Constant">0</span> }<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L151">&#x200c;</a><span class="linkable">ngx_http_header_filter</span>(<a href="ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; host, *status_line;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_buf.h.html#L18" title="core/ngx_buf.h:18">ngx_buf_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *b;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; status, i, port;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L16" title="core/ngx_core.h:16">ngx_chain_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; out;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_list.h.html#L16" title="core/ngx_list.h:16">ngx_list_part_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *part;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_hash.h.html#L97" title="core/ngx_hash.h:97">ngx_table_elt_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *header;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *c;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_core_module.h.html#L53" title="http/ngx_http_core_module.h:53">ngx_http_core_loc_conf_t</a>&nbsp; *clcf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_core_module.h.html#L212" title="http/ngx_http_core_module.h:212">ngx_http_core_srv_conf_t</a>&nbsp; *cscf;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in&nbsp; &nbsp; &nbsp; &nbsp; *sin;<br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in6&nbsp; &nbsp; &nbsp;&nbsp; *sin6;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; addr[<a href="../core/ngx_inet.h.html#L31" title="core/ngx_inet.h:31">NGX_SOCKADDR_STRLEN</a>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;header_sent) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;header_sent = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r != r-&gt;<a href="../core/nginx.c.html#L202" title="core/nginx.c:202">main</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;http_version &lt; <a href="ngx_http_request.h.html#L24" title="http/ngx_http_request.h:24">NGX_HTTP_VERSION_10</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;method == <a href="ngx_http_request.h.html#L29" title="http/ngx_http_request.h:29">NGX_HTTP_HEAD</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_only = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.last_modified_time != -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.status != <a href="ngx_http_request.h.html#L71" title="http/ngx_http_request.h:71">NGX_HTTP_OK</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; r-&gt;headers_out.status != <a href="ngx_http_request.h.html#L75" title="http/ngx_http_request.h:75">NGX_HTTP_PARTIAL_CONTENT</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; r-&gt;headers_out.status != <a href="ngx_http_request.h.html#L81" title="http/ngx_http_request.h:81">NGX_HTTP_NOT_MODIFIED</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_out.last_modified_time = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_out.last_modified = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; len = <span class="Statement">sizeof</span>(<span class="Constant">&quot;HTTP/1.x &quot;</span>) - <span class="Constant">1</span> + <span class="Statement">sizeof</span>(<a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>) - <span class="Constant">1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* the end of the header */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + <span class="Statement">sizeof</span>(<a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>) - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* status line */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.status_line.len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len += r-&gt;headers_out.status_line.len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; status_line = &amp;r-&gt;headers_out.status_line;<br/></li>
<li><span class="PreProc">#if (NGX_SUPPRESS_WARN)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; status = <span class="Constant">0</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; status = r-&gt;headers_out.status;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (status &gt;= <a href="ngx_http_request.h.html#L71" title="http/ngx_http_request.h:71">NGX_HTTP_OK</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; status &lt; <a href="#L65" title="http/ngx_http_header_filter_module.c:65">NGX_HTTP_LAST_2XX</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* 2XX */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (status == <a href="ngx_http_request.h.html#L74" title="http/ngx_http_request.h:74">NGX_HTTP_NO_CONTENT</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_only = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_string.h.html#L44" title="core/ngx_string.h:44">ngx_str_null</a>(&amp;r-&gt;headers_out.content_type);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_out.last_modified_time = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_out.last_modified = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_out.content_length = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_out.content_length_n = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status -= <a href="ngx_http_request.h.html#L71" title="http/ngx_http_request.h:71">NGX_HTTP_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status_line = &amp;<a href="#L53" title="http/ngx_http_header_filter_module.c:53">ngx_http_status_lines</a>[status];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <a href="#L53" title="http/ngx_http_header_filter_module.c:53">ngx_http_status_lines</a>[status].len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (status &gt;= <a href="ngx_http_request.h.html#L78" title="http/ngx_http_request.h:78">NGX_HTTP_MOVED_PERMANENTLY</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;&amp; status &lt; <a href="#L78" title="http/ngx_http_header_filter_module.c:78">NGX_HTTP_LAST_3XX</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* 3XX */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (status == <a href="ngx_http_request.h.html#L81" title="http/ngx_http_request.h:81">NGX_HTTP_NOT_MODIFIED</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;header_only = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status = status - <a href="ngx_http_request.h.html#L78" title="http/ngx_http_request.h:78">NGX_HTTP_MOVED_PERMANENTLY</a> + <a href="#L66" title="http/ngx_http_header_filter_module.c:66">NGX_HTTP_OFF_3XX</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status_line = &amp;<a href="#L53" title="http/ngx_http_header_filter_module.c:53">ngx_http_status_lines</a>[status];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <a href="#L53" title="http/ngx_http_header_filter_module.c:53">ngx_http_status_lines</a>[status].len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (status &gt;= <a href="ngx_http_request.h.html#L84" title="http/ngx_http_request.h:84">NGX_HTTP_BAD_REQUEST</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;&amp; status &lt; <a href="#L108" title="http/ngx_http_header_filter_module.c:108">NGX_HTTP_LAST_4XX</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* 4XX */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status = status - <a href="ngx_http_request.h.html#L84" title="http/ngx_http_request.h:84">NGX_HTTP_BAD_REQUEST</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + <a href="#L79" title="http/ngx_http_header_filter_module.c:79">NGX_HTTP_OFF_4XX</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status_line = &amp;<a href="#L53" title="http/ngx_http_header_filter_module.c:53">ngx_http_status_lines</a>[status];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <a href="#L53" title="http/ngx_http_header_filter_module.c:53">ngx_http_status_lines</a>[status].len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (status &gt;= <a href="ngx_http_request.h.html#L128" title="http/ngx_http_request.h:128">NGX_HTTP_INTERNAL_SERVER_ERROR</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;&amp; status &lt; <a href="#L124" title="http/ngx_http_header_filter_module.c:124">NGX_HTTP_LAST_5XX</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* 5XX */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status = status - <a href="ngx_http_request.h.html#L128" title="http/ngx_http_request.h:128">NGX_HTTP_INTERNAL_SERVER_ERROR</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + <a href="#L109" title="http/ngx_http_header_filter_module.c:109">NGX_HTTP_OFF_5XX</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status_line = &amp;<a href="#L53" title="http/ngx_http_header_filter_module.c:53">ngx_http_status_lines</a>[status];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <a href="#L53" title="http/ngx_http_header_filter_module.c:53">ngx_http_status_lines</a>[status].len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <a href="../core/ngx_config.h.html#L87" title="core/ngx_config.h:87">NGX_INT_T_LEN</a> + <span class="Constant">1</span> <span class="Comment">/* SP */</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status_line = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (status_line &amp;&amp; status_line-&gt;len == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status = r-&gt;headers_out.status;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <a href="../core/ngx_config.h.html#L87" title="core/ngx_config.h:87">NGX_INT_T_LEN</a> + <span class="Constant">1</span> <span class="Comment">/* SP */</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status_line = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; clcf = <a href="ngx_http_config.h.html#L58" title="http/ngx_http_config.h:58">ngx_http_get_module_loc_conf</a>(r, <a href="ngx_http_core_module.c.html#L811" title="http/ngx_http_core_module.c:811">ngx_http_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.server == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len += clcf-&gt;server_tokens ? <span class="Statement">sizeof</span>(<a href="#L50" title="http/ngx_http_header_filter_module.c:50">ngx_http_server_full_string</a>) - <span class="Constant">1</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<a href="#L49" title="http/ngx_http_header_filter_module.c:49">ngx_http_server_string</a>) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.date == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;Date: Mon, 28 Sep 1970 06:00:00 GMT&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.content_type.len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;Content-Type: &quot;</span>) - <span class="Constant">1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; + r-&gt;headers_out.content_type.len + <span class="Constant">2</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.content_type_len == r-&gt;headers_out.content_type.len<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; r-&gt;headers_out.charset.len)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;; charset=&quot;</span>) - <span class="Constant">1</span> + r-&gt;headers_out.charset.len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.content_length == <span class="Constant">NULL<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; r-&gt;headers_out.content_length_n &gt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;Content-Length: &quot;</span>) - <span class="Constant">1</span> + NGX_OFF_T_LEN + <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.last_modified == <span class="Constant">NULL<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; r-&gt;headers_out.last_modified_time != -<span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;Last-Modified: Mon, 28 Sep 1970 06:00:00 GMT&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c = r-&gt;connection;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.location<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; r-&gt;headers_out.location-&gt;value.len<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; r-&gt;headers_out.location-&gt;value.data[<span class="Constant">0</span>] == <span class="Constant">'/'</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_out.location-&gt;hash = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (clcf-&gt;server_name_in_redirect) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cscf = <a href="ngx_http_config.h.html#L57" title="http/ngx_http_config.h:57">ngx_http_get_module_srv_conf</a>(r, <a href="ngx_http_core_module.c.html#L811" title="http/ngx_http_core_module.c:811">ngx_http_core_module</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; host = cscf-&gt;server_name;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (r-&gt;headers_in.server.len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; host = r-&gt;headers_in.server;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; host.len = <a href="../core/ngx_inet.h.html#L31" title="core/ngx_inet.h:31">NGX_SOCKADDR_STRLEN</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; host.data = addr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../core/ngx_connection.c.html#L1064" title="core/ngx_connection.c:1064">ngx_connection_local_sockaddr</a>(c, &amp;host, <span class="Constant">0</span>) != <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (c-&gt;local_sockaddr-&gt;sa_family) {<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> AF_INET6:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sin6 = (<span class="Type">struct</span> sockaddr_in6 *) c-&gt;local_sockaddr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port = ntohs(sin6-&gt;sin6_port);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><span class="PreProc">#if (NGX_HAVE_UNIX_DOMAIN)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> AF_UNIX:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><span class="cUserCont">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> <span class="Comment">/* AF_INET */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sin = (<span class="Type">struct</span> sockaddr_in *) c-&gt;local_sockaddr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port = ntohs(sin-&gt;sin_port);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;Location: https://&quot;</span>) - <span class="Constant">1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; + host.len<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; + r-&gt;headers_out.location-&gt;value.len + <span class="Constant">2</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (clcf-&gt;port_in_redirect) {<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HTTP_SSL)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c-&gt;ssl)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port = (port == <span class="Constant">443</span>) ? <span class="Constant">0</span> : port;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">else<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port = (port == <span class="Constant">80</span>) ? <span class="Constant">0</span> : port;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (port) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;:65535&quot;</span>) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_string.h.html#L44" title="core/ngx_string.h:44">ngx_str_null</a>(&amp;host);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; port = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;chunked) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;Transfer-Encoding: chunked&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.status == <a href="ngx_http_request.h.html#L68" title="http/ngx_http_request.h:68">NGX_HTTP_SWITCHING_PROTOCOLS</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;Connection: upgrade&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>) - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (r-&gt;keepalive) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;Connection: keep-alive&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>) - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * MSIE and Opera ignore the &quot;Keep-Alive: timeout=&lt;N&gt;&quot; header.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * MSIE keeps the connection alive for about 60-65 seconds.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Opera keeps the connection alive very long.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Mozilla keeps the connection alive for N plus about 1-10 seconds.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Konqueror keeps the connection alive for about N seconds.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (clcf-&gt;keepalive_header) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;Keep-Alive: timeout=&quot;</span>) - <span class="Constant">1</span> + NGX_TIME_T_LEN + <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;Connection: close&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HTTP_GZIP)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;gzip_vary) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (clcf-&gt;gzip_vary) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;Vary: Accept-Encoding&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>) - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;gzip_vary = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; part = &amp;r-&gt;headers_out.headers.part;<br/></li>
<li>&nbsp; &nbsp; header = part-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; <span class="Comment">/* void */</span>; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i &gt;= part-&gt;nelts) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (part-&gt;next == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; part = part-&gt;next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; header = part-&gt;elts;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (header[i].hash == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len += header[i].key.len + <span class="Statement">sizeof</span>(<span class="Constant">&quot;: &quot;</span>) - <span class="Constant">1</span> + header[i].value.len<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; + <span class="Statement">sizeof</span>(<a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; b = <a href="../core/ngx_buf.c.html#L13" title="core/ngx_buf.c:13">ngx_create_temp_buf</a>(r-&gt;pool, len);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (b == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* &quot;HTTP/1.x &quot; */<br/></li>
<li></span>&nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(b-&gt;last, <span class="Constant">&quot;HTTP/1.1 &quot;</span>, <span class="Statement">sizeof</span>(<span class="Constant">&quot;HTTP/1.x &quot;</span>) - <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* status line */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (status_line) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L116" title="core/ngx_string.h:116">ngx_copy</a>(b-&gt;last, status_line-&gt;data, status_line-&gt;len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.c.html#L105" title="core/ngx_string.c:105">ngx_sprintf</a>(b-&gt;last, <span class="Constant">&quot;</span><span class="Special">%03u</span><span class="Constant">i &quot;</span>, status);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; *b-&gt;last++ = <a href="../core/ngx_core.h.html#L85" title="core/ngx_core.h:85">CR</a>; *b-&gt;last++ = <a href="../core/ngx_core.h.html#L84" title="core/ngx_core.h:84">LF</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.server == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (clcf-&gt;server_tokens) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = (u_char *) <a href="#L50" title="http/ngx_http_header_filter_module.c:50">ngx_http_server_full_string</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Statement">sizeof</span>(<a href="#L50" title="http/ngx_http_header_filter_module.c:50">ngx_http_server_full_string</a>) - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = (u_char *) <a href="#L49" title="http/ngx_http_header_filter_module.c:49">ngx_http_server_string</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Statement">sizeof</span>(<a href="#L49" title="http/ngx_http_header_filter_module.c:49">ngx_http_server_string</a>) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(b-&gt;last, p, len);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.date == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(b-&gt;last, <span class="Constant">&quot;Date: &quot;</span>, <span class="Statement">sizeof</span>(<span class="Constant">&quot;Date: &quot;</span>) - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(b-&gt;last, <a href="../core/ngx_times.c.html#L29" title="core/ngx_times.c:29">ngx_cached_http_time</a>.data,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../core/ngx_times.c.html#L29" title="core/ngx_times.c:29">ngx_cached_http_time</a>.len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *b-&gt;last++ = <a href="../core/ngx_core.h.html#L85" title="core/ngx_core.h:85">CR</a>; *b-&gt;last++ = <a href="../core/ngx_core.h.html#L84" title="core/ngx_core.h:84">LF</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.content_type.len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(b-&gt;last, <span class="Constant">&quot;Content-Type: &quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Content-Type: &quot;</span>) - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = b-&gt;last;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L116" title="core/ngx_string.h:116">ngx_copy</a>(b-&gt;last, r-&gt;headers_out.content_type.data,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; r-&gt;headers_out.content_type.len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.content_type_len == r-&gt;headers_out.content_type.len<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; r-&gt;headers_out.charset.len)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(b-&gt;last, <span class="Constant">&quot;; charset=&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;; charset=&quot;</span>) - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L116" title="core/ngx_string.h:116">ngx_copy</a>(b-&gt;last, r-&gt;headers_out.charset.data,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; r-&gt;headers_out.charset.len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* update r-&gt;headers_out.content_type for possible logging */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_out.content_type.len = b-&gt;last - p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_out.content_type.data = p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *b-&gt;last++ = <a href="../core/ngx_core.h.html#L85" title="core/ngx_core.h:85">CR</a>; *b-&gt;last++ = <a href="../core/ngx_core.h.html#L84" title="core/ngx_core.h:84">LF</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.content_length == <span class="Constant">NULL<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; r-&gt;headers_out.content_length_n &gt;= <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.c.html#L105" title="core/ngx_string.c:105">ngx_sprintf</a>(b-&gt;last, <span class="Constant">&quot;Content-Length: </span><span class="Special">%O</span><span class="Constant">&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_out.content_length_n);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.last_modified == <span class="Constant">NULL<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; r-&gt;headers_out.last_modified_time != -<span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(b-&gt;last, <span class="Constant">&quot;Last-Modified: &quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Last-Modified: &quot;</span>) - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_times.c.html#L255" title="core/ngx_times.c:255">ngx_http_time</a>(b-&gt;last, r-&gt;headers_out.last_modified_time);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *b-&gt;last++ = <a href="../core/ngx_core.h.html#L85" title="core/ngx_core.h:85">CR</a>; *b-&gt;last++ = <a href="../core/ngx_core.h.html#L84" title="core/ngx_core.h:84">LF</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (host.data) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = b-&gt;last + <span class="Statement">sizeof</span>(<span class="Constant">&quot;Location: &quot;</span>) - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(b-&gt;last, <span class="Constant">&quot;Location: http&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Location: http&quot;</span>) - <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HTTP_SSL)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c-&gt;ssl) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *b-&gt;last++ =<span class="Constant">'s'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *b-&gt;last++ = <span class="Constant">':'</span>; *b-&gt;last++ = <span class="Constant">'/'</span>; *b-&gt;last++ = <span class="Constant">'/'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L116" title="core/ngx_string.h:116">ngx_copy</a>(b-&gt;last, host.data, host.len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (port) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.c.html#L105" title="core/ngx_string.c:105">ngx_sprintf</a>(b-&gt;last, <span class="Constant">&quot;:</span><span class="Special">%u</span><span class="Constant">i&quot;</span>, port);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L116" title="core/ngx_string.h:116">ngx_copy</a>(b-&gt;last, r-&gt;headers_out.location-&gt;value.data,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; r-&gt;headers_out.location-&gt;value.len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* update r-&gt;headers_out.location-&gt;value for possible logging */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_out.location-&gt;value.len = b-&gt;last - p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_out.location-&gt;value.data = p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_string.h.html#L42" title="core/ngx_string.h:42">ngx_str_set</a>(&amp;r-&gt;headers_out.location-&gt;key, <span class="Constant">&quot;Location&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *b-&gt;last++ = <a href="../core/ngx_core.h.html#L85" title="core/ngx_core.h:85">CR</a>; *b-&gt;last++ = <a href="../core/ngx_core.h.html#L84" title="core/ngx_core.h:84">LF</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;chunked) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(b-&gt;last, <span class="Constant">&quot;Transfer-Encoding: chunked&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Transfer-Encoding: chunked&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>) - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.status == <a href="ngx_http_request.h.html#L68" title="http/ngx_http_request.h:68">NGX_HTTP_SWITCHING_PROTOCOLS</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(b-&gt;last, <span class="Constant">&quot;Connection: upgrade&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Connection: upgrade&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>) - <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (r-&gt;keepalive) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(b-&gt;last, <span class="Constant">&quot;Connection: keep-alive&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Connection: keep-alive&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>) - <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (clcf-&gt;keepalive_header) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.c.html#L105" title="core/ngx_string.c:105">ngx_sprintf</a>(b-&gt;last, <span class="Constant">&quot;Keep-Alive: timeout=%T&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clcf-&gt;keepalive_header);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(b-&gt;last, <span class="Constant">&quot;Connection: close&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Connection: close&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>) - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HTTP_GZIP)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;gzip_vary) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(b-&gt;last, <span class="Constant">&quot;Vary: Accept-Encoding&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Vary: Accept-Encoding&quot;</span> <a href="../core/ngx_core.h.html#L86" title="core/ngx_core.h:86">CRLF</a>) - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; part = &amp;r-&gt;headers_out.headers.part;<br/></li>
<li>&nbsp; &nbsp; header = part-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; <span class="Comment">/* void */</span>; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i &gt;= part-&gt;nelts) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (part-&gt;next == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; part = part-&gt;next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; header = part-&gt;elts;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (header[i].hash == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L116" title="core/ngx_string.h:116">ngx_copy</a>(b-&gt;last, header[i].key.data, header[i].key.len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *b-&gt;last++ = <span class="Constant">':'</span>; *b-&gt;last++ = <span class="Constant">' '</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last = <a href="../core/ngx_string.h.html#L116" title="core/ngx_string.h:116">ngx_copy</a>(b-&gt;last, header[i].value.data, header[i].value.len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *b-&gt;last++ = <a href="../core/ngx_core.h.html#L85" title="core/ngx_core.h:85">CR</a>; *b-&gt;last++ = <a href="../core/ngx_core.h.html#L84" title="core/ngx_core.h:84">LF</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, c-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;</span><span class="Special">%*s</span><span class="Constant">&quot;</span>, (<span class="Type">size_t</span>) (b-&gt;last - b-&gt;pos), b-&gt;pos);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* the end of HTTP header */<br/></li>
<li></span>&nbsp; &nbsp; *b-&gt;last++ = <a href="../core/ngx_core.h.html#L85" title="core/ngx_core.h:85">CR</a>; *b-&gt;last++ = <a href="../core/ngx_core.h.html#L84" title="core/ngx_core.h:84">LF</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;header_size = b-&gt;last - b-&gt;pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;header_only) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; b-&gt;last_buf = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; out.buf = b;<br/></li>
<li>&nbsp; &nbsp; out.next = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_http_write_filter_module.c.html#L48" title="http/ngx_http_write_filter_module.c:48">ngx_http_write_filter</a>(r, &amp;out);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L628">&#x200c;</a><span class="linkable">ngx_http_header_filter_init</span>(<a href="../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.c.html#L72" title="http/ngx_http.c:72">ngx_http_top_header_filter</a> = <a href="#L151" title="http/ngx_http_header_filter_module.c:151">ngx_http_header_filter</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
</ol></code>
 </body>
</html>

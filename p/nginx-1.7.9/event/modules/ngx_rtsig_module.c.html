<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>event/modules/ngx_rtsig_module.c - src</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>event/modules/ngx_rtsig_module.c - src</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Global variables defined</h4>
 <ul>
<li><a href="#L44">ngx_linux_rtsig_max</a></li>
<li><a href="#L82">ngx_overflow_threshold_bounds</a></li>
<li><a href="#L87">ngx_rtsig_commands</a></li>
<li><a href="#L141">ngx_rtsig_module</a></li>
<li><a href="#L121">ngx_rtsig_module_ctx</a></li>
<li><a href="#L76">overflow</a></li>
<li><a href="#L76">overflow_current</a></li>
<li><a href="#L77">overflow_list</a></li>
<li><a href="#L80">rtsig_name</a></li>
<li><a href="#L75">set</a></li>
</ul>
 <h4>Data types defined</h4>
 <ul>
<li><a href="#L54">ngx_rtsig_conf_t</a></li>
</ul>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L724">ngx_check_ngx_overflow_threshold_bounds</a></li>
<li><a href="#L208">ngx_rtsig_add_connection</a></li>
<li><a href="#L689">ngx_rtsig_create_conf</a></li>
<li><a href="#L269">ngx_rtsig_del_connection</a></li>
<li><a href="#L199">ngx_rtsig_done</a></li>
<li><a href="#L158">ngx_rtsig_init</a></li>
<li><a href="#L708">ngx_rtsig_init_conf</a></li>
<li><a href="#L304">ngx_rtsig_process_events</a></li>
<li><a href="#L477">ngx_rtsig_process_overflow</a></li>
<li><a href="#L38">sigtimedwait</a></li>
</ul>
 <h4>Macros defined</h4>
 <ul>
<li><a href="#L31">F_SETSIG</a></li>
<li><a href="#L33">KERN_RTSIGMAX</a></li>
<li><a href="#L32">KERN_RTSIGNR</a></li>
<li><a href="#L17">SIGRTMIN</a></li>
<li><a href="#L25">SIGRTMIN</a></li>
<li><a href="#L18">si_fd</a></li>
<li><a href="#L23">si_fd</a></li>
<li><a href="#L26">si_fd</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Copyright (C) Igor Sysoev<br/></li>
<li></span><span class="Comment"> * Copyright (C) Nginx, Inc.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;ngx_config.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_core.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_event.h&gt;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_TEST_BUILD_RTSIG)<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#if (NGX_DARWIN)<br/></li>
<li></span><br/></li>
<li><a id="L17">&#x200c;</a><span class="PreProc">#define <span class="linkable">SIGRTMIN</span>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">33<br/></li>
<li><a id="L18">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">si_fd</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; __pad[</span><span class="Constant">0</span><span class="PreProc">]<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#ifdef&nbsp; <a href="#L17" title="event/modules/ngx_rtsig_module.c:17">SIGRTMIN</a><br/></li>
<li><a id="L23">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">si_fd</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _reason.__spare__.__spare2__[</span><span class="Constant">0</span><span class="PreProc">]<br/></li>
<li></span><span class="PreProc">#else<br/></li>
<li><a id="L25">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">SIGRTMIN</span>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">33<br/></li>
<li><a id="L26">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">si_fd</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; __spare__[</span><span class="Constant">0</span><span class="PreProc">]<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><a id="L31">&#x200c;</a><span class="PreProc">#define <span class="linkable">F_SETSIG</span>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Constant">10<br/></li>
<li><a id="L32">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">KERN_RTSIGNR</span>&nbsp;&nbsp; </span><span class="Constant">30<br/></li>
<li><a id="L33">&#x200c;</a></span><span class="PreProc">#define <span class="linkable">KERN_RTSIGMAX</span>&nbsp; </span><span class="Constant">31<br/></li>
<li></span><br/></li>
<li><span class="Type">int</span> <a href="#L38" title="event/modules/ngx_rtsig_module.c:38">sigtimedwait</a>(<span class="Type">const</span> sigset_t *<a href="#L75" title="event/modules/ngx_rtsig_module.c:75">set</a>, siginfo_t *info,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">const</span> <span class="Type">struct</span> timespec *timeout);<br/></li>
<li><br/></li>
<li><a id="L38">&#x200c;</a><span class="Type">int</span> <span class="linkable">sigtimedwait</span>(<span class="Type">const</span> sigset_t *<a href="#L75" title="event/modules/ngx_rtsig_module.c:75">set</a>, siginfo_t *info,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Type">const</span> <span class="Type">struct</span> timespec *timeout)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> -<span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><a id="L44">&#x200c;</a><span class="Type">int</span> <span class="linkable">ngx_linux_rtsig_max</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct</span> {<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; signo;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; overflow_events;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; overflow_test;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; overflow_threshold;<br/></li>
<li><a id="L54">&#x200c;</a>} <span class="linkable">ngx_rtsig_conf_t</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">extern</span> <a href="../ngx_event.h.html#L468" title="event/ngx_event.h:468">ngx_event_module_t</a>&nbsp; <a href="ngx_poll_module.c.html#L30" title="event/modules/ngx_poll_module.c:30">ngx_poll_module_ctx</a>;<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L158" title="event/modules/ngx_rtsig_module.c:158">ngx_rtsig_init</a>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle, <a href="../../os/unix/ngx_time.h.html#L16" title="os/unix/ngx_time.h:16">ngx_msec_t</a> timer);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L199" title="event/modules/ngx_rtsig_module.c:199">ngx_rtsig_done</a>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle);<br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L208" title="event/modules/ngx_rtsig_module.c:208">ngx_rtsig_add_connection</a>(<a href="../../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a> *c);<br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L269" title="event/modules/ngx_rtsig_module.c:269">ngx_rtsig_del_connection</a>(<a href="../../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a> *c,<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> flags);<br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L304" title="event/modules/ngx_rtsig_module.c:304">ngx_rtsig_process_events</a>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle,<br/></li>
<li>&nbsp; &nbsp; <a href="../../os/unix/ngx_time.h.html#L16" title="os/unix/ngx_time.h:16">ngx_msec_t</a> timer, <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> flags);<br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L477" title="event/modules/ngx_rtsig_module.c:477">ngx_rtsig_process_overflow</a>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle,<br/></li>
<li>&nbsp; &nbsp; <a href="../../os/unix/ngx_time.h.html#L16" title="os/unix/ngx_time.h:16">ngx_msec_t</a> timer, <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> flags);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> *<a href="#L689" title="event/modules/ngx_rtsig_module.c:689">ngx_rtsig_create_conf</a>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L708" title="event/modules/ngx_rtsig_module.c:708">ngx_rtsig_init_conf</a>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle, <span class="Type">void</span> *conf);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L724" title="event/modules/ngx_rtsig_module.c:724">ngx_check_ngx_overflow_threshold_bounds</a>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span> *post, <span class="Type">void</span> *data);<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L75">&#x200c;</a><span class="Type">static</span> sigset_t&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">set</span>;<br/></li>
<li><a id="L76">&#x200c;</a><a id="L76">&#x200c;</a><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; <span class="linkable">overflow</span>, <span class="linkable">overflow_current</span>;<br/></li>
<li><a id="L77">&#x200c;</a><span class="Type">static</span> <span class="Type">struct</span> pollfd&nbsp; *<span class="linkable">overflow_list</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L80">&#x200c;</a><span class="Type">static</span> <a href="../../core/ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; <span class="linkable">rtsig_name</span> = <a href="../../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;rtsig&quot;</span>);<br/></li>
<li><br/></li>
<li><a id="L82">&#x200c;</a><span class="Type">static</span> <a href="../../core/ngx_conf_file.h.html#L195" title="core/ngx_conf_file.h:195">ngx_conf_num_bounds_t</a>&nbsp; <span class="linkable">ngx_overflow_threshold_bounds</span> = {<br/></li>
<li>&nbsp; &nbsp; <a href="#L724" title="event/modules/ngx_rtsig_module.c:724">ngx_check_ngx_overflow_threshold_bounds</a>, <span class="Constant">2</span>, <span class="Constant">10<br/></li>
<li></span>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L87">&#x200c;</a><span class="Type">static</span> <a href="../../core/ngx_core.h.html#L19" title="core/ngx_core.h:19">ngx_command_t</a>&nbsp; <span class="linkable">ngx_rtsig_commands</span>[] = {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;rtsig_signo&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../ngx_event.h.html#L441" title="event/ngx_event.h:441">NGX_EVENT_CONF</a>|<a href="../../core/ngx_conf_file.h.html#L23" title="core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../../core/ngx_conf_file.c.html#L1084" title="core/ngx_conf_file.c:1084">ngx_conf_set_num_slot</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; offsetof(<a href="#L54" title="event/modules/ngx_rtsig_module.c:54">ngx_rtsig_conf_t</a>, signo),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;rtsig_overflow_events&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../ngx_event.h.html#L441" title="event/ngx_event.h:441">NGX_EVENT_CONF</a>|<a href="../../core/ngx_conf_file.h.html#L23" title="core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../../core/ngx_conf_file.c.html#L1084" title="core/ngx_conf_file.c:1084">ngx_conf_set_num_slot</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; offsetof(<a href="#L54" title="event/modules/ngx_rtsig_module.c:54">ngx_rtsig_conf_t</a>, overflow_events),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;rtsig_overflow_test&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../ngx_event.h.html#L441" title="event/ngx_event.h:441">NGX_EVENT_CONF</a>|<a href="../../core/ngx_conf_file.h.html#L23" title="core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../../core/ngx_conf_file.c.html#L1084" title="core/ngx_conf_file.c:1084">ngx_conf_set_num_slot</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; offsetof(<a href="#L54" title="event/modules/ngx_rtsig_module.c:54">ngx_rtsig_conf_t</a>, overflow_test),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;rtsig_overflow_threshold&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../ngx_event.h.html#L441" title="event/ngx_event.h:441">NGX_EVENT_CONF</a>|<a href="../../core/ngx_conf_file.h.html#L23" title="core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../../core/ngx_conf_file.c.html#L1084" title="core/ngx_conf_file.c:1084">ngx_conf_set_num_slot</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; offsetof(<a href="#L54" title="event/modules/ngx_rtsig_module.c:54">ngx_rtsig_conf_t</a>, overflow_threshold),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &amp;<a href="#L82" title="event/modules/ngx_rtsig_module.c:82">ngx_overflow_threshold_bounds</a> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../../core/ngx_conf_file.h.html#L87" title="core/ngx_conf_file.h:87">ngx_null_command</a><br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L121">&#x200c;</a><a href="../ngx_event.h.html#L468" title="event/ngx_event.h:468">ngx_event_module_t</a>&nbsp; <span class="linkable">ngx_rtsig_module_ctx</span> = {<br/></li>
<li>&nbsp; &nbsp; &amp;<a href="#L80" title="event/modules/ngx_rtsig_module.c:80">rtsig_name</a>,<br/></li>
<li>&nbsp; &nbsp; <a href="#L689" title="event/modules/ngx_rtsig_module.c:689">ngx_rtsig_create_conf</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* create configuration */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L708" title="event/modules/ngx_rtsig_module.c:708">ngx_rtsig_init_conf</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* init configuration */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* add an event */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* delete an event */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* enable an event */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* disable an event */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L208" title="event/modules/ngx_rtsig_module.c:208">ngx_rtsig_add_connection</a>,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* add an connection */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L269" title="event/modules/ngx_rtsig_module.c:269">ngx_rtsig_del_connection</a>,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* delete an connection */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* process the changes */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L304" title="event/modules/ngx_rtsig_module.c:304">ngx_rtsig_process_events</a>,&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* process the events */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L158" title="event/modules/ngx_rtsig_module.c:158">ngx_rtsig_init</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init the events */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L199" title="event/modules/ngx_rtsig_module.c:199">ngx_rtsig_done</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* done the events */<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>};<br/></li>
<li><br/></li>
<li><a id="L141">&#x200c;</a><a href="../../core/ngx_core.h.html#L12" title="core/ngx_core.h:12">ngx_module_t</a>&nbsp; <span class="linkable">ngx_rtsig_module</span> = {<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_conf_file.h.html#L99" title="core/ngx_conf_file.h:99">NGX_MODULE_V1</a>,<br/></li>
<li>&nbsp; &nbsp; &amp;<a href="#L121" title="event/modules/ngx_rtsig_module.c:121">ngx_rtsig_module_ctx</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* module context */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L87" title="event/modules/ngx_rtsig_module.c:87">ngx_rtsig_commands</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* module directives */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../ngx_event.h.html#L440" title="event/ngx_event.h:440">NGX_EVENT_MODULE</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* module type */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init master */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init module */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init process */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init thread */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* exit thread */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* exit process */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* exit master */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../../core/ngx_conf_file.h.html#L100" title="core/ngx_conf_file.h:100">NGX_MODULE_V1_PADDING</a><br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L158">&#x200c;</a><span class="linkable">ngx_rtsig_init</span>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle, <a href="../../os/unix/ngx_time.h.html#L16" title="os/unix/ngx_time.h:16">ngx_msec_t</a> timer)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L54" title="event/modules/ngx_rtsig_module.c:54">ngx_rtsig_conf_t</a>&nbsp; *rtscf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rtscf = <a href="../ngx_event.h.html#L505" title="event/ngx_event.h:505">ngx_event_get_conf</a>(cycle-&gt;conf_ctx, <a href="#L141" title="event/modules/ngx_rtsig_module.c:141">ngx_rtsig_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sigemptyset(&amp;<a href="#L75" title="event/modules/ngx_rtsig_module.c:75">set</a>);<br/></li>
<li>&nbsp; &nbsp; sigaddset(&amp;<a href="#L75" title="event/modules/ngx_rtsig_module.c:75">set</a>, (<span class="Type">int</span>) rtscf-&gt;signo);<br/></li>
<li>&nbsp; &nbsp; sigaddset(&amp;<a href="#L75" title="event/modules/ngx_rtsig_module.c:75">set</a>, (<span class="Type">int</span>) rtscf-&gt;signo + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; sigaddset(&amp;<a href="#L75" title="event/modules/ngx_rtsig_module.c:75">set</a>, SIGIO);<br/></li>
<li>&nbsp; &nbsp; sigaddset(&amp;<a href="#L75" title="event/modules/ngx_rtsig_module.c:75">set</a>, <span class="Constant">SIGALRM</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sigprocmask(SIG_BLOCK, &amp;<a href="#L75" title="event/modules/ngx_rtsig_module.c:75">set</a>, <span class="Constant">NULL</span>) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L17" title="core/ngx_log.h:17">NGX_LOG_EMERG</a>, cycle-&gt;log, <a href="../../os/unix/ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;sigprocmask() failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L77" title="event/modules/ngx_rtsig_module.c:77">overflow_list</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../os/unix/ngx_alloc.h.html#L19" title="os/unix/ngx_alloc.h:19">ngx_free</a>(<a href="#L77" title="event/modules/ngx_rtsig_module.c:77">overflow_list</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L77" title="event/modules/ngx_rtsig_module.c:77">overflow_list</a> = <a href="../../os/unix/ngx_alloc.c.html#L18" title="os/unix/ngx_alloc.c:18">ngx_alloc</a>(<span class="Statement">sizeof</span>(<span class="Type">struct</span> pollfd) * rtscf-&gt;overflow_events,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;log);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L77" title="event/modules/ngx_rtsig_module.c:77">overflow_list</a> == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_connection.c.html#L13" title="core/ngx_connection.c:13">ngx_io</a> = <a href="../../os/unix/ngx_posix_init.c.html#L22" title="os/unix/ngx_posix_init.c:22">ngx_os_io</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../ngx_event.c.html#L45" title="event/ngx_event.c:45">ngx_event_actions</a> = <a href="#L121" title="event/modules/ngx_rtsig_module.c:121">ngx_rtsig_module_ctx</a>.actions;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../ngx_event.c.html#L44" title="event/ngx_event.c:44">ngx_event_flags</a> = <a href="../ngx_event.h.html#L260" title="event/ngx_event.h:260">NGX_USE_RTSIG_EVENT</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<a href="../ngx_event.h.html#L250" title="event/ngx_event.h:250">NGX_USE_GREEDY_EVENT</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<a href="../ngx_event.h.html#L278" title="event/ngx_event.h:278">NGX_USE_FD_EVENT</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L199">&#x200c;</a></span><span class="linkable">ngx_rtsig_done</span>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../../os/unix/ngx_alloc.h.html#L19" title="os/unix/ngx_alloc.h:19">ngx_free</a>(<a href="#L77" title="event/modules/ngx_rtsig_module.c:77">overflow_list</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L77" title="event/modules/ngx_rtsig_module.c:77">overflow_list</a> = <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L208">&#x200c;</a><span class="linkable">ngx_rtsig_add_connection</span>(<a href="../../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a> *c)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; signo;<br/></li>
<li>&nbsp; &nbsp; <a href="#L54" title="event/modules/ngx_rtsig_module.c:54">ngx_rtsig_conf_t</a>&nbsp; *rtscf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (c-&gt;read-&gt;accept &amp;&amp; c-&gt;read-&gt;disabled) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../../core/ngx_log.h.html#L29" title="core/ngx_log.h:29">NGX_LOG_DEBUG_EVENT</a>, c-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;rtsig enable connection: fd:</span><span class="Special">%d</span><span class="Constant">&quot;</span>, c-&gt;fd);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (fcntl(c-&gt;fd, F_SETOWN, <a href="../../os/unix/ngx_process_cycle.c.html#L36" title="os/unix/ngx_process_cycle.c:36">ngx_pid</a>) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, c-&gt;log, <a href="../../os/unix/ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;fcntl(F_SETOWN) failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c-&gt;read-&gt;active = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c-&gt;read-&gt;disabled = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rtscf = <a href="../ngx_event.h.html#L505" title="event/ngx_event.h:505">ngx_event_get_conf</a>(<a href="../../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;conf_ctx, <a href="#L141" title="event/modules/ngx_rtsig_module.c:141">ngx_rtsig_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; signo = rtscf-&gt;signo + c-&gt;read-&gt;instance;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../../core/ngx_log.h.html#L29" title="core/ngx_log.h:29">NGX_LOG_DEBUG_EVENT</a>, c-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;rtsig add connection: fd:</span><span class="Special">%d</span><span class="Constant"> signo:</span><span class="Special">%u</span><span class="Constant">i&quot;</span>, c-&gt;fd, signo);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fcntl(c-&gt;fd, F_SETFL, O_RDWR|O_NONBLOCK|O_ASYNC) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, c-&gt;log, <a href="../../os/unix/ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;fcntl(O_RDWR|O_NONBLOCK|O_ASYNC) failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fcntl(c-&gt;fd, <a href="#L31" title="event/modules/ngx_rtsig_module.c:31">F_SETSIG</a>, (<span class="Type">int</span>) signo) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, c-&gt;log, <a href="../../os/unix/ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;fcntl(<a href="#L31" title="event/modules/ngx_rtsig_module.c:31">F_SETSIG</a>) failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fcntl(c-&gt;fd, F_SETOWN, <a href="../../os/unix/ngx_process_cycle.c.html#L36" title="os/unix/ngx_process_cycle.c:36">ngx_pid</a>) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, c-&gt;log, <a href="../../os/unix/ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;fcntl(F_SETOWN) failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_ONESIGFD)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">if</span> (fcntl(c-&gt;fd, F_SETAUXFL, O_ONESIGFD) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, c-&gt;log, <a href="../../os/unix/ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;fcntl(F_SETAUXFL) failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; c-&gt;read-&gt;active = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; c-&gt;write-&gt;active = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L269">&#x200c;</a><span class="linkable">ngx_rtsig_del_connection</span>(<a href="../../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a> *c, <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> flags)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../../core/ngx_log.h.html#L29" title="core/ngx_log.h:29">NGX_LOG_DEBUG_EVENT</a>, c-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;rtsig del connection: fd:</span><span class="Special">%d</span><span class="Constant">&quot;</span>, c-&gt;fd);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> ((flags &amp; <a href="../ngx_event.h.html#L314" title="event/ngx_event.h:314">NGX_DISABLE_EVENT</a>) &amp;&amp; c-&gt;read-&gt;accept) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../../core/ngx_log.h.html#L29" title="core/ngx_log.h:29">NGX_LOG_DEBUG_EVENT</a>, c-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;rtsig disable connection: fd:</span><span class="Special">%d</span><span class="Constant">&quot;</span>, c-&gt;fd);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c-&gt;read-&gt;active = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c-&gt;read-&gt;disabled = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (flags &amp; <a href="../ngx_event.h.html#L308" title="event/ngx_event.h:308">NGX_CLOSE_EVENT</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c-&gt;read-&gt;active = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c-&gt;write-&gt;active = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (fcntl(c-&gt;fd, F_SETFL, O_RDWR|O_NONBLOCK) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, c-&gt;log, <a href="../../os/unix/ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;fcntl(O_RDWR|O_NONBLOCK) failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c-&gt;read-&gt;active = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; c-&gt;write-&gt;active = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L304">&#x200c;</a><span class="linkable">ngx_rtsig_process_events</span>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle, <a href="../../os/unix/ngx_time.h.html#L16" title="os/unix/ngx_time.h:16">ngx_msec_t</a> timer, <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> flags)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; signo;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; instance;<br/></li>
<li>&nbsp; &nbsp; <a href="../../os/unix/ngx_errno.h.html#L16" title="os/unix/ngx_errno.h:16">ngx_err_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; err;<br/></li>
<li>&nbsp; &nbsp; siginfo_t&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; si;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *rev, *wev;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_queue.h.html#L16" title="core/ngx_queue.h:16">ngx_queue_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *queue;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> timespec&nbsp; &nbsp;&nbsp; ts, *tp;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sigaction&nbsp; &nbsp; sa;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp;&nbsp; *c;<br/></li>
<li>&nbsp; &nbsp; <a href="#L54" title="event/modules/ngx_rtsig_module.c:54">ngx_rtsig_conf_t</a>&nbsp;&nbsp; *rtscf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (timer == <a href="../ngx_event_timer.h.html#L17" title="event/ngx_event_timer.h:17">NGX_TIMER_INFINITE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tp = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ts.tv_sec = timer / <span class="Constant">1000</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ts.tv_nsec = (timer % <span class="Constant">1000</span>) * <span class="Constant">1000000</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; tp = &amp;ts;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../../core/ngx_log.h.html#L29" title="core/ngx_log.h:29">NGX_LOG_DEBUG_EVENT</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;rtsig timer: %M&quot;</span>, timer);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Linux's sigwaitinfo() is <a href="#L38" title="event/modules/ngx_rtsig_module.c:38">sigtimedwait</a>() with the NULL timeout pointer */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; signo = <a href="#L38" title="event/modules/ngx_rtsig_module.c:38">sigtimedwait</a>(&amp;<a href="#L75" title="event/modules/ngx_rtsig_module.c:75">set</a>, &amp;si, tp);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (signo == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; err = <a href="../../os/unix/ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../../core/ngx_log.h.html#L29" title="core/ngx_log.h:29">NGX_LOG_DEBUG_EVENT</a>, cycle-&gt;log, err,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;rtsig signo:</span><span class="Special">%d</span><span class="Constant">&quot;</span>, signo);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (flags &amp; <a href="../ngx_event.h.html#L495" title="event/ngx_event.h:495">NGX_UPDATE_TIME</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_times.c.html#L78" title="core/ngx_times.c:78">ngx_time_update</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (err == <a href="../../os/unix/ngx_errno.h.html#L62" title="os/unix/ngx_errno.h:62">NGX_EAGAIN</a>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* timeout */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (timer != <a href="../ngx_event_timer.h.html#L17" title="event/ngx_event_timer.h:17">NGX_TIMER_INFINITE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L31" title="core/ngx_core.h:31">NGX_AGAIN</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, err,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;<a href="#L38" title="event/modules/ngx_rtsig_module.c:38">sigtimedwait</a>() returned EAGAIN without timeout&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>((err == <a href="../../os/unix/ngx_errno.h.html#L22" title="os/unix/ngx_errno.h:22">NGX_EINTR</a>) ? <a href="../../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a> : <a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;log, err, <span class="Constant">&quot;<a href="#L38" title="event/modules/ngx_rtsig_module.c:38">sigtimedwait</a>() failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L141" title="core/ngx_log.h:141">ngx_log_debug3</a>(<a href="../../core/ngx_log.h.html#L29" title="core/ngx_log.h:29">NGX_LOG_DEBUG_EVENT</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;rtsig signo:</span><span class="Special">%d</span><span class="Constant"> fd:</span><span class="Special">%d</span><span class="Constant"> band:</span><span class="Special">%04X</span><span class="Constant">d&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; signo, si.<a href="#L18" title="event/modules/ngx_rtsig_module.c:18">si_fd</a>, si.si_band);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (flags &amp; <a href="../ngx_event.h.html#L495" title="event/ngx_event.h:495">NGX_UPDATE_TIME</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_times.c.html#L78" title="core/ngx_times.c:78">ngx_time_update</a>();<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rtscf = <a href="../ngx_event.h.html#L505" title="event/ngx_event.h:505">ngx_event_get_conf</a>(<a href="../../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;conf_ctx, <a href="#L141" title="event/modules/ngx_rtsig_module.c:141">ngx_rtsig_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (signo == (<span class="Type">int</span>) rtscf-&gt;signo || signo == (<span class="Type">int</span>) rtscf-&gt;signo + <span class="Constant">1</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="event/modules/ngx_rtsig_module.c:76">overflow</a> &amp;&amp; (<a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) si.<a href="#L18" title="event/modules/ngx_rtsig_module.c:18">si_fd</a> &gt; <a href="#L76" title="event/modules/ngx_rtsig_module.c:76">overflow_current</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c = <a href="../../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;files[si.<a href="#L18" title="event/modules/ngx_rtsig_module.c:18">si_fd</a>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c == <span class="Constant">NULL</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* the stale event */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; instance = signo - (<span class="Type">int</span>) rtscf-&gt;signo;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rev = c-&gt;read;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rev-&gt;instance != instance) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * the stale event from a file descriptor<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * that was just closed in this iteration<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../../core/ngx_log.h.html#L29" title="core/ngx_log.h:29">NGX_LOG_DEBUG_EVENT</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;rtsig: stale event </span><span class="Special">%p</span><span class="Constant">&quot;</span>, c);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((si.si_band &amp; (POLLIN|POLLHUP|POLLERR)) &amp;&amp; rev-&gt;active) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rev-&gt;ready = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (flags &amp; <a href="../ngx_event.h.html#L496" title="event/ngx_event.h:496">NGX_POST_EVENTS</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; queue = rev-&gt;accept ? &amp;<a href="../ngx_event_posted.c.html#L13" title="event/ngx_event_posted.c:13">ngx_posted_accept_events</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : &amp;<a href="../ngx_event_posted.c.html#L14" title="event/ngx_event_posted.c:14">ngx_posted_events</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../ngx_event_posted.h.html#L17" title="event/ngx_event_posted.h:17">ngx_post_event</a>(rev, queue);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rev-&gt;handler(rev);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; wev = c-&gt;write;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((si.si_band &amp; (POLLOUT|POLLHUP|POLLERR)) &amp;&amp; wev-&gt;active) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wev-&gt;ready = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (flags &amp; <a href="../ngx_event.h.html#L496" title="event/ngx_event.h:496">NGX_POST_EVENTS</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../ngx_event_posted.h.html#L17" title="event/ngx_event_posted.h:17">ngx_post_event</a>(wev, &amp;<a href="../ngx_event_posted.c.html#L14" title="event/ngx_event_posted.c:14">ngx_posted_events</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wev-&gt;handler(wev);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (signo == <span class="Constant">SIGALRM</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_times.c.html#L78" title="core/ngx_times.c:78">ngx_time_update</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (signo == SIGIO) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rt signal queue overflowed&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* flush the RT signal queue */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_string.h.html#L86" title="core/ngx_string.h:86">ngx_memzero</a>(&amp;sa, <span class="Statement">sizeof</span>(<span class="Type">struct</span> sigaction));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sa.sa_handler = <span class="Constant">SIG_DFL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sigemptyset(&amp;sa.sa_mask);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sigaction(rtscf-&gt;signo, &amp;sa, <span class="Constant">NULL</span>) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <a href="../../os/unix/ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;sigaction(</span><span class="Special">%d</span><span class="Constant">, SIG_DFL) failed&quot;</span>, rtscf-&gt;signo);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sigaction(rtscf-&gt;signo + <span class="Constant">1</span>, &amp;sa, <span class="Constant">NULL</span>) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <a href="../../os/unix/ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;sigaction(</span><span class="Special">%d</span><span class="Constant">, SIG_DFL) failed&quot;</span>, rtscf-&gt;signo + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L76" title="event/modules/ngx_rtsig_module.c:76">overflow</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L76" title="event/modules/ngx_rtsig_module.c:76">overflow_current</a> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../ngx_event.c.html#L45" title="event/ngx_event.c:45">ngx_event_actions</a>.process_events = <a href="#L477" title="event/modules/ngx_rtsig_module.c:477">ngx_rtsig_process_overflow</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;<a href="#L38" title="event/modules/ngx_rtsig_module.c:38">sigtimedwait</a>() returned unexpected signal: </span><span class="Special">%d</span><span class="Constant">&quot;</span>, signo);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L477">&#x200c;</a><span class="linkable">ngx_rtsig_process_overflow</span>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle, <a href="../../os/unix/ngx_time.h.html#L16" title="os/unix/ngx_time.h:16">ngx_msec_t</a> timer,<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> flags)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name[<span class="Constant">2</span>], rtsig_max, rtsig_nr, events, ready;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <a href="../../os/unix/ngx_errno.h.html#L16" title="os/unix/ngx_errno.h:16">ngx_err_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; tested, n, i;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_core.h.html#L21" title="core/ngx_core.h:21">ngx_event_t</a>&nbsp; &nbsp; &nbsp;&nbsp; *rev, *wev;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_queue.h.html#L16" title="core/ngx_queue.h:16">ngx_queue_t</a>&nbsp; &nbsp; &nbsp;&nbsp; *queue;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_core.h.html#L23" title="core/ngx_core.h:23">ngx_connection_t</a>&nbsp; *c;<br/></li>
<li>&nbsp; &nbsp; <a href="#L54" title="event/modules/ngx_rtsig_module.c:54">ngx_rtsig_conf_t</a>&nbsp; *rtscf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L132" title="core/ngx_log.h:132">ngx_log_debug0</a>(<a href="../../core/ngx_log.h.html#L29" title="core/ngx_log.h:29">NGX_LOG_DEBUG_EVENT</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;rtsig process <a href="#L76" title="event/modules/ngx_rtsig_module.c:76">overflow</a>&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rtscf = <a href="../ngx_event.h.html#L505" title="event/ngx_event.h:505">ngx_event_get_conf</a>(<a href="../../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;conf_ctx, <a href="#L141" title="event/modules/ngx_rtsig_module.c:141">ngx_rtsig_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; tested = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> ( ;; ) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (n &lt; rtscf-&gt;overflow_events) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L76" title="event/modules/ngx_rtsig_module.c:76">overflow_current</a> == cycle-&gt;connection_n) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c = cycle-&gt;files[<a href="#L76" title="event/modules/ngx_rtsig_module.c:76">overflow_current</a>++];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c == <span class="Constant">NULL</span> || c-&gt;fd == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; events = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c-&gt;read-&gt;active &amp;&amp; c-&gt;read-&gt;handler) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; events |= POLLIN;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c-&gt;write-&gt;active &amp;&amp; c-&gt;write-&gt;handler) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; events |= POLLOUT;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (events == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L77" title="event/modules/ngx_rtsig_module.c:77">overflow_list</a>[n].fd = c-&gt;fd;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L77" title="event/modules/ngx_rtsig_module.c:77">overflow_list</a>[n].events = events;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L77" title="event/modules/ngx_rtsig_module.c:77">overflow_list</a>[n].revents = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> ( ;; ) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ready = poll(<a href="#L77" title="event/modules/ngx_rtsig_module.c:77">overflow_list</a>, n, <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../../core/ngx_log.h.html#L29" title="core/ngx_log.h:29">NGX_LOG_DEBUG_EVENT</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;rtsig <a href="#L76" title="event/modules/ngx_rtsig_module.c:76">overflow</a> poll:</span><span class="Special">%d</span><span class="Constant">&quot;</span>, ready);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ready == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err = <a href="../../os/unix/ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>((err == <a href="../../os/unix/ngx_errno.h.html#L22" title="os/unix/ngx_errno.h:22">NGX_EINTR</a>) ? <a href="../../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a> : <a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;poll() failed while the <a href="#L76" title="event/modules/ngx_rtsig_module.c:76">overflow</a> recover&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (err == <a href="../../os/unix/ngx_errno.h.html#L22" title="os/unix/ngx_errno.h:22">NGX_EINTR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ready &lt;= <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c = cycle-&gt;files[<a href="#L77" title="event/modules/ngx_rtsig_module.c:77">overflow_list</a>[i].fd];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rev = c-&gt;read;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rev-&gt;active<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; !rev-&gt;closed<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; rev-&gt;handler<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; (<a href="#L77" title="event/modules/ngx_rtsig_module.c:77">overflow_list</a>[i].revents<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp; (POLLIN|POLLERR|POLLHUP|POLLNVAL)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tested++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rev-&gt;ready = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (flags &amp; <a href="../ngx_event.h.html#L496" title="event/ngx_event.h:496">NGX_POST_EVENTS</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; queue = rev-&gt;accept ? &amp;<a href="../ngx_event_posted.c.html#L13" title="event/ngx_event_posted.c:13">ngx_posted_accept_events</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : &amp;<a href="../ngx_event_posted.c.html#L14" title="event/ngx_event_posted.c:14">ngx_posted_events</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../ngx_event_posted.h.html#L17" title="event/ngx_event_posted.h:17">ngx_post_event</a>(rev, queue);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rev-&gt;handler(rev);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wev = c-&gt;write;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (wev-&gt;active<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; !wev-&gt;closed<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; wev-&gt;handler<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; (<a href="#L77" title="event/modules/ngx_rtsig_module.c:77">overflow_list</a>[i].revents<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp; (POLLOUT|POLLERR|POLLHUP|POLLNVAL)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tested++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wev-&gt;ready = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (flags &amp; <a href="../ngx_event.h.html#L496" title="event/ngx_event.h:496">NGX_POST_EVENTS</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../ngx_event_posted.h.html#L17" title="event/ngx_event_posted.h:17">ngx_post_event</a>(wev, &amp;<a href="../ngx_event_posted.c.html#L14" title="event/ngx_event_posted.c:14">ngx_posted_events</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wev-&gt;handler(wev);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (tested &gt;= rtscf-&gt;overflow_test) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L44" title="event/modules/ngx_rtsig_module.c:44">ngx_linux_rtsig_max</a>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Check the current rt queue length to prevent<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * the new <a href="#L76" title="event/modules/ngx_rtsig_module.c:76">overflow</a>.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * learn the &quot;/proc/sys/kernel/rtsig-max&quot; value because<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * it can be changed since the last checking<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name[<span class="Constant">0</span>] = CTL_KERN;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name[<span class="Constant">1</span>] = <a href="#L33" title="event/modules/ngx_rtsig_module.c:33">KERN_RTSIGMAX</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Statement">sizeof</span>(rtsig_max);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sysctl(name, <span class="Constant">2</span>, &amp;rtsig_max, &amp;len, <span class="Constant">NULL</span>, <span class="Constant">0</span>) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, errno,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;sysctl(<a href="#L33" title="event/modules/ngx_rtsig_module.c:33">KERN_RTSIGMAX</a>) failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* name[0] = CTL_KERN; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name[<span class="Constant">1</span>] = <a href="#L32" title="event/modules/ngx_rtsig_module.c:32">KERN_RTSIGNR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Statement">sizeof</span>(rtsig_nr);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sysctl(name, <span class="Constant">2</span>, &amp;rtsig_nr, &amp;len, <span class="Constant">NULL</span>, <span class="Constant">0</span>) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, errno,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;sysctl(<a href="#L32" title="event/modules/ngx_rtsig_module.c:32">KERN_RTSIGNR</a>) failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * drain the rt signal queue if the /&quot;proc/sys/kernel/rtsig-nr&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * is bigger than<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &quot;/proc/sys/kernel/rtsig-max&quot; / &quot;rtsig_overflow_threshold&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rtsig_max / (<span class="Type">int</span>) rtscf-&gt;overflow_threshold &lt; rtsig_nr) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../../core/ngx_log.h.html#L29" title="core/ngx_log.h:29">NGX_LOG_DEBUG_EVENT</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;rtsig queue state: </span><span class="Special">%d</span><span class="Constant">/</span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; rtsig_nr, rtsig_max);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (<a href="#L304" title="event/modules/ngx_rtsig_module.c:304">ngx_rtsig_process_events</a>(cycle, <span class="Constant">0</span>, flags) == <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* void */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Linux has not <a href="#L33" title="event/modules/ngx_rtsig_module.c:33">KERN_RTSIGMAX</a> since 2.6.6-mm2<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * so drain the rt signal queue unconditionally<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (<a href="#L304" title="event/modules/ngx_rtsig_module.c:304">ngx_rtsig_process_events</a>(cycle, <span class="Constant">0</span>, flags) == <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* void */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tested = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (flags &amp; <a href="../ngx_event.h.html#L495" title="event/ngx_event.h:495">NGX_UPDATE_TIME</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_times.c.html#L78" title="core/ngx_times.c:78">ngx_time_update</a>();<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rt signal queue <a href="#L76" title="event/modules/ngx_rtsig_module.c:76">overflow</a> recovered&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L76" title="event/modules/ngx_rtsig_module.c:76">overflow</a> = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; <a href="../ngx_event.c.html#L45" title="event/ngx_event.c:45">ngx_event_actions</a>.process_events = <a href="#L304" title="event/modules/ngx_rtsig_module.c:304">ngx_rtsig_process_events</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> *<br/></li>
<li><a id="L689">&#x200c;</a><span class="linkable">ngx_rtsig_create_conf</span>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L54" title="event/modules/ngx_rtsig_module.c:54">ngx_rtsig_conf_t</a>&nbsp; *rtscf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rtscf = <a href="../../core/ngx_palloc.c.html#L120" title="core/ngx_palloc.c:120">ngx_palloc</a>(cycle-&gt;pool, <span class="Statement">sizeof</span>(<a href="#L54" title="event/modules/ngx_rtsig_module.c:54">ngx_rtsig_conf_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rtscf == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rtscf-&gt;signo = <a href="../../core/ngx_conf_file.h.html#L57" title="core/ngx_conf_file.h:57">NGX_CONF_UNSET</a>;<br/></li>
<li>&nbsp; &nbsp; rtscf-&gt;overflow_events = <a href="../../core/ngx_conf_file.h.html#L57" title="core/ngx_conf_file.h:57">NGX_CONF_UNSET</a>;<br/></li>
<li>&nbsp; &nbsp; rtscf-&gt;overflow_test = <a href="../../core/ngx_conf_file.h.html#L57" title="core/ngx_conf_file.h:57">NGX_CONF_UNSET</a>;<br/></li>
<li>&nbsp; &nbsp; rtscf-&gt;overflow_threshold = <a href="../../core/ngx_conf_file.h.html#L57" title="core/ngx_conf_file.h:57">NGX_CONF_UNSET</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> rtscf;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L708">&#x200c;</a><span class="linkable">ngx_rtsig_init_conf</span>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle, <span class="Type">void</span> *conf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L54" title="event/modules/ngx_rtsig_module.c:54">ngx_rtsig_conf_t</a>&nbsp; *rtscf = conf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* LinuxThreads use the first 3 RT <a href="../../os/unix/ngx_process.c.html#L39" title="os/unix/ngx_process.c:39">signals</a> */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../../core/ngx_conf_file.h.html#L231" title="core/ngx_conf_file.h:231">ngx_conf_init_uint_value</a>(rtscf-&gt;signo, <a href="#L17" title="event/modules/ngx_rtsig_module.c:17">SIGRTMIN</a> + <span class="Constant">10</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_conf_file.h.html#L231" title="core/ngx_conf_file.h:231">ngx_conf_init_uint_value</a>(rtscf-&gt;overflow_events, <span class="Constant">16</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_conf_file.h.html#L231" title="core/ngx_conf_file.h:231">ngx_conf_init_uint_value</a>(rtscf-&gt;overflow_test, <span class="Constant">32</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_conf_file.h.html#L231" title="core/ngx_conf_file.h:231">ngx_conf_init_uint_value</a>(rtscf-&gt;overflow_threshold, <span class="Constant">10</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L64" title="core/ngx_conf_file.h:64">NGX_CONF_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L724">&#x200c;</a><span class="linkable">ngx_check_ngx_overflow_threshold_bounds</span>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf, <span class="Type">void</span> *post, <span class="Type">void</span> *data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L44" title="event/modules/ngx_rtsig_module.c:44">ngx_linux_rtsig_max</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.c.html#L1377" title="core/ngx_conf_file.c:1377">ngx_conf_check_num_bounds</a>(cf, post, data);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_conf_file.c.html#L909" title="core/ngx_conf_file.c:909">ngx_conf_log_error</a>(<a href="../../core/ngx_log.h.html#L21" title="core/ngx_log.h:21">NGX_LOG_WARN</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">rtsig_overflow_threshold</span><span class="Special">\&quot;</span><span class="Constant"> is not supported &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;since Linux 2.6.6-mm2, ignored&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L64" title="core/ngx_conf_file.h:64">NGX_CONF_OK</a>;<br/></li>
<li>}<br/></li>
</ol></code>
 </body>
</html>

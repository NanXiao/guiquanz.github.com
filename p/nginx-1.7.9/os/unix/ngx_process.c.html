<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>os/unix/ngx_process.c - src</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>os/unix/ngx_process.c - src</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Global variables defined</h4>
 <ul>
<li><a href="#L29">ngx_argc</a></li>
<li><a href="#L30">ngx_argv</a></li>
<li><a href="#L34">ngx_channel</a></li>
<li><a href="#L35">ngx_last_process</a></li>
<li><a href="#L31">ngx_os_argv</a></li>
<li><a href="#L33">ngx_process_slot</a></li>
<li><a href="#L36">ngx_processes</a></li>
<li><a href="#L39">signals</a></li>
</ul>
 <h4>Data types defined</h4>
 <ul>
<li><a href="#L19">ngx_signal_t</a></li>
</ul>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L594">ngx_debug_point</a></li>
<li><a href="#L261">ngx_execute</a></li>
<li><a href="#L269">ngx_execute_proc</a></li>
<li><a href="#L284">ngx_init_signals</a></li>
<li><a href="#L614">ngx_os_signal_process</a></li>
<li><a href="#L453">ngx_process_get_status</a></li>
<li><a href="#L310">ngx_signal_handler</a></li>
<li><a href="#L87">ngx_spawn_process</a></li>
<li><a href="#L547">ngx_unlock_mutexes</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Copyright (C) Igor Sysoev<br/></li>
<li></span><span class="Comment"> * Copyright (C) Nginx, Inc.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;ngx_config.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_core.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_event.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;<a href="#L34" title="os/unix/ngx_process.c:34">ngx_channel</a>.h&gt;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct</span> {<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp;&nbsp; signo;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp;&nbsp; *signame;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp;&nbsp; *name;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span>&nbsp; (*handler)(<span class="Type">int</span> signo);<br/></li>
<li><a id="L19">&#x200c;</a>} <span class="linkable">ngx_signal_t</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L269" title="os/unix/ngx_process.c:269">ngx_execute_proc</a>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle, <span class="Type">void</span> *data);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L310" title="os/unix/ngx_process.c:310">ngx_signal_handler</a>(<span class="Type">int</span> signo);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L453" title="os/unix/ngx_process.c:453">ngx_process_get_status</a>(<span class="Type">void</span>);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L547" title="os/unix/ngx_process.c:547">ngx_unlock_mutexes</a>(<a href="ngx_process.h.html#L16" title="os/unix/ngx_process.h:16">ngx_pid_t</a> pid);<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L29">&#x200c;</a><span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">ngx_argc</span>;<br/></li>
<li><a id="L30">&#x200c;</a><span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; **<span class="linkable">ngx_argv</span>;<br/></li>
<li><a id="L31">&#x200c;</a><span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; **<span class="linkable">ngx_os_argv</span>;<br/></li>
<li><br/></li>
<li><a id="L33">&#x200c;</a><a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">ngx_process_slot</span>;<br/></li>
<li><a id="L34">&#x200c;</a><a href="ngx_socket.h.html#L17" title="os/unix/ngx_socket.h:17">ngx_socket_t</a>&nbsp; &nbsp;&nbsp; <span class="linkable">ngx_channel</span>;<br/></li>
<li><a id="L35">&#x200c;</a><a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; <span class="linkable">ngx_last_process</span>;<br/></li>
<li><a id="L36">&#x200c;</a><a href="ngx_process.h.html#L36" title="os/unix/ngx_process.h:36">ngx_process_t</a>&nbsp; &nbsp; <span class="linkable">ngx_processes</span>[<a href="ngx_process.h.html#L47" title="os/unix/ngx_process.h:47">NGX_MAX_PROCESSES</a>];<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L39">&#x200c;</a><a href="#L19" title="os/unix/ngx_process.c:19">ngx_signal_t</a>&nbsp; <span class="linkable">signals</span>[] = {<br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L63" title="core/ngx_config.h:63">NGX_RECONFIGURE_SIGNAL</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;SIG&quot;</span> <a href="../../core/ngx_string.h.html#L231" title="core/ngx_string.h:231">ngx_value</a>(<a href="../../core/ngx_config.h.html#L63" title="core/ngx_config.h:63">NGX_RECONFIGURE_SIGNAL</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;reload&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L310" title="os/unix/ngx_process.c:310">ngx_signal_handler</a> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L66" title="core/ngx_config.h:66">NGX_REOPEN_SIGNAL</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;SIG&quot;</span> <a href="../../core/ngx_string.h.html#L231" title="core/ngx_string.h:231">ngx_value</a>(<a href="../../core/ngx_config.h.html#L66" title="core/ngx_config.h:66">NGX_REOPEN_SIGNAL</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;reopen&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L310" title="os/unix/ngx_process.c:310">ngx_signal_handler</a> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L62" title="core/ngx_config.h:62">NGX_NOACCEPT_SIGNAL</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;SIG&quot;</span> <a href="../../core/ngx_string.h.html#L231" title="core/ngx_string.h:231">ngx_value</a>(<a href="../../core/ngx_config.h.html#L62" title="core/ngx_config.h:62">NGX_NOACCEPT_SIGNAL</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L310" title="os/unix/ngx_process.c:310">ngx_signal_handler</a> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L61" title="core/ngx_config.h:61">NGX_TERMINATE_SIGNAL</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;SIG&quot;</span> <a href="../../core/ngx_string.h.html#L231" title="core/ngx_string.h:231">ngx_value</a>(<a href="../../core/ngx_config.h.html#L61" title="core/ngx_config.h:61">NGX_TERMINATE_SIGNAL</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;stop&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L310" title="os/unix/ngx_process.c:310">ngx_signal_handler</a> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L60" title="core/ngx_config.h:60">NGX_SHUTDOWN_SIGNAL</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;SIG&quot;</span> <a href="../../core/ngx_string.h.html#L231" title="core/ngx_string.h:231">ngx_value</a>(<a href="../../core/ngx_config.h.html#L60" title="core/ngx_config.h:60">NGX_SHUTDOWN_SIGNAL</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;quit&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L310" title="os/unix/ngx_process.c:310">ngx_signal_handler</a> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L67" title="core/ngx_config.h:67">NGX_CHANGEBIN_SIGNAL</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;SIG&quot;</span> <a href="../../core/ngx_string.h.html#L231" title="core/ngx_string.h:231">ngx_value</a>(<a href="../../core/ngx_config.h.html#L67" title="core/ngx_config.h:67">NGX_CHANGEBIN_SIGNAL</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L310" title="os/unix/ngx_process.c:310">ngx_signal_handler</a> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">SIGALRM</span>, <span class="Constant">&quot;SIGALRM&quot;</span>, <span class="Constant">&quot;&quot;</span>, <a href="#L310" title="os/unix/ngx_process.c:310">ngx_signal_handler</a> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">SIGINT</span>, <span class="Constant">&quot;SIGINT&quot;</span>, <span class="Constant">&quot;&quot;</span>, <a href="#L310" title="os/unix/ngx_process.c:310">ngx_signal_handler</a> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { SIGIO, <span class="Constant">&quot;SIGIO&quot;</span>, <span class="Constant">&quot;&quot;</span>, <a href="#L310" title="os/unix/ngx_process.c:310">ngx_signal_handler</a> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">SIGCHLD</span>, <span class="Constant">&quot;SIGCHLD&quot;</span>, <span class="Constant">&quot;&quot;</span>, <a href="#L310" title="os/unix/ngx_process.c:310">ngx_signal_handler</a> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { SIGSYS, <span class="Constant">&quot;SIGSYS, SIG_IGN&quot;</span>, <span class="Constant">&quot;&quot;</span>, <span class="Constant">SIG_IGN</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">SIGPIPE</span>, <span class="Constant">&quot;SIGPIPE, SIG_IGN&quot;</span>, <span class="Constant">&quot;&quot;</span>, <span class="Constant">SIG_IGN</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">0</span>, <span class="Constant">NULL</span>, <span class="Constant">&quot;&quot;</span>, <span class="Constant">NULL</span> }<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_process.h.html#L16" title="os/unix/ngx_process.h:16">ngx_pid_t</a><br/></li>
<li><a id="L87">&#x200c;</a><span class="linkable">ngx_spawn_process</span>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle, <a href="ngx_process.h.html#L20" title="os/unix/ngx_process.h:20">ngx_spawn_proc_pt</a> proc, <span class="Type">void</span> *data,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span> *name, <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> respawn)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_long&nbsp; &nbsp;&nbsp; on;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_process.h.html#L16" title="os/unix/ngx_process.h:16">ngx_pid_t</a>&nbsp; pid;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; s;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (respawn &gt;= <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s = respawn;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (s = <span class="Constant">0</span>; s &lt; <a href="#L35" title="os/unix/ngx_process.c:35">ngx_last_process</a>; s++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].pid == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s == <a href="ngx_process.h.html#L47" title="os/unix/ngx_process.h:47">NGX_MAX_PROCESSES</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;no more than </span><span class="Special">%d</span><span class="Constant"> processes can be spawned&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_process.h.html#L47" title="os/unix/ngx_process.h:47">NGX_MAX_PROCESSES</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_process.h.html#L18" title="os/unix/ngx_process.h:18">NGX_INVALID_PID</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (respawn != <a href="ngx_process.h.html#L53" title="os/unix/ngx_process.h:53">NGX_PROCESS_DETACHED</a>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* Solaris 9 still has no AF_LOCAL */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (socketpair(AF_UNIX, SOCK_STREAM, <span class="Constant">0</span>, <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel) == -<span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <a href="ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;socketpair() failed while spawning </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_process.h.html#L18" title="os/unix/ngx_process.h:18">NGX_INVALID_PID</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../../core/ngx_log.h.html#L26" title="core/ngx_log.h:26">NGX_LOG_DEBUG_CORE</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;channel </span><span class="Special">%d</span><span class="Constant">:</span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel[<span class="Constant">0</span>],<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel[<span class="Constant">1</span>]);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_socket.c.html#L27" title="os/unix/ngx_socket.c:27">ngx_nonblocking</a>(<a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel[<span class="Constant">0</span>]) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <a href="ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_socket.h.html#L28" title="os/unix/ngx_socket.h:28">ngx_nonblocking_n</a> <span class="Constant">&quot; failed while spawning </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_channel.c.html#L244" title="os/unix/ngx_channel.c:244">ngx_close_channel</a>(<a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel, cycle-&gt;log);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_process.h.html#L18" title="os/unix/ngx_process.h:18">NGX_INVALID_PID</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_socket.c.html#L27" title="os/unix/ngx_socket.c:27">ngx_nonblocking</a>(<a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel[<span class="Constant">1</span>]) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <a href="ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_socket.h.html#L28" title="os/unix/ngx_socket.h:28">ngx_nonblocking_n</a> <span class="Constant">&quot; failed while spawning </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_channel.c.html#L244" title="os/unix/ngx_channel.c:244">ngx_close_channel</a>(<a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel, cycle-&gt;log);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_process.h.html#L18" title="os/unix/ngx_process.h:18">NGX_INVALID_PID</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; on = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ioctl(<a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel[<span class="Constant">0</span>], FIOASYNC, &amp;on) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <a href="ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;ioctl(FIOASYNC) failed while spawning </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_channel.c.html#L244" title="os/unix/ngx_channel.c:244">ngx_close_channel</a>(<a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel, cycle-&gt;log);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_process.h.html#L18" title="os/unix/ngx_process.h:18">NGX_INVALID_PID</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (fcntl(<a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel[<span class="Constant">0</span>], F_SETOWN, <a href="ngx_process_cycle.c.html#L36" title="os/unix/ngx_process_cycle.c:36">ngx_pid</a>) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <a href="ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;fcntl(F_SETOWN) failed while spawning </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_channel.c.html#L244" title="os/unix/ngx_channel.c:244">ngx_close_channel</a>(<a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel, cycle-&gt;log);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_process.h.html#L18" title="os/unix/ngx_process.h:18">NGX_INVALID_PID</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (fcntl(<a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel[<span class="Constant">0</span>], F_SETFD, FD_CLOEXEC) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <a href="ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;fcntl(FD_CLOEXEC) failed while spawning </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_channel.c.html#L244" title="os/unix/ngx_channel.c:244">ngx_close_channel</a>(<a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel, cycle-&gt;log);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_process.h.html#L18" title="os/unix/ngx_process.h:18">NGX_INVALID_PID</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (fcntl(<a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel[<span class="Constant">1</span>], F_SETFD, FD_CLOEXEC) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <a href="ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;fcntl(FD_CLOEXEC) failed while spawning </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_channel.c.html#L244" title="os/unix/ngx_channel.c:244">ngx_close_channel</a>(<a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel, cycle-&gt;log);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_process.h.html#L18" title="os/unix/ngx_process.h:18">NGX_INVALID_PID</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L34" title="os/unix/ngx_process.c:34">ngx_channel</a> = <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel[<span class="Constant">1</span>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel[<span class="Constant">0</span>] = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel[<span class="Constant">1</span>] = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L33" title="os/unix/ngx_process.c:33">ngx_process_slot</a> = s;<br/></li>
<li><br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; pid = fork();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (pid) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> -<span class="Constant">1</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <a href="ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;fork() failed while spawning </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_channel.c.html#L244" title="os/unix/ngx_channel.c:244">ngx_close_channel</a>(<a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].channel, cycle-&gt;log);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_process.h.html#L18" title="os/unix/ngx_process.h:18">NGX_INVALID_PID</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">0</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_process_cycle.c.html#L36" title="os/unix/ngx_process_cycle.c:36">ngx_pid</a> = <a href="ngx_process.h.html#L56" title="os/unix/ngx_process.h:56">ngx_getpid</a>();<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; proc(cycle, data);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L22" title="core/ngx_log.h:22">NGX_LOG_NOTICE</a>, cycle-&gt;log, <span class="Constant">0</span>, <span class="Constant">&quot;start </span><span class="Special">%s</span><span class="Constant"> %P&quot;</span>, name, pid);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].pid = pid;<br/></li>
<li>&nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].exited = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (respawn &gt;= <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> pid;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].proc = proc;<br/></li>
<li>&nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].data = data;<br/></li>
<li>&nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].name = name;<br/></li>
<li>&nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].exiting = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (respawn) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_process.h.html#L49" title="os/unix/ngx_process.h:49">NGX_PROCESS_NORESPAWN</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].respawn = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].just_spawn = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].detached = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_process.h.html#L50" title="os/unix/ngx_process.h:50">NGX_PROCESS_JUST_SPAWN</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].respawn = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].just_spawn = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].detached = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_process.h.html#L51" title="os/unix/ngx_process.h:51">NGX_PROCESS_RESPAWN</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].respawn = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].just_spawn = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].detached = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_process.h.html#L52" title="os/unix/ngx_process.h:52">NGX_PROCESS_JUST_RESPAWN</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].respawn = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].just_spawn = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].detached = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_process.h.html#L53" title="os/unix/ngx_process.h:53">NGX_PROCESS_DETACHED</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].respawn = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].just_spawn = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[s].detached = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (s == <a href="#L35" title="os/unix/ngx_process.c:35">ngx_last_process</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L35" title="os/unix/ngx_process.c:35">ngx_last_process</a>++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> pid;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_process.h.html#L16" title="os/unix/ngx_process.h:16">ngx_pid_t</a><br/></li>
<li><a id="L261">&#x200c;</a><span class="linkable">ngx_execute</span>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle, <a href="ngx_process.h.html#L44" title="os/unix/ngx_process.h:44">ngx_exec_ctx_t</a> *ctx)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L87" title="os/unix/ngx_process.c:87">ngx_spawn_process</a>(cycle, <a href="#L269" title="os/unix/ngx_process.c:269">ngx_execute_proc</a>, ctx, ctx-&gt;name,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="ngx_process.h.html#L53" title="os/unix/ngx_process.h:53">NGX_PROCESS_DETACHED</a>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L269">&#x200c;</a></span><span class="linkable">ngx_execute_proc</span>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle, <span class="Type">void</span> *data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_process.h.html#L44" title="os/unix/ngx_process.h:44">ngx_exec_ctx_t</a>&nbsp; *ctx = data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (execve(ctx-&gt;path, ctx-&gt;argv, ctx-&gt;envp) == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <a href="ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;execve() failed while executing </span><span class="Special">%s</span><span class="Constant"> </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx-&gt;name, ctx-&gt;path);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; exit(<span class="Constant">1</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L284">&#x200c;</a><span class="linkable">ngx_init_signals</span>(<a href="../../core/ngx_core.h.html#L17" title="core/ngx_core.h:17">ngx_log_t</a> *log)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L19" title="os/unix/ngx_process.c:19">ngx_signal_t</a>&nbsp; &nbsp; &nbsp; *sig;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sigaction&nbsp;&nbsp; sa;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (sig = <a href="#L39" title="os/unix/ngx_process.c:39">signals</a>; sig-&gt;signo != <span class="Constant">0</span>; sig++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_string.h.html#L86" title="core/ngx_string.h:86">ngx_memzero</a>(&amp;sa, <span class="Statement">sizeof</span>(<span class="Type">struct</span> sigaction));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sa.sa_handler = sig-&gt;handler;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sigemptyset(&amp;sa.sa_mask);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sigaction(sig-&gt;signo, &amp;sa, <span class="Constant">NULL</span>) == -<span class="Constant">1</span>) {<br/></li>
<li><span class="PreProc">#if (NGX_VALGRIND)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, log, <a href="ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;sigaction(</span><span class="Special">%s</span><span class="Constant">) failed, ignored&quot;</span>, sig-&gt;signame);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L17" title="core/ngx_log.h:17">NGX_LOG_EMERG</a>, log, <a href="ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;sigaction(</span><span class="Special">%s</span><span class="Constant">) failed&quot;</span>, sig-&gt;signame);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L310">&#x200c;</a></span><span class="linkable">ngx_signal_handler</span>(<span class="Type">int</span> signo)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *action;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; ignore;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_errno.h.html#L16" title="os/unix/ngx_errno.h:16">ngx_err_t</a>&nbsp; &nbsp; &nbsp; &nbsp; err;<br/></li>
<li>&nbsp; &nbsp; <a href="#L19" title="os/unix/ngx_process.c:19">ngx_signal_t</a>&nbsp; &nbsp; *sig;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ignore = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; err = <a href="ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (sig = <a href="#L39" title="os/unix/ngx_process.c:39">signals</a>; sig-&gt;signo != <span class="Constant">0</span>; sig++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sig-&gt;signo == signo) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_times.c.html#L195" title="core/ngx_times.c:195">ngx_time_sigsafe_update</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; action = <span class="Constant">&quot;&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (<a href="ngx_process_cycle.c.html#L35" title="os/unix/ngx_process_cycle.c:35">ngx_process</a>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_process_cycle.h.html#L24" title="os/unix/ngx_process_cycle.h:24">NGX_PROCESS_MASTER</a>:<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_process_cycle.h.html#L23" title="os/unix/ngx_process_cycle.h:23">NGX_PROCESS_SINGLE</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (signo) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L60" title="core/ngx_config.h:60">NGX_SHUTDOWN_SIGNAL</a>):<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_process_cycle.c.html#L43" title="os/unix/ngx_process_cycle.c:43">ngx_quit</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action = <span class="Constant">&quot;, shutting down&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L61" title="core/ngx_config.h:61">NGX_TERMINATE_SIGNAL</a>):<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">SIGINT</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_process_cycle.c.html#L42" title="os/unix/ngx_process_cycle.c:42">ngx_terminate</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action = <span class="Constant">&quot;, exiting&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L62" title="core/ngx_config.h:62">NGX_NOACCEPT_SIGNAL</a>):<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_process_cycle.c.html#L52" title="os/unix/ngx_process_cycle.c:52">ngx_daemonized</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_process_cycle.c.html#L54" title="os/unix/ngx_process_cycle.c:54">ngx_noaccept</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action = <span class="Constant">&quot;, stop accepting connections&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L63" title="core/ngx_config.h:63">NGX_RECONFIGURE_SIGNAL</a>):<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_process_cycle.c.html#L46" title="os/unix/ngx_process_cycle.c:46">ngx_reconfigure</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action = <span class="Constant">&quot;, reconfiguring&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L66" title="core/ngx_config.h:66">NGX_REOPEN_SIGNAL</a>):<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_process_cycle.c.html#L47" title="os/unix/ngx_process_cycle.c:47">ngx_reopen</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action = <span class="Constant">&quot;, reopening logs&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L67" title="core/ngx_config.h:67">NGX_CHANGEBIN_SIGNAL</a>):<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (getppid() &gt; <span class="Constant">1</span> || <a href="ngx_process_cycle.c.html#L50" title="os/unix/ngx_process_cycle.c:50">ngx_new_binary</a> &gt; <span class="Constant">0</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Ignore the signal in the new binary if its parent is<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * not the init process, i.e. the old binary's process<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * is still running.&nbsp; Or ignore the signal in the old binary's<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * process if the new binary's process is already running.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action = <span class="Constant">&quot;, ignoring&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ignore = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_process_cycle.c.html#L49" title="os/unix/ngx_process_cycle.c:49">ngx_change_binary</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action = <span class="Constant">&quot;, changing binary&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">SIGALRM</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_process_cycle.c.html#L41" title="os/unix/ngx_process_cycle.c:41">ngx_sigalrm</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> SIGIO:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_process_cycle.c.html#L40" title="os/unix/ngx_process_cycle.c:40">ngx_sigio</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">SIGCHLD</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_process_cycle.c.html#L39" title="os/unix/ngx_process_cycle.c:39">ngx_reap</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_process_cycle.h.html#L26" title="os/unix/ngx_process_cycle.h:26">NGX_PROCESS_WORKER</a>:<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="ngx_process_cycle.h.html#L27" title="os/unix/ngx_process_cycle.h:27">NGX_PROCESS_HELPER</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (signo) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L62" title="core/ngx_config.h:62">NGX_NOACCEPT_SIGNAL</a>):<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="ngx_process_cycle.c.html#L52" title="os/unix/ngx_process_cycle.c:52">ngx_daemonized</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_process_cycle.c.html#L44" title="os/unix/ngx_process_cycle.c:44">ngx_debug_quit</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L60" title="core/ngx_config.h:60">NGX_SHUTDOWN_SIGNAL</a>):<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_process_cycle.c.html#L43" title="os/unix/ngx_process_cycle.c:43">ngx_quit</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action = <span class="Constant">&quot;, shutting down&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L61" title="core/ngx_config.h:61">NGX_TERMINATE_SIGNAL</a>):<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">SIGINT</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_process_cycle.c.html#L42" title="os/unix/ngx_process_cycle.c:42">ngx_terminate</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action = <span class="Constant">&quot;, exiting&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L66" title="core/ngx_config.h:66">NGX_REOPEN_SIGNAL</a>):<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_process_cycle.c.html#L47" title="os/unix/ngx_process_cycle.c:47">ngx_reopen</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action = <span class="Constant">&quot;, reopening logs&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L63" title="core/ngx_config.h:63">NGX_RECONFIGURE_SIGNAL</a>):<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <a href="../../core/ngx_config.h.html#L55" title="core/ngx_config.h:55">ngx_signal_value</a>(<a href="../../core/ngx_config.h.html#L67" title="core/ngx_config.h:67">NGX_CHANGEBIN_SIGNAL</a>):<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> SIGIO:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action = <span class="Constant">&quot;, ignoring&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L22" title="core/ngx_log.h:22">NGX_LOG_NOTICE</a>, <a href="../../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;signal </span><span class="Special">%d</span><span class="Constant"> (</span><span class="Special">%s</span><span class="Constant">) received</span><span class="Special">%s</span><span class="Constant">&quot;</span>, signo, sig-&gt;signame, action);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ignore) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L19" title="core/ngx_log.h:19">NGX_LOG_CRIT</a>, <a href="../../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;the changing binary signal is ignored: &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;you should shutdown or terminate &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;before either old or new binary's process&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (signo == <span class="Constant">SIGCHLD</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L453" title="os/unix/ngx_process.c:453">ngx_process_get_status</a>();<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_errno.h.html#L70" title="os/unix/ngx_errno.h:70">ngx_set_errno</a>(err);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L453">&#x200c;</a></span><span class="linkable">ngx_process_get_status</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *process;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_process.h.html#L16" title="os/unix/ngx_process.h:16">ngx_pid_t</a>&nbsp; &nbsp; &nbsp; &nbsp; pid;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_errno.h.html#L16" title="os/unix/ngx_errno.h:16">ngx_err_t</a>&nbsp; &nbsp; &nbsp; &nbsp; err;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp;&nbsp; one;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; one = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> ( ;; ) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pid = waitpid(-<span class="Constant">1</span>, &amp;status, WNOHANG);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (pid == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (pid == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; err = <a href="ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (err == <a href="ngx_errno.h.html#L22" title="os/unix/ngx_errno.h:22">NGX_EINTR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (err == <a href="ngx_errno.h.html#L23" title="os/unix/ngx_errno.h:23">NGX_ECHILD</a> &amp;&amp; one) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Solaris always calls the signal handler for each exited process<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * despite waitpid() may be already called for this process.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * When several processes exit at the same time FreeBSD may<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * erroneously call the signal handler for exited process<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * despite waitpid() may be already called for this process.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (err == <a href="ngx_errno.h.html#L23" title="os/unix/ngx_errno.h:23">NGX_ECHILD</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L23" title="core/ngx_log.h:23">NGX_LOG_INFO</a>, <a href="../../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;log, err,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;waitpid() failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, <a href="../../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;log, err,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;waitpid() failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; one = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; process = <span class="Constant">&quot;unknown process&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; <a href="#L35" title="os/unix/ngx_process.c:35">ngx_last_process</a>; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[i].pid == pid) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[i].status = status;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[i].exited = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; process = <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[i].name;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (WTERMSIG(status)) {<br/></li>
<li><span class="PreProc">#ifdef WCOREDUMP<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, <a href="../../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> %P exited on signal </span><span class="Special">%d%s</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; process, pid, WTERMSIG(status),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WCOREDUMP(status) ? <span class="Constant">&quot; (core dumped)&quot;</span> : <span class="Constant">&quot;&quot;</span>);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, <a href="../../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> %P exited on signal </span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; process, pid, WTERMSIG(status));<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L22" title="core/ngx_log.h:22">NGX_LOG_NOTICE</a>, <a href="../../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> %P exited with code </span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; process, pid, WEXITSTATUS(status));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (WEXITSTATUS(status) == <span class="Constant">2</span> &amp;&amp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[i].respawn) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, <a href="../../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> %P exited with fatal code </span><span class="Special">%d</span><span class="Constant"> &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;and cannot be respawned&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; process, pid, WEXITSTATUS(status));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L36" title="os/unix/ngx_process.c:36">ngx_processes</a>[i].respawn = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L547" title="os/unix/ngx_process.c:547">ngx_unlock_mutexes</a>(pid);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L547">&#x200c;</a></span><span class="linkable">ngx_unlock_mutexes</span>(<a href="ngx_process.h.html#L16" title="os/unix/ngx_process.h:16">ngx_pid_t</a> pid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_cycle.h.html#L25" title="core/ngx_cycle.h:25">ngx_shm_zone_t</a>&nbsp;&nbsp; *shm_zone;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_list.h.html#L16" title="core/ngx_list.h:16">ngx_list_part_t</a>&nbsp; *part;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_slab.h.html#L47" title="core/ngx_slab.h:47">ngx_slab_pool_t</a>&nbsp; *sp;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * unlock the accept mutex if the abnormally exited process<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * held it<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../../event/ngx_event.c.html#L52" title="event/ngx_event.c:52">ngx_accept_mutex_ptr</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">void</span>) <a href="../../core/ngx_shmtx.c.html#L149" title="core/ngx_shmtx.c:149">ngx_shmtx_force_unlock</a>(&amp;<a href="../../event/ngx_event.c.html#L53" title="event/ngx_event.c:53">ngx_accept_mutex</a>, pid);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * unlock shared memory mutexes if held by the abnormally exited<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * process<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; part = (<a href="../../core/ngx_list.h.html#L16" title="core/ngx_list.h:16">ngx_list_part_t</a> *) &amp;<a href="../../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;shared_memory.part;<br/></li>
<li>&nbsp; &nbsp; shm_zone = part-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; <span class="Comment">/* void */</span> ; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i &gt;= part-&gt;nelts) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (part-&gt;next == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; part = part-&gt;next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; shm_zone = part-&gt;elts;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sp = (<a href="../../core/ngx_slab.h.html#L47" title="core/ngx_slab.h:47">ngx_slab_pool_t</a> *) shm_zone[i].shm.addr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../../core/ngx_shmtx.c.html#L149" title="core/ngx_shmtx.c:149">ngx_shmtx_force_unlock</a>(&amp;sp-&gt;mutex, pid)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, <a href="../../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;shared memory zone </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant"> was locked by %P&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;shm_zone[i].shm.name, pid);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L594">&#x200c;</a></span><span class="linkable">ngx_debug_point</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_cycle.h.html#L111" title="core/ngx_cycle.h:111">ngx_core_conf_t</a>&nbsp; *ccf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf = (<a href="../../core/ngx_cycle.h.html#L111" title="core/ngx_cycle.h:111">ngx_core_conf_t</a> *) <a href="../../core/ngx_conf_file.h.html#L217" title="core/ngx_conf_file.h:217">ngx_get_conf</a>(<a href="../../core/ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;conf_ctx,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../../core/nginx.c.html#L171" title="core/nginx.c:171">ngx_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (ccf-&gt;debug_points) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="../../core/ngx_cycle.h.html#L21" title="core/ngx_cycle.h:21">NGX_DEBUG_POINTS_STOP</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; raise(<span class="Constant">SIGSTOP</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> <a href="../../core/ngx_cycle.h.html#L22" title="core/ngx_cycle.h:22">NGX_DEBUG_POINTS_ABORT</a>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L102" title="core/ngx_config.h:102">ngx_abort</a>();<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L614">&#x200c;</a><span class="linkable">ngx_os_signal_process</span>(<a href="../../core/ngx_core.h.html#L14" title="core/ngx_core.h:14">ngx_cycle_t</a> *cycle, <span class="Type">char</span> *name, <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> pid)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L19" title="os/unix/ngx_process.c:19">ngx_signal_t</a>&nbsp; *sig;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (sig = <a href="#L39" title="os/unix/ngx_process.c:39">signals</a>; sig-&gt;signo != <span class="Constant">0</span>; sig++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../../core/ngx_string.h.html#L57" title="core/ngx_string.h:57">ngx_strcmp</a>(name, sig-&gt;name) == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (kill(pid, sig-&gt;signo) != -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="../../core/ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <a href="ngx_errno.h.html#L68" title="os/unix/ngx_errno.h:68">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;kill(%P, </span><span class="Special">%d</span><span class="Constant">) failed&quot;</span>, pid, sig-&gt;signo);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
</ol></code>
 </body>
</html>

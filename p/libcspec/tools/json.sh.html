<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>tools/json.sh - libcspec_book</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>tools/json.sh - libcspec_book</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L50">awk_egrep</a></li>
<li><a href="#L176">parse</a></li>
<li><a href="#L93">parse_array</a></li>
<li><a href="#L119">parse_object</a></li>
<li><a href="#L23">parse_options</a></li>
<li><a href="#L154">parse_value</a></li>
<li><a href="#L3">throw</a></li>
<li><a href="#L63">tokenize</a></li>
<li><a href="#L12">usage</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><span class="Comment">#!/bin/sh<br/></li>
<li></span><br/></li>
<li><a id="L3">&#x200c;</a><span class="Identifier"><span class="linkable">throw</span> () {<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="PreProc">$*</span><span class="Statement">&quot;</span><span class="Constant"> </span><span class="Statement">&gt;&amp;2<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">exit</span><span class="shFunctionOne"> </span><span class="Constant">1<br/></li>
<li></span><span class="Identifier">}<br/></li>
<li></span><br/></li>
<li><span class="Identifier">BRIEF</span><span class="shSetIdentifier">=</span><span class="Constant">0<br/></li>
<li></span><span class="Identifier">LEAFONLY</span><span class="shSetIdentifier">=</span><span class="Constant">0<br/></li>
<li></span><span class="Identifier">PRUNE</span><span class="shSetIdentifier">=</span><span class="Constant">0<br/></li>
<li></span><br/></li>
<li><a id="L12">&#x200c;</a><span class="Identifier"><span class="linkable">usage</span>() {<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">echo<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">Usage: </span><span class="PreProc">$0</span><span class="Constant"> [-b] [-l] [-p] [-h]</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">echo<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">-p - Prune empty. Exclude fields with empty values.</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">-l - Leaf only. Only show leaf nodes, which stops data duplication.</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">-b - Brief. Combines 'Leaf only' and 'Prune empty' options.</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">-h - This help text.</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">echo<br/></li>
<li></span><span class="Identifier">}<br/></li>
<li></span><br/></li>
<li><a id="L23">&#x200c;</a><span class="Identifier"><span class="linkable">parse_options</span>() {<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">set</span><span class="Identifier"> -- </span><span class="Statement">&quot;</span><span class="PreProc">$@</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionOne">&nbsp; local </span><span class="Identifier">ARGN</span><span class="shSetIdentifier">=</span><span class="PreProc">$#<br/></li>
<li></span><span class="shFunctionOne">&nbsp; while </span><span class="Statement">[</span><span class="shExpr"> </span><span class="PreProc">$ARGN</span><span class="shExpr"> </span><span class="Statement">-ne</span><span class="shExpr"> </span><span class="Constant">0</span><span class="shExpr"> </span><span class="Statement">]<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">do<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="PreProc">$1</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; -h</span><span class="Statement">)</span><span class="shCase"> <a href="#L12" title="tools/json.sh:12">usage</a><br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">exit</span><span class="shCase"> </span><span class="Constant">0<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; -b</span><span class="Statement">)</span><span class="shCase"> </span><span class="Identifier">BRIEF</span><span class="shSetIdentifier">=</span><span class="Constant">1<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">LEAFONLY</span><span class="shSetIdentifier">=</span><span class="Constant">1<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">PRUNE</span><span class="shSetIdentifier">=</span><span class="Constant">1<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; -l</span><span class="Statement">)</span><span class="shCase"> </span><span class="Identifier">LEAFONLY</span><span class="shSetIdentifier">=</span><span class="Constant">1<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; -p</span><span class="Statement">)</span><span class="shCase"> </span><span class="Identifier">PRUNE</span><span class="shSetIdentifier">=</span><span class="Constant">1<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; ?*</span><span class="Statement">)</span><span class="shCase"> </span><span class="Statement">echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">ERROR: Unknown option.</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L12" title="tools/json.sh:12">usage</a><br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">exit</span><span class="shCase"> </span><span class="Constant">0<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Statement">shift</span><span class="shFunctionOne"> </span><span class="Constant">1<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Identifier">ARGN</span><span class="shSetIdentifier">=</span><span class="Error">$(</span><span class="Statement">(</span><span class="Special">ARGN</span><span class="Constant">-1</span><span class="Statement">)</span><span class="Error">)<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">done<br/></li>
<li></span><span class="Identifier">}<br/></li>
<li></span><br/></li>
<li><a id="L50">&#x200c;</a><span class="Identifier"><span class="linkable">awk_egrep</span> () {<br/></li>
<li></span><span class="shFunctionOne">&nbsp; local </span><span class="Identifier">pattern_string</span><span class="shSetIdentifier">=</span><span class="PreProc">$1<br/></li>
<li></span><br/></li>
<li><span class="shFunctionOne">&nbsp; awk </span><span class="Statement">'</span><span class="Constant">{<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; while ($0) {<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; start=match($0, pattern);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; token=substr($0, start, RLENGTH);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; print token;<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; &nbsp; $0=substr($0, start+RLENGTH);<br/></li>
<li></span><span class="Constant">&nbsp; &nbsp; }<br/></li>
<li></span><span class="Constant">&nbsp; }</span><span class="Statement">'</span><span class="shFunctionOne"> </span><span class="Identifier">pattern</span><span class="shSetIdentifier">=</span><span class="PreProc">$pattern_string<br/></li>
<li></span><span class="Identifier">}<br/></li>
<li></span><br/></li>
<li><a id="L63">&#x200c;</a><span class="Identifier"><span class="linkable">tokenize</span> () {<br/></li>
<li></span><span class="shFunctionOne">&nbsp; local GREP<br/></li>
<li></span><span class="shFunctionOne">&nbsp; local ESCAPE<br/></li>
<li></span><span class="shFunctionOne">&nbsp; local CHAR<br/></li>
<li></span><br/></li>
<li><span class="shFunctionOne">&nbsp; </span><span class="Statement">if echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">test string</span><span class="Statement">&quot;</span><span class="Constant"> </span><span class="Statement">|</span><span class="shFunctionOne"> egrep -ao --</span><span class="Identifier">color</span><span class="shSetIdentifier">=</span><span class="shFunctionOne">never </span><span class="Statement">&quot;</span><span class="Constant">test</span><span class="Statement">&quot;</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&gt;</span><span class="shFunctionOne">/dev/null<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">then<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Identifier">GREP</span><span class="shSetIdentifier">=</span><span class="Statement">'</span><span class="Constant">egrep -ao --color=never</span><span class="Statement">'<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Identifier">GREP</span><span class="shSetIdentifier">=</span><span class="Statement">'</span><span class="Constant">egrep -ao</span><span class="Statement">'<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">fi<br/></li>
<li></span><br/></li>
<li><span class="shFunctionOne">&nbsp; </span><span class="Statement">if echo</span><span class="Constant"> </span><span class="Statement">&quot;</span><span class="Constant">test string</span><span class="Statement">&quot;</span><span class="Constant"> </span><span class="Statement">|</span><span class="shFunctionOne"> egrep </span><span class="Statement">-o</span><span class="shFunctionOne"> </span><span class="Statement">&quot;</span><span class="Constant">test</span><span class="Statement">&quot;</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&gt;</span><span class="shFunctionOne">/dev/null<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">then<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Identifier">ESCAPE</span><span class="shSetIdentifier">=</span><span class="Statement">'</span><span class="Constant">(\\[^u[:cntrl:]]|\\u[0-9a-fA-F]{4})</span><span class="Statement">'<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Identifier">CHAR</span><span class="shSetIdentifier">=</span><span class="Statement">'</span><span class="Constant">[^[:cntrl:]&quot;\\]</span><span class="Statement">'<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">else<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Identifier">GREP</span><span class="shSetIdentifier">=</span><span class="shFunctionOne"><a href="#L50" title="tools/json.sh:50">awk_egrep</a><br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Identifier">ESCAPE</span><span class="shSetIdentifier">=</span><span class="Statement">'</span><span class="Constant">(\\\\[^u[:cntrl:]]|\\u[0-9a-fA-F]{4})</span><span class="Statement">'<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Identifier">CHAR</span><span class="shSetIdentifier">=</span><span class="Statement">'</span><span class="Constant">[^[:cntrl:]&quot;\\\\]</span><span class="Statement">'<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">fi<br/></li>
<li></span><br/></li>
<li><span class="shFunctionOne">&nbsp; local </span><span class="Identifier">STRING</span><span class="shSetIdentifier">=</span><span class="Statement">&quot;</span><span class="Special">\&quot;</span><span class="PreProc">$CHAR</span><span class="Constant">*(</span><span class="PreProc">$ESCAPE$CHAR</span><span class="Constant">*)*</span><span class="Special">\&quot;</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionOne">&nbsp; local </span><span class="Identifier">NUMBER</span><span class="shSetIdentifier">=</span><span class="Statement">'</span><span class="Constant">-?(0|[1-9][0-9]*)([.][0-9]*)?([eE][+-]?[0-9]*)?</span><span class="Statement">'<br/></li>
<li></span><span class="shFunctionOne">&nbsp; local </span><span class="Identifier">KEYWORD</span><span class="shSetIdentifier">=</span><span class="Statement">'</span><span class="Constant">null|false|true</span><span class="Statement">'<br/></li>
<li></span><span class="shFunctionOne">&nbsp; local </span><span class="Identifier">SPACE</span><span class="shSetIdentifier">=</span><span class="Statement">'</span><span class="Constant">[[:space:]]+</span><span class="Statement">'<br/></li>
<li></span><br/></li>
<li><span class="shFunctionOne">&nbsp; </span><span class="PreProc">$GREP</span><span class="shFunctionOne"> </span><span class="Statement">&quot;</span><span class="PreProc">$STRING</span><span class="Constant">|</span><span class="PreProc">$NUMBER</span><span class="Constant">|</span><span class="PreProc">$KEYWORD</span><span class="Constant">|</span><span class="PreProc">$SPACE</span><span class="Constant">|.</span><span class="Statement">&quot;</span><span class="shFunctionOne"> </span><span class="Statement">|</span><span class="shFunctionOne"> egrep </span><span class="Special">-v</span><span class="shFunctionOne"> </span><span class="Statement">&quot;</span><span class="Constant">^</span><span class="PreProc">$SPACE</span><span class="Constant">$</span><span class="Statement">&quot;<br/></li>
<li></span><span class="Identifier">}<br/></li>
<li></span><br/></li>
<li><a id="L93">&#x200c;</a><span class="Identifier"><span class="linkable">parse_array</span> () {<br/></li>
<li></span><span class="shFunctionOne">&nbsp; local </span><span class="Identifier">index</span><span class="shSetIdentifier">=</span><span class="Constant">0<br/></li>
<li></span><span class="shFunctionOne">&nbsp; local </span><span class="Identifier">ary</span><span class="shSetIdentifier">=</span><span class="Statement">''<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">read</span><span class="shFunctionOne"> </span><span class="Special">-r</span><span class="shFunctionOne"> token<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$token</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; </span><span class="Statement">'</span><span class="Constant">]</span><span class="Statement">')</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; *</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; while :<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">do<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L154" title="tools/json.sh:154">parse_value</a> </span><span class="Statement">&quot;</span><span class="PreProc">$1</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$index</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">index</span><span class="shSetIdentifier">=</span><span class="Error">$(</span><span class="Statement">(</span><span class="Special">index+</span><span class="Constant">1</span><span class="Statement">)</span><span class="Error">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">ary</span><span class="shSetIdentifier">=</span><span class="Statement">&quot;</span><span class="PreProc">$ary</span><span class="Statement">&quot;&quot;</span><span class="PreProc">$value</span><span class="Statement">&quot;</span><span class="shCase"><br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">read</span><span class="shCase"> </span><span class="Statement">-r</span><span class="shCase"> token<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$token</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">'</span><span class="Constant">]</span><span class="Statement">')</span><span class="shCase"> </span><span class="Statement">break</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">'</span><span class="Constant">,</span><span class="Statement">')</span><span class="shCase"> </span><span class="Identifier">ary</span><span class="shSetIdentifier">=</span><span class="Statement">&quot;</span><span class="PreProc">$ary</span><span class="Constant">,</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *</span><span class="Statement">)</span><span class="shCase"> <a href="#L3" title="tools/json.sh:3">throw</a> </span><span class="Statement">&quot;</span><span class="Constant">EXPECTED , or ] GOT </span><span class="PreProc">${token</span><span class="Statement">:-</span><span class="Error">EOF</span><span class="PreProc">}</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">read</span><span class="shCase"> </span><span class="Statement">-r</span><span class="shCase"> token<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">done<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$BRIEF</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">-eq</span><span class="shExpr"> </span><span class="Constant">0</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> </span><span class="Identifier">value</span><span class="shSetIdentifier">=</span><span class="Special">`printf </span><span class="Statement">'</span><span class="Constant">[%s]</span><span class="Statement">'</span><span class="Special"> </span><span class="Statement">&quot;</span><span class="PreProc">$ary</span><span class="Statement">&quot;</span><span class="Special">`</span><span class="shFunctionOne"> </span><span class="Statement">||</span><span class="shFunctionOne"> </span><span class="Identifier">value</span><span class="shSetIdentifier">=<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Comment">:<br/></li>
<li></span><span class="Identifier">}<br/></li>
<li></span><br/></li>
<li><a id="L119">&#x200c;</a><span class="Identifier"><span class="linkable">parse_object</span> () {<br/></li>
<li></span><span class="shFunctionOne">&nbsp; local key<br/></li>
<li></span><span class="shFunctionOne">&nbsp; local </span><span class="Identifier">obj</span><span class="shSetIdentifier">=</span><span class="Statement">''<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">read</span><span class="shFunctionOne"> </span><span class="Special">-r</span><span class="shFunctionOne"> token<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$token</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; </span><span class="Statement">'</span><span class="Constant">}</span><span class="Statement">')</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; *</span><span class="Statement">)<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; while :<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">do<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$token</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">'</span><span class="Constant">&quot;</span><span class="Statement">'</span><span class="shCaseEsac">*</span><span class="Statement">'</span><span class="Constant">&quot;</span><span class="Statement">')</span><span class="shCase"> </span><span class="Identifier">key</span><span class="shSetIdentifier">=</span><span class="PreProc">$token</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *</span><span class="Statement">)</span><span class="shCase"> <a href="#L3" title="tools/json.sh:3">throw</a> </span><span class="Statement">&quot;</span><span class="Constant">EXPECTED string GOT </span><span class="PreProc">${token</span><span class="Statement">:-</span><span class="Error">EOF</span><span class="PreProc">}</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">read</span><span class="shCase"> </span><span class="Statement">-r</span><span class="shCase"> token<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$token</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">'</span><span class="Constant">:</span><span class="Statement">')</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *</span><span class="Statement">)</span><span class="shCase"> <a href="#L3" title="tools/json.sh:3">throw</a> </span><span class="Statement">&quot;</span><span class="Constant">EXPECTED : GOT </span><span class="PreProc">${token</span><span class="Statement">:-</span><span class="Error">EOF</span><span class="PreProc">}</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">read</span><span class="shCase"> </span><span class="Statement">-r</span><span class="shCase"> token<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L154" title="tools/json.sh:154">parse_value</a> </span><span class="Statement">&quot;</span><span class="PreProc">$1</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">&quot;</span><span class="PreProc">$key</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Identifier">obj</span><span class="shSetIdentifier">=</span><span class="Statement">&quot;</span><span class="PreProc">$obj$key</span><span class="Constant">:</span><span class="PreProc">$value</span><span class="Statement">&quot;</span><span class="shCase"><br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">read</span><span class="shCase"> </span><span class="Statement">-r</span><span class="shCase"> token<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$token</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">'</span><span class="Constant">}</span><span class="Statement">')</span><span class="shCase"> </span><span class="Statement">break</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">'</span><span class="Constant">,</span><span class="Statement">')</span><span class="shCase"> </span><span class="Identifier">obj</span><span class="shSetIdentifier">=</span><span class="Statement">&quot;</span><span class="PreProc">$obj</span><span class="Constant">,</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *</span><span class="Statement">)</span><span class="shCase"> <a href="#L3" title="tools/json.sh:3">throw</a> </span><span class="Statement">&quot;</span><span class="Constant">EXPECTED , or } GOT </span><span class="PreProc">${token</span><span class="Statement">:-</span><span class="Error">EOF</span><span class="PreProc">}</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">read</span><span class="shCase"> </span><span class="Statement">-r</span><span class="shCase"> token<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp; </span><span class="Statement">done<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$BRIEF</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">-eq</span><span class="shExpr"> </span><span class="Constant">0</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> </span><span class="Identifier">value</span><span class="shSetIdentifier">=</span><span class="Special">`printf </span><span class="Statement">'</span><span class="Constant">{%s}</span><span class="Statement">'</span><span class="Special"> </span><span class="Statement">&quot;</span><span class="PreProc">$obj</span><span class="Statement">&quot;</span><span class="Special">`</span><span class="shFunctionOne"> </span><span class="Statement">||</span><span class="shFunctionOne"> </span><span class="Identifier">value</span><span class="shSetIdentifier">=<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Comment">:<br/></li>
<li></span><span class="Identifier">}<br/></li>
<li></span><br/></li>
<li><a id="L154">&#x200c;</a><span class="Identifier"><span class="linkable">parse_value</span> () {<br/></li>
<li></span><span class="shFunctionOne">&nbsp; local </span><span class="Identifier">jpath</span><span class="shSetIdentifier">=</span><span class="Statement">&quot;</span><span class="PreProc">${1</span><span class="Statement">:+</span><span class="PreProc">$1</span><span class="Error">,</span><span class="PreProc">}$2</span><span class="Statement">&quot;</span><span class="shFunctionOne"> </span><span class="Identifier">isleaf</span><span class="shSetIdentifier">=</span><span class="Constant">0</span><span class="shFunctionOne"> </span><span class="Identifier">isempty</span><span class="shSetIdentifier">=</span><span class="Constant">0</span><span class="shFunctionOne"> </span><span class="Identifier">print</span><span class="shSetIdentifier">=</span><span class="Constant">0<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$token</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; </span><span class="Statement">'</span><span class="Constant">{</span><span class="Statement">')</span><span class="shCase"> <a href="#L119" title="tools/json.sh:119">parse_object</a> </span><span class="Statement">&quot;</span><span class="PreProc">$jpath</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; </span><span class="Statement">'</span><span class="Constant">[</span><span class="Statement">')</span><span class="shCase"> <a href="#L93" title="tools/json.sh:93">parse_array</a>&nbsp; </span><span class="Statement">&quot;</span><span class="PreProc">$jpath</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; </span><span class="Comment"># At this point, the only valid single-character tokens are digits.<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; </span><span class="Statement">''</span><span class="shCaseEsac">|</span><span class="Special">[</span><span class="shCaseRange">!0-9</span><span class="Special">]</span><span class="Statement">)</span><span class="shCase"> <a href="#L3" title="tools/json.sh:3">throw</a> </span><span class="Statement">&quot;</span><span class="Constant">EXPECTED value GOT </span><span class="PreProc">${token</span><span class="Statement">:-</span><span class="Error">EOF</span><span class="PreProc">}</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; *</span><span class="Statement">)</span><span class="shCase"> </span><span class="Identifier">value</span><span class="shSetIdentifier">=</span><span class="PreProc">$token<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Identifier">isleaf</span><span class="shSetIdentifier">=</span><span class="Constant">1<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$value</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">=</span><span class="shExpr"> </span><span class="Constant">'&quot;&quot;'</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shCase"> </span><span class="Statement">&amp;&amp;</span><span class="shCase"> </span><span class="Identifier">isempty</span><span class="shSetIdentifier">=</span><span class="Constant">1<br/></li>
<li></span><span class="shCase">&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$value</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">=</span><span class="shExpr"> </span><span class="Constant">''</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> </span><span class="Statement">return<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$LEAFONLY</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">-eq</span><span class="shExpr"> </span><span class="Constant">0</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$PRUNE</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">-eq</span><span class="shExpr"> </span><span class="Constant">0</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> </span><span class="Identifier">print</span><span class="shSetIdentifier">=</span><span class="Constant">1<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$LEAFONLY</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">-eq</span><span class="shExpr"> </span><span class="Constant">1</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$isleaf</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">-eq</span><span class="shExpr"> </span><span class="Constant">1</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> </span><span class="Statement">[</span><span class="shExpr"> </span><span class="PreProc">$PRUNE</span><span class="shExpr"> </span><span class="Statement">-eq</span><span class="shExpr"> </span><span class="Constant">0</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> </span><span class="Identifier">print</span><span class="shSetIdentifier">=</span><span class="Constant">1<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$LEAFONLY</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">-eq</span><span class="shExpr"> </span><span class="Constant">0</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$PRUNE</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">-eq</span><span class="shExpr"> </span><span class="Constant">1</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$isempty</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">-eq</span><span class="shExpr"> </span><span class="Constant">0</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> </span><span class="Identifier">print</span><span class="shSetIdentifier">=</span><span class="Constant">1<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$LEAFONLY</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">-eq</span><span class="shExpr"> </span><span class="Constant">1</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$isleaf</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">-eq</span><span class="shExpr"> </span><span class="Constant">1</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> \<br/></li>
<li></span><span class="shFunctionOne">&nbsp; &nbsp; </span><span class="Statement">[</span><span class="shExpr"> </span><span class="PreProc">$PRUNE</span><span class="shExpr"> </span><span class="Statement">-eq</span><span class="shExpr"> </span><span class="Constant">1</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> </span><span class="Statement">[</span><span class="shExpr"> </span><span class="PreProc">$isempty</span><span class="shExpr"> </span><span class="Statement">-eq</span><span class="shExpr"> </span><span class="Constant">0</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> </span><span class="Identifier">print</span><span class="shSetIdentifier">=</span><span class="Constant">1<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$print</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">-eq</span><span class="shExpr"> </span><span class="Constant">1</span><span class="shExpr"> </span><span class="Statement">]</span><span class="shFunctionOne"> </span><span class="Statement">&amp;&amp;</span><span class="shFunctionOne"> printf </span><span class="Statement">&quot;</span><span class="Constant">[%s]</span><span class="Special">\t</span><span class="Constant">%s</span><span class="Special">\n</span><span class="Statement">&quot;</span><span class="shFunctionOne"> </span><span class="Statement">&quot;</span><span class="PreProc">$jpath</span><span class="Statement">&quot;</span><span class="shFunctionOne"> </span><span class="Statement">&quot;</span><span class="PreProc">$value</span><span class="Statement">&quot;<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Comment">:<br/></li>
<li></span><span class="Identifier">}<br/></li>
<li></span><br/></li>
<li><a id="L176">&#x200c;</a><span class="Identifier"><span class="linkable">parse</span> () {<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">read</span><span class="shFunctionOne"> </span><span class="Special">-r</span><span class="shFunctionOne"> token<br/></li>
<li></span><span class="shFunctionOne">&nbsp; <a href="#L154" title="tools/json.sh:154">parse_value</a><br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">read</span><span class="shFunctionOne"> </span><span class="Special">-r</span><span class="shFunctionOne"> token<br/></li>
<li></span><span class="shFunctionOne">&nbsp; </span><span class="Statement">case</span><span class="shCaseEsac"> </span><span class="Statement">&quot;</span><span class="PreProc">$token</span><span class="Statement">&quot;</span><span class="shCaseEsac"> </span><span class="Statement">in<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; </span><span class="Statement">'')</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; &nbsp; *</span><span class="Statement">)</span><span class="shCase"> <a href="#L3" title="tools/json.sh:3">throw</a> </span><span class="Statement">&quot;</span><span class="Constant">EXPECTED EOF GOT </span><span class="PreProc">$token</span><span class="Statement">&quot;</span><span class="shCase"> </span><span class="Statement">;;<br/></li>
<li></span><span class="shCaseEsac">&nbsp; </span><span class="Statement">esac<br/></li>
<li></span><span class="Identifier">}<br/></li>
<li></span><br/></li>
<li><span class="Statement">if ([</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$0</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">=</span><span class="shExpr"> </span><span class="Constant">&quot;$BASH_SOURCE&quot;</span><span class="shExpr"> </span><span class="Statement">]</span> <span class="Statement">||</span> <span class="Statement">!</span> <span class="Statement">[</span><span class="shExpr"> </span><span class="Statement">-n</span><span class="shExpr"> </span><span class="Statement">&quot;</span><span class="PreProc">$BASH_SOURCE</span><span class="Statement">&quot;</span><span class="shExpr"> </span><span class="Statement">]);<br/></li>
<li></span><span class="Statement">then<br/></li>
<li></span>&nbsp; <a href="#L23" title="tools/json.sh:23">parse_options</a> <span class="Statement">&quot;</span><span class="PreProc">$@</span><span class="Statement">&quot;<br/></li>
<li></span>&nbsp; <a href="#L63" title="tools/json.sh:63">tokenize</a> <span class="Statement">|</span> <a href="#L176" title="tools/json.sh:176">parse</a><br/></li>
<li><span class="Statement">fi<br/></li>
<li></span><br/></li>
</ol></code>
 </body>
</html>
